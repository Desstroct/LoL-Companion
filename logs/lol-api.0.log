2026-02-21T07:41:25.740Z ERROR Process encountered uncaught exception 
file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1
import e from"events";import t from"https";import a from"http";import i from"net";import s from"tls";import n from"crypto";import r from"stream";import o from"url";import l from"zlib";import c from"buffer";import d,{existsSync as h,readFileSync as u}from"node:fs";import p,{join as m,dirname as f}from"node:path";import{cwd as g}from"node:process";import{randomUUID as y}from"node:crypto";import{exec as w,spawn as v}from"node:child_process";import{readFile as b}from"node:fs/promises";import S from"node:https";import{fileURLToPath as _}from"node:url";class k{events=new Map;addListener(e,t){return this.add(e,t,e=>e.push({listener:t}))}disposableOn(e,t){return this.add(e,t,e=>e.push({listener:t})),function(e){let t=!1;const a=()=>{t||(e(),t=!0)};return{[Symbol.dispose]:a,dispose:a}}(()=>this.removeListener(e,t))}emit(e,...t){const a=this.events.get(e);if(void 0===a)return!1;for(let i=0;i<a.length;){const{listener:s,once:n}=a[i];n?this.remove(e,a,i):i++,s(...t)}return!0}eventNames(){return Array.from(this.events.keys())}listenerCount(e,t){const a=this.events.get(e);if(void 0===a||null==t)return a?.length||0;let i=0;return a.forEach(e=>{e.listener===t&&i++}),i}listeners(e){return Array.from(this.events.get(e)||[]).map(({listener:e})=>e)}off(e,t){const a=this.events.get(e)??[];for(let i=a.length-1;i>=0;i--)a[i].listener===t&&this.remove(e,a,i);return this}on(e,t){return this.add(e,t,e=>e.push({listener:t}))}once(e,t){return this.add(e,t,e=>e.push({listener:t,once:!0}))}prependListener(e,t){return this.add(e,t,e=>e.splice(0,0,{listener:t}))}prependOnceListener(e,t){return this.add(e,t,e=>e.splice(0,0,{listener:t,once:!0}))}removeAllListeners(e){const t=this.events.get(e)??[];for(;t.length>0;)this.remove(e,t,0);return this.events.delete(e),this}removeListener(e,t){return this.off(e,t)}add(e,t,a){let i=this.events.get(e);if(void 0===i&&(i=[],this.events.set(e,i)),a(i),"newListener"!==e){const a=[e,t];this.emit("newListener",...a)}return this}remove(e,t,a){const[{listener:i}]=t.splice(a,1);if("removeListener"!==e){const t=[e,i];this.emit("removeListener",...t)}}}function C(e){null==e||"object"!=typeof e||Object.isFrozen(e)||(Object.freeze(e),Object.values(e).forEach(C))}function $(e,t){return t.split(".").reduce((e,t)=>e&&e[t],e)}class I{#e;#t=new Map;#a;#i=new k;constructor(e,t){this.#e=e,this.#a=t}get language(){return this.#e}set language(e){this.#e!==e&&(this.#e=e,this.#i.emit("languageChange",e))}onLanguageChange(e){return this.#i.disposableOn("languageChange",e)}t(e,t=this.language){return this.translate(e,t)}translate(e,t=this.language){const a=new Set([t,t.replaceAll("_","-").split("-").at(0),"en"]);for(const t of a){const a=$(this.getTranslations(t),e);if(a)return a.toString()}return e}getTranslations(e){let t=this.#t.get(e);return void 0===t&&(t=this.#a(e),C(t),this.#t.set(e,t)),t}}class x{#s;#n;#r;constructor(e){e instanceof x?(this.#s=e.#s,this.#n=e.#n):Array.isArray(e)?(this.#s=()=>e.values(),this.#n=()=>e.length):e instanceof Map||e instanceof Set?(this.#s=()=>e.values(),this.#n=()=>e.size):(this.#s=e,this.#n=()=>{let e=0;for(const t of this)e++;return e})}get length(){return this.#n()}*[Symbol.iterator](){for(const e of this.#s())yield e}asIndexedPairs(){return new x(function*(){let e=0;for(const t of this)yield[e++,t]}.bind(this))}drop(e){if(isNaN(e)||e<0)throw new RangeError("limit must be 0, or a positive number");return new x(function*(){let t=0;for(const a of this)t++>=e&&(yield a)}.bind(this))}every(e){for(const t of this)if(!e(t))return!1;return!0}filter(e){return new x(function*(){for(const t of this)e(t)&&(yield t)}.bind(this))}find(e){for(const t of this)if(e(t))return t}findLast(e){let t;for(const a of this)e(a)&&(t=a);return t}flatMap(e){return new x(function*(){for(const t of this)for(const a of e(t))yield a}.bind(this))}forEach(e){for(const t of this)e(t)}includes(e){return this.some(t=>t===e)}map(e){return new x(function*(){for(const t of this)yield e(t)}.bind(this))}next(...e){this.#r??=this.#s();const t=this.#r.next(...e);return t.done&&(this.#r=void 0),t}reduce(e,t){if(0===this.length){if(void 0===t)throw new TypeError("Reduce of empty enumerable with no initial value.");return t}let a=t;for(const t of this)a=void 0===a?t:e(a,t);return a}return(e){return this.#r=void 0,{done:!0,value:e}}some(e){for(const t of this)if(e(t))return!0;return!1}take(e){if(isNaN(e)||e<0)throw new RangeError("limit must be 0, or a positive number");return new x(function*(){let t=0;for(const a of this)t++<e&&(yield a)}.bind(this))}throw(e){throw e}toArray(){return Array.from(this)}toJSON(){return this.toArray()}toString(){return`${this.toArray()}`}}Symbol.dispose??=Symbol("Symbol.dispose");class T{#o=void 0;#l;constructor(e){this.#l=e}get value(){return void 0===this.#o&&(this.#o=this.#l()),this.#o}}function A(){let e,t;return{promise:new Promise((a,i)=>{e=a,t=i}),resolve:e,reject:t}}function D(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var R,E,P,L,N,B,F,O={exports:{}};function M(){if(E)return R;E=1;const e=["nodebuffer","arraybuffer","fragments"],t="undefined"!=typeof Blob;return t&&e.push("blob"),R={BINARY_TYPES:e,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:t,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}}function U(){if(P)return O.exports;P=1;const{EMPTY_BUFFER:e}=M(),t=Buffer[Symbol.species];function a(e,t,a,i,s){for(let n=0;n<s;n++)a[i+n]=e[n]^t[3&n]}function i(e,t){for(let a=0;a<e.length;a++)e[a]^=t[3&a]}if(O.exports={concat:function(a,i){if(0===a.length)return e;if(1===a.length)return a[0];const s=Buffer.allocUnsafe(i);let n=0;for(let e=0;e<a.length;e++){const t=a[e];s.set(t,n),n+=t.length}return n<i?new t(s.buffer,s.byteOffset,n):s},mask:a,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(a){if(e.readOnly=!0,Buffer.isBuffer(a))return a;let i;return a instanceof ArrayBuffer?i=new t(a):ArrayBuffer.isView(a)?i=new t(a.buffer,a.byteOffset,a.byteLength):(i=Buffer.from(a),e.readOnly=!1),i},unmask:i},!process.env.WS_NO_BUFFER_UTIL)try{const e=require("bufferutil");O.exports.mask=function(t,i,s,n,r){r<48?a(t,i,s,n,r):e.mask(t,i,s,n,r)},O.exports.unmask=function(t,a){t.length<32?i(t,a):e.unmask(t,a)}}catch(e){}return O.exports}function G(){if(F)return B;F=1;const e=l,t=U(),a=function(){if(N)return L;N=1;const e=Symbol("kDone"),t=Symbol("kRun");return L=class{constructor(a){this[e]=()=>{this.pending--,this[t]()},this.concurrency=a||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[t]()}[t](){if(this.pending!==this.concurrency&&this.jobs.length){const t=this.jobs.shift();this.pending++,t(this[e])}}}}(),{kStatusCode:i}=M(),s=Buffer[Symbol.species],n=Buffer.from([0,0,255,255]),r=Symbol("permessage-deflate"),o=Symbol("total-length"),c=Symbol("callback"),d=Symbol("buffers"),h=Symbol("error");let u;function p(e){this[d].push(e),this[o]+=e.length}function m(e){this[o]+=e.length,this[r]._maxPayload<1||this[o]<=this[r]._maxPayload?this[d].push(e):(this[h]=new RangeError("Max payload size exceeded"),this[h].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[h][i]=1009,this.removeListener("data",m),this.reset())}function f(e){this[r]._inflate=null,this[h]?this[c](this[h]):(e[i]=1007,this[c](e))}return B=class{constructor(e,t,i){if(this._maxPayload=0|i,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!u){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;u=new a(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[c];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,a=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!a)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(a.server_no_context_takeover=!0),t.clientNoContextTakeover&&(a.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(a.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?a.client_max_window_bits=t.clientMaxWindowBits:!0!==a.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete a.client_max_window_bits,a}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let a=e[t];if(a.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(a=a[0],"client_max_window_bits"===t){if(!0!==a){const e=+a;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${a}`);a=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${a}`)}else if("server_max_window_bits"===t){const e=+a;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${a}`);a=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==a)throw new TypeError(`Invalid value for parameter "${t}": ${a}`)}e[t]=a})}),e}decompress(e,t,a){u.add(i=>{this._decompress(e,t,(e,t)=>{i(),a(e,t)})})}compress(e,t,a){u.add(i=>{this._compress(e,t,(e,t)=>{i(),a(e,t)})})}_decompress(a,i,s){const l=this._isServer?"client":"server";if(!this._inflate){const t=`${l}_max_window_bits`,a="number"!=typeof this.params[t]?e.Z_DEFAULT_WINDOWBITS:this.params[t];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:a}),this._inflate[r]=this,this._inflate[o]=0,this._inflate[d]=[],this._inflate.on("error",f),this._inflate.on("data",m)}this._inflate[c]=s,this._inflate.write(a),i&&this._inflate.write(n),this._inflate.flush(()=>{const e=this._inflate[h];if(e)return this._inflate.close(),this._inflate=null,void s(e);const a=t.concat(this._inflate[d],this._inflate[o]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[o]=0,this._inflate[d]=[],i&&this.params[`${l}_no_context_takeover`]&&this._inflate.reset()),s(null,a)})}_compress(a,i,n){const r=this._isServer?"server":"client";if(!this._deflate){const t=`${r}_max_window_bits`,a="number"!=typeof this.params[t]?e.Z_DEFAULT_WINDOWBITS:this.params[t];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:a}),this._deflate[o]=0,this._deflate[d]=[],this._deflate.on("data",p)}this._deflate[c]=n,this._deflate.write(a),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=t.concat(this._deflate[d],this._deflate[o]);i&&(e=new s(e.buffer,e.byteOffset,e.length-4)),this._deflate[c]=null,this._deflate[o]=0,this._deflate[d]=[],i&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),n(null,e)})}}}var j,W,K,V,q,z,H,J,Y,Q,X,Z,ee,te={exports:{}};function ae(){if(j)return te.exports;j=1;const{isUtf8:e}=c,{hasBlob:t}=M();function a(e){const t=e.length;let a=0;for(;a<t;)if(128&e[a])if(192==(224&e[a])){if(a+1===t||128!=(192&e[a+1])||192==(254&e[a]))return!1;a+=2}else if(224==(240&e[a])){if(a+2>=t||128!=(192&e[a+1])||128!=(192&e[a+2])||224===e[a]&&128==(224&e[a+1])||237===e[a]&&160==(224&e[a+1]))return!1;a+=3}else{if(240!=(248&e[a]))return!1;if(a+3>=t||128!=(192&e[a+1])||128!=(192&e[a+2])||128!=(192&e[a+3])||240===e[a]&&128==(240&e[a+1])||244===e[a]&&e[a+1]>143||e[a]>244)return!1;a+=4}else a++;return!0}if(te.exports={isBlob:function(e){return t&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:a,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},e)te.exports.isValidUTF8=function(t){return t.length<24?a(t):e(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const e=require("utf-8-validate");te.exports.isValidUTF8=function(t){return t.length<32?a(t):e(t)}}catch(e){}return te.exports}function ie(){if(K)return W;K=1;const{Writable:e}=r,t=G(),{BINARY_TYPES:a,EMPTY_BUFFER:i,kStatusCode:s,kWebSocket:n}=M(),{concat:o,toArrayBuffer:l,unmask:c}=U(),{isValidStatusCode:d,isValidUTF8:h}=ae(),u=Buffer[Symbol.species];return W=class extends e{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||a[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[n]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,a){if(8===this._opcode&&0==this._state)return a();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(a)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new u(t.buffer,t.byteOffset+e,t.length-e),new u(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const a=this._buffers[0],i=t.length-e;e>=a.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(a.buffer,a.byteOffset,e),i),this._buffers[0]=new u(a.buffer,a.byteOffset+e,a.length-e)),e-=a.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const a=this.consume(2);if(48&a[0]){return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"))}const i=!(64&~a[0]);if(i&&!this._extensions[t.extensionName]){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._fin=!(128&~a[0]),this._opcode=15&a[0],this._payloadLength=127&a[1],0===this._opcode){if(i){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(!this._fragmented){return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"))}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}this._compressed=i}else{if(!(this._opcode>7&&this._opcode<11)){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}if(!this._fin){return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"))}if(i){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~a[1]),this._isServer){if(!this._masked){return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}}else if(this._masked){return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"))}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),a=t.readUInt32BE(0);if(a>Math.pow(2,21)-1){return void e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"))}this._payloadLength=a*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){return void e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"))}this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=i;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!==(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&c(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,a){this._extensions[t.extensionName].decompress(e,this._fin,(e,t)=>{if(e)return a(e);if(t.length){if(this._messageLength+=t.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void a(e)}this._fragments.push(t)}this.dataMessage(a),0===this._state&&this.startLoop(a)})}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,a=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let i;i="nodebuffer"===this._binaryType?o(a,t):"arraybuffer"===this._binaryType?l(o(a,t)):"blob"===this._binaryType?new Blob(a):a,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!0),this._state=0,this.startLoop(e)}))}else{const i=o(a,t);if(!this._skipUTF8Validation&&!h(i)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,i),this.end();else{const a=e.readUInt16BE(0);if(!d(a)){const e=this.createError(RangeError,`invalid status code ${a}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const i=new u(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!h(i)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",a,i),this.end()}this._state=0}}createError(e,t,a,i,n){this._loop=!1,this._errored=!0;const r=new e(a?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(r,this.createError),r.code=n,r[s]=i,r}}}function se(){if(q)return V;q=1;const{Duplex:e}=r,{randomFillSync:t}=n,a=G(),{EMPTY_BUFFER:i,kWebSocket:s,NOOP:o}=M(),{isBlob:l,isValidStatusCode:c}=ae(),{mask:d,toBuffer:h}=U(),u=Symbol("kByteLength"),p=Buffer.alloc(4),m=8192;let f,g=m;class y{constructor(e,t,a){this._extensions=t||{},a&&(this._generateMask=a,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=o,this[s]=void 0}static frame(e,a){let i,s,n=!1,r=2,o=!1;a.mask&&(i=a.maskBuffer||p,a.generateMask?a.generateMask(i):(g===m&&(void 0===f&&(f=Buffer.alloc(m)),t(f,0,m),g=0),i[0]=f[g++],i[1]=f[g++],i[2]=f[g++],i[3]=f[g++]),o=0===(i[0]|i[1]|i[2]|i[3]),r=6),"string"==typeof e?s=a.mask&&!o||void 0===a[u]?(e=Buffer.from(e)).length:a[u]:(s=e.length,n=a.mask&&a.readOnly&&!o);let l=s;s>=65536?(r+=8,l=127):s>125&&(r+=2,l=126);const c=Buffer.allocUnsafe(n?s+r:r);return c[0]=a.fin?128|a.opcode:a.opcode,a.rsv1&&(c[0]|=64),c[1]=l,126===l?c.writeUInt16BE(s,2):127===l&&(c[2]=c[3]=0,c.writeUIntBE(s,4,6)),a.mask?(c[1]|=128,c[r-4]=i[0],c[r-3]=i[1],c[r-2]=i[2],c[r-1]=i[3],o?[c,e]:n?(d(e,i,c,r,s),[c]):(d(e,i,e,0,s),[c,e])):[c,e]}close(e,t,a,s){let n;if(void 0===e)n=i;else{if("number"!=typeof e||!c(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const a=Buffer.byteLength(t);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");n=Buffer.allocUnsafe(2+a),n.writeUInt16BE(e,0),"string"==typeof t?n.write(t,2):n.set(t,2)}else n=Buffer.allocUnsafe(2),n.writeUInt16BE(e,0)}const r={[u]:n.length,fin:!0,generateMask:this._generateMask,mask:a,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,n,!1,r,s]):this.sendFrame(y.frame(n,r),s)}ping(e,t,a){let i,s;if("string"==typeof e?(i=Buffer.byteLength(e),s=!1):l(e)?(i=e.size,s=!1):(i=(e=h(e)).length,s=h.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");const n={[u]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,n,a]):this.getBlobData(e,!1,n,a):0!==this._state?this.enqueue([this.dispatch,e,!1,n,a]):this.sendFrame(y.frame(e,n),a)}pong(e,t,a){let i,s;if("string"==typeof e?(i=Buffer.byteLength(e),s=!1):l(e)?(i=e.size,s=!1):(i=(e=h(e)).length,s=h.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");const n={[u]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,n,a]):this.getBlobData(e,!1,n,a):0!==this._state?this.enqueue([this.dispatch,e,!1,n,a]):this.sendFrame(y.frame(e,n),a)}send(e,t,i){const s=this._extensions[a.extensionName];let n,r,o=t.binary?2:1,c=t.compress;"string"==typeof e?(n=Buffer.byteLength(e),r=!1):l(e)?(n=e.size,r=!1):(n=(e=h(e)).length,r=h.readOnly),this._firstFragment?(this._firstFragment=!1,c&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=n>=s._threshold),this._compress=c):(c=!1,o=0),t.fin&&(this._firstFragment=!0);const d={[u]:n,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:r,rsv1:c};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,d,i]):this.getBlobData(e,this._compress,d,i):0!==this._state?this.enqueue([this.dispatch,e,this._compress,d,i]):this.dispatch(e,this._compress,d,i)}getBlobData(e,t,a,i){this._bufferedBytes+=a[u],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){const e=new Error("The socket was closed while the blob was being read");return void process.nextTick(w,this,e,i)}this._bufferedBytes-=a[u];const s=h(e);t?this.dispatch(s,t,a,i):(this._state=0,this.sendFrame(y.frame(s,a),i),this.dequeue())}).catch(e=>{process.nextTick(v,this,e,i)})}dispatch(e,t,i,s){if(!t)return void this.sendFrame(y.frame(e,i),s);const n=this._extensions[a.extensionName];this._bufferedBytes+=i[u],this._state=1,n.compress(e,i.fin,(e,t)=>{if(this._socket.destroyed){return void w(this,new Error("The socket was closed while data was being compressed"),s)}this._bufferedBytes-=i[u],this._state=0,i.readOnly=!1,this.sendFrame(y.frame(t,i),s),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][u],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][u],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function w(e,t,a){"function"==typeof a&&a(t);for(let a=0;a<e._queue.length;a++){const i=e._queue[a],s=i[i.length-1];"function"==typeof s&&s(t)}}function v(e,t,a){w(e,t,a),e.onerror(t)}return V=y}function ne(){if(Y)return J;Y=1;const{tokenChars:e}=ae();function t(e,t,a){void 0===e[t]?e[t]=[a]:e[t].push(a)}return J={format:function(e){return Object.keys(e).map(t=>{let a=e[t];return Array.isArray(a)||(a=[a]),a.map(e=>[t].concat(Object.keys(e).map(t=>{let a=e[t];return Array.isArray(a)||(a=[a]),a.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(a){const i=Object.create(null);let s,n,r=Object.create(null),o=!1,l=!1,c=!1,d=-1,h=-1,u=-1,p=0;for(;p<a.length;p++)if(h=a.charCodeAt(p),void 0===s)if(-1===u&&1===e[h])-1===d&&(d=p);else if(0===p||32!==h&&9!==h){if(59!==h&&44!==h)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p);const e=a.slice(d,u);44===h?(t(i,e,r),r=Object.create(null)):s=e,d=u=-1}}else-1===u&&-1!==d&&(u=p);else if(void 0===n)if(-1===u&&1===e[h])-1===d&&(d=p);else if(32===h||9===h)-1===u&&-1!==d&&(u=p);else if(59===h||44===h){if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p),t(r,a.slice(d,u),!0),44===h&&(t(i,s,r),r=Object.create(null),s=void 0),d=u=-1}else{if(61!==h||-1===d||-1!==u)throw new SyntaxError(`Unexpected character at index ${p}`);n=a.slice(d,p),d=u=-1}else if(l){if(1!==e[h])throw new SyntaxError(`Unexpected character at index ${p}`);-1===d?d=p:o||(o=!0),l=!1}else if(c)if(1===e[h])-1===d&&(d=p);else if(34===h&&-1!==d)c=!1,u=p;else{if(92!==h)throw new SyntaxError(`Unexpected character at index ${p}`);l=!0}else if(34===h&&61===a.charCodeAt(p-1))c=!0;else if(-1===u&&1===e[h])-1===d&&(d=p);else if(-1===d||32!==h&&9!==h){if(59!==h&&44!==h)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p);let e=a.slice(d,u);o&&(e=e.replace(/\\/g,""),o=!1),t(r,n,e),44===h&&(t(i,s,r),r=Object.create(null),s=void 0),n=void 0,d=u=-1}}else-1===u&&(u=p);if(-1===d||c||32===h||9===h)throw new SyntaxError("Unexpected end of input");-1===u&&(u=p);const m=a.slice(d,u);return void 0===s?t(i,m,r):(void 0===n?t(r,m,!0):t(r,n,o?m.replace(/\\/g,""):m),t(i,s,r)),i}}}function re(){if(X)return Q;X=1;const l=e,c=t,d=a,h=i,u=s,{randomBytes:p,createHash:m}=n,{Duplex:f,Readable:g}=r,{URL:y}=o,w=G(),v=ie(),b=se(),{isBlob:S}=ae(),{BINARY_TYPES:_,CLOSE_TIMEOUT:k,EMPTY_BUFFER:C,GUID:$,kForOnEventAttribute:I,kListener:x,kStatusCode:T,kWebSocket:A,NOOP:D}=M(),{EventTarget:{addEventListener:R,removeEventListener:E}}=function(){if(H)return z;H=1;const{kForOnEventAttribute:e,kListener:t}=M(),a=Symbol("kCode"),i=Symbol("kData"),s=Symbol("kError"),n=Symbol("kMessage"),r=Symbol("kReason"),o=Symbol("kTarget"),l=Symbol("kType"),c=Symbol("kWasClean");class d{constructor(e){this[o]=null,this[l]=e}get target(){return this[o]}get type(){return this[l]}}Object.defineProperty(d.prototype,"target",{enumerable:!0}),Object.defineProperty(d.prototype,"type",{enumerable:!0});class h extends d{constructor(e,t={}){super(e),this[a]=void 0===t.code?0:t.code,this[r]=void 0===t.reason?"":t.reason,this[c]=void 0!==t.wasClean&&t.wasClean}get code(){return this[a]}get reason(){return this[r]}get wasClean(){return this[c]}}Object.defineProperty(h.prototype,"code",{enumerable:!0}),Object.defineProperty(h.prototype,"reason",{enumerable:!0}),Object.defineProperty(h.prototype,"wasClean",{enumerable:!0});class u extends d{constructor(e,t={}){super(e),this[s]=void 0===t.error?null:t.error,this[n]=void 0===t.message?"":t.message}get error(){return this[s]}get message(){return this[n]}}Object.defineProperty(u.prototype,"error",{enumerable:!0}),Object.defineProperty(u.prototype,"message",{enumerable:!0});class p extends d{constructor(e,t={}){super(e),this[i]=void 0===t.data?null:t.data}get data(){return this[i]}}Object.defineProperty(p.prototype,"data",{enumerable:!0});const m={addEventListener(a,i,s={}){for(const n of this.listeners(a))if(!s[e]&&n[t]===i&&!n[e])return;let n;if("message"===a)n=function(e,t){const a=new p("message",{data:t?e:e.toString()});a[o]=this,f(i,this,a)};else if("close"===a)n=function(e,t){const a=new h("close",{code:e,reason:t.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[o]=this,f(i,this,a)};else if("error"===a)n=function(e){const t=new u("error",{error:e,message:e.message});t[o]=this,f(i,this,t)};else{if("open"!==a)return;n=function(){const e=new d("open");e[o]=this,f(i,this,e)}}n[e]=!!s[e],n[t]=i,s.once?this.once(a,n):this.on(a,n)},removeEventListener(a,i){for(const s of this.listeners(a))if(s[t]===i&&!s[e]){this.removeListener(a,s);break}}};function f(e,t,a){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,a):e.call(t,a)}return z={CloseEvent:h,ErrorEvent:u,Event:d,EventTarget:m,MessageEvent:p}}(),{format:P,parse:L}=ne(),{toBuffer:N}=U(),B=Symbol("kAborted"),F=[8,13],O=["CONNECTING","OPEN","CLOSING","CLOSED"],j=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class W extends l{constructor(e,t,a){super(),this._binaryType=_[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=C,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=W.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(a=t,t=[]):t=[t]),K(this,e,t,a)):(this._autoPong=a.autoPong,this._closeTimeout=a.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){_.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,a){const i=new v({allowSynchronousEvents:a.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:a.maxPayload,skipUTF8Validation:a.skipUTF8Validation}),s=new b(e,this._extensions,a.generateMask);this._receiver=i,this._sender=s,this._socket=e,i[A]=this,s[A]=this,e[A]=this,i.on("conclude",ee),i.on("drain",te),i.on("error",re),i.on("message",le),i.on("ping",ce),i.on("pong",de),s.onerror=ue,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",me),e.on("data",fe),e.on("end",ge),e.on("error",ye),this._readyState=W.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=W.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[w.extensionName]&&this._extensions[w.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=W.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==W.CLOSED){if(this.readyState===W.CONNECTING){const e="WebSocket was closed before the connection was established";return void Y(this,this._req,e)}this.readyState!==W.CLOSING?(this._readyState=W.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),pe(this)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==W.CONNECTING&&this.readyState!==W.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,a){if(this.readyState===W.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(a=e,e=t=void 0):"function"==typeof t&&(a=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===W.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||C,t,a)):Z(this,e,a)}pong(e,t,a){if(this.readyState===W.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(a=e,e=t=void 0):"function"==typeof t&&(a=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===W.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||C,t,a)):Z(this,e,a)}resume(){this.readyState!==W.CONNECTING&&this.readyState!==W.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,a){if(this.readyState===W.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(a=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==W.OPEN)return void Z(this,e,a);const i={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[w.extensionName]||(i.compress=!1),this._sender.send(e||C,i,a)}terminate(){if(this.readyState!==W.CLOSED){if(this.readyState===W.CONNECTING){const e="WebSocket was closed before the connection was established";return void Y(this,this._req,e)}this._socket&&(this._readyState=W.CLOSING,this._socket.destroy())}}}function K(e,t,a,i){const s={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:k,protocolVersion:F[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...i,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=s.autoPong,e._closeTimeout=s.closeTimeout,!F.includes(s.protocolVersion))throw new RangeError(`Unsupported protocol version: ${s.protocolVersion} (supported versions: ${F.join(", ")})`);let n;if(t instanceof y)n=t;else try{n=new y(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===n.protocol?n.protocol="ws:":"https:"===n.protocol&&(n.protocol="wss:"),e._url=n.href;const r="wss:"===n.protocol,o="ws+unix:"===n.protocol;let l;if("ws:"===n.protocol||r||o?o&&!n.pathname?l="The URL's pathname is empty":n.hash&&(l="The URL contains a fragment identifier"):l='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',l){const t=new SyntaxError(l);if(0===e._redirects)throw t;return void V(e,t)}const h=r?443:80,u=p(16).toString("base64"),f=r?c.request:d.request,g=new Set;let v,b;if(s.createConnection=s.createConnection||(r?J:q),s.defaultPort=s.defaultPort||h,s.port=n.port||h,s.host=n.hostname.startsWith("[")?n.hostname.slice(1,-1):n.hostname,s.headers={...s.headers,"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},s.path=n.pathname+n.search,s.timeout=s.handshakeTimeout,s.perMessageDeflate&&(v=new w(!0!==s.perMessageDeflate?s.perMessageDeflate:{},!1,s.maxPayload),s.headers["Sec-WebSocket-Extensions"]=P({[w.extensionName]:v.offer()})),a.length){for(const e of a){if("string"!=typeof e||!j.test(e)||g.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(e)}s.headers["Sec-WebSocket-Protocol"]=a.join(",")}if(s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin),(n.username||n.password)&&(s.auth=`${n.username}:${n.password}`),o){const e=s.path.split(":");s.socketPath=e[0],s.path=e[1]}if(s.followRedirects){if(0===e._redirects){e._originalIpc=o,e._originalSecure=r,e._originalHostOrSocketPath=o?s.socketPath:n.host;const t=i&&i.headers;if(i={...i,headers:{}},t)for(const[e,a]of Object.entries(t))i.headers[e.toLowerCase()]=a}else if(0===e.listenerCount("redirect")){const t=o?!!e._originalIpc&&s.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&n.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!r)&&(delete s.headers.authorization,delete s.headers.cookie,t||delete s.headers.host,s.auth=void 0)}s.auth&&!i.headers.authorization&&(i.headers.authorization="Basic "+Buffer.from(s.auth).toString("base64")),b=e._req=f(s),e._redirects&&e.emit("redirect",e.url,b)}else b=e._req=f(s);s.timeout&&b.on("timeout",()=>{Y(e,b,"Opening handshake has timed out")}),b.on("error",t=>{null===b||b[B]||(b=e._req=null,V(e,t))}),b.on("response",n=>{const r=n.headers.location,o=n.statusCode;if(r&&s.followRedirects&&o>=300&&o<400){if(++e._redirects>s.maxRedirects)return void Y(e,b,"Maximum redirects exceeded");let n;b.abort();try{n=new y(r,t)}catch(t){const a=new SyntaxError(`Invalid URL: ${r}`);return void V(e,a)}K(e,n,a,i)}else e.emit("unexpected-response",b,n)||Y(e,b,`Unexpected server response: ${n.statusCode}`)}),b.on("upgrade",(t,a,i)=>{if(e.emit("upgrade",t),e.readyState!==W.CONNECTING)return;b=e._req=null;const n=t.headers.upgrade;if(void 0===n||"websocket"!==n.toLowerCase())return void Y(e,a,"Invalid Upgrade header");const r=m("sha1").update(u+$).digest("base64");if(t.headers["sec-websocket-accept"]!==r)return void Y(e,a,"Invalid Sec-WebSocket-Accept header");const o=t.headers["sec-websocket-protocol"];let l;if(void 0!==o?g.size?g.has(o)||(l="Server sent an invalid subprotocol"):l="Server sent a subprotocol but none was requested":g.size&&(l="Server sent no subprotocol"),l)return void Y(e,a,l);o&&(e._protocol=o);const c=t.headers["sec-websocket-extensions"];if(void 0!==c){if(!v){return void Y(e,a,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=L(c)}catch(t){return void Y(e,a,"Invalid Sec-WebSocket-Extensions header")}const i=Object.keys(t);if(1!==i.length||i[0]!==w.extensionName){return void Y(e,a,"Server indicated an extension that was not requested")}try{v.accept(t[w.extensionName])}catch(t){return void Y(e,a,"Invalid Sec-WebSocket-Extensions header")}e._extensions[w.extensionName]=v}e.setSocket(a,i,{allowSynchronousEvents:s.allowSynchronousEvents,generateMask:s.generateMask,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation})}),s.finishRequest?s.finishRequest(b,e):b.end()}function V(e,t){e._readyState=W.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function q(e){return e.path=e.socketPath,h.connect(e)}function J(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=h.isIP(e.host)?"":e.host),u.connect(e)}function Y(e,t,a){e._readyState=W.CLOSING;const i=new Error(a);Error.captureStackTrace(i,Y),t.setHeader?(t[B]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(V,e,i)):(t.destroy(i),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function Z(e,t,a){if(t){const a=S(t)?t.size:N(t).length;e._socket?e._sender._bufferedBytes+=a:e._bufferedAmount+=a}if(a){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${O[e.readyState]})`);process.nextTick(a,t)}}function ee(e,t){const a=this[A];a._closeFrameReceived=!0,a._closeMessage=t,a._closeCode=e,void 0!==a._socket[A]&&(a._socket.removeListener("data",fe),process.nextTick(he,a._socket),1005===e?a.close():a.close(e,t))}function te(){const e=this[A];e.isPaused||e._socket.resume()}function re(e){const t=this[A];void 0!==t._socket[A]&&(t._socket.removeListener("data",fe),process.nextTick(he,t._socket),t.close(e[T])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function oe(){this[A].emitClose()}function le(e,t){this[A].emit("message",e,t)}function ce(e){const t=this[A];t._autoPong&&t.pong(e,!this._isServer,D),t.emit("ping",e)}function de(e){this[A].emit("pong",e)}function he(e){e.resume()}function ue(e){const t=this[A];t.readyState!==W.CLOSED&&(t.readyState===W.OPEN&&(t._readyState=W.CLOSING,pe(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function pe(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),e._closeTimeout)}function me(){const e=this[A];if(this.removeListener("close",me),this.removeListener("data",fe),this.removeListener("end",ge),e._readyState=W.CLOSING,!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&0!==this._readableState.length){const t=this.read(this._readableState.length);e._receiver.write(t)}e._receiver.end(),this[A]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",oe),e._receiver.on("finish",oe))}function fe(e){this[A]._receiver.write(e)||this.pause()}function ge(){const e=this[A];e._readyState=W.CLOSING,e._receiver.end(),this.end()}function ye(){const e=this[A];this.removeListener("error",ye),this.on("error",D),e&&(e._readyState=W.CLOSING,this.destroy())}return Object.defineProperty(W,"CONNECTING",{enumerable:!0,value:O.indexOf("CONNECTING")}),Object.defineProperty(W.prototype,"CONNECTING",{enumerable:!0,value:O.indexOf("CONNECTING")}),Object.defineProperty(W,"OPEN",{enumerable:!0,value:O.indexOf("OPEN")}),Object.defineProperty(W.prototype,"OPEN",{enumerable:!0,value:O.indexOf("OPEN")}),Object.defineProperty(W,"CLOSING",{enumerable:!0,value:O.indexOf("CLOSING")}),Object.defineProperty(W.prototype,"CLOSING",{enumerable:!0,value:O.indexOf("CLOSING")}),Object.defineProperty(W,"CLOSED",{enumerable:!0,value:O.indexOf("CLOSED")}),Object.defineProperty(W.prototype,"CLOSED",{enumerable:!0,value:O.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(W.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(W.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[I])return t[x];return null},set(t){for(const t of this.listeners(e))if(t[I]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[I]:!0})}})}),W.prototype.addEventListener=R,W.prototype.removeEventListener=E,Q=W}!function(){if(ee)return Z;ee=1,re();const{Duplex:e}=r;function t(e){e.emit("close")}function a(){!this.destroyed&&this._writableState.finished&&this.destroy()}function i(e){this.removeListener("error",i),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}Z=function(s,n){let r=!0;const o=new e({...n,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(e,t){const a=!t&&o._readableState.objectMode?e.toString():e;o.push(a)||s.pause()}),s.once("error",function(e){o.destroyed||(r=!1,o.destroy(e))}),s.once("close",function(){o.destroyed||o.push(null)}),o._destroy=function(e,a){if(s.readyState===s.CLOSED)return a(e),void process.nextTick(t,o);let i=!1;s.once("error",function(e){i=!0,a(e)}),s.once("close",function(){i||a(e),process.nextTick(t,o)}),r&&s.terminate()},o._final=function(e){s.readyState!==s.CONNECTING?null!==s._socket&&(s._socket._writableState.finished?(e(),o._readableState.endEmitted&&o.destroy()):(s._socket.once("finish",function(){e()}),s.close())):s.once("open",function(){o._final(e)})},o._read=function(){s.isPaused&&s.resume()},o._write=function(e,t,a){s.readyState!==s.CONNECTING?s.send(e,a):s.once("open",function(){o._write(e,t,a)})},o.on("end",a),o.on("error",i),o}}(),ie(),se();var oe,le,ce,de,he,ue,pe,me,fe=D(re());function ge(){if(le)return oe;le=1;const{tokenChars:e}=ae();return oe={parse:function(t){const a=new Set;let i=-1,s=-1,n=0;for(;n<t.length;n++){const r=t.charCodeAt(n);if(-1===s&&1===e[r])-1===i&&(i=n);else if(0===n||32!==r&&9!==r){if(44!==r)throw new SyntaxError(`Unexpected character at index ${n}`);{if(-1===i)throw new SyntaxError(`Unexpected character at index ${n}`);-1===s&&(s=n);const e=t.slice(i,s);if(a.has(e))throw new SyntaxError(`The "${e}" subprotocol is duplicated`);a.add(e),i=s=-1}}else-1===s&&-1!==i&&(s=n)}if(-1===i||-1!==s)throw new SyntaxError("Unexpected end of input");const r=t.slice(i,n);if(a.has(r))throw new SyntaxError(`The "${r}" subprotocol is duplicated`);return a.add(r),a}}}!function(){if(de)return ce;de=1;const t=e,i=a,{Duplex:s}=r,{createHash:o}=n,l=ne(),c=G(),d=ge(),h=re(),{CLOSE_TIMEOUT:u,GUID:p,kWebSocket:m}=M(),f=/^[+/0-9A-Za-z]{22}==$/;function g(e){e._state=2,e.emit("close")}function y(){this.destroy()}function w(e,t,a,s){a=a||i.STATUS_CODES[t],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(a),...s},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r\n`+Object.keys(s).map(e=>`${e}: ${s[e]}`).join("\r\n")+"\r\n\r\n"+a)}function v(e,t,a,i,s,n){if(e.listenerCount("wsClientError")){const i=new Error(s);Error.captureStackTrace(i,v),e.emit("wsClientError",i,a,t)}else w(a,i,s,n)}ce=class extends t{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:u,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:h,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{const a=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":a.length,"Content-Type":"text/plain"}),t.end(a)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const a of Object.keys(t))e.on(a,t[a]);return function(){for(const a of Object.keys(t))e.removeListener(a,t[a])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,a,i)=>{this.handleUpgrade(t,a,i,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",()=>{e(new Error("The server is not running"))}),void process.nextTick(g,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(g,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{g(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,a,i){t.on("error",y);const s=e.headers["sec-websocket-key"],n=e.headers.upgrade,r=+e.headers["sec-websocket-version"];if("GET"!==e.method){return void v(this,e,t,405,"Invalid HTTP method")}if(void 0===n||"websocket"!==n.toLowerCase()){return void v(this,e,t,400,"Invalid Upgrade header")}if(void 0===s||!f.test(s)){return void v(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header")}if(13!==r&&8!==r){return void v(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"})}if(!this.shouldHandle(e))return void w(t,400);const o=e.headers["sec-websocket-protocol"];let h=new Set;if(void 0!==o)try{h=d.parse(o)}catch(a){return void v(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const u=e.headers["sec-websocket-extensions"],p={};if(this.options.perMessageDeflate&&void 0!==u){const a=new c(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=l.parse(u);e[c.extensionName]&&(a.accept(e[c.extensionName]),p[c.extensionName]=a)}catch(a){return void v(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const n={origin:e.headers[""+(8===r?"sec-websocket-origin":"origin")],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(n,(n,r,o,l)=>{if(!n)return w(t,r||401,o,l);this.completeUpgrade(p,s,h,e,t,a,i)});if(!this.options.verifyClient(n))return w(t,401)}this.completeUpgrade(p,s,h,e,t,a,i)}completeUpgrade(e,t,a,i,s,n,r){if(!s.readable||!s.writable)return s.destroy();if(s[m])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return w(s,503);const d=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${o("sha1").update(t+p).digest("base64")}`],h=new this.options.WebSocket(null,void 0,this.options);if(a.size){const e=this.options.handleProtocols?this.options.handleProtocols(a,i):a.values().next().value;e&&(d.push(`Sec-WebSocket-Protocol: ${e}`),h._protocol=e)}if(e[c.extensionName]){const t=e[c.extensionName].params,a=l.format({[c.extensionName]:[t]});d.push(`Sec-WebSocket-Extensions: ${a}`),h._extensions=e}this.emit("headers",d,i),s.write(d.concat("\r\n").join("\r\n")),s.removeListener("error",y),h.setSocket(s,n,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(g,this)})),r(h,i)}}}(),function(e){e[e.StreamDeck=0]="StreamDeck",e[e.StreamDeckMini=1]="StreamDeckMini",e[e.StreamDeckXL=2]="StreamDeckXL",e[e.StreamDeckMobile=3]="StreamDeckMobile",e[e.CorsairGKeys=4]="CorsairGKeys",e[e.StreamDeckPedal=5]="StreamDeckPedal",e[e.CorsairVoyager=6]="CorsairVoyager",e[e.StreamDeckPlus=7]="StreamDeckPlus",e[e.SCUFController=8]="SCUFController",e[e.StreamDeckNeo=9]="StreamDeckNeo",e[e.StreamDeckStudio=10]="StreamDeckStudio",e[e.VirtualStreamDeck=11]="VirtualStreamDeck"}(he||(he={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.DoubleRectangle=1]="DoubleRectangle",e[e.Trapezoid=2]="Trapezoid",e[e.DoubleTrapezoid=3]="DoubleTrapezoid",e[e.Groove=4]="Groove"}(ue||(ue={})),function(e){e.Port="-port",e.Info="-info",e.PluginUUID="-pluginUUID",e.RegisterEvent="-registerEvent"}(pe||(pe={})),function(e){e[e.HardwareAndSoftware=0]="HardwareAndSoftware",e[e.Hardware=1]="Hardware",e[e.Software=2]="Software"}(me||(me={}));class ye{build;major;minor;patch;constructor(e){const t=e.match(/^(0|[1-9]\d*)(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?$/);if(null===t)throw new Error(`Invalid format; expected "{major}[.{minor}[.{patch}[.{build}]]]" but was "${e}"`);[,this.major,this.minor,this.patch,this.build]=[...t.map(e=>parseInt(e)||0)]}compareTo(e){const t=({major:e,minor:t,build:a,patch:i})=>[e,t,a,i],a=t(this),i=t(e);for(let e=0;e<4;e++){if(a[e]<i[e])return-1;if(a[e]>i[e])return 1}return 0}toString(){return`${this.major}.${this.minor}`}}class we{write(e){switch(e.level){case"error":console.error(...e.data);break;case"warn":console.warn(...e.data);break;default:console.log(...e.data)}}}const ve="\n";function be(e){switch(e){case"error":return 0;case"warn":return 1;case"info":return 2;case"debug":return 3;default:return 4}}class Se{#c;#d;#h;constructor(e){this.#d={minimumLevel:"trace",...e},this.#h=void 0===this.#d.scope||""===this.#d.scope.trim()?"":this.#d.scope,"function"!=typeof this.#d.level&&this.setLevel(this.#d.level)}get level(){return void 0!==this.#c?this.#c:"function"==typeof this.#d.level?this.#d.level():this.#d.level}createScope(e){return""===(e=e.trim())?this:new Se({...this.#d,level:()=>this.level,scope:this.#d.scope?`${this.#d.scope}->${e}`:e})}debug(...e){return this.write({level:"debug",data:e,scope:this.#h})}error(...e){return this.write({level:"error",data:e,scope:this.#h})}info(...e){return this.write({level:"info",data:e,scope:this.#h})}setLevel(e){return void 0!==e&&be(e)>be(this.#d.minimumLevel)?this.#c="info":this.#c=e,this}trace(...e){return this.write({level:"trace",data:e,scope:this.#h})}warn(...e){return this.write({level:"warn",data:e,scope:this.#h})}write(e){return be(e.level)<=be(this.level)&&this.#d.targets.forEach(t=>t.write(e)),this}}let _e;function ke(){return void 0===_e&&(_e=process.execArgv.some(e=>{const t=e.split("=")[0];return"--inspect"===t||"--inspect-brk"===t||"--inspect-port"===t})),_e}const Ce=[new class{#u;#d;#p=0;constructor(e){this.#d=e,this.#u=this.getLogFilePath(),this.reIndex()}write(e){const t=d.openSync(this.#u,"a");try{const a=this.#d.format(e);d.writeSync(t,a+"\n"),this.#p+=a.length}finally{d.closeSync(t)}this.#p>=this.#d.maxSize&&(this.reIndex(),this.#p=0)}getLogFilePath(e=0){return p.join(this.#d.dest,`${this.#d.fileName}.${e}.log`)}getLogFiles(){const e=/^\.(\d+)\.log$/;return d.readdirSync(this.#d.dest,{withFileTypes:!0}).reduce((t,a)=>{if(a.isDirectory()||a.name.indexOf(this.#d.fileName)<0)return t;const i=a.name.substring(this.#d.fileName.length).match(e);return 2!==i?.length||t.push({path:p.join(this.#d.dest,a.name),index:parseInt(i[1])}),t},[]).sort(({index:e},{index:t})=>e<t?-1:e>t?1:0)}reIndex(){if(!d.existsSync(this.#d.dest))return void d.mkdirSync(this.#d.dest);const e=this.getLogFiles();for(let t=e.length-1;t>=0;t--){const a=e[t];t>=this.#d.maxFileCount-1?d.rmSync(a.path):d.renameSync(a.path,this.getLogFilePath(t+1))}}}({dest:p.join(g(),"logs"),fileName:function(){const e=p.basename(process.cwd()),t=e.lastIndexOf(".sdPlugin");return t<0?e:e.substring(0,t)}(),format:e=>{const{data:t,level:a,scope:i}=e;let s=`${(new Date).toISOString()} ${a.toUpperCase().padEnd(5)} `;return i&&(s+=`${i}: `),`${s}${function(e){let t="",a=!1;for(const i of e)"object"==typeof i&&i instanceof Error?(t+=`${ve}${i.stack}`,a=!0):(a&&(t+=ve,a=!1),t+="object"==typeof i?JSON.stringify(i):i,t+=" ");return t.trimEnd()}(t)}`},maxFileCount:10,maxSize:52428800})];ke()&&Ce.splice(0,0,new we);const $e=new Se({level:ke()?"debug":"info",minimumLevel:ke()?"trace":"debug",targets:Ce});process.once("uncaughtException",e=>$e.error("Process encountered uncaught exception",e));const Ie=new class extends k{_registrationParameters;_version;canConnect=!0;connection=A();logger=$e.createScope("Connection");get registrationParameters(){return this._registrationParameters??=this.getRegistrationParameters()}get version(){return this._version??=new ye(this.registrationParameters.info.application.version)}async connect(){if(this.canConnect){this.canConnect=!1;const e=new fe(`ws://127.0.0.1:${this.registrationParameters.port}`);e.onmessage=e=>this.tryEmit(e),e.onopen=()=>{e.send(JSON.stringify({event:this.registrationParameters.registerEvent,uuid:this.registrationParameters.pluginUUID})),this.connection.resolve(e),this.emit("connected",this.registrationParameters.info)}}await this.connection.promise}async send(e){const t=await this.connection.promise,a=JSON.stringify(e);this.logger.trace(a),t.send(a)}getRegistrationParameters(){const e={port:void 0,info:void 0,pluginUUID:void 0,registerEvent:void 0},t=$e.createScope("RegistrationParameters");for(let a=0;a<process.argv.length-1;a++){const i=process.argv[a],s=process.argv[++a];switch(i){case pe.Port:t.debug(`port=${s}`),e.port=s;break;case pe.PluginUUID:t.debug(`pluginUUID=${s}`),e.pluginUUID=s;break;case pe.RegisterEvent:t.debug(`registerEvent=${s}`),e.registerEvent=s;break;case pe.Info:t.debug(`info=${s}`),e.info=JSON.parse(s);break;default:a--}}const a=[],i=(e,t)=>{void 0===t&&a.push(e)};if(i(pe.Port,e.port),i(pe.PluginUUID,e.pluginUUID),i(pe.RegisterEvent,e.registerEvent),i(pe.Info,e.info),a.length>0)throw new Error(`Unable to establish a connection with Stream Deck, missing command line arguments: ${a.join(", ")}`);return e}tryEmit(e){try{const t=JSON.parse(e.data.toString());t.event?(this.logger.trace(e.data.toString()),this.emit(t.event,t)):this.logger.warn(`Received unknown message: ${e.data}`)}catch(t){this.logger.error(`Failed to parse message: ${e.data}`,t)}}};class xe{type;constructor(e){this.type=e.event}}class Te extends xe{action;constructor(e,t){super(t),this.action=e}}class Ae extends Te{payload;constructor(e,t){super(e,t),this.payload=t.payload}}const De=new T(()=>{const e=m(process.cwd(),"manifest.json");if(!h(e))throw new Error("Failed to read manifest.json as the file does not exist.");try{return JSON.parse(u(e,{encoding:"utf-8",flag:"r"}).toString())}catch(e){if(e instanceof SyntaxError)return null;throw e}}),Re=new T(()=>null===De.value?null:new ye(De.value.Software.MinimumVersion));function Ee(){return Re.value}const Pe=new Map;class Le extends x{constructor(){super(Pe)}getActionById(e){return Pe.get(e)}}const Ne=new class extends Le{delete(e){Pe.delete(e)}set(e){Pe.set(e.id,e)}};class Be extends xe{application;constructor(e){super(e),this.application=e.payload.application}}class Fe extends xe{device;constructor(e,t){super(e),this.device=t}}class Oe extends xe{url;constructor(e){super(e),this.url=new Ue(e.payload.url)}}const Me="streamdeck://";class Ue{fragment;href;path;query;queryParameters;constructor(e){const t=new URL(`${Me}${e}`);this.fragment=t.hash.substring(1),this.href=t.href.substring(13),this.path=Ue.parsePath(this.href),this.query=t.search.substring(1),this.queryParameters=t.searchParams}static parsePath(e){const t=t=>{const a=e.indexOf(t);return a>=0?a:e.length};return e.substring(0,Math.min(t("?"),t("#")))}}class Ge extends xe{settings;constructor(e){super(e),this.settings=e.payload.settings}}class je extends xe{action;payload;constructor(e,t){super(t),this.action=e,this.payload=t.payload}}function We(e,t){const a=De.value?.SDKVersion??null;if(null!==a&&e>a)throw new Error(`[ERR_NOT_SUPPORTED]: ${t} requires manifest SDK version ${e} or higher, but found version ${a}; please update the "SDKVersion" in the plugin's manifest to ${e} or higher.`)}function Ke(e,t,a){const i={major:Math.floor(e),minor:Number(e.toString().split(".").at(1)??0),patch:0,build:0};if(-1===t.compareTo(i))throw new Error(`[ERR_NOT_SUPPORTED]: ${a} requires Stream Deck version ${i.major}.${i.minor} or higher, but current version is ${t.major}.${t.minor}; please update Stream Deck and the "Software.MinimumVersion" in the plugin's manifest to "${i.major}.${i.minor}" or higher.`);const s=Ee();if(null!==s&&-1===s.compareTo(i))throw new Error(`[ERR_NOT_SUPPORTED]: ${a} requires Stream Deck version ${i.major}.${i.minor} or higher; please update the "Software.MinimumVersion" in the plugin's manifest to "${i.major}.${i.minor}" or higher.`)}let Ve=!1;const qe={get useExperimentalMessageIdentifiers(){return Ve},set useExperimentalMessageIdentifiers(e){Ke(7.1,Ie.version,"Message identifiers"),Ve=e},getGlobalSettings:()=>new Promise(e=>{Ie.once("didReceiveGlobalSettings",t=>e(t.payload.settings)),Ie.send({event:"getGlobalSettings",context:Ie.registrationParameters.pluginUUID,id:y()})}),onDidReceiveGlobalSettings:e=>Ie.disposableOn("didReceiveGlobalSettings",t=>{qe.useExperimentalMessageIdentifiers&&t.id||e(new Ge(t))}),onDidReceiveSettings:e=>Ie.disposableOn("didReceiveSettings",t=>{if(qe.useExperimentalMessageIdentifiers&&t.id)return;const a=Ne.getActionById(t.context);a&&e(new Ae(a,t))}),setGlobalSettings:async e=>{await Ie.send({event:"setGlobalSettings",context:Ie.registrationParameters.pluginUUID,payload:e})}};const ze=new class{#m;#f=0;constructor(){this.onDidAppear(e=>{this.#g(e.action)?this.#f++:(this.#f=1,this.#m=e.action)}),this.onDidDisappear(e=>{this.#g(e.action)&&(this.#f--,this.#f<=0&&(this.#m=void 0))})}get action(){return this.#m}onDidAppear(e){return Ie.disposableOn("propertyInspectorDidAppear",t=>{const a=Ne.getActionById(t.context);a&&e(new Te(a,t))})}onDidDisappear(e){return Ie.disposableOn("propertyInspectorDidDisappear",t=>{const a=Ne.getActionById(t.context);a&&e(new Te(a,t))})}onSendToPlugin(e){return Ie.disposableOn("sendToPlugin",t=>{const a=Ne.getActionById(t.context);a&&e(new je(a,t))})}async sendToPropertyInspector(e){this.#m&&await Ie.send({event:"sendToPropertyInspector",context:this.#m.id,payload:e})}#g(e){return this.#m?.id===e.id&&this.#m?.manifestId===e.manifestId&&this.#m?.device?.id===e.device.id}},He=new Map;class Je extends x{constructor(){super(He)}getDeviceById(e){return He.get(e)}}const Ye=new class extends Je{set(e){He.set(e.id,e)}};class Qe{#y;#w;constructor(e){this.#w=e;const t=Ye.getDeviceById(e.device);if(!t)throw new Error(`Failed to initialize action; device ${e.device} not found`);this.#y=t}get controllerType(){return this.#w.payload.controller}get device(){return this.#y}get id(){return this.#w.context}get manifestId(){return this.#w.action}toJSON(){return{controllerType:this.controllerType,device:this.device,id:this.id,manifestId:this.manifestId}}}class Xe extends Qe{async getResources(){Ke(7.1,Ie.version,"getResources");return(await this.#v("getResources","didReceiveResources")).payload.resources}async getSettings(){return(await this.#v("getSettings","didReceiveSettings")).payload.settings}isDial(){return"Encoder"===this.controllerType}isKey(){return"Keypad"===this.controllerType}setResources(e){return Ke(7.1,Ie.version,"setResources"),Ie.send({event:"setResources",context:this.id,payload:e})}setSettings(e){return Ie.send({event:"setSettings",context:this.id,payload:e})}showAlert(){return Ie.send({event:"showAlert",context:this.id})}async#v(e,t){const{resolve:a,reject:i,promise:s}=A(),n=setTimeout(()=>{r.dispose(),i("The request timed out")},15e3),r=Ie.disposableOn(t,e=>{e.context==this.id&&(clearTimeout(n),r.dispose(),a(e))});return await Ie.send({event:e,context:this.id,id:y()}),s}}class Ze extends Xe{#b;constructor(e){if(super(e),"Encoder"!==e.payload.controller)throw new Error("Unable to create DialAction; source event is not a Encoder");this.#b=Object.freeze(e.payload.coordinates)}get coordinates(){return this.#b}setFeedback(e){return Ie.send({event:"setFeedback",context:this.id,payload:e})}setFeedbackLayout(e){return Ie.send({event:"setFeedbackLayout",context:this.id,payload:{layout:e}})}setImage(e){return Ie.send({event:"setImage",context:this.id,payload:{image:e}})}setTitle(e){return this.setFeedback({title:e})}setTriggerDescription(e){return Ie.send({event:"setTriggerDescription",context:this.id,payload:e||{}})}toJSON(){return{...super.toJSON(),coordinates:this.coordinates}}}class et extends Xe{#b;#w;constructor(e){if(super(e),"Keypad"!==e.payload.controller)throw new Error("Unable to create KeyAction; source event is not a Keypad");this.#b=e.payload.isInMultiAction?void 0:Object.freeze(e.payload.coordinates),this.#w=e}get coordinates(){return this.#b}isInMultiAction(){return this.#w.payload.isInMultiAction}setImage(e,t){return Ie.send({event:"setImage",context:this.id,payload:{image:e,...t}})}setState(e){return Ie.send({event:"setState",context:this.id,payload:{state:e}})}setTitle(e,t){return Ie.send({event:"setTitle",context:this.id,payload:{title:e,...t}})}showOk(){return Ie.send({event:"showOk",context:this.id})}toJSON(){return{...super.toJSON(),coordinates:this.coordinates,isInMultiAction:this.isInMultiAction()}}}const tt=new T(()=>De.value);const at=new class extends Le{constructor(){super(),Ie.prependListener("willAppear",e=>{const t="Encoder"===e.payload.controller?new Ze(e):new et(e);Ne.set(t)}),Ie.prependListener("willDisappear",e=>Ne.delete(e.context))}onDialDown(e){return Ie.disposableOn("dialDown",t=>{const a=Ne.getActionById(t.context);a?.isDial()&&e(new Ae(a,t))})}onDialRotate(e){return Ie.disposableOn("dialRotate",t=>{const a=Ne.getActionById(t.context);a?.isDial()&&e(new Ae(a,t))})}onDialUp(e){return Ie.disposableOn("dialUp",t=>{const a=Ne.getActionById(t.context);a?.isDial()&&e(new Ae(a,t))})}onDidReceiveResources(e){return Ie.disposableOn("didReceiveResources",t=>{if(void 0!==t.id)return;const a=Ne.getActionById(t.context);a&&e(new Ae(a,t))})}onKeyDown(e){return Ie.disposableOn("keyDown",t=>{const a=Ne.getActionById(t.context);a?.isKey()&&e(new Ae(a,t))})}onKeyUp(e){return Ie.disposableOn("keyUp",t=>{const a=Ne.getActionById(t.context);a?.isKey()&&e(new Ae(a,t))})}onTitleParametersDidChange(e){return Ie.disposableOn("titleParametersDidChange",t=>{const a=Ne.getActionById(t.context);a&&e(new Ae(a,t))})}onTouchTap(e){return Ie.disposableOn("touchTap",t=>{const a=Ne.getActionById(t.context);a?.isDial()&&e(new Ae(a,t))})}onWillAppear(e){return Ie.disposableOn("willAppear",t=>{const a=Ne.getActionById(t.context);a&&e(new Ae(a,t))})}onWillDisappear(e){return Ie.disposableOn("willDisappear",t=>e(new Ae(new Qe(t),t)))}registerAction(e){if(void 0===e.manifestId)throw new Error("The action's manifestId cannot be undefined.");if(null!==tt.value&&!tt.value.Actions.some(t=>t.UUID===e.manifestId))throw new Error(`The action's manifestId was not found within the manifest: ${e.manifestId}`);const{manifestId:t}=e,a=(a,i)=>{const s=i?.bind(e);void 0!==s&&a.bind(e)(async e=>{e.action.manifestId==t&&await s(e)})};a(this.onDialDown,e.onDialDown),a(this.onDialUp,e.onDialUp),a(this.onDialRotate,e.onDialRotate),a(ze.onSendToPlugin,e.onSendToPlugin),a(this.onDidReceiveResources,e.onDidReceiveResources),a(qe.onDidReceiveSettings,e.onDidReceiveSettings),a(this.onKeyDown,e.onKeyDown),a(this.onKeyUp,e.onKeyUp),a(ze.onDidAppear,e.onPropertyInspectorDidAppear),a(ze.onDidDisappear,e.onPropertyInspectorDidDisappear),a(this.onTitleParametersDidChange,e.onTitleParametersDidChange),a(this.onTouchTap,e.onTouchTap),a(this.onWillAppear,e.onWillAppear),a(this.onWillDisappear,e.onWillDisappear)}};class it{#S=!1;#_;id;constructor(e,t,a){this.id=e,this.#_=t,this.#S=a,Ie.prependListener("deviceDidConnect",e=>{e.device===this.id&&(this.#_=e.deviceInfo,this.#S=!0)}),Ie.prependListener("deviceDidChange",e=>{e.device===this.id&&(this.#_=e.deviceInfo)}),Ie.prependListener("deviceDidDisconnect",e=>{e.device===this.id&&(this.#S=!1)})}get actions(){return Ne.filter(e=>e.device.id===this.id)}get isConnected(){return this.#S}get name(){return this.#_.name}get size(){return this.#_.size}get type(){return this.#_.type}}const st=new class extends Je{constructor(){super(),Ie.once("connected",e=>{e.devices.forEach(e=>Ye.set(new it(e.id,e,!1)))}),Ie.on("deviceDidConnect",({device:e,deviceInfo:t})=>{Ye.getDeviceById(e)||Ye.set(new it(e,t,!0))}),Ie.on("deviceDidChange",({device:e,deviceInfo:t})=>{Ye.getDeviceById(e)||Ye.set(new it(e,t,!1))})}onDeviceDidChange(e){return Ke(7,Ie.version,"onDeviceDidChange"),Ie.disposableOn("deviceDidChange",t=>e(new Fe(t,this.getDeviceById(t.device))))}onDeviceDidConnect(e){return Ie.disposableOn("deviceDidConnect",t=>e(new Fe(t,this.getDeviceById(t.device))))}onDeviceDidDisconnect(e){return Ie.disposableOn("deviceDidDisconnect",t=>e(new Fe(t,this.getDeviceById(t.device))))}};function nt(e){const t=p.join(process.cwd(),`${e}.json`);if(!d.existsSync(t))return null;try{const e=d.readFileSync(t,{flag:"r"})?.toString();return function(e){const t=JSON.parse(e);if(null!=t&&"object"==typeof t&&"Localization"in t)return t.Localization;throw new TypeError('Translations must be a JSON object nested under a property named "Localization"')}(e)}catch(e){return $e.error(`Failed to load translations from ${t}`,e),null}}var rt=Object.freeze({__proto__:null,switchToProfile:function(e,t,a){return void 0!==a&&Ke(6.5,Ie.version,"Switching to a profile page"),Ie.send({event:"switchToProfile",context:Ie.registrationParameters.pluginUUID,device:e,payload:{page:a,profile:t}})}});var ot=Object.freeze({__proto__:null,getSecrets:function(){return Ke(6.9,Ie.version,"Secrets"),We(3,"Secrets"),new Promise(e=>{Ie.once("didReceiveSecrets",t=>e(t.payload.secrets)),Ie.send({event:"getSecrets",context:Ie.registrationParameters.pluginUUID})})},onApplicationDidLaunch:function(e){return Ie.disposableOn("applicationDidLaunch",t=>e(new Be(t)))},onApplicationDidTerminate:function(e){return Ie.disposableOn("applicationDidTerminate",t=>e(new Be(t)))},onDidReceiveDeepLink:function(e){return Ke(6.5,Ie.version,"Receiving deep-link messages"),Ie.disposableOn("didReceiveDeepLink",t=>e(new Oe(t)))},onSystemDidWakeUp:function(e){return Ie.disposableOn("systemDidWakeUp",t=>e(new xe(t)))},openUrl:function(e){return Ie.send({event:"openUrl",payload:{url:e}})}});function lt(e){const t=e.UUID;return function(e,a){return class extends e{manifestId=t}}}class ct{manifestId;get actions(){return Ne.filter(e=>e.manifestId===this.manifestId)}}let dt;const ht={get actions(){return at},get devices(){return st},get i18n(){return dt??=new I(this.info.application.language,nt)},get info(){return Ie.registrationParameters.info},get logger(){return $e},get profiles(){return rt},get settings(){return qe},get system(){return ot},get ui(){return ze},connect:()=>Ie.connect()};function ut(e,t,a,i,s,n){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",d=!t&&e?i.static?e:e.prototype:null,h=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,p=a.length-1;p>=0;p--){var m={};for(var f in i)m[f]="access"===f?{}:i[f];for(var f in i.access)m.access[f]=i.access[f];m.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");n.push(r(e||null))};var g=(0,a[p])("accessor"===l?{get:h.get,set:h.set}:h[c],m);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=r(g.get))&&(h.get=o),(o=r(g.set))&&(h.set=o),(o=r(g.init))&&s.unshift(o)}else(o=r(g))&&("field"===l?s.unshift(o):h[c]=o)}d&&Object.defineProperty(d,i.name,h),u=!0}function pt(e,t,a){for(var i=arguments.length>2,s=0;s<t.length;s++)a=i?t[s].call(e,a):t[s].call(e);return i?a:void 0}"function"==typeof SuppressedError&&SuppressedError;const mt=ht.logger.createScope("LcuConnector");const ft=new class{credentials=null;pollInterval=null;listeners=[];getCredentials(){return this.credentials}isConnected(){return null!==this.credentials}onConnectionChange(e){this.listeners.push(e)}startPolling(e=3e3){this.pollInterval||(this.discover().catch(e=>mt.error(`LCU discover error: ${e}`)),this.pollInterval=setInterval(()=>{this.discover().catch(e=>mt.error(`LCU discover error: ${e}`))},e),mt.info("Started LCU polling"))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async discover(){if(this.credentials){if(await this.pingLcu())return;return this.credentials=null,mt.info("LCU client lost (ping failed)"),void this.notifyListeners()}try{const e=await this.discoverFromProcess();if(e)return this.credentials=e,mt.info(`LCU discovered on port ${e.port}`),void this.notifyListeners()}catch{}try{const e=await this.discoverFromLockfile();if(e)return this.credentials=e,mt.info(`LCU discovered from lockfile on port ${e.port}`),void this.notifyListeners()}catch{}}pingAgent=new S.Agent({rejectUnauthorized:!1,keepAlive:!0});pingLcu(){if(!this.credentials)return Promise.resolve(!1);const{port:e,password:t}=this.credentials;return new Promise(a=>{const i=S.request({hostname:"127.0.0.1",port:e,path:"/Help",method:"GET",headers:{Authorization:`Basic ${Buffer.from(`riot:${t}`).toString("base64")}`},agent:this.pingAgent,timeout:2e3},e=>{e.resume(),200!==e.statusCode&&mt.warn(`LCU ping got status ${e.statusCode}`),a(200===e.statusCode)});i.on("error",e=>{mt.warn(`LCU ping error: ${e.message}`),a(!1)}),i.on("timeout",()=>{mt.warn("LCU ping timeout"),i.destroy(),a(!1)}),i.end()})}discoverFromProcess(){return new Promise((e,t)=>{const a="win32"===process.platform?'powershell.exe -NoProfile -Command "Get-CimInstance Win32_Process -Filter \\"name=\'LeagueClientUx.exe\'\\" | Select-Object -ExpandProperty CommandLine"':"ps -A -o args | grep LeagueClientUx";w(a,{timeout:5e3},(a,i)=>{if(a)return void t(a);const s=i.match(/--app-port=(\d+)/),n=i.match(/--remoting-auth-token=([\w_-]+)/),r=i.match(/--app-pid=(\d+)/);e(s&&n?{port:parseInt(s[1],10),password:n[1],pid:r?parseInt(r[1],10):0,protocol:"https"}:null)})})}async discoverFromLockfile(){const e="win32"===process.platform?["C:\\Riot Games\\League of Legends\\lockfile","D:\\Riot Games\\League of Legends\\lockfile",m(process.env.LOCALAPPDATA||"","Riot Games","League of Legends","lockfile")]:["/Applications/League of Legends.app/Contents/LoL/lockfile"];for(const t of e)try{const e=(await b(t,"utf-8")).split(":");if(e.length>=5)return{pid:parseInt(e[1],10),port:parseInt(e[2],10),password:e[3],protocol:e[4]}}catch{continue}return null}notifyListeners(){for(const e of this.listeners)try{e(this.credentials)}catch(e){mt.error(`Listener error: ${e}`)}}},gt=ht.logger.createScope("LcuApi");const yt=new class{agent=new S.Agent({rejectUnauthorized:!1,keepAlive:!0});getCache=new Map;GET_CACHE_TTL=500;async get(e){const t=ft.getCredentials();if(!t)return null;const a=this.getCache.get(e);return a&&Date.now()-a.timestamp<this.GET_CACHE_TTL?a.data:(a&&this.getCache.delete(e),new Promise(a=>{const i=Buffer.from(`riot:${t.password}`).toString("base64"),s=S.request({hostname:"127.0.0.1",port:t.port,path:e,method:"GET",headers:{Authorization:`Basic ${i}`,Accept:"application/json"},agent:this.agent},t=>{let i="";t.on("data",e=>{i+=e.toString()}),t.on("end",()=>{try{if(200===t.statusCode){const t=JSON.parse(i);this.getCache.set(e,{data:t,timestamp:Date.now()}),a(t)}else gt.warn(`LCU ${e} returned ${t.statusCode}`),a(null)}catch(t){gt.error(`LCU parse error on ${e}: ${t}`),a(null)}})});s.on("error",t=>{gt.debug(`LCU request error on ${e}: ${t.message}`),a(null)}),s.setTimeout(3e3,()=>{s.destroy(),a(null)}),s.end()}))}async post(e,t){const a=ft.getCredentials();return!!a&&new Promise(i=>{const s=Buffer.from(`riot:${a.password}`).toString("base64"),n=t?JSON.stringify(t):"",r=S.request({hostname:"127.0.0.1",port:a.port,path:e,method:"POST",headers:{Authorization:`Basic ${s}`,"Content-Type":"application/json","Content-Length":Buffer.byteLength(n)},agent:this.agent},t=>{let a="";t.on("data",e=>{a+=e.toString()}),t.on("end",()=>{t.statusCode&&t.statusCode>=200&&t.statusCode<300?i(!0):(gt.warn(`LCU POST ${e} returned ${t.statusCode}`),i(!1))})});r.on("error",t=>{gt.debug(`LCU POST error on ${e}: ${t.message}`),i(!1)}),r.setTimeout(3e3,()=>{r.destroy(),i(!1)}),r.write(n),r.end()})}async getGameflowPhase(){return await this.get("/lol-gameflow/v1/gameflow-phase")??"None"}async getChampSelectSession(){return this.get("/lol-champ-select/v1/session")}async getCurrentSummoner(){return this.get("/lol-summoner/v1/current-summoner")}async getRegion(){const e=await this.get("/riotclient/region-locale");return e?.region??null}async getSummonerByPuuid(e){return this.get(`/lol-summoner/v2/summoners/puuid/${encodeURIComponent(e)}`)}async getRankedStats(e){return this.get(`/lol-ranked/v1/ranked-stats/${encodeURIComponent(e)}`)}async getCurrentRankedStats(){return this.get("/lol-ranked/v1/current-ranked-stats")}async put(e,t){return await this.request("PUT",e,t)??null}async patch(e,t){gt.debug(`PATCH ${e} body: ${JSON.stringify(t)}`);return await this.request("PATCH",e,t)}async del(e){const t=ft.getCredentials();return!!t&&new Promise(a=>{const i=Buffer.from(`riot:${t.password}`).toString("base64"),s=S.request({hostname:"127.0.0.1",port:t.port,path:e,method:"DELETE",headers:{Authorization:`Basic ${i}`},agent:this.agent},e=>{let t="";e.on("data",e=>{t+=e.toString()}),e.on("end",()=>{a(void 0!==e.statusCode&&e.statusCode>=200&&e.statusCode<300)})});s.on("error",()=>a(!1)),s.setTimeout(3e3,()=>{s.destroy(),a(!1)}),s.end()})}async request(e,t,a){const i=ft.getCredentials();return i?new Promise(s=>{const n=Buffer.from(`riot:${i.password}`).toString("base64"),r=a?JSON.stringify(a):"",o=S.request({hostname:"127.0.0.1",port:i.port,path:t,method:e,headers:{Authorization:`Basic ${n}`,"Content-Type":"application/json","Content-Length":Buffer.byteLength(r),Accept:"application/json"},agent:this.agent},a=>{let i="";a.on("data",e=>{i+=e.toString()}),a.on("end",()=>{try{a.statusCode&&a.statusCode>=200&&a.statusCode<300&&i.length>0?s(JSON.parse(i)):a.statusCode&&a.statusCode>=200&&a.statusCode<300?s(void 0):(gt.warn(`LCU ${e} ${t} returned ${a.statusCode}: ${i.slice(0,200)}`),s(null))}catch{s(null)}})});o.on("error",a=>{gt.warn(`LCU ${e} ${t} error: ${a.message}`),s(null)}),o.setTimeout(3e3,()=>{o.destroy(),s(null)}),o.write(r),o.end()}):null}async getRunePages(){return await this.get("/lol-perks/v1/pages")??[]}async getCurrentRunePage(){return this.get("/lol-perks/v1/currentpage")}async createRunePage(e){return ft.getCredentials()?await this.request("POST","/lol-perks/v1/pages",e)??null:null}async updateRunePage(e,t){return this.put(`/lol-perks/v1/pages/${e}`,t)}async deleteRunePage(e){return this.del(`/lol-perks/v1/pages/${e}`)}async setSummonerSpells(e,t){return null!==await this.patch("/lol-champ-select/v1/session/my-selection",{spell1Id:e,spell2Id:t})}};ht.logger.createScope("GameClient");const wt=new S.Agent({rejectUnauthorized:!1});const vt=new class{cachedData=null;lastFetchTime=0;cacheTtlMs=500;request(e){return new Promise(t=>{const a=new URL(e,"https://127.0.0.1:2999"),i=S.request({hostname:a.hostname,port:a.port,path:a.pathname,method:"GET",headers:{Accept:"application/json"},agent:wt},e=>{let a="";e.on("data",e=>{a+=e.toString()}),e.on("end",()=>{try{200===e.statusCode?t(JSON.parse(a)):t(null)}catch{t(null)}})});i.on("error",()=>{t(null)}),i.setTimeout(2e3,()=>{i.destroy(),t(null)}),i.end()})}async isInGame(){return null!==await this.request("/liveclientdata/gamestats")}async getAllData(){const e=Date.now();if(this.cachedData&&e-this.lastFetchTime<this.cacheTtlMs)return this.cachedData;const t=await this.request("/liveclientdata/allgamedata");return t?(this.cachedData=t,this.lastFetchTime=e):this.cachedData=null,this.cachedData}async getActivePlayer(){const e=await this.getAllData();return e?.activePlayer??null}async getAllPlayers(){const e=await this.getAllData();return e?.allPlayers??[]}async getEnemyPlayers(){const e=await this.getAllData();if(!e)return[];const t=e.activePlayer.summonerName,a=e.allPlayers.find(e=>e.riotIdGameName===t||e.summonerName===t);return a?e.allPlayers.filter(e=>e.team!==a.team):[]}async getGameTime(){const e=await this.getAllData();return e?.gameData.gameTime??0}async getEvents(){const e=await this.getAllData();return e?.events??null}clearCache(){this.cachedData=null,this.lastFetchTime=0}},bt=ht.logger.createScope("GameMode");const St=new class{currentMode="NONE";currentPhase="None";pollTimer=null;listeners=[];start(){this.pollTimer||(this.refresh().catch(()=>{}),this.pollTimer=setInterval(()=>this.refresh().catch(()=>{}),2e3),bt.info("GameMode service started"))}stop(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}get(){return this.currentMode}isTFT(){return"TFT"===this.currentMode}isLoL(){return"CLASSIC"===this.currentMode||"ARAM"===this.currentMode}isArena(){return"CHERRY"===this.currentMode}isARAM(){return"ARAM"===this.currentMode}getPhase(){return this.currentPhase}onChange(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}async refresh(){if(!ft.isConnected())return void this.update("NONE","None");const e=await yt.getGameflowPhase();if("None"===e)return void this.update("NONE",e);const t=await yt.get("/lol-gameflow/v1/session"),a=(t?.gameData?.queue?.gameMode??"").toUpperCase();let i;switch(a){case"CLASSIC":case"PRACTICETOOL":i="CLASSIC";break;case"ARAM":i="ARAM";break;case"TFT":i="TFT";break;case"CHERRY":i="CHERRY";break;case"":i="NONE"!==this.currentMode&&"UNKNOWN"!==this.currentMode?this.currentMode:"NONE";break;default:"NONE"!==this.currentMode&&"UNKNOWN"!==this.currentMode?(i=this.currentMode,bt.debug(`Unhandled game mode "${a}", retaining ${i}`)):(i="UNKNOWN",bt.debug(`Unknown game mode: "${a}"`))}this.update(i,e)}update(e,t){if(!(e!==this.currentMode||t!==this.currentPhase))return;const a=this.currentMode,i=this.currentPhase;this.currentMode=e,this.currentPhase=t,bt.info(`Mode: ${a}${e}, Phase: ${i}${t}`);for(const a of this.listeners)try{a(e,t)}catch(e){bt.error(`GameMode listener error: ${e}`)}}},_t=ht.logger.createScope("GameStatus"),kt={None:{label:"Status\nOffline"},Lobby:{label:"Status\nLobby"},Matchmaking:{label:"Status\nQueue..."},ReadyCheck:{label:"MATCH\nFOUND"},ChampSelect:{label:"Champ\nSelect"},GameStart:{label:"Status\nLoading"},InProgress:{label:"Status\nIn Game"},WaitingForStats:{label:"Status\nStats..."},EndOfGame:{label:"Status\nEnd"},Reconnect:{label:"Status\nReconnect"}},Ct={Lobby:{label:"TFT\nLobby"},Matchmaking:{label:"TFT\nQueue..."},ReadyCheck:{label:"TFT\nFOUND"},ChampSelect:{label:"TFT\nLoading"},GameStart:{label:"TFT\nLoading"},InProgress:{label:"TFT\nIn Game"},WaitingForStats:{label:"TFT\nStats..."},EndOfGame:{label:"TFT\nEnd"},Reconnect:{label:"TFT\nReconnect"}},$t={EUW:"euw",EUNE:"eune",NA:"na",KR:"kr",JP:"jp",BR:"br",LAN:"lan",LAS:"las",OCE:"oce",TR:"tr",RU:"ru",PH:"ph",SG:"sg",TH:"th",TW:"tw",VN:"vn",ME:"me"};let It=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.game-status"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;currentPhase="None";detectedRegion=null;onWillAppear(e){return this.startPolling(),e.action.setTitle("LoL\nStatus")}onWillDisappear(e){0===this.actions.length&&this.stopPolling()}async onKeyDown(e){if(ft.isConnected())try{const t=await yt.getCurrentSummoner();if(t&&t.gameName){const a=encodeURIComponent(t.gameName),i=encodeURIComponent(t.tagLine||"EUW");if(!this.detectedRegion){const e=await yt.getRegion();e&&(this.detectedRegion=$t[e.toUpperCase()]??e.toLowerCase())}const s=`https://www.op.gg/summoners/${e.payload.settings.region??this.detectedRegion??"euw"}/${a}-${i}`;return _t.info(`Opening OP.GG: ${s}`),void("darwin"===process.platform?v("open",[s],{stdio:"ignore"}):v("cmd",["/c","start","",s],{stdio:"ignore"}))}}catch(e){_t.error(`Failed to open OP.GG: ${e}`)}await this.updateStatus()}startPolling(){this.pollInterval||(this.updateStatus().catch(e=>_t.error(`updateStatus error: ${e}`)),this.pollInterval=setInterval(()=>this.updateStatus().catch(e=>_t.error(`updateStatus error: ${e}`)),2e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateStatus(){let e="None";if(ft.isConnected()&&(e=await yt.getGameflowPhase()),"InProgress"===e&&!St.isTFT()){await vt.isInGame()||(e="GameStart")}if(e!==this.currentPhase){this.currentPhase=e;const t=(St.isTFT()?Ct:kt)[e]??kt[e]??kt.None;_t.info(`Game phase changed: ${e} (mode=${St.get()})`);for(const e of this.actions)await e.setTitle(t.label)}}},t})();const xt=ht.logger.createScope("DataDragon"),Tt="https://ddragon.leagueoflegends.com";class At{version=null;champions=new Map;championsByKey=new Map;summonerSpells=new Map;items=new Map;initialized=!1;versionCheckTimer=null;static VERSION_CHECK_INTERVAL=18e5;isReady(){return this.initialized}async init(){if(!this.initialized)try{const e=await this.fetchJson(`${Tt}/api/versions.json`);e&&e.length>0?(this.version=e[0],xt.info(`Data Dragon version: ${this.version}`)):(this.version="14.24.1",xt.warn(`Could not fetch DD version, using fallback ${this.version}`)),await this.loadChampions(),await this.loadSummonerSpells(),await this.loadItems(),this.initialized=!0,xt.info(`Data Dragon initialized: ${this.champions.size} champions, ${this.summonerSpells.size} spells, ${this.items.size} items`),this.startVersionCheck()}catch(e){xt.error(`Data Dragon init failed: ${e}`)}}startVersionCheck(){this.versionCheckTimer||(this.versionCheckTimer=setInterval(()=>this.checkForNewVersion().catch(()=>{}),At.VERSION_CHECK_INTERVAL))}async checkForNewVersion(){const e=await this.fetchJson(`${Tt}/api/versions.json`);if(!e||0===e.length)return;const t=e[0];if(t===this.version)return;xt.info(`New Data Dragon version detected: ${this.version}  ${t}`);const a=this.version;this.version=t;const i=new Map,s=new Map,n=new Map,r=new Map;try{const e=await this.fetchJson(`${Tt}/cdn/${t}/data/en_US/champion.json`);if(e?.data)for(const[t,a]of Object.entries(e.data))i.set(t,a),s.set(a.key,a);const a=await this.fetchJson(`${Tt}/cdn/${t}/data/en_US/summoner.json`);if(a?.data)for(const[e,t]of Object.entries(a.data))n.set(e,t);const o=await this.fetchJson(`${Tt}/cdn/${t}/data/en_US/item.json`);if(o?.data)for(const[e,t]of Object.entries(o.data))r.set(e,t);if(0===i.size)throw new Error("Champion data empty after fetch");this.champions=i,this.championsByKey=s,this.summonerSpells=n,this.items=r,xt.info(`Data Dragon refreshed: ${this.champions.size} champions, ${this.summonerSpells.size} spells, ${this.items.size} items`)}catch(e){xt.error(`Data Dragon refresh failed, keeping ${a}: ${e}`),this.version=a}}getVersion(){return this.version??"14.24.1"}getChampion(e){return this.champions.get(e)}getChampionByKey(e){return this.championsByKey.get(e)}getChampionByName(e){const t=e.toLowerCase();for(const e of this.champions.values())if(e.name.toLowerCase()===t||e.id.toLowerCase()===t)return e}getChampionImageUrl(e){return`${Tt}/cdn/${this.getVersion()}/img/champion/${e}.png`}getAllChampions(){return this.champions.values()}getSummonerSpell(e){return this.summonerSpells.get(e)}getSpellImageUrl(e){const t=this.summonerSpells.get(e),a=t?.image.full??`${e}.png`;return`${Tt}/cdn/${this.getVersion()}/img/spell/${a}`}getItem(e){return this.items.get(e)}getItemName(e){return this.items.get(String(e))?.name??`Item ${e}`}getItemCost(e){return this.items.get(String(e))?.gold.total??0}getItemComponents(e){const t=this.items.get(String(e));return t?.from?.map(Number).filter(e=>!isNaN(e))??[]}getItemBaseCost(e){return this.items.get(String(e))?.gold.base??0}getItemImageUrl(e){return`${Tt}/cdn/${this.getVersion()}/img/item/${e}.png`}async loadChampions(){const e=`${Tt}/cdn/${this.getVersion()}/data/en_US/champion.json`,t=await this.fetchJson(e);if(t?.data)for(const[e,a]of Object.entries(t.data))this.champions.set(e,a),this.championsByKey.set(a.key,a)}async loadSummonerSpells(){const e=`${Tt}/cdn/${this.getVersion()}/data/en_US/summoner.json`,t=await this.fetchJson(e);if(t?.data)for(const[e,a]of Object.entries(t.data))this.summonerSpells.set(e,a)}async loadItems(){const e=`${Tt}/cdn/${this.getVersion()}/data/en_US/item.json`,t=await this.fetchJson(e);if(t?.data)for(const[e,a]of Object.entries(t.data))this.items.set(e,a)}async fetchJson(e){try{const t=await fetch(e,{signal:AbortSignal.timeout(15e3)});return t.ok?await t.json():(xt.warn(`DD fetch ${e} returned ${t.status}`),null)}catch(t){return xt.error(`DD fetch error ${e}: ${t}`),null}}}const Dt=new At,Rt=ht.logger.createScope("LoLIcons"),Et=new Map;async function Pt(e,t){const a=Et.get(e);if(void 0!==a){if(""!==a.data)return a.data;if(Date.now()-a.timestamp<3e5)return null;Et.delete(e)}try{const a=await fetch(t);if(!a.ok)return Rt.warn(`Icon fetch failed (${a.status}): ${t}`),Et.set(e,{data:"",timestamp:Date.now()}),null;const i=`data:image/png;base64,${Buffer.from(await a.arrayBuffer()).toString("base64")}`;if(Et.size>=500){const e=Et.keys().next().value;e&&Et.delete(e)}return Et.set(e,{data:i,timestamp:Date.now()}),i}catch(a){return Rt.error(`Icon fetch error: ${t}  ${a}`),Et.set(e,{data:"",timestamp:Date.now()}),null}}async function Lt(e){const t=function(e){if(!e)return null;const t=e.toLowerCase().replace(/['\s.]/g,"");for(const e of Dt.getAllChampions()){if(e.id.toLowerCase().replace(/['\s.]/g,"")===t)return e.id}return null}(e);return t?Pt(`champ:${e}`,Dt.getChampionImageUrl(t)):(Rt.warn(`Cannot resolve DDragon ID for alias: ${e}`),null)}async function Nt(e){if(!e)return null;const t=Dt.getChampionByKey(e);return t?Pt(`champ:${t.id.toLowerCase()}`,Dt.getChampionImageUrl(t.id)):null}async function Bt(e){if(!e)return null;const t=e.toLowerCase().replace(/['\s.]/g,"");for(const e of Dt.getAllChampions()){const a=e.id.toLowerCase().replace(/['\s.]/g,""),i=e.name.toLowerCase().replace(/['\s.]/g,"");if(a===t||i===t)return Pt(`champ:${a}`,Dt.getChampionImageUrl(e.id))}return null}function Ft(e){for(const t of e)Et.has(`champ:${t}`)||Lt(t).catch(()=>{})}async function Ot(e){return Pt(`item:${e}`,`https://ddragon.leagueoflegends.com/cdn/${Dt.getVersion()}/img/item/${e}.png`)}const Mt="https://raw.communitydragon.org/latest/game/assets/ux/minimap/icons",Ut={blue:`${Mt}/blue.png`,red:`${Mt}/red.png`,gromp:`${Mt}/gromp.png`,wolves:`${Mt}/wolf.png`,raptors:`${Mt}/razorbeak.png`,krugs:`${Mt}/krug.png`,scuttle:`${Mt}/crab.png`};async function Gt(e){const t=Ut[e];return t?Pt(`camp:${e}`,t):null}async function jt(e){if(!e||"NONE"===e)return null;const t=e.toLowerCase();return Pt(`ranked-emblem:${t}`,`https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-shared-components/global/default/images/${t}.png`)}const Wt=ht.logger.createScope("LobbyScan"),Kt={top:"TOP",jungle:"JGL",middle:"MID",bottom:"BOT",utility:"SUP","":"?"},Vt=["top","jungle","middle","bottom","utility"],qt=["TOP","JGL","MID","BOT","SUP"];function zt(e){const t=(e<=5?e:e-5)-1;return qt[t]??`#${t+1}`}function Ht(e){if(!e.some(e=>e.assignedPosition&&""!==e.assignedPosition))return{sorted:[...e],hasRoles:!1};return{sorted:[...e].sort((e,t)=>{const a=Vt.indexOf(e.assignedPosition),i=Vt.indexOf(t.assignedPosition);return(-1===a?99:a)-(-1===i?99:i)}),hasRoles:!0}}let Jt=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.lobby-scanner"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;dialStates=new Map;onWillAppear(e){const t=e.payload.settings.slot??1,a=t<=5?"Ally":"Enemy",i=zt(t);return this.startPolling(),e.action.isDial()?(this.getDialSlot(e.action.id,t),e.action.setFeedback({title:`${a} ${i}`,champion:"Waiting...",rank:"",wr_text:"",wr_bar:{value:0}})):e.action.setTitle(`${a}\n${i}`)}onWillDisappear(e){this.dialStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){await this.updateLobby()}async onDialRotate(e){const t=this.getDialSlot(e.action.id);t.currentSlot=(t.currentSlot-1+e.payload.ticks+100)%10+1,await this.updateLobby()}async onDialUp(e){await this.updateLobby()}async onTouchTap(e){await this.updateLobby()}getDialSlot(e,t){let a=this.dialStates.get(e);return a||(a={currentSlot:t??1},this.dialStates.set(e,a)),a}startPolling(){this.pollInterval||(this.updateLobby().catch(e=>Wt.error(`updateLobby error: ${e}`)),this.pollInterval=setInterval(()=>this.updateLobby().catch(e=>Wt.error(`updateLobby error: ${e}`)),2e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateLobby(){if(!ft.isConnected()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",title:"Lobby Scan",champion:"Offline",rank:"",wr_text:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Lobby\nOffline"));return}if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",title:"Lobby Scan",champion:"N/A in TFT",rank:"",wr_text:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Lobby\nN/A TFT"));return}if("ChampSelect"!==await yt.getGameflowPhase()){for(const e of this.actions)if(e.isDial()){const t=this.getDialSlot(e.id).currentSlot,a=t<=5?"Ally":"Enemy",i=zt(t);await e.setFeedback({champ_icon:"",title:`${a} ${i}`,champion:"Waiting...",rank:"",wr_text:"",wr_bar:{value:0}})}else{const t=(await e.getSettings()).slot??1,a=t<=5?"Ally":"Enemy",i=zt(t);await e.setImage(""),await e.setTitle(`${a}\n${i}`)}return}const e=await yt.getChampSelectSession();if(!e)return;const t=Ht(e.myTeam),a=Ht(e.theirTeam);for(const e of this.actions){let i;const s=e.isDial();if(s)i=this.getDialSlot(e.id).currentSlot;else{i=(await e.getSettings()).slot??1}const n=i<=5,r=(n?i:i-5)-1,o=n?t:a,l=o.sorted[r],c=o.hasRoles?Kt[l?.assignedPosition??""]??`#${r+1}`:`#${r+1}`,d=n?"Ally":"Enemy";if(!l){s?await e.setFeedback({champ_icon:"",title:`${d} ${c}`,champion:"No data",rank:"",wr_text:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${d}\n${c}`));continue}let h="???",u=null;const p=l.championId>0?String(l.championId):l.championPickIntent>0?String(l.championPickIntent):null;if(p){const e=Dt.getChampionByKey(p);h=l.championId>0?e?.name??`#${l.championId}`:e?`(${e.name})`:"...",u=await Nt(p)}const m=Kt[l.assignedPosition]??"?";let f="",g=0;if(l.puuid&&""!==l.puuid){const e=await yt.getRankedStats(l.puuid);if(e?.queueMap?.RANKED_SOLO_5x5){const t=e.queueMap.RANKED_SOLO_5x5,a=t.tier?t.tier.charAt(0)+t.tier.slice(1).toLowerCase():"?",i=t.division??"";g=t.wins+t.losses>0?Math.round(t.wins/(t.wins+t.losses)*100):0,f=`${a} ${i}`}}if(s){const t=g>=55?"#2ECC71":g>=50?"#F1C40F":g>0?"#E74C3C":"#666666";await e.setFeedback({champ_icon:u??"",title:`${m}  ${d} ${c}`,champion:h,rank:f||"Unranked",wr_text:g>0?`${g}% WR`:"",wr_bar:{value:g||50,bar_fill_c:t}})}else{u&&await e.setImage(u);const t=f?`${h}\n${f} ${g}%`:`${m}\n${h}`;await e.setTitle(t)}}}},t})();const Yt=ht.logger.createScope("KdaTracker");let Qt=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.kda-tracker"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({kda_line:"- / - / -",cs_line:"",gold_text:"",kda_bar:{value:0},ratio_text:"Waiting..."}):e.action.setTitle("KDA\nWaiting...")}onWillDisappear(e){0===this.actions.length&&this.stopPolling()}startPolling(){this.pollInterval||(this.updateAll().catch(e=>Yt.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>Yt.error(`updateAll error: ${e}`)),1500))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",kda_line:"",cs_line:"N/A in TFT",gold_text:"",kda_bar:{value:0},ratio_text:""}):(await e.setImage(""),await e.setTitle("KDA\nN/A TFT"));return}const e=await vt.getAllData();if(!e){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",kda_line:"- / - / -",cs_line:"No game",gold_text:"",kda_bar:{value:0},ratio_text:""}):(await e.setImage(""),await e.setTitle("KDA\nNo game"));return}const t=e.activePlayer.summonerName,a=e.allPlayers.find(e=>e.riotIdGameName===t||e.summonerName===t);if(!a){for(const e of this.actions)e.isDial()?await e.setFeedback({kda_line:"???",cs_line:"",gold_text:"",kda_bar:{value:0},ratio_text:""}):await e.setTitle("KDA\n?");return}const{kills:i,deaths:s,assists:n,creepScore:r}=a.scores,o=e.gameData.gameTime/60,l=a.championName?await Bt(a.championName):null,c=0===s?i+n:parseFloat(((i+n)/s).toFixed(1)),d=o>.5?(r/o).toFixed(1):r.toString(),h=e.activePlayer.currentGold,u=h>=1e3?`${(h/1e3).toFixed(1)}k`:`${h}`,p=`${i}/${s}/${n}`,m=`${r}cs ${d}/m`,f=0===s?`Perfect ${c}`:`${c} KDA`,g=Math.min(100,Math.round(c/10*100)),y=c>=3?"#2ECC71":c>=1.5?"#F1C40F":"#E74C3C";for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:l??"",kda_line:p,cs_line:m,gold_text:`${u}g`,kda_bar:{value:g,bar_fill_c:y},ratio_text:f}):(l&&await e.setImage(l),await e.setTitle(`${p}\n${f}`))}},t})();const Xt=ht.logger.createScope("AutoAccept");let Zt=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.auto-accept"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;renderTimeout=null;enabled=!0;lastPhase="None";hasAcceptedCurrent=!1;async onWillAppear(e){const t=e.payload.settings;this.enabled=!1!==t.enabled,this.startPolling(),await this.renderAll()}onWillDisappear(e){this.renderTimeout&&(clearTimeout(this.renderTimeout),this.renderTimeout=null)}async onKeyDown(e){this.enabled=!this.enabled,await e.action.setSettings({enabled:this.enabled}),Xt.info("Auto-accept "+(this.enabled?"enabled":"disabled")),await this.renderAll()}startPolling(){this.pollInterval||(this.pollInterval=setInterval(()=>this.checkReadyCheck().catch(e=>Xt.error(`checkReadyCheck error: ${e}`)),500))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async checkReadyCheck(){if(!ft.isConnected())return void("None"!==this.lastPhase&&(this.lastPhase="None",await this.renderAll()));const e=await yt.getGameflowPhase();if(e!==this.lastPhase&&("ReadyCheck"===this.lastPhase&&"ReadyCheck"!==e&&(this.hasAcceptedCurrent=!1),this.lastPhase=e,await this.renderAll()),this.enabled&&"ReadyCheck"===e&&!this.hasAcceptedCurrent){Xt.info("Ready check detected! Auto-accepting...");if(await yt.post("/lol-matchmaking/v1/ready-check/accept")){this.hasAcceptedCurrent=!0,Xt.info("Ready check accepted!");for(const e of this.actions)await e.setTitle("Accepted\n");this.renderTimeout=setTimeout(()=>{this.renderTimeout=null,this.renderAll().catch(e=>Xt.error(`renderAll error: ${e}`))},2e3)}else Xt.warn("Failed to accept ready check")}}async renderAll(){for(const e of this.actions)"ReadyCheck"!==this.lastPhase||this.enabled?this.enabled?await e.setTitle("Accept\nON"):await e.setTitle("Accept\nOFF"):await e.setTitle("MATCH!\nManual")}},t})();const ea=ht.logger.createScope("LolalyticsThrottle"),ta={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"};let aa=3,ia=Date.now();const sa=[];let na=null;function ra(){const e=Date.now()-ia,t=Math.floor(e/500);t>0&&(aa=Math.min(3,aa+t),ia+=500*t)}function oa(){for(ra();sa.length>0&&aa>0;){aa--;const e=sa.shift();e?.()}0===sa.length&&na&&(clearInterval(na),na=null)}async function la(e,t){await(ra(),aa>0?(aa--,Promise.resolve()):new Promise(e=>{sa.push(e),na||(na=setInterval(oa,500))}));const a={...ta,...t?.headers};return ea.debug(`Throttled fetch: ${e} (tokens left: ${aa}, queued: ${sa.length})`),fetch(e,{headers:a,signal:t?.signal})}const ca=ht.logger.createScope("ChampionStats"),da="https://a1.lolalytics.com";class ha{cache=new Map;CACHE_TTL=18e5;async getCounters(e,t){return(await this.getMatchups(e,t)).sort((e,t)=>e.winRateVs-t.winRateVs)}async getBestCounterpicks(e,t){return(await this.getMatchups(e,t)).map(e=>({...e,winRateVs:+(100-e.winRateVs).toFixed(2)})).sort((e,t)=>t.winRateVs-e.winRateVs)}async getBestOverallPick(e,t,a){if(0===e.length)return[];const i=new Map,s=await Promise.all(e.map(e=>this.getBestCounterpicks(e,t)));for(const e of s)for(const a of e){if(a.defaultLane&&!this.isViableInLane(a.defaultLane,a.alias,t))continue;const e=i.get(a.alias);e?(e.totalWr+=a.winRateVs,e.count+=1):i.set(a.alias,{totalWr:a.winRateVs,count:1,name:a.name})}const n=a?.length?this.buildTeamProfile(a):null;return[...i.entries()].filter(([e,t])=>t.count>=1).map(([e,t])=>{const a=t.totalWr/t.count;let i=0;n&&(i=this.computeSynergyBonus(e,n));const s=a+i;return{alias:e,name:t.name,score:+s.toFixed(2),details:n?`ctr ${a.toFixed(1)}% syn ${i>=0?"+":""}${i.toFixed(1)}`:`avg ${a.toFixed(1)}%`}}).sort((e,t)=>t.score-e.score)}buildTeamProfile(e){let t=0,a=0,i=0,s=0;const n=[];for(const r of e){const e=Dt.getChampionByKey(r);e&&(t+=e.info.magic,a+=e.info.attack,i+=e.info.defense,n.push(...e.tags),s++)}return 0===s?{avgMagic:5,avgAttack:5,avgDefense:5,tags:n,hasTank:!1,hasEngage:!1,count:0}:{avgMagic:t/s,avgAttack:a/s,avgDefense:i/s,tags:n,hasTank:n.includes("Tank"),hasEngage:n.includes("Tank")||n.includes("Support"),count:s}}computeSynergyBonus(e,t){if(!e)return 0;const a=Dt.getChampionByName(e);if(!a||0===t.count)return 0;let i=0;t.avgMagic<4&&a.info.magic>=7||t.avgMagic>6&&a.info.magic<=3?i+=2.5:t.avgMagic>=4&&t.avgMagic<=6&&(i+=.5),!t.hasTank&&a.tags.includes("Tank")?i+=1.5:!t.hasTank&&a.info.defense>=7&&(i+=1);const s=a.tags[0];return t.tags.filter(e=>e===s).length>=2&&(i-=1),Math.max(-5,Math.min(5,i))}async getMatchups(e,t){const a=`${e}:${t}`,i=this.cache.get(a);if(i&&Date.now()-i.timestamp<this.CACHE_TTL)return i.data;i&&this.cache.delete(a);const s=Dt.getVersion().split("."),n=`${s[0]}.${s[1]}`,r=[n,"30"];for(const i of r){const s=`${da}/mega/?ep=counter&p=d&v=1&patch=${i}&c=${e}&lane=${t}&tier=emerald_plus&queue=ranked&region=all`;try{ca.debug(`Fetching matchups: ${s}`);const r=await la(s,{signal:AbortSignal.timeout(1e4)});if(!r.ok){ca.warn(`Lolalytics API returned ${r.status} for ${e} ${t} (patch=${i})`);continue}const o=await r.json();if(!o?.counters||!Array.isArray(o.counters)){ca.warn(`Invalid API response structure for ${e} ${t} (patch=${i})`);continue}const l=[];for(const e of o.counters){if(!e.cid||e.n<50)continue;const t=Dt.getChampionByKey(String(e.cid)),a=t?ha.toLolalytics(t.id):String(e.cid),i=t?.name??`Champion ${e.cid}`;l.push({alias:a,name:i,winRateVs:e.vsWr,games:e.n,defaultLane:e.defaultLane})}if(0===l.length){ca.warn(`0 matchups from API for ${e} ${t} (patch=${i})`);continue}return i!==n&&ca.info(`Using patch=${i} fallback for ${e} ${t} (current patch has no data)`),ca.info(`Parsed ${l.length} matchups for ${e} ${t} via API`),this.cache.set(a,{data:l,timestamp:Date.now()}),l}catch(a){ca.error(`Failed to fetch matchups for ${e} ${t} (patch=${i}): ${a}`)}}if(ca.warn(`All patch attempts failed for ${e} ${t}`),"default"!==t)for(const i of r){const s=`${da}/mega/?ep=counter&p=d&v=1&patch=${i}&c=${e}&lane=default&tier=emerald_plus&queue=ranked&region=all`;try{ca.debug(`Trying default lane fallback for ${e} (patch=${i})`);const n=await la(s,{signal:AbortSignal.timeout(1e4)});if(!n.ok)continue;const r=await n.json();if(!r?.counters||!Array.isArray(r.counters))continue;const o=[];for(const e of r.counters){if(!e.cid||e.n<50)continue;const t=Dt.getChampionByKey(String(e.cid)),a=t?ha.toLolalytics(t.id):String(e.cid),i=t?.name??`Champion ${e.cid}`;o.push({alias:a,name:i,winRateVs:e.vsWr,games:e.n,defaultLane:e.defaultLane})}if(o.length>0)return ca.info(`Lane fallback: ${o.length} matchups for ${e} via default lane (requested: ${t})`),this.cache.set(a,{data:o,timestamp:Date.now()}),o}catch(t){ca.debug(`Default lane fallback failed for ${e}: ${t}`)}}return ca.error(`All lane+patch attempts failed for ${e} ${t}`),this.cache.set(a,{data:[],timestamp:Date.now()-this.CACHE_TTL+3e5}),i?.data??[]}isViableInLane(e,t,a){const i=e=>({mid:"middle",middle:"middle",top:"top",jungle:"jungle",jng:"jungle",bot:"bottom",bottom:"bottom",adc:"bottom",sup:"support",support:"support",utility:"support"}[e.toLowerCase()]??e.toLowerCase()),s=i(e),n=i(a);if(s===n)return!0;const r=[["top","jungle"],["top","middle"],["middle","bottom"],["middle","support"],["bottom","middle"],["support","middle"]];for(const e of r)if(e.includes(s)&&e.includes(n))return!0;return!1}static toLolalytics(e){return e.toLowerCase().replace(/['\s.]/g,"")}static toLolalyticsLane(e){return{top:"top",jungle:"jungle",middle:"middle",bottom:"bottom",utility:"support"}[e]??"top"}}const ua=new ha,pa=ht.logger.createScope("SmartPick");let ma=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.smart-pick"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;onWillAppear(e){this.startPolling();const t=e.payload.settings.role??"auto",a="auto"===t?"AUTO":t.toUpperCase(),i=e.payload.settings.defaultMode??"counter";return e.action.isDial()?(this.getState(e.action.id,i),e.action.setFeedback({champ_icon:"",title:`${"counter"===i?"Counter":"Best"}  ${a}`,pick_name:"Waiting...",pick_info:"",score_bar:{value:0}})):e.action.setTitle(`${"counter"===i?"Counter":"Best"}\n${a}`)}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id,e.payload.settings.defaultMode);t.mode="counter"===t.mode?"best":"counter",t.lastHash="",await this.updateSmartPick()}async onDialRotate(e){const t=this.getState(e.action.id);0!==t.lastPicks.length&&(t.viewIndex=(t.viewIndex+e.payload.ticks+100*t.lastPicks.length)%t.lastPicks.length,await this.renderDialPick(e.action,t))}async onDialUp(e){const t=this.getState(e.action.id);t.mode="counter"===t.mode?"best":"counter",t.lastHash="",await this.updateSmartPick()}async onTouchTap(e){this.getState(e.action.id).lastHash="",await this.updateSmartPick()}getState(e,t="counter"){let a=this.actionStates.get(e);return a||(a={mode:t,viewIndex:0,lastHash:"",lastPicks:[],lastInfo:""},this.actionStates.set(e,a)),a}async renderDialPick(e,t){if(!e.isDial())return;const a=t.lastPicks[t.viewIndex];if(!a)return;const i=a.winRateVs??a.score,s=i>=54?"#2ECC71":i>=50?"#F1C40F":"#E74C3C",n=await Lt(a.alias),r="counter"===t.mode?"":"";await e.setFeedback({champ_icon:n??"",title:`${r} ${t.lastInfo}`,pick_name:`#${t.viewIndex+1} ${a.name}`,pick_info:a.details,score_bar:{value:i,bar_fill_c:s}})}startPolling(){this.pollInterval||(this.updateSmartPick().catch(e=>pa.error(`updateSmartPick error: ${e}`)),this.pollInterval=setInterval(()=>this.updateSmartPick().catch(e=>pa.error(`updateSmartPick error: ${e}`)),4e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateSmartPick(){if(!ft.isConnected()){for(const e of this.actions){const t="counter"===this.getState(e.id).mode?"Counter":"Best";e.isDial()?await e.setFeedback({champ_icon:"",title:t,pick_name:"Offline",pick_info:"",score_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${t}\nOffline`))}return}if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",title:"Smart Pick",pick_name:"N/A in TFT",pick_info:"",score_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Pick\nN/A TFT"));return}if(St.isARAM()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",title:"Smart Pick",pick_name:"N/A in ARAM",pick_info:"",score_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Pick\nN/A ARAM"));return}if("ChampSelect"!==await yt.getGameflowPhase()){for(const e of this.actionStates.values())e.lastHash="",e.lastPicks=[];for(const e of this.actions){const t=await e.getSettings(),a=t.role??"auto",i="auto"===a?"AUTO":a.toUpperCase(),s="counter"===this.getState(e.id,t.defaultMode).mode?"Counter":"Best";e.isDial()?await e.setFeedback({champ_icon:"",title:`${s}  ${i}`,pick_name:"Waiting...",pick_info:"Press dial to toggle mode",score_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${s}\n${i}`))}return}const e=await yt.getChampSelectSession();if(!e)return void pa.debug("No champ select session available");const t=e.localPlayerCellId,a=e.myTeam.find(e=>e.cellId===t);for(const t of this.actions){const i=await t.getSettings(),s=(i.role&&"auto"!==i.role?i.role:null)??a?.assignedPosition??"top",n=ha.toLolalyticsLane(s),r=this.getState(t.id,i.defaultMode);"counter"===r.mode?await this.updateCounterMode(t,e,s,n,r):await this.updateBestMode(t,e,s,n,r)}}async updateCounterMode(e,t,a,i,s){if(!t)return;let n=t.theirTeam.find(e=>e.assignedPosition===a&&e.championId>0);if(n||(n=t.theirTeam.find(e=>e.championId>0&&(!e.assignedPosition||""===e.assignedPosition))),n||(n=t.theirTeam.find(e=>e.championId>0)),!n)return void(e.isDial()?await e.setFeedback({title:` Counter  ${a.toUpperCase()}`,pick_name:"No enemy yet",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Counter\nNo enemy"));const r=Dt.getChampionByKey(String(n.championId));if(!r)return;const o=ha.toLolalytics(r.id),l=`counter:${o}`;if(l!==s.lastHash){e.isDial()?await e.setFeedback({title:`vs ${r.name}`,pick_name:"Searching...",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle(`vs ${r.name}\nSearching...`);try{const t=await ua.getBestCounterpicks(o,i);if(s.lastPicks=t.map(e=>({alias:e.alias,name:e.name,score:e.winRateVs,winRateVs:e.winRateVs,games:e.games,details:`${e.winRateVs}% WR  ${e.games>=1e3?`${(e.games/1e3).toFixed(1)}k`:e.games} games`})),s.lastInfo=`vs ${r.name}`,s.lastHash=l,Ft(t.slice(0,5).map(e=>e.alias)),0===t.length)e.isDial()?await e.setFeedback({title:` vs ${r.name}`,pick_name:"No data",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle(`vs ${r.name}\nNo data`);else if(e.isDial())s.viewIndex=0,await this.renderDialPick(e,s);else{const a=t[0],i=await Lt(a.alias);i&&await e.setImage(i),await e.setTitle(`Counter\n${a.name} ${a.winRateVs}%`)}}catch(t){pa.error(`Counter mode error: ${t}`),e.isDial()?await e.setFeedback({title:`vs ${r.name}`,pick_name:"Error",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Counter\nError")}}else e.isDial()&&await this.renderDialPick(e,s)}async updateBestMode(e,t,a,i,s){if(!t)return;const n=[],r=[];for(const e of t.theirTeam)if(e.championId>0){const t=Dt.getChampionByKey(String(e.championId));if(t){const i=ha.toLolalytics(t.id);r.push(i),e.assignedPosition!==a&&""!==e.assignedPosition&&e.assignedPosition||n.push(i)}}const o=[];for(const e of t.myTeam)e.championId>0&&e.cellId!==t.localPlayerCellId&&o.push(String(e.championId));if(0===r.length)return void(e.isDial()?await e.setFeedback({title:` Best  ${a.toUpperCase()}`,pick_name:"No enemy yet",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Best\nNo enemy"));const l=n.length>0?n:r,c=`best:${r.sort().join(",")}|${o.sort().join(",")}`;if(c!==s.lastHash){e.isDial()?await e.setFeedback({title:` Best  ${a.toUpperCase()}`,pick_name:"Searching...",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Best\nSearching...");try{const t=await ua.getBestOverallPick(l,i,o.length>0?o:void 0);if(s.lastPicks=t,s.lastInfo=o.length>0?`vs${l.length} +syn${o.length}`:`vs${l.length}  ${a.toUpperCase()}`,s.lastHash=c,Ft(t.slice(0,5).map(e=>e.alias)),0===t.length)e.isDial()?await e.setFeedback({title:` ${s.lastInfo}`,pick_name:"No data",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Best\nNo data");else if(e.isDial())s.viewIndex=0,await this.renderDialPick(e,s);else{const a=t[0],i=await Lt(a.alias);i&&await e.setImage(i),await e.setTitle(`Best Pick\n${a.name} ${a.score}%`)}}catch(t){pa.error(`Best mode error: ${t}`),e.isDial()?await e.setFeedback({title:` Best  ${a.toUpperCase()}`,pick_name:"Error",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Best\nError")}}else e.isDial()&&await this.renderDialPick(e,s)}},t})();const fa=ht.logger.createScope("LobbyLevel"),ga={IRON:0,BRONZE:4,SILVER:8,GOLD:12,PLATINUM:16,EMERALD:20,DIAMOND:24,MASTER:28,GRANDMASTER:29,CHALLENGER:30},ya={IRON:"Iron",BRONZE:"Bronze",SILVER:"Silver",GOLD:"Gold",PLATINUM:"Plat",EMERALD:"Em",DIAMOND:"Dia",MASTER:"Master",GRANDMASTER:"GM",CHALLENGER:"Chall"},wa={IV:0,III:1,II:2,I:3};let va=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.lobby-level"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;lastHashMap=new Map;onWillAppear(e){return this.startPolling(),e.action.setTitle("Lobby\nLevel")}onWillDisappear(e){this.lastHashMap.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){this.lastHashMap.set(e.action.id,""),await this.updateLobbyLevel()}startPolling(){this.pollInterval||(this.updateLobbyLevel().catch(e=>fa.error(`updateLobbyLevel error: ${e}`)),this.pollInterval=setInterval(()=>this.updateLobbyLevel().catch(e=>fa.error(`updateLobbyLevel error: ${e}`)),5e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateLobbyLevel(){if(!ft.isConnected()){for(const e of this.actions)await e.setTitle("Lobby Lvl\nOffline");return}if(St.isTFT()){for(const e of this.actions)await e.setTitle("Lobby Lvl\nN/A TFT");return}if("ChampSelect"!==await yt.getGameflowPhase()){for(const e of this.actions)this.lastHashMap.set(e.id,"");for(const e of this.actions)await e.setTitle("Lobby\nLevel");return}const e=await yt.getChampSelectSession();if(!e)return;const t=e.myTeam.map(e=>e.puuid).filter(e=>e&&""!==e),a=e.theirTeam.map(e=>e.puuid).filter(e=>e&&""!==e),i=[...t,...a];if(0===i.length){for(const e of this.actions)await e.setTitle("Lobby Lvl\nWaiting...");return}const s=i.sort().join(",");for(const e of this.actions){if(s===(this.lastHashMap.get(e.id)??""))continue;const i=(await e.getSettings()).view??"all";try{const n=await this.fetchPlayerData(t),r=await this.fetchPlayerData(a);let o;if("allies"===i){const e=this.avgLevel(n.map(e=>e.level));o=`Allies ${this.avgRankLabel(n)}\nLvl ${e}`}else if("enemies"===i){const e=this.avgLevel(r.map(e=>e.level));o=`Enemies ${this.avgRankLabel(r)}\nLvl ${e}`}else{const e=this.avgRankLabel(n),t=this.avgRankLabel(r),a=[...n,...r];o=`${e} vs ${t}\nLvl ${this.avgLevel(a.map(e=>e.level))}`}await e.setTitle(o),this.lastHashMap.set(e.id,s)}catch(t){fa.error(`LobbyLevel error: ${t}`),await e.setTitle("Lobby Lvl\nError")}}}async fetchPlayerData(e){const t=e.map(async e=>{const t=await yt.getSummonerByPuuid(e),a=t?.summonerLevel??0;let i=-1;try{const t=await yt.getRankedStats(e);if(t?.queueMap?.RANKED_SOLO_5x5){const e=t.queueMap.RANKED_SOLO_5x5;i=function(e,t){const a=ga[e]??-1;return a<0?-1:a>=28?a:a+(wa[t]??0)}(e.tier,e.division)}}catch{}return{level:a,rankValue:i}});return Promise.all(t)}avgRankLabel(e){const t=e.filter(e=>e.rankValue>=0);if(0===t.length)return"Unranked";const a=t.reduce((e,t)=>e+t.rankValue,0)/t.length;return function(e){if(e>=30)return"Chall";if(e>=29)return"GM";if(e>=28)return"Master";const t=Object.entries(ga).filter(([,e])=>e<28).sort((e,t)=>t[1]-e[1]);for(const[a,i]of t)if(e>=i){const t=e-i,s=["IV","III","II","I"][Math.min(t,3)];return`${ya[a]} ${s}`}return"Iron IV"}(Math.round(a))}avgLevel(e){const t=e.filter(e=>e>0);return 0===t.length?0:Math.round(t.reduce((e,t)=>e+t,0)/t.length)}},t})();const ba=ht.logger.createScope("LolaBuild"),Sa={0:8e3,1:8100,2:8200,3:8400,4:8300},_a={8005:"Press the Attack",8008:"Lethal Tempo",8010:"Conqueror",8021:"Fleet Footwork",8112:"Electrocute",8124:"Predator",8128:"Dark Harvest",9923:"Hail of Blades",8214:"Summon Aery",8229:"Arcane Comet",8230:"Phase Rush",8351:"Glacial Augment",8360:"Unsealed Spellbook",8369:"First Strike",8437:"Grasp of the Undying",8439:"Aftershock",8465:"Guardian"};const ka=new class{cache=new Map;CACHE_TTL=18e5;async getBuildData(e,t,a){const i=a?`${e}:${t}:vs:${a}`:`${e}:${t}`,s=this.cache.get(i);if(s&&Date.now()-s.timestamp<this.CACHE_TTL)return s.data;s&&this.cache.delete(i);const n="aram"===t?"":t;let r;r="aram"===t?`https://lolalytics.com/lol/${e}/aram/build/`:a?`https://lolalytics.com/lol/${e}/vs/${a}/build/?lane=${n}`:`https://lolalytics.com/lol/${e}/build/?lane=${n}`;try{ba.debug(`Fetching build page: ${r}`);const a=await la(r,{signal:AbortSignal.timeout(15e3),headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html"}});if(!a.ok)return ba.warn(`Lolalytics build page returned ${a.status}`),s?.data??null;const n=await a.text(),o=this.parseQwikData(n,e,t);return o&&(this.cache.set(i,{data:o,timestamp:Date.now()}),ba.info(`Parsed build page for ${e} ${t}: ${o.runes.length} rune pages, ${o.summonerSpells.length} spell combos, ${o.skillPriority.length} skill orders`)),o}catch(a){return ba.error(`Failed to fetch build page for ${e} ${t}: ${a}`),s?.data??null}}parseQwikData(e,t,a){try{const t=e.match(/<script type=["']qwik\/json["']>([\s\S]*?)<\/script>/);if(!t)return ba.warn("No qwik/json script found in build page"),null;const a=JSON.parse(t[1]).objs;if(!Array.isArray(a)||0===a.length)return ba.warn("Empty or invalid qwik objs array"),null;const i=e=>{const t=parseInt(e,36);if(!(isNaN(t)||t>=a.length))return a[t]},s=(e,t=0)=>{if(t>12||null==e)return e;if("number"==typeof e||"boolean"==typeof e)return e;if("string"!=typeof e){if(Array.isArray(e))return e.map(e=>s(e,t+1));if("object"==typeof e){const a={};for(const[i,n]of Object.entries(e))a[i]=s(n,t+1);return a}return e}const a=i(e);return void 0===a?e:s(a,t+1)};let n=a.findIndex(e=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&"summary"in e&&"spells"in e&&"skillOrder"in e);if(-1===n&&(n=a.findIndex(e=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&"summary"in e&&("spells"in e||"skillOrder"in e)),-1!==n&&ba.debug("Using lenient Qwik data match (matchup page?)")),-1===n)return ba.debug("Could not find main data object in Qwik data (expected on matchup pages)"),null;const r=a[n],o=s(i(r.summary));if(!o)return ba.warn("Could not resolve summary data"),null;const l=this.extractRunes(o,a),c=this.extractSummonerSpells(o),d=this.extractSkillPriority(o),h=this.extractSkillOrder(o);return{runes:l,summonerSpells:c,skillPriority:d,skillOrder:h,skillEarly:this.extractSkillEarly(r,a,s)}}catch(e){return ba.error(`Failed to parse Qwik data: ${e}`),null}}extractRunes(e,t){const a=[];if(e.pick?.runes){const i=this.convertRuneData(e.pick.runes,"most_common",t);i&&a.push(i)}if(e.win?.runes){const i=this.convertRuneData(e.win.runes,"highest_wr",t);i&&a.push(i)}return a}convertRuneData(e,t,a){const{set:i,page:s,wr:n,n:r}=e;if(!(i?.pri&&i?.sec&&i?.mod&&s))return null;if(!Array.isArray(i.pri)||4!==i.pri.length)return null;if(!Array.isArray(i.sec)||2!==i.sec.length)return null;if(!Array.isArray(i.mod)||3!==i.mod.length)return null;const o=e=>{if("number"==typeof e)return e;if("string"==typeof e){const t=parseInt(e,36);if(!isNaN(t)&&t<a.length&&"number"==typeof a[t])return a[t]}return 0},l=i.pri.map(o),c=i.sec.map(o),d=i.mod.map(o);if(l[0]<8e3)return ba.warn(`Invalid keystone ID ${l[0]} after resolution (source: ${t})`),null;const h=Sa[s.pri]??this.treeFromKeystoneId(l[0]),u=Sa[s.sec]??this.treeFromRuneId(c[0]);if(!h||!u)return null;return{primaryStyleId:h,subStyleId:u,selectedPerkIds:[...l,...c,...d],winRate:n??0,games:r??0,source:t,keystoneName:_a[l[0]]??`Keystone ${l[0]}`}}extractSummonerSpells(e){const t=[];if(e.pick?.sums){const{ids:a,n:i,wr:s}=e.pick.sums;Array.isArray(a)&&2===a.length&&t.push({ids:a,winRate:s??0,pickRate:100,games:i??0,source:"most_common"})}if(e.win?.sums){const{ids:a,n:i,wr:s}=e.win.sums;if(Array.isArray(a)&&2===a.length){t.some(e=>e.ids[0]===a[0]&&e.ids[1]===a[1])||t.push({ids:a,winRate:s??0,pickRate:0,games:i??0,source:"highest_wr"})}}return t}extractSkillPriority(e){const t=[];if(e.pick?.skillpriority){const{id:a,n:i,wr:s}=e.pick.skillpriority;"string"==typeof a&&a.length>=2&&t.push({order:a,winRate:s??0,pickRate:100,games:i??0,source:"most_common"})}if(e.win?.skillpriority){const{id:a,n:i,wr:s}=e.win.skillpriority;if("string"==typeof a&&a.length>=2){t.some(e=>e.order===a)||t.push({order:a,winRate:s??0,pickRate:0,games:i??0,source:"highest_wr"})}}return t}extractSkillOrder(e){const t=[];if(e.pick?.skillorder){const{id:a,n:i,wr:s}=e.pick.skillorder;"number"==typeof a&&t.push({sequence:a,winRate:s??0,pickRate:100,games:i??0,source:"most_common"})}if(e.win?.skillorder){const{id:a,n:i,wr:s}=e.win.skillorder;if("number"==typeof a){t.some(e=>e.sequence===a)||t.push({sequence:a,winRate:s??0,pickRate:0,games:i??0,source:"highest_wr"})}}return t}extractSkillEarly(e,t,a){try{if(!e.skillEarly)return[];const i=a((e=>{const a=parseInt(e,36);return isNaN(a)||a>=t.length?void 0:t[a]})(e.skillEarly));return Array.isArray(i)?i.map(e=>({skills:e.map(e=>({winRate:e[0]??0,pickRate:e[1]??0,games:e[2]??0}))})):[]}catch{return[]}}treeFromKeystoneId(e){return e>=8e3&&e<8500?100*Math.floor(e/100):9923===e?8100:8e3}treeFromRuneId(e){return e>=8400&&e<8500?8400:e>=8300&&e<8400?8300:e>=8200&&e<8300?8200:e>=8100&&e<8200?8100:8e3}},Ca=ht.logger.createScope("RuneData"),$a=[8e3,8100,8200,8400,8300],Ia={8005:"Press the Attack",8008:"Lethal Tempo",8010:"Conqueror",8021:"Fleet Footwork",8112:"Electrocute",8124:"Predator",8128:"Dark Harvest",9923:"Hail of Blades",8214:"Summon Aery",8229:"Arcane Comet",8230:"Phase Rush",8437:"Grasp of the Undying",8439:"Aftershock",8465:"Guardian",8351:"Glacial Augment",8360:"Unsealed Spellbook",8369:"First Strike"};const xa=new class{cache=new Map;CACHE_TTL=18e5;async getRecommendedRunes(e,t,a){const i=a?`${e}:${t}:vs:${a}`:`${e}:${t}`,s=this.cache.get(i);if(s&&Date.now()-s.timestamp<this.CACHE_TTL)return s.data;s&&this.cache.delete(i);try{const s=await ka.getBuildData(e,t,a);if(s&&s.runes.length>0)return Ca.info(`Parsed ${s.runes.length} rune page(s) via SSR for ${e} ${t}: `+s.runes.map(e=>`${e.source} ${e.keystoneName} ${e.winRate}%`).join(", ")),this.cache.set(i,{data:s.runes,timestamp:Date.now()}),s.runes}catch(a){Ca.warn(`SSR rune fetch failed for ${e} ${t}: ${a}`)}return this.fetchFromApi(e,t,s?.data??[])}async fetchFromApi(e,t,a){const i=Dt.getVersion().split("."),s=`https://a1.lolalytics.com/mega/?ep=rune&v=1&patch=${`${i[0]}.${i[1]}`}&c=${e}&lane=${"aram"===t?"default":t}&tier=emerald_plus${"aram"===t?"&queue=450":"&queue=ranked"}&region=all`;try{Ca.debug(`Fetching runes (API fallback): ${s}`);const i=await la(s,{signal:AbortSignal.timeout(1e4)});if(!i.ok)return Ca.warn(`Lolalytics API returned ${i.status} for rune data`),a;const n=await i.json();if(!n?.summary?.runes)return Ca.warn(`Invalid rune API response for ${e} ${t}`),a;const r=this.parseApiRunes(n.summary.runes);return r.length>0?(Ca.info(`Parsed ${r.length} rune page(s) via API for ${e} ${t}: `+r.map(e=>`${e.source} ${e.keystoneName} ${e.winRate}%`).join(", ")),r):(Ca.warn(`No rune data found via API for ${e} ${t}`),a)}catch(i){return Ca.error(`API rune fetch failed for ${e} ${t}: ${i}`),a}}parseApiRunes(e){const t=[];if(e.pick){const a=this.convertApiEntry(e.pick,"most_common");a&&t.push(a)}if(e.win){const a=this.convertApiEntry(e.win,"highest_wr");a&&t.push(a)}return t}convertApiEntry(e,t){const{set:a,page:i,wr:s,n:n}=e;if(!(a?.pri&&a?.sec&&a?.mod&&i&&4===a.pri.length&&2===a.sec.length&&3===a.mod.length))return null;const r=$a[i.pri]??this.treeFromKeystoneId(a.pri[0]),o=$a[i.sec]??this.treeFromRuneId(a.sec[0]);if(!r||!o)return null;return{primaryStyleId:r,subStyleId:o,selectedPerkIds:[...a.pri,...a.sec,...a.mod],winRate:s??0,games:n??0,source:t,keystoneName:Ia[a.pri[0]]??`Keystone ${a.pri[0]}`}}treeFromKeystoneId(e){return e>=8e3&&e<8500?100*Math.floor(e/100):9923===e?8100:8e3}treeFromRuneId(e){return e>=8400&&e<8500?8400:e>=8300&&e<8400?8300:e>=8200&&e<8300?8200:e>=8100&&e<8200?8100:8e3}},Ta=ht.logger.createScope("AutoRune"),Aa=m(f(_(import.meta.url)),".."),Da=new Map,Ra=new Map,Ea=new Map;function Pa(e){if(Da.has(e))return Da.get(e);try{const t=m(Aa,"imgs","actions","auto-rune","keystones",`${e}@2x.png`),a=u(t).toString("base64");return Da.set(e,a),a}catch{return null}}const La="#C89B3C",Na="#0A1428";function Ba(e,t){const a=`${e}:${t}`;if(Ea.has(a))return Ea.get(a);const i=Pa(e);if(!i)return null;const s=function(e){if(Ra.has(e))return Ra.get(e);try{const t=m(Aa,"imgs","actions","auto-rune","trees",`${e}@2x.png`),a=u(t).toString("base64");return Ra.set(e,a),a}catch{return null}}(t),n=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t<rect width="144" height="144" rx="14" fill="${Na}"/>\n\t\t<defs><radialGradient id="g" cx="50%" cy="50%" r="50%">\n\t\t\t<stop offset="0%" stop-color="${La}" stop-opacity="0.22"/>\n\t\t\t<stop offset="55%" stop-color="${La}" stop-opacity="0.07"/>\n\t\t\t<stop offset="100%" stop-color="${La}" stop-opacity="0"/>\n\t\t</radialGradient></defs>\n\t\t<circle cx="72" cy="72" r="55" fill="url(#g)"/>\n\t\t<rect x="3" y="3" width="138" height="138" rx="11" stroke="${La}" stroke-width="3" fill="none"/>\n\t\t<image href="data:image/png;base64,${i}" x="14" y="14" width="116" height="116"/>\n\t\t${s?`<circle cx="116" cy="116" r="25" fill="${Na}" stroke="${La}" stroke-width="1.5"/>\n\t\t   <clipPath id="tc"><circle cx="116" cy="116" r="22"/></clipPath>\n\t\t   <image href="data:image/png;base64,${s}" x="94" y="94" width="44" height="44" clip-path="url(#tc)"/>`:""}\n\t</svg>`,r=`data:image/svg+xml;base64,${Buffer.from(n).toString("base64")}`;return Ea.set(a,r),r}const Fa="LoL Companion";let Oa=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.auto-rune"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n})}pollInterval=null;actionStates=new Map;onWillAppear(e){this.startPolling();const t=e.payload.settings.role??"auto",a="auto"===t?"AUTO":t.toUpperCase();return e.action.isDial()?e.action.setFeedback({title:`Auto Rune  ${a}`,rune_name:"Waiting...",rune_info:"",wr_bar:{value:0}}):e.action.setTitle(`Auto Rune\n${a}`)}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id);await this.applyRunesForAction(e.action,t,e.payload.settings)}async onDialRotate(e){const t=this.getState(e.action.id);t.lastRunes.length<2||(t.selectedIndex=(t.selectedIndex+1)%t.lastRunes.length,t.applied=!1,await this.renderAction(e.action,t,e.payload.settings))}async onDialUp(e){const t=this.getState(e.action.id);await this.applyRunesForAction(e.action,t,e.payload.settings)}async onTouchTap(e){const t=this.getState(e.action.id);await this.applyRunesForAction(e.action,t,e.payload.settings)}getState(e){let t=this.actionStates.get(e);return t||(t={lastChampKey:"",lastRunes:[],selectedIndex:0,applied:!1,spells:[],spellsApplied:!1,lastEnemyKey:"",vsChampName:""},this.actionStates.set(e,t)),t}startPolling(){this.pollInterval||(this.updateState().catch(e=>Ta.error(`updateState error: ${e}`)),this.pollInterval=setInterval(()=>this.updateState().catch(e=>Ta.error(`updateState error: ${e}`)),3e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateState(){if(!ft.isConnected()){for(const e of this.actions)e.isDial()?await e.setFeedback({keystone_icon:"",title:"Auto Rune",rune_name:"Offline",rune_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Runes\nOffline"));return}if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({keystone_icon:"",title:"Auto Rune",rune_name:"N/A in TFT",rune_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Runes\nN/A TFT"));return}if("ChampSelect"!==await yt.getGameflowPhase()){let e=!1;for(const t of this.actionStates.values())""!==t.lastChampKey&&(e=!0),t.lastChampKey="",t.lastRunes=[],t.selectedIndex=0,t.applied=!1,t.spells=[],t.spellsApplied=!1,t.lastEnemyKey="",t.vsChampName="";if(e)for(const e of this.actions){const t=(await e.getSettings()).role??"auto",a="auto"===t?"AUTO":t.toUpperCase();e.isDial()?await e.setFeedback({keystone_icon:"",title:`Auto Rune  ${a}`,rune_name:"Waiting...",rune_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`Auto Rune\n${a}`))}return}const e=await yt.getChampSelectSession();if(!e)return;const t=e.localPlayerCellId,a=e.myTeam.find(e=>e.cellId===t);if(!a||a.championId<=0)return;const i=String(a.championId),s=Dt.getChampionByKey(i);if(!s)return;const n=e.actions.flat().some(e=>e.actorCellId===t&&"pick"===e.type&&e.completed&&e.championId>0),r=ha.toLolalytics(s.id);for(const t of this.actions){const o=await t.getSettings(),l=this.getState(t.id),c=(o.role&&"auto"!==o.role?o.role:null)??a.assignedPosition??"",d=St.isARAM()?"aram":ha.toLolalyticsLane(c||"top"),h=this.getEnemyLaner(e,c,o),u=h?.alias??"",p=i!==l.lastChampKey,m=u!==l.lastEnemyKey;if(!p&&!m){n&&o.autoApply&&(!l.applied||!l.spellsApplied)&&l.lastRunes.length>0&&await this.applyRunesForAction(t,l,o);continue}p&&(l.lastChampKey=i,l.selectedIndex=0,l.applied=!1,l.spells=[],l.spellsApplied=!1),m&&(l.lastEnemyKey=u,l.vsChampName=h?.name??"",!p&&u&&(l.applied=!1,l.spellsApplied=!1,l.selectedIndex=0));const f=l.vsChampName?` vs ${l.vsChampName}`:"";t.isDial()?await t.setFeedback({title:`${s.name}${f}`,rune_name:"Searching...",rune_info:"",wr_bar:{value:0}}):await t.setTitle(`${s.name}\nSearching...`);const g=u||void 0;try{const e=await xa.getRecommendedRunes(r,d,g);if(g&&e.length>0&&e[0].games<50){Ta.info(`Matchup data for ${s.name} vs ${l.vsChampName} has only ${e[0].games} games, using generic`);const t=await xa.getRecommendedRunes(r,d);l.lastRunes=t,l.vsChampName=""}else l.lastRunes=e;try{const e=await ka.getBuildData(r,d,g);e&&e.summonerSpells.length>0&&(l.spells=e.summonerSpells,Ta.info(`Spells for ${s.name} ${d}${g?` vs ${l.vsChampName}`:""}: ${l.spells[0].ids.join("+")} (${l.spells[0].winRate}%)`))}catch(e){Ta.warn(`Failed to fetch spells for ${s.name}: ${e}`)}if(l.lastRunes.length>0){const e=g&&l.vsChampName?`vs ${l.vsChampName}`:"generic";Ta.info(`Runes for ${s.name} ${d} (${e}): ${l.lastRunes[0].keystoneName} (${l.lastRunes[0].winRate}%)`),n&&o.autoApply&&await this.applyRunesForAction(t,l,o)}await this.renderAction(t,l,o)}catch(e){Ta.error(`Failed to get runes: ${e}`)}}}static POSITION_TO_DEFAULT_LANE={top:["top"],jungle:["jungle"],middle:["middle","mid"],bottom:["bottom","adc"],utility:["support"]};getEnemyLaner(e,t,a){if(!1===a.matchup)return null;if(St.isARAM())return null;if(!t)return null;const i=e.theirTeam.find(e=>e.assignedPosition===t&&e.championId>0);if(i){const e=Dt.getChampionByKey(String(i.championId));if(e)return{alias:ha.toLolalytics(e.id),name:e.name}}const s=ha.toLolalyticsLane(t);for(const t of e.theirTeam){if(t.championId<=0)continue;const e=Dt.getChampionByKey(String(t.championId));if(!e)continue;if(this.championMatchesLane(e,s))return{alias:ha.toLolalytics(e.id),name:e.name}}const n=e.theirTeam.filter(e=>e.championId>0);if(1===n.length){const e=Dt.getChampionByKey(String(n[0].championId));if(e)return{alias:ha.toLolalytics(e.id),name:e.name}}return null}championMatchesLane(e,t){const a=e.tags;switch(t){case"top":return a.includes("Fighter")||a.includes("Tank")&&!a.includes("Support");case"jungle":default:return!1;case"middle":return a.includes("Mage")||a.includes("Assassin");case"bottom":return a.includes("Marksman");case"support":return a.includes("Support")}}async renderAction(e,t,a){const i=t.lastRunes[t.selectedIndex],s=t.lastChampKey?Dt.getChampionByKey(t.lastChampKey):null,n=s?.name??"?";if(!i)return void(e.isDial()?await e.setFeedback({keystone_icon:"",title:n,rune_name:"No data",rune_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${n}\nNo rune data`)));const r="highest_wr"===i.source?"Best WR":"Popular",o=t.applied&&t.spellsApplied?" ":t.applied?" ":"",l=i.games>=1e3?`${(i.games/1e3).toFixed(1)}k`:`${i.games}`,c=i.winRate>=54?"#2ECC71":i.winRate>=50?"#F1C40F":"#E74C3C",d=t.vsChampName?` vs ${t.vsChampName}`:"",h=i.selectedPerkIds[0],u=function(e){const t=Pa(e);return t?`data:image/png;base64,${t}`:null}(h),p=n.length>10?n.slice(0,9)+"":n,m=t.vsChampName?t.vsChampName.length>8?` v ${t.vsChampName.slice(0,7)}`:` v ${t.vsChampName}`:"";if(e.isDial())await e.setFeedback({keystone_icon:u??"",title:`${p}${m}  ${r}${o}`,rune_name:i.keystoneName,rune_info:`${i.winRate}% WR  ${l} games${d?" (matchup)":""}`,wr_bar:{value:i.winRate,bar_fill_c:c}});else{const a=Ba(h,i.subStyleId);a?await e.setImage(a):u&&await e.setImage(u),await e.setTitle(`${n}${o}${d?`\nvs ${t.vsChampName}`:""}`)}}async applyRunesForAction(e,t,a){const i=t.lastRunes[t.selectedIndex];if(i)if(ft.isConnected())try{const s=await yt.getRunePages();let n=s.find(e=>e.name===Fa&&e.isEditable);n||(n=s.find(e=>e.isEditable&&e.isDeletable));const r={name:Fa,primaryStyleId:i.primaryStyleId,subStyleId:i.subStyleId,selectedPerkIds:i.selectedPerkIds,current:!0};if(n){if(await yt.updateRunePage(n.id,r))Ta.info(`Updated rune page ${n.id}  ${i.keystoneName}`),t.applied=!0;else{Ta.debug("Update failed, trying delete + create"),await yt.deleteRunePage(n.id);await yt.createRunePage(r)?(Ta.info(`Recreated rune page  ${i.keystoneName}`),t.applied=!0):Ta.error("Failed to create rune page")}}else{const e=s.filter(e=>e.isDeletable);if(e.length>0){const t=e[e.length-1];await yt.deleteRunePage(t.id)}await yt.createRunePage(r)?(Ta.info(`Created new rune page  ${i.keystoneName}`),t.applied=!0):Ta.error("Failed to create rune page after cleanup")}if(!1!==a.autoSpells&&t.spells.length>0&&!t.spellsApplied){const e=t.spells[0];try{await yt.setSummonerSpells(e.ids[0],e.ids[1])?(t.spellsApplied=!0,Ta.info(`Applied summoner spells: ${e.ids.join("+")} (${e.winRate}% WR)`)):Ta.warn("setSummonerSpells returned false")}catch(e){Ta.warn(`Failed to set summoner spells: ${e}`)}}await this.renderAction(e,t,a)}catch(e){Ta.error(`applyRunes error: ${e}`)}else Ta.warn("Not connected to LCU");else Ta.warn("No rune data to apply")}static{pt(t,i)}},t})();const Ma=ht.logger.createScope("ItemBuilds");class Ua{cache=new Map;CACHE_TTL=18e5;async getBuild(e,t){const a=`${e}:${t}`,i=this.cache.get(a);if(i&&Date.now()-i.timestamp<this.CACHE_TTL)return i.data;i&&this.cache.delete(a);const s=Dt.getVersion().split("."),n=`https://a1.lolalytics.com/mega/?ep=build-itemset&v=1&patch=${`${s[0]}.${s[1]}`}&c=${e}&lane=${"aram"===t?"default":t}&tier=emerald_plus${"aram"===t?"&queue=450":"&queue=ranked"}&region=all`;for(let i=0;i<=2;i++)try{if(i>0){const a=1e3*Math.pow(2,i-1);Ma.debug(`Retry ${i}/2 for ${e} ${t} build in ${a}ms`),await new Promise(e=>setTimeout(e,a))}Ma.debug(`Fetching build (API): ${n}`);const s=await la(n,{signal:AbortSignal.timeout(1e4)});if(!s.ok){Ma.warn(`Lolalytics API returned ${s.status} for ${e} ${t} build`);continue}const r=await s.json();if(!r?.itemSets){Ma.warn(`Invalid API response for ${e} ${t} build`);continue}const o=this.extractBuild(r.itemSets);if(!o||0===o.fullBuild.length){Ma.warn(`Parsed no build data for ${e} ${t} (attempt ${i+1})`);continue}return Ma.info(`Parsed build for ${e} ${t}: start=[${o.startingItems.join(",")}] build=[${o.fullBuild.join(",")}]`),this.cache.set(a,{data:o,timestamp:Date.now()}),o}catch(a){Ma.error(`Failed to fetch build for ${e} ${t} (attempt ${i+1}): ${a}`)}return Ma.error(`All 3 attempts failed for ${e} ${t} build`),i?.data??null}extractBuild(e){let t=this.getBestSet(e.itemBootSet6,6);if(t.length<4&&(t=this.buildSlotBySlot(e)),0===t.length)return null;return{startingItems:this.extractStartingItems(e,t),fullBuild:t}}extractStartingItems(e,t){if(e.startSet){const t=this.getBestSet(e.startSet,1);if(t.length>0)return t}const a=t[0];if(a){const e=Dt.getItemCost(a);if(e>0&&e<=500)return[a,2003];const t=Dt.getItemName(a)?.toLowerCase()??"";if(this.isJungleItem(a))return[1103,2003];if(t.includes("rod")||t.includes("luden")||t.includes("liandry")||t.includes("everfrost")||t.includes("malignance")||t.includes("stormsurge"))return[1056,2003];if(t.includes("sunfire")||t.includes("heartsteel")||t.includes("hollow")||t.includes("iceborn")||t.includes("jak'sho")||t.includes("unending"))return[1054,2003];if(t.includes("shurelya")||t.includes("moonstone")||t.includes("redemption")||t.includes("echoes")||t.includes("dream maker")||t.includes("celestial"))return[3850,2003]}return[1055,2003]}isJungleItem(e){return e>=1101&&e<=1104||e>=1035&&e<=1041}getBestSet(e,t){if(!e||0===e.length)return[];const a=[...e].map(([e,t])=>({ids:e,games:t})).filter(e=>e.games>=5).sort((e,t)=>t.games-e.games);for(const e of a){const a=e.ids.split("_").map(Number).filter(e=>!isNaN(e)&&e>0);if(a.length>=t)return a}return a.length>0?a[0].ids.split("_").map(Number).filter(e=>!isNaN(e)&&e>0):[]}buildSlotBySlot(e){const t=[],a=new Set;for(let i=1;i<=5;i++){const s=e[`itemSet${i}`];if(!s)continue;const n=[...s].map(([e,t])=>({ids:e.split("_").map(Number),games:t})).filter(e=>e.games>=3).sort((e,t)=>t.games-e.games);for(const e of n){const i=e.ids[e.ids.length-1];if(i&&!a.has(i)){t.push(i),a.add(i);break}}}const i=e.itemBootSet1;if(i){const e=[...i].map(([e,t])=>({id:Number(e),games:t})).filter(e=>!isNaN(e.id)&&e.games>=5&&this.isBootsItem(e.id)).sort((e,t)=>t.games-e.games);e.length>0&&!a.has(e[0].id)&&t.splice(1,0,e[0].id)}return t}isBootsItem(e){return e>=3006&&e<=3020||3047===e||3111===e||3117===e||3158===e||3009===e}static toLolalyticsLane(e){return{TOP:"top",JUNGLE:"jungle",MIDDLE:"middle",BOTTOM:"bottom",UTILITY:"support"}[e]??"top"}static toAlias(e){if(!e)return"unknown";for(const t of Dt.getAllChampions())if(t.name.toLowerCase()===e.toLowerCase())return t.id.toLowerCase().replace(/['\s.]/g,"");return e.toLowerCase().replace(/['\s.]/g,"")}clearCache(){this.cache.clear()}}const Ga=new Ua,ja=ht.logger.createScope("BestItem"),Wa=new Set([3006,3009,3020,3047,3111,3117,3158]);let Ka=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.best-item"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;fetchingBuild=!1;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"BEST ITEM",item_name:"Waiting...",cost_text:"",gold_bar:{value:0},status_text:""}):e.action.setTitle("Best Item\nWaiting...")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}onDialRotate(e){const t=this.getState(e.action.id);if(!t.currentBuild||0===t.currentBuild.fullBuild.length)return;const a=t.currentBuild.fullBuild.length;-1===t.browseIndex?t.browseIndex=e.payload.ticks>0?0:a-1:(t.browseIndex+=e.payload.ticks>0?1:-1,t.browseIndex>=a&&(t.browseIndex=0),t.browseIndex<0&&(t.browseIndex=a-1)),this.updateAll().catch(e=>ja.error(`updateAll error: ${e}`))}getState(e){let t=this.actionStates.get(e);return t||(t={currentBuild:null,currentChampion:null,currentLane:null,browseIndex:-1},this.actionStates.set(e,t)),t}startPolling(){this.pollInterval||(this.updateAll().catch(e=>ja.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>ja.error(`updateAll error: ${e}`)),2e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({item_icon:"",title:"BEST ITEM",item_name:"N/A in TFT",cost_text:"",gold_bar:{value:0},status_text:""}):(await e.setImage(""),await e.setTitle("Best Item\nN/A TFT"));return}const e=await vt.getAllData();if(!e){for(const e of this.actionStates.values())e.currentChampion&&(e.currentChampion=null,e.currentLane=null,e.currentBuild=null,e.browseIndex=-1);for(const e of this.actions)e.isDial()?await e.setFeedback({item_icon:"",title:"BEST ITEM",item_name:"No game",cost_text:"",gold_bar:{value:0},status_text:""}):(await e.setImage(""),await e.setTitle("Best Item\nNo game"));return}const t=e.activePlayer.summonerName,a=e.allPlayers.find(e=>e.riotIdGameName===t||e.summonerName===t);if(!a){for(const e of this.actions)e.isDial()?await e.setFeedback({item_name:"Player?",cost_text:"",status_text:""}):await e.setTitle("Best Item\n?");return}const i=a.championName,s=St.isARAM()?"aram":Ua.toLolalyticsLane(a.position);if(i&&""!==i)for(const t of this.actions){const n=this.getState(t.id);if((i!==n.currentChampion||s!==n.currentLane)&&(n.currentChampion=i,n.currentLane=s,n.currentBuild=null,n.browseIndex=-1,!this.fetchingBuild)){this.fetchingBuild=!0,t.isDial()?await t.setFeedback({item_name:"Loading build...",cost_text:"",status_text:""}):await t.setTitle("Best Item\nLoading...");const e=Ua.toAlias(i),a=await Ga.getBuild(e,s);for(const e of this.actionStates.values())e.currentChampion===i&&e.currentLane===s&&(e.currentBuild=a);if(this.fetchingBuild=!1,!a){t.isDial()?await t.setFeedback({item_name:"No data",cost_text:"",status_text:""}):await t.setTitle("Best Item\nNo data");continue}}if(!n.currentBuild||0===n.currentBuild.fullBuild.length)continue;const r=new Set(a.items.map(e=>e.itemID)),o=e.activePlayer.currentGold,l=n.currentBuild.fullBuild;let c,d,h;if(n.browseIndex>=0&&n.browseIndex<l.length)c=l[n.browseIndex],d=`Item ${n.browseIndex+1}/${l.length}`,h=!1;else{const e=this.findNextItemIndex(l,r);if(-1===e){t.isDial()?await t.setFeedback({item_icon:"",title:"BUILD",item_name:"Complete!",cost_text:`${Va(o)}g`,gold_bar:{value:100,bar_fill_c:"#2ECC71"},status_text:"Full build "}):(await t.setImage(""),await t.setTitle("Build\nComplete!"));continue}c=l[e],d=`NEXT (${e+1}/${l.length})`,h=!0}const u=Dt.getItemName(c),p=Dt.getItemCost(c),m=await Ot(c),f=o>=p,g=this.isItemOwned(c,r),y=p>0?Math.min(100,Math.round(o/p*100)):100;let w,v;if(g)w="Owned ",v="#2ECC71";else if(f&&h)w="BUY NOW!",v="#2ECC71";else if(h){w=`Need ${Va(p-o)}g`,v="#F1C40F"}else w=`${Va(p)}g`,v="#888888";const b=`${Va(p)}g | ${Va(o)}g`;if(t.isDial())await t.setFeedback({item_icon:m??"",title:d,item_name:qa(u,18),cost_text:b,gold_bar:{value:g?100:y,bar_fill_c:v},status_text:w});else{m&&await t.setImage(m);const e=g?"":f&&h?"BUY":`${Va(p)}g`;await t.setTitle(`${qa(u,12)}\n${e}`)}}else ja.debug("Champion name not available yet, skipping build fetch")}findNextItemIndex(e,t){for(let a=0;a<e.length;a++)if(!this.isItemOwned(e[a],t))return a;return-1}isItemOwned(e,t){if(t.has(e))return!0;if(Wa.has(e))for(const e of Wa)if(t.has(e))return!0;return!1}},t})();function Va(e){return e>=1e3?`${(e/1e3).toFixed(1)}k`:String(e)}function qa(e,t){return e.length<=t?e:e.substring(0,t-1)+""}const za=ht.logger.createScope("DeathTimer");let Ha=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.death-timer"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;lastDeadMap=new Map;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({champ_icon:"",status_text:"Death Timer",timer_text:"Waiting...",respawn_bar:{value:0}}):e.action.setTitle("Death\nTimer")}onWillDisappear(e){this.lastDeadMap.delete(e.action.id),0===this.actions.length&&this.stopPolling()}startPolling(){this.pollInterval||(this.updateAll().catch(e=>za.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>za.error(`updateAll error: ${e}`)),1e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",status_text:"N/A in TFT",timer_text:"",respawn_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Death\nN/A TFT"));return}const e=await vt.getAllData();if(!e){for(const e of this.actions)this.lastDeadMap.set(e.id,!1),e.isDial()?await e.setFeedback({champ_icon:"",status_text:"Death Timer",timer_text:"No game",respawn_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Death\nTimer"));return}const t=e.activePlayer.summonerName,a=e.allPlayers.find(e=>e.riotIdGameName===t||e.summonerName===t);if(!a){for(const e of this.actions)e.isDial()?await e.setFeedback({status_text:"?",timer_text:"",respawn_bar:{value:0}}):await e.setTitle("Death\n?");return}const i=a.championName?await Bt(a.championName):null;if(a.isDead){const e=Math.ceil(a.respawnTimer),t=Math.min(100,Math.round(e/60*100));for(const a of this.actions)this.lastDeadMap.set(a.id,!0),a.isDial()?await a.setFeedback({champ_icon:i??"",status_text:" DEAD",timer_text:`${e}s`,respawn_bar:{value:t,bar_fill_c:"#E74C3C"}}):(i&&await a.setImage(i),await a.setTitle(` DEAD\n${e}s`))}else for(const e of this.actions){const t=this.lastDeadMap.get(e.id)??!1;this.lastDeadMap.set(e.id,!1),e.isDial()?await e.setFeedback({champ_icon:i??"",status_text:t?"RESPAWNED!":"ALIVE",timer_text:`Lvl ${a.level}`,respawn_bar:{value:100,bar_fill_c:"#2ECC71"}}):(i&&await e.setImage(i),await e.setTitle(t?"ALIVE!\n":`ALIVE\nLvl ${a.level}`))}}},t})();const Ja=ht.logger.createScope("AutoPick");let Ya=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.auto-pick"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;getState(e){let t=this.actionStates.get(e);return t||(t={enabled:!0,hasPicked:!1,hasBanned:!1,lastPhaseTimer:""},this.actionStates.set(e,t)),t}async onWillAppear(e){const t=e.payload.settings,a=this.getState(e.action.id);a.enabled=!1!==t.enabled,this.startPolling(),await this.renderAction(e.action,t,a)}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id);t.enabled=!t.enabled,await e.action.setSettings({...e.payload.settings,enabled:t.enabled}),Ja.info("Auto-pick "+(t.enabled?"enabled":"disabled")),await this.renderAction(e.action,e.payload.settings,t)}startPolling(){this.pollInterval||(this.pollInterval=setInterval(()=>this.updateState().catch(e=>Ja.error(`updateState error: ${e}`)),1e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async renderAction(e,t,a){const i=t.pickChampion||"???",s=t.banChampion||"";if(a.enabled){const t=Dt.getChampionByName(i);if(t){const a=await Lt(t.id);a&&await e.setImage(a)}await e.setTitle(`Pick: ${i}\nBan: ${s}\nON`)}else await e.setImage(""),await e.setTitle("Auto Pick\nOFF")}async updateState(){if(!Array.from(this.actionStates.values()).some(e=>e.enabled))return;if(!ft.isConnected()){for(const e of this.actions)await e.setTitle("Auto Pick\nOffline");return}if(St.isTFT())return;if("ChampSelect"!==await yt.getGameflowPhase()){let e=!1;for(const t of this.actionStates.values())(t.hasPicked||t.hasBanned)&&(t.hasPicked=!1,t.hasBanned=!1,t.lastPhaseTimer="",e=!0);if(e)for(const e of this.actions){const t=await e.getSettings(),a=this.getState(e.id);await this.renderAction(e,t,a)}return}const e=await yt.getChampSelectSession();if(!e)return;const t=e.timer?.phase,a=e.localPlayerCellId,i=e.actions.flat(),s=i.filter(e=>e.actorCellId===a);if("PLANNING"===t){for(const e of this.actions){const t=await e.getSettings(),a=this.getState(e.id);if(t.pickChampion&&!a.hasPicked&&a.enabled){const e=this.resolveChampionId(t.pickChampion);if(e){const a=s.find(e=>"pick"===e.type&&!e.completed);a&&a.championId!==e&&(Ja.info(`PLANNING: hovering ${t.pickChampion} as intent`),await yt.patch(`/lol-champ-select/v1/session/actions/${a.id}`,{championId:e}))}}}return}const n=s.filter(e=>"ban"===e.type),r=s.filter(e=>"pick"===e.type);(n.length>0||r.length>0)&&Ja.debug(`My actions: bans=${JSON.stringify(n.map(e=>({id:e.id,inProgress:e.isInProgress,completed:e.completed})))}, picks=${JSON.stringify(r.map(e=>({id:e.id,inProgress:e.isInProgress,completed:e.completed})))}`);for(const e of this.actions){const t=await e.getSettings(),n=this.getState(e.id);if(n.enabled){if(!n.hasBanned&&t.banChampion){const a=s.find(e=>"ban"===e.type&&!e.completed);if(a&&(Ja.debug(`Found ban action: id=${a.id}, isInProgress=${a.isInProgress}, completed=${a.completed}`),a.isInProgress)){const i=this.resolveChampionId(t.banChampion);if(i){Ja.info(`Auto-banning ${t.banChampion} (ID: ${i})`);const s=!1!==t.autoLock;await this.performAction(a.id,i,s)&&(n.hasBanned=!0,await e.setTitle(`Banned!\n${t.banChampion}`))}else Ja.warn(`Could not resolve ban champion: ${t.banChampion}`)}}else!n.hasBanned&&t.banChampion;if(!n.hasPicked&&t.pickChampion){const r=this.resolveChampionId(t.pickChampion);if(r){if(i.some(e=>"ban"===e.type&&e.completed&&e.championId===r)){Ja.warn(`${t.pickChampion} was banned  cannot auto-pick`),await e.setTitle(`BANNED!\n${t.pickChampion}`),n.hasPicked=!0;continue}if(i.some(e=>"pick"===e.type&&e.completed&&e.championId===r&&e.actorCellId!==a)){Ja.warn(`${t.pickChampion} already picked by a teammate`),await e.setTitle(`TAKEN!\n${t.pickChampion}`),n.hasPicked=!0;continue}}const o=s.find(e=>"pick"===e.type&&!e.completed);if(o&&(Ja.debug(`Found pick action: id=${o.id}, isInProgress=${o.isInProgress}, completed=${o.completed}`),o.isInProgress&&r)){Ja.info(`Auto-picking ${t.pickChampion} (ID: ${r})`);const a=!1!==t.autoLock;if(await this.performAction(o.id,r,a)){n.hasPicked=!0;const a=Dt.getChampionByKey(String(r)),i=a?await Lt(a.id):null;i&&await e.setImage(i),await e.setTitle(`Picked!\n${t.pickChampion}`)}}}}}}resolveChampionId(e){const t=Dt.getChampionByName(e);if(t)return parseInt(t.key,10);const a=Dt.getChampion(e);if(a)return parseInt(a.key,10);const i=parseInt(e,10);if(!isNaN(i)){if(Dt.getChampionByKey(e))return i}return Ja.warn(`Could not resolve champion: ${e}`),null}async performAction(e,t,a){try{if(await yt.patch(`/lol-champ-select/v1/session/actions/${e}`,{championId:t}),Ja.info(`Hover action ${e} with champion ${t}: sent`),a){await new Promise(e=>setTimeout(e,600));const t=await yt.post(`/lol-champ-select/v1/session/actions/${e}/complete`,{});if(Ja.info(`Lock action ${e}: ${t?"success":"failed"}`),!t){await new Promise(e=>setTimeout(e,800));const t=await yt.post(`/lol-champ-select/v1/session/actions/${e}/complete`,{});if(Ja.info(`Lock retry action ${e}: ${t?"success":"failed"}`),!t)return Ja.warn(`Failed to lock action ${e} after retry  will retry next poll`),!1}}return!0}catch(e){return Ja.error(`performAction error: ${e}`),!1}}},t})();const Qa=ht.logger.createScope("LpTracker"),Xa=["RANKED_SOLO_5x5","RANKED_FLEX_SR","RANKED_TFT","RANKED_TFT_DOUBLE_UP"],Za={RANKED_SOLO_5x5:"Solo/Duo",RANKED_FLEX_SR:"Flex",RANKED_TFT:"TFT",RANKED_TFT_DOUBLE_UP:"TFT Duo"},ei={IRON:"Iron",BRONZE:"Bronze",SILVER:"Silver",GOLD:"Gold",PLATINUM:"Plat",EMERALD:"Emerald",DIAMOND:"Dia",MASTER:"Master",GRANDMASTER:"GM",CHALLENGER:"Chall"},ti={IRON:"#7C7C7C",BRONZE:"#CD7F32",SILVER:"#C0C0C0",GOLD:"#FFD700",PLATINUM:"#4ECDC4",EMERALD:"#50C878",DIAMOND:"#B9F2FF",MASTER:"#9B59B6",GRANDMASTER:"#E74C3C",CHALLENGER:"#F1C40F"};let ai=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.lp-tracker"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;getState(e){let t=this.actionStates.get(e);return t||(t={queueIndex:0,lastDisplay:"",sessionStartLp:-1,sessionStartTier:"",sessionStartDiv:"",trackingStarted:!1},this.actionStates.set(e,t)),t}onWillAppear(e){return this.getState(e.action.id),this.startPolling(),e.action.isDial()?e.action.setFeedback({rank_text:"LP Tracker",lp_text:"",winrate_text:"Connecting...",lp_bar:{value:0},delta_text:""}):e.action.setTitle("LP\nTracker")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id);t.queueIndex=(t.queueIndex+1)%Xa.length,t.lastDisplay="",await this.updateAll()}async onDialRotate(e){const t=this.getState(e.action.id);t.queueIndex=(t.queueIndex+(e.payload.ticks>0?1:-1)+Xa.length)%Xa.length,t.lastDisplay="",await this.updateAll()}startPolling(){this.pollInterval||(this.updateAll().catch(e=>Qa.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>Qa.error(`updateAll error: ${e}`)),1e4))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(!ft.isConnected()){for(const e of this.actions)e.isDial()?await e.setFeedback({rank_icon:"",rank_text:"Offline",lp_text:"",winrate_text:"",lp_bar:{value:0},delta_text:""}):(await e.setImage(""),await e.setTitle("LP\nOffline"));return}const e=await yt.getCurrentRankedStats();if(e)for(const t of this.actions){const a=this.getState(t.id),i=Xa[a.queueIndex],s=e.queueMap?.[i];if(!s||!s.tier||""===s.tier||"NONE"===s.tier){const e=Za[i]??i;t.isDial()?await t.setFeedback({rank_icon:"",rank_text:e,lp_text:"Unranked",winrate_text:"",lp_bar:{value:0},delta_text:""}):(await t.setImage(""),await t.setTitle(`${e}\nUnranked`));continue}const n=s.tier,r=s.division??"",o=s.leaguePoints??0,l=s.wins??0,c=s.losses??0,d=l+c,h=d>0?Math.round(l/d*100):0,u=ei[n]??n,p=ti[n]??"#FFFFFF",m=Za[i]??i;a.trackingStarted||(a.sessionStartLp=o,a.sessionStartTier=n,a.sessionStartDiv=r,a.trackingStarted=!0);let f="";if(a.trackingStarted&&a.sessionStartTier===n&&a.sessionStartDiv===r){const e=o-a.sessionStartLp;f=e>0?`+${e} LP`:e<0?`${e} LP`:"0 LP"}else if(a.trackingStarted){const e=ii(n,r),t=ii(a.sessionStartTier,a.sessionStartDiv);e>t?f=" Promoted!":e<t&&(f=" Demoted")}const g=`${i}|${n}|${r}|${o}|${l}|${c}`;if(g===a.lastDisplay)continue;a.lastDisplay=g;const y=await jt(n);if(t.isDial()){const e=Math.min(100,o);await t.setFeedback({rank_icon:y??"",rank_text:`${u} ${r}`,lp_text:`${o} LP`,winrate_text:`${l}W ${c}L (${h}%)`,lp_bar:{value:e,bar_fill_c:p},delta_text:f,queue_text:m})}else{y&&await t.setImage(y);const e=[`${u} ${r}`,`${o} LP`,`${h}% WR`];f&&e.push(f),await t.setTitle(e.join("\n"))}}else for(const e of this.actions)e.isDial()?await e.setFeedback({rank_icon:"",rank_text:"No Data",lp_text:"",winrate_text:"",lp_bar:{value:0},delta_text:""}):(await e.setImage(""),await e.setTitle("LP\nNo Data"))}},t})();function ii(e,t){const a={IRON:0,BRONZE:4,SILVER:8,GOLD:12,PLATINUM:16,EMERALD:20,DIAMOND:24,MASTER:28,GRANDMASTER:29,CHALLENGER:30}[e]??0;return a>=28?a:a+({IV:0,III:1,II:2,I:3}[t]??0)}const si=ht.logger.createScope("JunglePath"),ni={blue:"Blue",gromp:"Gromp",wolves:"Wolves",raptors:"Raptors",red:"Red",krugs:"Krugs",scuttle:"Scuttle",gank:"Gank"},ri={fullClearBlue:{name:"Full Clear (Blue start)",shortName:"Full Blue",description:"Optimal 6-camp clear starting blue side",camps:["blue","gromp","wolves","raptors","red","krugs","scuttle"]},fullClearRed:{name:"Full Clear (Red start)",shortName:"Full Red",description:"Optimal 6-camp clear starting red side",camps:["red","krugs","raptors","wolves","blue","gromp","scuttle"]},threeCampBlue:{name:"3-Camp Gank (Blue start)",shortName:"3C Blue",description:"Fast 3-camp into gank  BlueGrompRedGank",camps:["blue","gromp","red","gank"]},threeCampRed:{name:"3-Camp Gank (Red start)",shortName:"3C Red",description:"Fast 3-camp into gank  RedBlueGrompGank",camps:["red","blue","gromp","gank"]},threeCampRedKrugs:{name:"3-Camp Gank (Red+Krugs)",shortName:"3C RedK",description:"RedKrugsRaptorsGank (bot-focused early)",camps:["red","krugs","raptors","gank"]},fiveCampBlue:{name:"5-Camp Skip Krugs",shortName:"5C SkipK",description:"BlueGrompWolvesRaptorsRedScuttle (skip krugs for tempo)",camps:["blue","gromp","wolves","raptors","red","scuttle"]},fiveCampRed:{name:"5-Camp Skip Gromp",shortName:"5C SkipG",description:"RedKrugsRaptorsWolvesBlueScuttle (skip gromp for tempo)",camps:["red","krugs","raptors","wolves","blue","scuttle"]},reverseFullBlue:{name:"Reverse Full (BlueTop)",shortName:"Rev Blue",description:"BlueWolvesRaptorsRedKrugsGromp (reverse path for flex gank)",camps:["blue","wolves","raptors","red","krugs","scuttle"]}},oi={flexible:["fullClearBlue","fiveCampBlue","threeCampBlue"]},li={masteryi:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Full clear always, scale hard"},karthus:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue"],tip:"Red start preferred, AoE clear"},shyvana:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Farm to 6, prioritize drakes"},diana:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed","fiveCampBlue"],tip:"Fast AoE clear, look for dives at 6"},lillia:{style:"powerFarmer",paths:["fullClearBlue","fiveCampBlue","fullClearRed"],tip:"Fastest full clear, invade enemy camps"},udyr:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Very fast clear, contest scuttles"},nocturne:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Farm to 6, then R-gank"},kindred:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue","threeCampRed"],tip:"Track marks, invade for them"},belveth:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue"],tip:"Farm heavy, scale with resets"},kayn:{style:"powerFarmer",paths:["fullClearBlue","fiveCampBlue","fullClearRed"],tip:"Raptor start optional for AoE form stacking"},viego:{style:"flexible",paths:["fullClearBlue","fiveCampBlue","threeCampBlue"],tip:"Flexible clear, strong skirmisher"},graves:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue"],tip:"Kite camps, healthy full clears"},hecarim:{style:"powerFarmer",paths:["fullClearBlue","fiveCampBlue","fullClearRed"],tip:"Fast clear with Q AoE, strong post-6 ganks"},amumu:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"AoE clear, strong post-6 ganks"},fiddlesticks:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"W-drain AoE clears, avoid early fights"},mordekaiser:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Passive AoE clears, strong 1v1 at 6"},gwen:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Scale-heavy, look for dives at 6"},briar:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue","fiveCampRed"],tip:"Very healthy clear with W sustain"},zyra:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Plant-based AoE clear"},brand:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Passive burn clears camps fast"},taliyah:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed","fiveCampBlue"],tip:"Hard AoE clear, roam with R"},leesin:{style:"ganker",paths:["threeCampRed","threeCampBlue","fullClearRed"],tip:"Early gank power, ward-hop plays"},elise:{style:"ganker",paths:["threeCampRed","threeCampBlue","threeCampRedKrugs"],tip:"Level 3 power spike, tower dive queen"},jarvaniv:{style:"ganker",paths:["threeCampRed","threeCampBlue","fullClearRed"],tip:"Strong level 2-3 ganks with E-Q"},xinzhao:{style:"ganker",paths:["threeCampRed","threeCampRedKrugs","fullClearRed"],tip:"Early duelist, gank at 3"},reksai:{style:"ganker",paths:["threeCampRed","threeCampBlue","fullClearRed"],tip:"Tunnel ganks, strong early pressure"},nidalee:{style:"ganker",paths:["threeCampBlue","threeCampRed"],tip:"Must gank/invade early, falls off"},nunu:{style:"ganker",paths:["threeCampBlue","threeCampRed","fullClearBlue"],tip:"Snowball ganks from level 2-3"},zac:{style:"ganker",paths:["fullClearBlue","threeCampBlue","fiveCampBlue"],tip:"Long-range E ganks at level 4-5"},sejuani:{style:"ganker",paths:["fullClearBlue","threeCampBlue","threeCampRed"],tip:"Strong CC ganks, play for lanes"},rammus:{style:"ganker",paths:["fullClearBlue","threeCampRed","threeCampBlue"],tip:"Q-roll ganks, look for overextended lanes"},volibear:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Strong early duel, tower dive at 6"},warwick:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Blood trail ganks, invade when enemies are low"},pantheon:{style:"ganker",paths:["threeCampRed","threeCampBlue","threeCampRedKrugs"],tip:"Early lane dominant, roam with R at 6"},twistedfate:{style:"ganker",paths:["fullClearBlue","threeCampBlue"],tip:"Farm to 6, global R ganks"},talon:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Wall-hop ganks, invade weak junglers"},qiyana:{style:"ganker",paths:["threeCampRed","threeCampBlue"],tip:"Strong level 3 burst, terrain-based plays"},vi:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Q ganks, point-and-click R at 6"},wukong:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Strong level 2-3, team fight at 6"},ivern:{style:"ganker",paths:["threeCampBlue","threeCampRed"],tip:"Mark & leave camps, perma-gank with Daisy"},poppy:{style:"ganker",paths:["fullClearBlue","threeCampBlue","threeCampRed"],tip:"Wall-stun ganks, anti-dash"},maokai:{style:"ganker",paths:["fullClearBlue","threeCampBlue"],tip:"Sapling vision, root ganks"},rell:{style:"ganker",paths:["threeCampRed","threeCampBlue","fullClearRed"],tip:"Strong CC ganks, engage heavy"},sylas:{style:"ganker",paths:["threeCampBlue","fullClearBlue","threeCampRed"],tip:"Steal ults, flexible duelist"},gragas:{style:"ganker",paths:["threeCampBlue","fullClearBlue","threeCampRed"],tip:"E-flash ganks, body slam CC"},khazix:{style:"invader",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Isolate & delete, invade weak junglers"},rengar:{style:"invader",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Bush-leap ganks, invade at 3"},shaco:{style:"invader",paths:["threeCampRedKrugs","threeCampRed"],tip:"Box-trap start, invade & cheese"},evelynn:{style:"flexible",paths:["fullClearBlue","fullClearRed","fiveCampBlue"],tip:"Farm to 6, perma-stealth ganks"},ekko:{style:"flexible",paths:["fullClearBlue","fiveCampBlue","threeCampBlue"],tip:"Flex between farm and ganks, strong at 6"},yone:{style:"flexible",paths:["fullClearBlue","fullClearRed","fiveCampBlue"],tip:"Scale 6, E-engage ganks"},aurora:{style:"flexible",paths:["fullClearBlue","fiveCampBlue","threeCampBlue"],tip:"R-zoning, flexible clear"},ambessa:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Strong early pressure, dash-heavy ganks"},naafiri:{style:"ganker",paths:["threeCampRed","fullClearRed"],tip:"Pack hunter, walls for gank angles"},skarner:{style:"flexible",paths:["fullClearBlue","threeCampBlue","fullClearRed"],tip:"Strong CC, E-stun ganks"},trundle:{style:"invader",paths:["fullClearRed","threeCampRed","fullClearBlue"],tip:"Pillar ganks, steal stats with R"},olaf:{style:"invader",paths:["fullClearRed","threeCampRed","fullClearBlue"],tip:"Healthy clear, run-down ganks"},jax:{style:"flexible",paths:["fullClearBlue","fullClearRed","threeCampRed"],tip:"Scale hard, strong at 2 items"}};function ci(e,t){return"blue"===e?"blue"===t?"Bot Blue":"Top Blue":"red"===e?"blue"===t?"Top Red":"Bot Red":"gromp"===e?"blue"===t?"Bot Gromp":"Top Gromp":"krugs"===e?"blue"===t?"Top Krugs":"Bot Krugs":"wolves"===e?"Wolves":"raptors"===e?"Raptors":"scuttle"===e?"Scuttle":"Gank"}let di=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.jungle-path"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;dialStates=new Map;currentChampAlias="";currentChampName="";currentSide="blue";currentPaths=[];currentTip="";enemyJunglerName="";enemyJunglerAlias="";enemyJunglerStyle="";async onWillAppear(e){this.stopPolling(),this.startPolling(),e.action.isDial()?(this.getDialState(e.action.id),await e.action.setFeedback({champ_icon:"",title:"Jungle Path",path_name:"Waiting...",camp_route:"",step_bar:{value:0}})):await e.action.setTitle("JGL Path\nWaiting...")}onWillDisappear(e){this.dialStates.delete(e.action.id),0===this.actions.length&&(this.stopPolling(),this.resetState())}async onKeyDown(e){const t=this.getDialState(e.action.id);this.currentPaths.length>0&&(t.pathIndex=(t.pathIndex+1)%this.currentPaths.length,t.stepIndex=0),await this.updateAll()}async onDialRotate(e){const t=this.getDialState(e.action.id);if(0===this.currentPaths.length)return;const a=this.currentPaths[t.pathIndex];a&&(t.stepIndex=(t.stepIndex+e.payload.ticks+100*a.camps.length)%a.camps.length,await this.updateAll())}async onDialUp(e){const t=this.getDialState(e.action.id);this.currentPaths.length>0&&(t.pathIndex=(t.pathIndex+1)%this.currentPaths.length,t.stepIndex=0),await this.updateAll()}async onTouchTap(e){await this.updateAll()}startPolling(){this.pollInterval||(this.updateAll().catch(e=>si.error(`JunglePath poll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>si.error(`JunglePath poll error: ${e}`)),4e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null),this.dialStates.clear()}getDialState(e){let t=this.dialStates.get(e);return t||(t={pathIndex:0,stepIndex:0},this.dialStates.set(e,t)),t}async updateAll(){await this.detectState(),this.resolvePaths();for(const e of this.actions){const t=await e.getSettings(),a=this.getDialState(e.id);this.currentPaths.length>0&&(a.pathIndex=a.pathIndex%this.currentPaths.length);const i=this.currentPaths[a.pathIndex];if(!this.currentChampAlias||0===this.currentPaths.length){e.isDial()?await e.setFeedback({champ_icon:"",title:"Jungle Path",path_name:ft.isConnected()?"Pick a JGL champ":"Offline",camp_route:"",step_bar:{value:0}}):(await e.setImage(""),await e.setTitle(ft.isConnected()?"JGL Path\nPick JGL":"JGL Path\nOffline"));continue}const s=t.side&&"auto"!==t.side?t.side:this.currentSide;e.isDial()&&i?await this.renderDial(e,a,i,s):i&&await this.renderKey(e,a,i,s)}}async renderDial(e,t,a,i){if(!e.isDial())return;const s=a.camps[t.stepIndex],n=t.stepIndex+1,r=a.camps.length,o=Math.round(n/r*100),l="gank"!==s?await Gt(s):null,c=await this.getChampIcon(),d=l??c,h="blue"===i?"Blue":"Red",u=this.enemyJunglerName?` vs ${this.enemyJunglerName}`:"",p=`${this.currentChampName}${u}  ${h}`,m=` ${n}/${r}  ${ci(s,i)}`,f=a.camps.map((e,a)=>{const i=ni[e];return a===t.stepIndex?`[${i}]`:i}),g=`${a.shortName}: ${f.join("  ")}`,y=this.currentTip||g,w=this.getBarColor(s);await e.setFeedback({champ_icon:d??"",title:p,path_name:m,camp_route:y,step_bar:{value:o,bar_fill_c:w}})}async renderKey(e,t,a,i){const s=a.camps[t.stepIndex],n="gank"!==s?await Gt(s):null,r=await this.getChampIcon();n?await e.setImage(n):r&&await e.setImage(r);const o=t.stepIndex+1,l=a.camps.length,c=ci(s,i);await e.setTitle(`${a.shortName} ${o}/${l}\n ${c}`)}getBarColor(e){switch(e){case"blue":return"#3498DB";case"red":return"#E74C3C";case"gromp":default:return"#2ECC71";case"wolves":return"#95A5A6";case"raptors":return"#E67E22";case"krugs":return"#8B4513";case"scuttle":return"#1ABC9C";case"gank":return"#F1C40F"}}async detectState(){const e=await vt.getAllData();if(e?.activePlayer)return void await this.detectFromGame();if(!ft.isConnected())return void(this.currentChampAlias||this.resetState());if(St.isTFT()||St.isARAM())return void this.resetState();const t=await yt.getGameflowPhase();"ChampSelect"===t?await this.detectFromChampSelect():"InProgress"===t||"GameStart"===t||"Reconnect"===t?await this.detectFromGame():this.currentChampAlias||this.resetState()}async detectFromChampSelect(){const e=await yt.getChampSelectSession();if(!e)return;const t=e.myTeam.find(t=>t.cellId===e.localPlayerCellId);if(!t)return;if("jungle"!==t.assignedPosition)return void this.resetState();const a=t.championId||t.championPickIntent;if(!a)return;const i=Dt.getChampionByKey(String(a));i&&(this.currentChampAlias=i.id.toLowerCase().replace(/['\s.]/g,""),this.currentChampName=i.name),this.currentSide=e.localPlayerCellId<5?"blue":"red",this.enemyJunglerName="",this.enemyJunglerAlias="",this.enemyJunglerStyle="";const s=e.theirTeam.find(e=>"jungle"===e.assignedPosition);if(s){const e=s.championId||s.championPickIntent;if(e){const t=Dt.getChampionByKey(String(e));if(t){this.enemyJunglerName=t.name,this.enemyJunglerAlias=t.id.toLowerCase().replace(/['\s.]/g,"");const e=li[this.enemyJunglerAlias];this.enemyJunglerStyle=e?.style??""}}}}async detectFromGame(){Dt.isReady()||await Dt.init();const e=await vt.getAllData();if(!e)return;const t=e.activePlayer;if(!t)return;const a=e.allPlayers?.find(e=>e.summonerName===t.summonerName||e.riotIdGameName===t.summonerName);if(!a)return void si.warn("detectFromGame: could not find active player in allPlayers list");const i=(a.summonerSpells?.summonerSpellOne?.displayName??"").toLowerCase(),s=(a.summonerSpells?.summonerSpellTwo?.displayName??"").toLowerCase();if(!(i.includes("smite")||s.includes("smite")||"JUNGLE"===(a.position??"").toUpperCase()))return void(this.currentChampAlias||this.resetState());si.info(`detectFromGame: JGL detected  ${a.championName}, team=${a.team}`);const n=a.championName;if(n){const e=Dt.getChampionByName(n);e?(this.currentChampAlias=e.id.toLowerCase().replace(/['\s.]/g,""),this.currentChampName=e.name):(this.currentChampAlias=n.toLowerCase().replace(/['\s.]/g,""),this.currentChampName=n)}this.currentSide="ORDER"===a.team?"blue":"red";const r=a.team,o=(e.allPlayers?.filter(e=>e.team!==r)??[]).find(e=>{const t=(e.summonerSpells?.summonerSpellOne?.displayName??"").toLowerCase(),a=(e.summonerSpells?.summonerSpellTwo?.displayName??"").toLowerCase();return t.includes("smite")||a.includes("smite")||"JUNGLE"===(e.position??"").toUpperCase()});if(o?.championName){this.enemyJunglerName=o.championName;const e=Dt.getChampionByName(o.championName);if(e){this.enemyJunglerAlias=e.id.toLowerCase().replace(/['\s.]/g,"");const t=li[this.enemyJunglerAlias];this.enemyJunglerStyle=t?.style??""}}}resetState(){this.currentChampAlias="",this.currentChampName="",this.currentPaths=[],this.currentTip="",this.enemyJunglerName="",this.enemyJunglerAlias="",this.enemyJunglerStyle=""}resolvePaths(){if(!this.currentChampAlias)return this.currentPaths=[],void(this.currentTip="");const e=li[this.currentChampAlias];let t,a;if(e?(t=[...e.paths],a=e.tip??""):(t=[...oi.flexible],a="Default paths (champion not in DB)"),this.enemyJunglerStyle){const i=e?.style??"flexible";if("invader"===this.enemyJunglerStyle||"ganker"===this.enemyJunglerStyle)"powerFarmer"===i&&(a=` ${this.enemyJunglerName} invades early! Start away`,t.includes("fiveCampBlue")||t.push("fiveCampBlue"),t.includes("fiveCampRed")||t.push("fiveCampRed"));else if("powerFarmer"===this.enemyJunglerStyle&&"ganker"===i){a=`${this.enemyJunglerName} farms  gank early for lead!`;const e=t.filter(e=>e.startsWith("threeCamp")),i=t.filter(e=>!e.startsWith("threeCamp"));t=[...e,...i]}else"powerFarmer"===this.enemyJunglerStyle&&"invader"===i&&(a=`${this.enemyJunglerName} farms  invade their jungle!`)}this.currentPaths=t.map(e=>ri[e]).filter(e=>!!e),this.currentTip=a}async getChampIcon(){if(!this.currentChampAlias)return null;const e=this.currentChampAlias;for(const t of Dt.getAllChampions()){if(t.id.toLowerCase().replace(/['\s.]/g,"")===e)return Nt(t.key)}return Bt(this.currentChampName)}},t})();const hi=ht.logger.createScope("SkillOrder"),ui=["","Q","W","E","R"],pi={Q:"#3498DB",W:"#2ECC71",E:"#E67E22",R:"#E74C3C"},mi="#C89B3C";let fi=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.skill-order"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"Skill Order",skill_order:"Waiting...",skill_info:"",wr_bar:{value:0}}):e.action.setTitle("Skill\nOrder")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id);t.detailView=!t.detailView,await this.renderAction(e.action,t)}async onDialRotate(e){const t=this.getState(e.action.id),a=Math.max(0,t.priority.length-1);t.selectedIndex=Math.max(0,Math.min(a,t.selectedIndex+(e.payload.ticks>0?1:-1))),await this.renderAction(e.action,t)}async onDialUp(e){const t=this.getState(e.action.id);t.detailView=!t.detailView,await this.renderAction(e.action,t)}async onTouchTap(e){this.getState(e.action.id).lastChampKey="",await this.updateState()}getState(e){let t=this.actionStates.get(e);return t||(t={lastChampKey:"",priority:[],fullOrder:[],selectedIndex:0,detailView:!1},this.actionStates.set(e,t)),t}startPolling(){this.pollInterval||(this.updateState().catch(e=>hi.error(`updateState error: ${e}`)),this.pollInterval=setInterval(()=>this.updateState().catch(e=>hi.error(`updateState error: ${e}`)),3e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateState(){if(0===this.actions.length)return;const e=ft.isConnected()?await yt.getGameflowPhase():null,t=null!==e&&["ChampSelect","GameStart","InProgress","WaitingForStats","Reconnect"].includes(e);if("ChampSelect"!==e){if(!t)for(const e of this.actions){const t=this.getState(e.id);t.lastChampKey&&(t.lastChampKey="",t.priority=[],t.fullOrder=[],t.selectedIndex=0,e.isDial()?await e.setFeedback({title:"Skill Order",skill_order:"Waiting...",skill_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Skill\nOrder")))}return}const a=await yt.getChampSelectSession();if(!a)return;const i=a.localPlayerCellId,s=a.myTeam.find(e=>e.cellId===i);if(!s||s.championId<=0)return;const n=String(s.championId),r=Dt.getChampionByKey(n);if(!r)return;const o=ha.toLolalytics(r.id);for(const e of this.actions){const t=await e.getSettings(),a=this.getState(e.id);if(n===a.lastChampKey&&a.priority.length>0)continue;a.lastChampKey=n,a.selectedIndex=0,a.priority=[],a.fullOrder=[],a.detailView=!1,e.isDial()?await e.setFeedback({title:r.name,skill_order:"Loading...",skill_info:"",wr_bar:{value:0}}):await e.setTitle(`${r.name}\nLoading...`);const i=St.isARAM()?"aram":ha.toLolalyticsLane((t.role&&"auto"!==t.role?t.role:null)??s.assignedPosition??"top");try{const t=await ka.getBuildData(o,i);t&&(a.priority=t.skillPriority,a.fullOrder=t.skillOrder,a.priority.length>0&&hi.info(`Skills for ${r.name} ${i}: ${a.priority[0].order} (${a.priority[0].winRate}% WR)`)),await this.renderAction(e,a)}catch(t){hi.error(`Failed to get skill data: ${t}`),e.isDial()?await e.setFeedback({title:r.name,skill_order:"Error",skill_info:"",wr_bar:{value:0}}):await e.setTitle(`${r.name}\nNo data`)}}}async renderAction(e,t){const a=t.lastChampKey?Dt.getChampionByKey(t.lastChampKey):null,i=a?.name??"?",s=t.priority[t.selectedIndex];if(!s)return void(e.isDial()?await e.setFeedback({title:i,skill_order:"No data",skill_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${i}\nNo skill data`)));const n="highest_wr"===s.source?"Best WR":"Popular",r=s.order.split("").join(" > "),o=s.games>=1e3?`${(s.games/1e3).toFixed(1)}k`:`${s.games}`,l=s.winRate>=54?"#2ECC71":s.winRate>=50?"#F1C40F":"#E74C3C";if(e.isDial()){const a=i.length>10?i.slice(0,9)+"":i;await e.setFeedback({title:`${a}  ${n}`,skill_order:t.detailView?this.formatFullOrder(t):r,skill_info:`${s.winRate}% WR  ${s.pickRate}% PR  ${o}`,wr_bar:{value:s.winRate,bar_fill_c:l}})}else{const a=this.composeSkillImage(s,t.detailView?t.fullOrder[t.selectedIndex]:null);a&&await e.setImage(a),await e.setTitle(t.detailView?"":`${i}`)}}formatFullOrder(e){const t=e.fullOrder[e.selectedIndex];if(!t)return"N/A";return String(t.sequence).split("").map(e=>ui[parseInt(e)]||"?").join(" ")}composeSkillImage(e,t){const a=e.order.split("");let i;if(t){const e=String(t.sequence).split(""),a=9,s=14,n=4,r=24,o=2,l=0;let c="";const d=["Q","W","E","R"];for(let e=0;e<15;e++){c+=`<text x="${n+e*(a+l)+a/2}" y="${r-4}" font-size="7" fill="#888" text-anchor="middle" font-family="sans-serif">${e+1}</text>`}for(let t=0;t<4;t++){const i=d[t],h=r+t*(s+o),u=pi[i]??"#FFF";c+=`<text x="${n-1}" y="${h+s-3}" font-size="10" fill="${u}" font-weight="bold" text-anchor="end" font-family="sans-serif">${i}</text>`;for(let t=0;t<e.length&&t<15;t++){const r=n+t*(a+l);ui[parseInt(e[t])]===i?(c+=`<rect x="${r}" y="${h}" width="${a}" height="${s}" rx="2" fill="${u}" opacity="0.85"/>`,c+=`<text x="${r+a/2}" y="${h+s-3}" font-size="8" fill="#FFF" text-anchor="middle" font-weight="bold" font-family="sans-serif"></text>`):c+=`<rect x="${r}" y="${h}" width="${a}" height="${s}" rx="2" fill="#1a1a2e" stroke="#333" stroke-width="0.5"/>`}}c+=`<text x="72" y="${r+4*(s+o)+16}" font-size="11" fill="${mi}" text-anchor="middle" font-family="sans-serif">${t.winRate}% WR</text>`,i=c}else{i=`\n\t\t\t\t<text x="72" y="52" font-size="28" text-anchor="middle" font-family="sans-serif">${a.map(e=>`<tspan fill="${pi[e]??"#FFF"}" font-weight="bold">${e}</tspan>`).join('<tspan fill="#888">  </tspan>')}</text>\n\t\t\t\t<text x="72" y="78" font-size="13" fill="${mi}" text-anchor="middle" font-family="sans-serif">${e.winRate}% WR</text>\n\t\t\t\t<text x="72" y="98" font-size="11" fill="#888" text-anchor="middle" font-family="sans-serif">${e.pickRate}% Pick Rate</text>\n\t\t\t`}const s=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t\t<rect width="144" height="144" rx="14" fill="#0A1428"/>\n\t\t\t<rect x="3" y="3" width="138" height="138" rx="13" fill="none" stroke="${mi}" stroke-width="1.5" opacity="0.4"/>\n\t\t\t${i}\n\t\t</svg>`;return`data:image/svg+xml;base64,${Buffer.from(s).toString("base64")}`}},t})();const gi=ht.logger.createScope("RecallWindow"),yi="#C89B3C",wi="#2ECC71",vi="#3498DB",bi="#F1C40F",Si="#E74C3C",_i="#E67E22",ki=1200;let Ci=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.recall-window"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"RECALL",status_text:"Waiting...",gold_text:"",gold_bar:{value:0},info_text:""}):e.action.setTitle("Recall\nWindow")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){await this.updateAll()}async onDialRotate(e){const t=await e.action.getSettings(),a=t.goldTarget??1100,i=Math.max(100,a+50*e.payload.ticks);await e.action.setSettings({...t,goldTarget:i}),await this.updateAll()}async onDialUp(e){const t=await e.action.getSettings();await e.action.setSettings({...t,goldTarget:void 0}),await this.updateAll()}async onTouchTap(e){await this.updateAll()}getState(e){let t=this.actionStates.get(e);return t||(t={currentGold:0,targetGold:1100,targetLabel:"Component",goldReady:!1,shouldRecall:!1,timing:{quality:"neutral",reason:"",shortReason:""},goldPerMin:0,etaSeconds:0,gameTime:0,champName:"",lane:"",buildItems:[],goldHistory:[],enemyLanerName:"",enemyDead:!1,componentBreakpoints:[],lastDragonKill:0,lastBaronKill:0,buildItemsLoading:!1},this.actionStates.set(e,t)),t}startPolling(){this.pollInterval||(this.updateAll().catch(e=>gi.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>gi.error(`updateAll error: ${e}`)),1500))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({title:"RECALL",status_text:"N/A in TFT",gold_text:"",gold_bar:{value:0},info_text:""}):(await e.setImage(""),await e.setTitle("Recall\nN/A TFT"));return}const e=await vt.getAllData();if(!e){for(const e of this.actionStates.values())e.goldHistory=[],e.buildItems=[],e.buildItemsLoading=!1,e.champName="",e.enemyLanerName="",e.componentBreakpoints=[],e.lastDragonKill=0,e.lastBaronKill=0;for(const e of this.actions)e.isDial()?await e.setFeedback({recall_icon:"",title:"RECALL",status_text:"No game",gold_text:"",gold_bar:{value:0},info_text:""}):(await e.setImage(""),await e.setTitle("Recall\nNo game"));return}const t=e.activePlayer,a=t.summonerName,i=e.allPlayers.find(e=>e.riotIdGameName===a||e.summonerName===a);if(!i)return;const s=e.gameData.gameTime,n=t.currentGold,r=i.championName,o=i.team,l=new Set(i.items.map(e=>e.itemID)),c=e.events?.Events??[],d=i.position,h=this.findEnemyLaner(e.allPlayers,o,d);for(const e of this.actions){const t=await e.getSettings(),a=this.getState(e.id);if(a.currentGold=n,a.gameTime=s,a.champName=r,a.lane=d,h?(a.enemyLanerName=h.championName,a.enemyDead=h.isDead):(a.enemyLanerName="",a.enemyDead=!1),this.trackObjectiveEvents(a,c),0===a.buildItems.length&&r&&!a.buildItemsLoading){a.buildItemsLoading=!0;try{const e=St.isARAM()?"aram":Ua.toLolalyticsLane(d),t=Ua.toAlias(r),i=await Ga.getBuild(t,e);i&&i.fullBuild.length>0&&(a.buildItems=i.fullBuild,a.componentBreakpoints=this.buildComponentBreakpoints(i.fullBuild,i.startingItems),gi.info(`Recall: loaded ${a.componentBreakpoints.length} breakpoints for ${r}`))}catch(e){gi.warn(`Failed to load build for recall: ${e}`)}finally{a.buildItemsLoading=!1}}this.updateGoldRate(a,n,s);const{target:i,label:o}=this.findNextTarget(a,l,t);if(a.targetGold=i,a.targetLabel=o,a.goldReady=n>=i,a.timing=this.evaluateTiming(a,s),a.shouldRecall=a.goldReady&&"bad"!==a.timing.quality,a.goldPerMin>0&&!a.goldReady){const e=i-n,t=Math.round(e/a.goldPerMin*60),s=St.isARAM()?4.5:8;a.etaSeconds=t+s}else a.etaSeconds=0;await this.renderAction(e,a)}}findEnemyLaner(e,t,a){const i=e.find(e=>e.team!==t&&e.position===a&&""!==e.position);return i||(e.find(e=>e.team!==t)??null)}trackObjectiveEvents(e,t){for(const a of t)"DragonKill"===a.EventName?e.lastDragonKill=a.EventTime:"BaronKill"===a.EventName&&(e.lastBaronKill=a.EventTime)}evaluateTiming(e,t){const a=St.isARAM(),i=[];if(e.enemyDead&&!a&&i.push({quality:"great",reason:`${e.enemyLanerName} is dead`,shortReason:`${e.enemyLanerName} dead`,priority:10}),!a){const a=this.checkObjectiveTiming(e,t);a&&i.push(a)}if(!a){const e=this.checkCannonTiming(t);e&&i.push(e)}if(e.gameTime>0){const t=this.checkLevelSpike(e);t&&i.push(t)}return 0===i.length?{quality:"neutral",reason:"",shortReason:""}:(i.sort((e,t)=>t.priority-e.priority),i[0])}checkObjectiveTiming(e,t){let a;a=e.lastDragonKill>0?e.lastDragonKill+300:300;const i=a-t;if(i>0&&i<45)return{quality:"bad",reason:`Dragon in ${Math.round(i)}s`,shortReason:`Drake ${Math.round(i)}s`,priority:8};if(t>=1140){let a;a=e.lastBaronKill>0?e.lastBaronKill+360:ki;const i=a-t;if(i>0&&i<45)return{quality:"bad",reason:`Baron in ${Math.round(i)}s`,shortReason:`Baron ${Math.round(i)}s`,priority:9}}if(t<ki){const e=840-t;if(e>0&&e<40)return{quality:"bad",reason:`Herald in ${Math.round(e)}s`,shortReason:`Herald ${Math.round(e)}s`,priority:7}}return null}checkCannonTiming(e){if(e<65)return null;const t=e-65,a=Math.floor(t/30)+1;let i;i=e>=2100?1:e>=1500?2:3;const s=65+30*((a%i===0?a:a+(i-a%i))-1)+15-e;return s>=-5&&s<=20?{quality:"good",reason:"Cannon wave  push & recall",shortReason:"Cannon wave",priority:5}:null}checkLevelSpike(e){return null}buildComponentBreakpoints(e,t){const a=[],i=new Set;if(t.length>0){const e=t.reduce((e,t)=>e+Dt.getItemCost(t),0),i=t.map(e=>Dt.getItemName(e)).join(" + ");e>0&&a.push({gold:e,label:i.length>20?i.slice(0,18)+"":i})}for(const t of e){if(i.has(t))continue;i.add(t);const e=Dt.getItemComponents(t),s=Dt.getItemCost(t);if(e.length>0)for(const t of e){if(i.has(t))continue;const e=Dt.getItemCost(t),s=Dt.getItemName(t);e>=300&&(a.push({gold:e,label:s}),i.add(t))}if(s>0){const e=Dt.getItemName(t);a.push({gold:s,label:e})}}a.sort((e,t)=>e.gold-t.gold);const s=[];for(const e of a)0!==s.length&&s[s.length-1].gold===e.gold||s.push(e);return s}updateGoldRate(e,t,a){if(a<90)return void(e.goldPerMin=0);const i=e.goldHistory[e.goldHistory.length-1];if(!i||a-i.time>=3){e.goldHistory.push({gold:t,time:a});const i=a-60;e.goldHistory=e.goldHistory.filter(e=>e.time>=i)}if(e.goldHistory.length>=2){const t=e.goldHistory[0],i=e.goldHistory[e.goldHistory.length-1];if(i.time-t.time>5){let s=1/0,n=t.time;for(const t of e.goldHistory)t.gold<s&&(s=t.gold,n=t.time);const r=i.time-n;r>10&&i.gold>s?e.goldPerMin=(i.gold-s)/r*60:e.goldPerMin=a<600?250:320}}}findNextTarget(e,t,a){if(a.goldTarget&&a.goldTarget>0)return{target:a.goldTarget,label:`${a.goldTarget}g target`};if(e.componentBreakpoints.length>0){const t=e.componentBreakpoints.filter(e=>!0),a=t.filter(t=>e.currentGold>=t.gold);if(a.length>0){const e=a[a.length-1];return{target:e.gold,label:e.label}}const i=t.find(t=>t.gold>e.currentGold);if(i)return{target:i.gold,label:i.label}}const i=[{gold:350,label:"Boots"},{gold:875,label:"Component"},{gold:1100,label:"Component+"},{gold:1300,label:"Big Comp"},{gold:2600,label:"Full Item"}];for(const t of i)if(e.currentGold<t.gold)return{target:t.gold,label:t.label};return{target:e.currentGold,label:"Full buy"}}async renderAction(e,t){const a=t.targetGold>0?Math.min(100,Math.round(t.currentGold/t.targetGold*100)):100,i=$i(t.currentGold),s=$i(t.targetGold),n=Ii(t.gameTime);"great"===t.timing.quality||"good"===t.timing.quality||t.timing.quality;const r="great"===t.timing.quality?"":"good"===t.timing.quality?"":"bad"===t.timing.quality?"":"",o=t.enemyLanerName?`vs ${t.enemyLanerName}`:"";if(t.shouldRecall){const a=t.timing.reason?`  ${t.timing.shortReason}`:"";if(e.isDial())await e.setFeedback({title:`${t.champName||"RECALL"}  ${n}`,status_text:`RECALL NOW ${r}`,gold_text:`${i}g  ${t.targetLabel}`,gold_bar:{value:100,bar_fill_c:wi},info_text:o?`${o}${a}`:t.timing.reason||"Gold ready!"});else{const a=this.composeKeyImage(t);a&&await e.setImage(a),await e.setTitle("")}}else if(t.goldReady&&"bad"===t.timing.quality)if(e.isDial())await e.setFeedback({title:`${t.champName||"RECALL"}  ${n}`,status_text:`WAIT ${r}`,gold_text:`${i}g   ${t.targetLabel}`,gold_bar:{value:100,bar_fill_c:_i},info_text:t.timing.reason});else{const a=this.composeKeyImage(t);a&&await e.setImage(a),await e.setTitle("")}else{const r=t.etaSeconds>0?`~${Ii(t.etaSeconds)}`:"",o=t.targetGold-t.currentGold,l=a>=80?bi:vi,c=t.timing.reason?`  ${t.timing.shortReason}`:"";if(e.isDial())await e.setFeedback({title:`${t.champName||"RECALL"}  ${n}`,status_text:`Need ${$i(o)}g`,gold_text:`${i}g / ${s}g`,gold_bar:{value:a,bar_fill_c:l},info_text:`${t.targetLabel}${r?`  ${r}`:""}${c}`});else{const a=this.composeKeyImage(t);a&&await e.setImage(a),await e.setTitle("")}}}composeKeyImage(e){const t=40,a=e.targetGold>0?Math.min(1,e.currentGold/e.targetGold):1,i=2*Math.PI*t,s=i*(1-a),n=$i(e.currentGold),r=$i(e.targetGold),o=e.shouldRecall,l=e.goldReady&&"bad"===e.timing.quality;let c,d,h;o?(c=wi,d="NOW",h=wi):l?(c=_i,d="WAIT",h=_i):(c=a>=.8?bi:vi,d=`${Math.round(100*a)}%`,h="#FFF");const u=o||l?28:22;let p="",m="#AAA";"neutral"!==e.timing.quality&&e.timing.shortReason?(p=xi(e.timing.shortReason,12),m="great"===e.timing.quality?wi:"good"===e.timing.quality?vi:"bad"===e.timing.quality?Si:"#AAA"):(p=xi(e.targetLabel,12),e.etaSeconds>0&&!e.goldReady&&(p+=` ${Ii(e.etaSeconds)}`));const f=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t\t<rect width="144" height="144" rx="14" fill="#0A1428"/>\n\t\t\t<rect x="3" y="3" width="138" height="138" rx="12" fill="none" stroke="${yi}" stroke-width="1.5" opacity="0.3"/>\n\n\t\t\t\x3c!-- Progress ring background --\x3e\n\t\t\t<circle cx="72" cy="52" r="40" fill="none" stroke="#333" stroke-width="7"/>\n\t\t\t\x3c!-- Progress ring --\x3e\n\t\t\t<circle cx="72" cy="52" r="40" fill="none" stroke="${c}" stroke-width="7"\n\t\t\t\tstroke-dasharray="${i}" stroke-dashoffset="${s}"\n\t\t\t\tstroke-linecap="round" transform="rotate(-90 72 52)"\n\t\t\t\topacity="0.9"/>\n\n\t\t\t${o?`<circle cx="72" cy="52" r="46" fill="none" stroke="${wi}" stroke-width="2" opacity="0.3"/>`:""}\n\n\t\t\t\x3c!-- Status text inside ring --\x3e\n\t\t\t<text x="72" y="61" font-size="${u}" fill="${h}" text-anchor="middle" font-weight="bold" font-family="sans-serif">${d}</text>\n\n\t\t\t\x3c!-- Gold info --\x3e\n\t\t\t<text x="72" y="116" font-size="18" fill="${yi}" text-anchor="middle" font-weight="700" font-family="sans-serif">${n} / ${r}</text>\n\n\t\t\t\x3c!-- Bottom info --\x3e\n\t\t\t<text x="72" y="136" font-size="14" fill="${m}" text-anchor="middle" font-weight="600" font-family="sans-serif">${g=p,g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}</text>\n\t\t</svg>`;var g;return`data:image/svg+xml;base64,${Buffer.from(f).toString("base64")}`}},t})();function $i(e){return e>=1e4?`${(e/1e3).toFixed(1)}k`:String(Math.round(e))}function Ii(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}function xi(e,t){return e.length>t?e.slice(0,t-1)+"":e}const Ti=ht.logger.createScope("SessionStats"),Ai=["RANKED_SOLO_5x5","RANKED_FLEX_SR"],Di={RANKED_SOLO_5x5:"Solo/Duo",RANKED_FLEX_SR:"Flex"},Ri={IRON:"Iron",BRONZE:"Bronze",SILVER:"Silver",GOLD:"Gold",PLATINUM:"Plat",EMERALD:"Emerald",DIAMOND:"Dia",MASTER:"Master",GRANDMASTER:"GM",CHALLENGER:"Chall"};function Ei(e,t,a){const i={IRON:0,BRONZE:400,SILVER:800,GOLD:1200,PLATINUM:1600,EMERALD:2e3,DIAMOND:2400,MASTER:2800,GRANDMASTER:2900,CHALLENGER:3e3}[e]??0;return i>=2800?i+a:i+({IV:0,III:100,II:200,I:300}[t]??0)+a}let Pi=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.session-stats"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;getState(e){let t=this.actionStates.get(e);return t||(t={queueIndex:0,lastDisplay:"",baselines:new Map,knownGameIds:new Set,sessionRecord:new Map,streak:new Map,sessionStart:Date.now()},this.actionStates.set(e,t)),t}onWillAppear(e){return this.getState(e.action.id),this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"Session Stats",record_text:"",lp_text:"Loading...",streak_text:"",winrate_bar:{value:0}}):e.action.setTitle("Session\nStats")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){this.resetSession(e.action.id),await e.action.setTitle("Session\nReset!"),await this.updateAll()}async onDialRotate(e){const t=this.getState(e.action.id);t.queueIndex=(t.queueIndex+(e.payload.ticks>0?1:-1)+Ai.length)%Ai.length,t.lastDisplay="",await this.updateAll()}async onDialUp(e){this.resetSession(e.action.id),await this.updateAll()}async onTouchTap(e){await this.updateAll()}resetSession(e){const t=this.getState(e);t.baselines.clear(),t.knownGameIds.clear(),t.sessionRecord.clear(),t.streak.clear(),t.lastDisplay="",t.sessionStart=Date.now(),Ti.info(`Session reset for action ${e}`)}startPolling(){this.pollInterval||(this.updateAll().catch(e=>Ti.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>Ti.error(`updateAll error: ${e}`)),15e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(!ft.isConnected()){for(const e of this.actions)e.isDial()?await e.setFeedback({title:"Session Stats",record_text:"",lp_text:"Offline",streak_text:"",winrate_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Session\nOffline"));return}const e=await yt.getCurrentRankedStats();if(!e){for(const e of this.actions)e.isDial()?await e.setFeedback({title:"Session Stats",record_text:"",lp_text:"No Data",streak_text:"",winrate_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Session\nNo Data"));return}const t=await this.fetchRecentMatches();for(const a of this.actions){const i=this.getState(a.id),s=Ai[i.queueIndex],n=e.queueMap?.[s],r=Di[s]??s;if(!n||!n.tier||""===n.tier||"NONE"===n.tier){a.isDial()?await a.setFeedback({title:r,record_text:"",lp_text:"Unranked",streak_text:"",winrate_bar:{value:0}}):(await a.setImage(""),await a.setTitle(`${r}\nUnranked`));continue}const o=Ei(n.tier,n.division,n.leaguePoints??0);i.baselines.has(s)||(i.baselines.set(s,{tier:n.tier,div:n.division,lp:n.leaguePoints??0,totalLp:o,wins:n.wins??0,losses:n.losses??0}),Ti.info(`Session baseline for ${s}: ${n.tier} ${n.division} ${n.leaguePoints}LP`));const l=i.baselines.get(s),c=(n.wins??0)-l.wins,d=(n.losses??0)-l.losses,h=c+d,u=h>0?Math.round(c/h*100):0,p=o-l.totalLp;let m;m=p>0?`+${p} LP`:p<0?`${p} LP`:"0 LP";const f="RANKED_SOLO_5x5"===s?420:440,g=this.calculateStreak(t,f);let y="";g>0?y=` ${g}W`:g<0&&(y=` ${Math.abs(g)}L`);const w=Ri[n.tier]??n.tier;n.tier;const v=`${s}|${n.tier}|${n.division}|${n.leaguePoints}|${n.wins}|${n.losses}|${g}`;if(v===i.lastDisplay)continue;i.lastDisplay=v;const b=await jt(n.tier);if(a.isDial())await a.setFeedback({title:`${r}  ${w} ${n.division}`,record_text:h>0?`${c}W ${d}L (${u}%)`:"No games yet",lp_text:m,streak_text:y,winrate_bar:{value:h>0?u:50,bar_fill_c:h>0?u>=50?"#2ECC71":"#E74C3C":"#555"},rank_icon:b??""});else{b&&await a.setImage(b);const e=[];h>0?e.push(`${c}W ${d}L`):e.push("No games"),e.push(m),y&&e.push(y),await a.setTitle(e.join("\n"))}}}async fetchRecentMatches(){try{const e=await yt.get("/lol-match-history/v1/products/lol/current-summoner/matches?begIndex=0&endIndex=20");return e?.games?.games??[]}catch(e){return Ti.warn(`Failed to fetch match history: ${e}`),[]}}calculateStreak(e,t){const a=e.filter(e=>e.queueId===t).sort((e,t)=>t.gameCreation-e.gameCreation);if(0===a.length)return 0;const i=a[0].participants?.[0]?.stats?.win;if(void 0===i)return 0;let s=0;for(const e of a){const t=e.participants?.[0]?.stats?.win;if(t!==i)break;s++}return i?s:-s}},t})();const Li=ht.logger.createScope("PostGame"),Ni="#C89B3C",Bi="#2ECC71",Fi="#E74C3C",Oi=["overview","damage","details"];let Mi=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.post-game"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}lastMatchStats=null;lastGameId=0;displayPage="overview";unsubscribeMode=null;pollInterval=null;wasInGame=!1;onWillAppear(e){return this.startListening(),this.lastMatchStats?this.renderAll():e.action.isDial()?e.action.setFeedback({title:"Post-Game",result_text:"",kda_text:"No game yet",stat1_text:"",stat2_text:"",stat_bar:{value:0}}):e.action.setTitle("Post\nGame")}onWillDisappear(e){0===this.actions.length&&this.stopListening()}async onKeyDown(e){await this.fetchLatestMatch(),await this.renderAll()}async onDialRotate(e){const t=(Oi.indexOf(this.displayPage)+(e.payload.ticks>0?1:-1)+Oi.length)%Oi.length;this.displayPage=Oi[t],await this.renderAll()}async onTouchTap(e){await this.fetchLatestMatch(),await this.renderAll()}startListening(){this.unsubscribeMode||(this.unsubscribeMode=St.onChange((e,t)=>{"InProgress"===t&&(this.wasInGame=!0),!this.wasInGame||"EndOfGame"!==t&&"PreEndOfGame"!==t||(this.wasInGame=!1,setTimeout(()=>{this.fetchLatestMatch().then(()=>this.renderAll()).catch(e=>Li.error(`Post-game fetch error: ${e}`))},3e3))})),this.pollInterval||(this.pollInterval=setInterval(()=>{const e=St.getPhase();this.lastMatchStats||"EndOfGame"!==e&&"Lobby"!==e||this.fetchLatestMatch().then(()=>this.renderAll()).catch(e=>Li.error(`Post-game poll error: ${e}`))},3e4))}stopListening(){this.unsubscribeMode&&(this.unsubscribeMode(),this.unsubscribeMode=null),this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async fetchLatestMatch(){if(ft.isConnected())try{const e=await yt.get("/lol-match-history/v1/products/lol/current-summoner/matches?begIndex=0&endIndex=1"),t=e?.games?.games;if(!t||0===t.length)return void Li.debug("No recent matches in history");const a=t[0];if(a.gameId===this.lastGameId)return;const i=a.participants?.[0],s=i?.stats;if(!s)return void Li.warn("No participant stats in match history entry");const n=i.championId,r=Dt.getChampionByKey(String(n));this.lastMatchStats={win:s.win,championName:r?.name??`Champ ${n}`,kills:s.kills??0,deaths:s.deaths??0,assists:s.assists??0,cs:(s.totalMinionsKilled??0)+(s.neutralMinionsKilled??0),goldEarned:s.goldEarned??0,totalDamageDealt:s.totalDamageDealtToChampions??0,visionScore:s.visionScore??0,gameDuration:a.gameDuration??0,gameMode:a.gameMode??"",queueId:a.queueId??0,gameId:a.gameId},this.lastGameId=a.gameId,this.displayPage="overview",Li.info(`Post-game: ${this.lastMatchStats.win?"WIN":"LOSS"} as ${this.lastMatchStats.championName} (${this.lastMatchStats.kills}/${this.lastMatchStats.deaths}/${this.lastMatchStats.assists}) ${Math.round(this.lastMatchStats.gameDuration/60)}min`)}catch(e){Li.error(`Failed to fetch match history: ${e}`)}}async renderAll(){for(const e of this.actions)await this.renderAction(e)}async renderAction(e){const t=this.lastMatchStats;if(!t)return void(e.isDial()?await e.setFeedback({title:"Post-Game",result_text:"",kda_text:"No game yet",stat1_text:"",stat2_text:"",stat_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Post\nGame")));const a=t.deaths>0?((t.kills+t.assists)/t.deaths).toFixed(1):"Perfect",i=`${t.kills}/${t.deaths}/${t.assists}`,s=t.gameDuration>0?(t.cs/(t.gameDuration/60)).toFixed(1):"0",n=Math.round(t.gameDuration/60),r=(t.goldEarned/1e3).toFixed(1),o=(t.totalDamageDealt/1e3).toFixed(1),l=t.win?Bi:Fi,c=t.win?"VICTORY":"DEFEAT";if(e.isDial())switch(this.displayPage){case"overview":await e.setFeedback({title:`${t.championName}  ${n}min`,result_text:{value:c,color:l},kda_text:{value:`${i}  (${a} KDA)`,color:"#FFF"},stat1_text:{value:`${t.cs} CS (${s}/min)`,color:"#AAA"},stat2_text:{value:`${r}k gold  ${t.visionScore} vision`,color:Ni},stat_bar:{value:Math.min(100,Math.round((t.kills+t.assists)/Math.max(1,t.deaths)*20)),bar_fill_c:l}});break;case"damage":await e.setFeedback({title:`${t.championName}  Damage`,result_text:{value:c,color:l},kda_text:{value:`${o}k damage to champs`,color:"#FFF"},stat1_text:{value:`${r}k gold earned`,color:Ni},stat2_text:{value:`${i}  (${a} KDA)`,color:"#AAA"},stat_bar:{value:Math.min(100,Math.round(t.totalDamageDealt/500)),bar_fill_c:"#3498DB"}});break;case"details":await e.setFeedback({title:`${t.championName}  Details`,result_text:{value:c,color:l},kda_text:{value:`${t.cs} CS (${s}/min)`,color:"#FFF"},stat1_text:{value:`Vision: ${t.visionScore}`,color:"#AAA"},stat2_text:{value:`Game: ${n}min`,color:"#AAA"},stat_bar:{value:Math.min(100,Math.round(3*t.visionScore)),bar_fill_c:"#9B59B6"}})}else{const a=this.composeKeyImage(t);a&&await e.setImage(a),await e.setTitle("")}}composeKeyImage(e){const t=e.deaths>0?((e.kills+e.assists)/e.deaths).toFixed(1):"Perfect",a=`${e.kills}/${e.deaths}/${e.assists}`,i=e.gameDuration>0?(e.cs/(e.gameDuration/60)).toFixed(1):"0",s=Math.round(e.gameDuration/60),n=(e.goldEarned/1e3).toFixed(1),r=e.win?Bi:Fi,o=e.win?"VICTORY":"DEFEAT",l=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t\t<rect width="144" height="144" rx="14" fill="#0A1428"/>\n\t\t\t<rect x="3" y="3" width="138" height="138" rx="12" fill="none" stroke="${r}" stroke-width="2" opacity="0.4"/>\n\n\t\t\t\x3c!-- Result banner --\x3e\n\t\t\t<rect x="10" y="8" width="124" height="28" rx="6" fill="${e.win?"rgba(46,204,113,0.15)":"rgba(231,76,60,0.15)"}"/>\n\t\t\t<text x="72" y="28" font-size="20" fill="${r}" text-anchor="middle" font-weight="bold" font-family="sans-serif">${o}</text>\n\n\t\t\t\x3c!-- Champion name --\x3e\n\t\t\t<text x="72" y="52" font-size="13" fill="${Ni}" text-anchor="middle" font-weight="600" font-family="sans-serif">${function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}((c=e.championName,d=14,c.length>d?c.slice(0,d-1)+"":c))}  ${s}m</text>\n\n\t\t\t\x3c!-- KDA --\x3e\n\t\t\t<text x="72" y="76" font-size="22" fill="#FFF" text-anchor="middle" font-weight="bold" font-family="sans-serif">${a}</text>\n\t\t\t<text x="72" y="94" font-size="13" fill="#AAA" text-anchor="middle" font-family="sans-serif">${t} KDA</text>\n\n\t\t\t\x3c!-- Stats row --\x3e\n\t\t\t<text x="72" y="116" font-size="12" fill="#AAA" text-anchor="middle" font-family="sans-serif">${e.cs} CS (${i}/m)  ${n}k gold</text>\n\n\t\t\t\x3c!-- Vision --\x3e\n\t\t\t<text x="72" y="134" font-size="11" fill="#888" text-anchor="middle" font-family="sans-serif">Vision ${e.visionScore}</text>\n\t\t</svg>`;var c,d;return`data:image/svg+xml;base64,${Buffer.from(l).toString("base64")}`}},t})();const Ui=ht.logger.createScope("TftComps"),Gi={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml"};let ji=[],Wi=0,Ki=!1;async function Vi(){if(ji.length>0&&Date.now()-Wi<72e5)return ji;if(Ki){for(let e=0;e<30&&(await new Promise(e=>setTimeout(e,500)),Ki);e++);return ji}Ki=!0;try{Ui.info("Fetching TFT meta comps from tftactics.gg...");const e=await fetch("https://tftactics.gg/tierlist/team-comps",{headers:Gi});if(!e.ok)return Ui.warn(`TFT comps fetch failed: ${e.status}`),ji;const t=function(e){const t=[];e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();const a=e.split(/Copy Team Code/i);for(const e of a){if(e.length<50)continue;const a=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),i=a.match(/([]?\s*[NEW\s]*)?\b([SABN])\s*([A-Z][a-zA-Z &']+?)(?:\s*(?:Fast|Slow|Standard|lvl|Augment|Emblem))/);if(!i)continue;const s=a.includes("")?"up":a.includes("")?"down":a.includes("NEW")?"new":"stable",n=i[2];let r=i[3].trim();if(r=r.replace(/\s+/g," ").trim(),r.length<3||r.length>40)continue;const o=a.match(/(Fast\s+\d+|Slow\s+Roll\s*\(\d+\)|Standard|lvl\s+\d+)/i),l=o?o[1]:"",c=e.matchAll(/\/champions\/([a-z_&]+)\/?/gi),d=new Set,h=[];for(const t of c){const i=t[1].replace(/_/g," ").replace(/&/g," & ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");if(d.has(i))continue;d.add(i);const s=a.includes(` ${i}`),n=qi(e,t[1]);h.push({name:i,items:n,threeStarred:s})}h.length<3||t.push({tier:n,name:r,playstyle:l,trend:s,champions:h})}const i=new Set,s=[];for(const e of t){const t=e.name.toLowerCase();i.has(t)||(i.add(t),s.push(e))}return s}(await e.text());return t.length>0?(ji=t,Wi=Date.now(),Ui.info(`Parsed ${t.length} TFT meta comps (S: ${t.filter(e=>"S"===e.tier).length}, A: ${t.filter(e=>"A"===e.tier).length}, B: ${t.filter(e=>"B"===e.tier).length})`)):Ui.warn("TFT comps parse returned 0 comps  page structure may have changed"),ji}catch(e){return Ui.error(`TFT comps fetch error: ${e}`),ji}finally{Ki=!1}}function qi(e,t){const a=e.split(new RegExp(`/champions/${t}/?`,"i"));if(a.length<2)return[];const i=a[1].substring(0,300),s=[],n=["Bloodthirster","Deathblade","Giant Slayer","Guinsoo's Rageblade","Hand of Justice","Hextech Gunblade","Infinity Edge","Last Whisper","Nashor's Tooth","Quicksilver","Rabadon's Deathcap","Spear of Shojin","Statikk Shiv","Titan's Resolve","Archangel's Staff","Blue Buff","Bramble Vest","Dragon's Claw","Edge of Night","Evenshroud","Gargoyle Stoneplate","Ionic Spark","Morellonomicon","Redemption","Shroud of Stillness","Spark","Sunfire Cape","Warmog's Armor","Jeweled Gauntlet","Crownguard","Adaptive Helm","Red Buff","Spirit Visage","Sterak's Gage","Striker's Flail","Void Staff","Kraken's Fury"];for(const e of n)if(i.includes(e)&&(s.push(e),s.length>=3))break;return s}const zi=ht.logger.createScope("TftComp"),Hi="#C89B3C",Ji={S:"#FF7F50",A:"#2ECC71",B:"#3498DB",N:"#95A5A6"},Yi=["ALL","S","A","B"];let Qi=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.tft-comp"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;lastComps=[];dataLoaded=!1;onWillAppear(e){const t=e.payload.settings.tierFilter??"ALL";return this.getState(e.action.id,t),this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"TFT Meta Comps",comp_name:"Loading...",comp_info:"",champ_list:"",tier_bar:{value:0}}):e.action.setTitle("TFT\nComps")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id,e.payload.settings.tierFilter),a=this.getFilteredComps(t.tierFilter);a.length>0&&(t.compIndex=(t.compIndex+1)%a.length),await this.renderAll()}async onDialRotate(e){const t=this.getState(e.action.id,e.payload.settings.tierFilter),a=this.getFilteredComps(t.tierFilter);a.length>0&&(t.compIndex=(t.compIndex+e.payload.ticks+100*a.length)%a.length),await this.renderAll()}async onDialUp(e){const t=this.getState(e.action.id,e.payload.settings.tierFilter),a=Yi.indexOf(t.tierFilter);t.tierFilter=Yi[(a+1)%Yi.length],t.compIndex=0,await this.renderAll()}async onTouchTap(e){ji=[],Wi=0,this.dataLoaded=!1,await this.fetchComps(),await this.renderAll()}getState(e,t){let a=this.actionStates.get(e);return a||(a={compIndex:0,tierFilter:t??"ALL"},this.actionStates.set(e,a)),a}getFilteredComps(e){return"ALL"===e?this.lastComps:this.lastComps.filter(t=>t.tier===e)}startPolling(){this.pollInterval||(this.fetchComps().then(()=>this.renderAll()).catch(e=>zi.error(`TFT fetch error: ${e}`)),this.pollInterval=setInterval(()=>{this.fetchComps().then(()=>this.renderAll()).catch(e=>zi.error(`TFT poll error: ${e}`))},18e5))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async fetchComps(){const e=await Vi();e.length>0&&(this.lastComps=e,this.dataLoaded=!0)}async renderAll(){for(const e of this.actions)await this.renderAction(e)}async renderAction(e){const t=this.getState(e.id),a=this.getFilteredComps(t.tierFilter);if(!this.dataLoaded||0===a.length)return void(e.isDial()?await e.setFeedback({title:`TFT Comps  ${t.tierFilter}`,comp_name:this.dataLoaded?"No comps found":"Loading...",comp_info:"",champ_list:"",tier_bar:{value:0}}):(await e.setImage(""),await e.setTitle(this.dataLoaded?"TFT\nNo comps":"TFT\nLoading...")));const i=a[t.compIndex%a.length],s=Ji[i.tier]??"#AAA",n="up"===i.trend?"":"down"===i.trend?"":"new"===i.trend?"":"",r=i.champions.slice(0,5).map(e=>`${e.threeStarred?"":""}${Xi(e.name)}`).join(" ");i.champions.map(e=>{const t=e.threeStarred?"":"",a=e.items.length>0?` (${e.items.map(Zi).join(",")})`:"";return`${t}${e.name}${a}`}).join("  ");const o=i.champions.filter(e=>e.items.length>0).slice(0,2).map(e=>`${Xi(e.name)}: ${e.items.map(Zi).join("+")}`).join(" | ");if(e.isDial()){const l="S"===i.tier?95:"A"===i.tier?65:"B"===i.tier?35:15;await e.setFeedback({title:{value:`${n} [${i.tier}] ${i.name}`,color:s},comp_name:{value:`${i.playstyle}  ${t.compIndex+1}/${a.length}`,color:"#FFF"},comp_info:{value:o||r,color:"#AAA"},champ_list:{value:r,color:Hi},tier_bar:{value:l,bar_fill_c:s}})}else{const s=this.composeKeyImage(i,t.compIndex+1,a.length,t.tierFilter);s&&await e.setImage(s),await e.setTitle("")}}composeKeyImage(e,t,a,i){const s=Ji[e.tier]??"#AAA",n="up"===e.trend?"":"down"===e.trend?"":"",r=e.champions.slice(0,4).map(e=>(e.threeStarred?"":"")+Xi(e.name)).join(" "),o=e.champions.length>4?e.champions.slice(4,8).map(e=>(e.threeStarred?"":"")+Xi(e.name)).join(" "):"",l=e.champions.find(e=>e.items.length>0),c=l?`${Xi(l.name)}: ${l.items.map(Zi).join("+")}`:"",d=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t\t<rect width="144" height="144" rx="14" fill="#0A1428"/>\n\t\t\t<rect x="3" y="3" width="138" height="138" rx="12" fill="none" stroke="${s}" stroke-width="2" opacity="0.5"/>\n\n\t\t\t\x3c!-- Tier badge --\x3e\n\t\t\t<rect x="10" y="7" width="30" height="22" rx="5" fill="${s}" opacity="0.9"/>\n\t\t\t<text x="25" y="24" font-size="16" fill="#FFF" text-anchor="middle" font-weight="bold" font-family="sans-serif">${ts(e.tier)}</text>\n\n\t\t\t\x3c!-- Trend + index --\x3e\n\t\t\t<text x="132" y="23" font-size="11" fill="#888" text-anchor="end" font-family="sans-serif">${ts(n)} ${t}/${a}</text>\n\n\t\t\t\x3c!-- Comp name --\x3e\n\t\t\t<text x="72" y="48" font-size="14" fill="${s}" text-anchor="middle" font-weight="bold" font-family="sans-serif">${ts(es(e.name,16))}</text>\n\n\t\t\t\x3c!-- Playstyle --\x3e\n\t\t\t<text x="72" y="65" font-size="11" fill="#AAA" text-anchor="middle" font-family="sans-serif">${ts(e.playstyle||"Standard")}</text>\n\n\t\t\t\x3c!-- Champions line 1 --\x3e\n\t\t\t<text x="72" y="86" font-size="11" fill="${Hi}" text-anchor="middle" font-weight="600" font-family="sans-serif">${ts(es(r,22))}</text>\n\n\t\t\t\x3c!-- Champions line 2 --\x3e\n\t\t\t<text x="72" y="102" font-size="11" fill="${Hi}" text-anchor="middle" font-weight="600" font-family="sans-serif">${ts(es(o,22))}</text>\n\n\t\t\t\x3c!-- Carry items --\x3e\n\t\t\t<text x="72" y="122" font-size="10" fill="#AAA" text-anchor="middle" font-family="sans-serif">${ts(es(c,24))}</text>\n\n\t\t\t\x3c!-- Filter indicator --\x3e\n\t\t\t<text x="72" y="138" font-size="9" fill="#666" text-anchor="middle" font-family="sans-serif">Filter: ${i}</text>\n\t\t</svg>`;return`data:image/svg+xml;base64,${Buffer.from(d).toString("base64")}`}},t})();function Xi(e){if(e.includes("&")){return e.split("&").map(e=>e.trim()).map(e=>e.slice(0,3)).join("&")}const t=e.split(" ");if(t.length>=2){return t[0].charAt(0).toUpperCase()+t[1].charAt(0).toUpperCase()}return e.length>5?e.slice(0,4):e}function Zi(e){return{Bloodthirster:"BT",Deathblade:"DB","Giant Slayer":"GS","Guinsoo's Rageblade":"GRB","Hand of Justice":"HoJ","Hextech Gunblade":"HGB","Infinity Edge":"IE","Last Whisper":"LW","Nashor's Tooth":"NT",Quicksilver:"QSS","Rabadon's Deathcap":"Rab","Spear of Shojin":"SoS","Statikk Shiv":"SS","Titan's Resolve":"TR","Archangel's Staff":"AA","Blue Buff":"BB","Bramble Vest":"BV","Dragon's Claw":"DC","Edge of Night":"EoN",Evenshroud:"ES","Gargoyle Stoneplate":"GS","Ionic Spark":"IS",Morellonomicon:"Mor","Sunfire Cape":"SFC","Warmog's Armor":"WA","Jeweled Gauntlet":"JG",Crownguard:"CG","Adaptive Helm":"AH","Red Buff":"RB","Spirit Visage":"SV","Sterak's Gage":"SG","Striker's Flail":"SF","Void Staff":"VS","Kraken's Fury":"KF"}[e]??e.split(" ").map(e=>e[0]).join("")}function es(e,t){return e.length>t?e.slice(0,t-1)+"":e}function ts(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}for(const e of[process.stdout,process.stderr])e?.on?.("error",e=>{if("EPIPE"!==e.code&&"ERR_STREAM_DESTROYED"!==e.code)throw e});ht.logger.setLevel("info");const as=ht.logger.createScope("Plugin");process.on("uncaughtException",e=>{if("EPIPE"!==e.code&&"ERR_STREAM_DESTROYED"!==e.code)try{as.error(`Uncaught exception: ${e.message}\n${e.stack}`)}catch{}}),process.on("unhandledRejection",e=>{try{as.error(`Unhandled rejection: ${e}`)}catch{}}),ht.actions.registerAction(new It),ht.actions.registerAction(new Jt),ht.actions.registerAction(new Qt),ht.actions.registerAction(new Zt),ht.actions.registerAction(new ma),ht.actions.registerAction(new va),ht.actions.registerAction(new Oa),ht.actions.registerAction(new Ka),ht.actions.registerAction(new Ha),ht.actions.registerAction(new Ya),ht.actions.registerAction(new ai),ht.actions.registerAction(new di),ht.actions.registerAction(new fi),ht.actions.registerAction(new Ci),ht.actions.registerAction(new Pi),ht.actions.registerAction(new Mi),ht.actions.registerAction(new Qi),ht.connect().then(()=>{(async function(){as.info("LoL Companion plugin starting...");for(let e=1;e<=3&&(await Dt.init(),!Dt.isReady()&&3!==e);e++)as.warn(`DataDragon init attempt ${e} may have failed, retrying in ${2*e}s...`),await new Promise(t=>setTimeout(t,2e3*e));ft.startPolling(3e3),St.start(),ft.onConnectionChange(e=>{e?as.info(`League Client connected (port ${e.port})`):as.info("League Client disconnected")}),as.info("LoL Companion plugin initialized")})().catch(e=>as.error(`Init failed: ${e}`))});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            

Error: Failed to read manifest.json as the file does not exist.
    at T.<anonymous> (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:57706)
    at get value (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:4772)
    at T.<anonymous> (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:64498)
    at get value (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:4772)
    at Le.registerAction (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:66035)
    at file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:212800
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:454:37)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:435:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1537:24)
    at Module._compile (node:internal/modules/cjs/loader:1688:5)
2026-02-21T07:41:25.744Z ERROR Plugin: Uncaught exception: Failed to read manifest.json as the file does not exist.
file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1
import e from"events";import t from"https";import a from"http";import i from"net";import s from"tls";import n from"crypto";import r from"stream";import o from"url";import l from"zlib";import c from"buffer";import d,{existsSync as h,readFileSync as u}from"node:fs";import p,{join as m,dirname as f}from"node:path";import{cwd as g}from"node:process";import{randomUUID as y}from"node:crypto";import{exec as w,spawn as v}from"node:child_process";import{readFile as b}from"node:fs/promises";import S from"node:https";import{fileURLToPath as _}from"node:url";class k{events=new Map;addListener(e,t){return this.add(e,t,e=>e.push({listener:t}))}disposableOn(e,t){return this.add(e,t,e=>e.push({listener:t})),function(e){let t=!1;const a=()=>{t||(e(),t=!0)};return{[Symbol.dispose]:a,dispose:a}}(()=>this.removeListener(e,t))}emit(e,...t){const a=this.events.get(e);if(void 0===a)return!1;for(let i=0;i<a.length;){const{listener:s,once:n}=a[i];n?this.remove(e,a,i):i++,s(...t)}return!0}eventNames(){return Array.from(this.events.keys())}listenerCount(e,t){const a=this.events.get(e);if(void 0===a||null==t)return a?.length||0;let i=0;return a.forEach(e=>{e.listener===t&&i++}),i}listeners(e){return Array.from(this.events.get(e)||[]).map(({listener:e})=>e)}off(e,t){const a=this.events.get(e)??[];for(let i=a.length-1;i>=0;i--)a[i].listener===t&&this.remove(e,a,i);return this}on(e,t){return this.add(e,t,e=>e.push({listener:t}))}once(e,t){return this.add(e,t,e=>e.push({listener:t,once:!0}))}prependListener(e,t){return this.add(e,t,e=>e.splice(0,0,{listener:t}))}prependOnceListener(e,t){return this.add(e,t,e=>e.splice(0,0,{listener:t,once:!0}))}removeAllListeners(e){const t=this.events.get(e)??[];for(;t.length>0;)this.remove(e,t,0);return this.events.delete(e),this}removeListener(e,t){return this.off(e,t)}add(e,t,a){let i=this.events.get(e);if(void 0===i&&(i=[],this.events.set(e,i)),a(i),"newListener"!==e){const a=[e,t];this.emit("newListener",...a)}return this}remove(e,t,a){const[{listener:i}]=t.splice(a,1);if("removeListener"!==e){const t=[e,i];this.emit("removeListener",...t)}}}function C(e){null==e||"object"!=typeof e||Object.isFrozen(e)||(Object.freeze(e),Object.values(e).forEach(C))}function $(e,t){return t.split(".").reduce((e,t)=>e&&e[t],e)}class I{#e;#t=new Map;#a;#i=new k;constructor(e,t){this.#e=e,this.#a=t}get language(){return this.#e}set language(e){this.#e!==e&&(this.#e=e,this.#i.emit("languageChange",e))}onLanguageChange(e){return this.#i.disposableOn("languageChange",e)}t(e,t=this.language){return this.translate(e,t)}translate(e,t=this.language){const a=new Set([t,t.replaceAll("_","-").split("-").at(0),"en"]);for(const t of a){const a=$(this.getTranslations(t),e);if(a)return a.toString()}return e}getTranslations(e){let t=this.#t.get(e);return void 0===t&&(t=this.#a(e),C(t),this.#t.set(e,t)),t}}class x{#s;#n;#r;constructor(e){e instanceof x?(this.#s=e.#s,this.#n=e.#n):Array.isArray(e)?(this.#s=()=>e.values(),this.#n=()=>e.length):e instanceof Map||e instanceof Set?(this.#s=()=>e.values(),this.#n=()=>e.size):(this.#s=e,this.#n=()=>{let e=0;for(const t of this)e++;return e})}get length(){return this.#n()}*[Symbol.iterator](){for(const e of this.#s())yield e}asIndexedPairs(){return new x(function*(){let e=0;for(const t of this)yield[e++,t]}.bind(this))}drop(e){if(isNaN(e)||e<0)throw new RangeError("limit must be 0, or a positive number");return new x(function*(){let t=0;for(const a of this)t++>=e&&(yield a)}.bind(this))}every(e){for(const t of this)if(!e(t))return!1;return!0}filter(e){return new x(function*(){for(const t of this)e(t)&&(yield t)}.bind(this))}find(e){for(const t of this)if(e(t))return t}findLast(e){let t;for(const a of this)e(a)&&(t=a);return t}flatMap(e){return new x(function*(){for(const t of this)for(const a of e(t))yield a}.bind(this))}forEach(e){for(const t of this)e(t)}includes(e){return this.some(t=>t===e)}map(e){return new x(function*(){for(const t of this)yield e(t)}.bind(this))}next(...e){this.#r??=this.#s();const t=this.#r.next(...e);return t.done&&(this.#r=void 0),t}reduce(e,t){if(0===this.length){if(void 0===t)throw new TypeError("Reduce of empty enumerable with no initial value.");return t}let a=t;for(const t of this)a=void 0===a?t:e(a,t);return a}return(e){return this.#r=void 0,{done:!0,value:e}}some(e){for(const t of this)if(e(t))return!0;return!1}take(e){if(isNaN(e)||e<0)throw new RangeError("limit must be 0, or a positive number");return new x(function*(){let t=0;for(const a of this)t++<e&&(yield a)}.bind(this))}throw(e){throw e}toArray(){return Array.from(this)}toJSON(){return this.toArray()}toString(){return`${this.toArray()}`}}Symbol.dispose??=Symbol("Symbol.dispose");class T{#o=void 0;#l;constructor(e){this.#l=e}get value(){return void 0===this.#o&&(this.#o=this.#l()),this.#o}}function A(){let e,t;return{promise:new Promise((a,i)=>{e=a,t=i}),resolve:e,reject:t}}function D(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var R,E,P,L,N,B,F,O={exports:{}};function M(){if(E)return R;E=1;const e=["nodebuffer","arraybuffer","fragments"],t="undefined"!=typeof Blob;return t&&e.push("blob"),R={BINARY_TYPES:e,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:t,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}}function U(){if(P)return O.exports;P=1;const{EMPTY_BUFFER:e}=M(),t=Buffer[Symbol.species];function a(e,t,a,i,s){for(let n=0;n<s;n++)a[i+n]=e[n]^t[3&n]}function i(e,t){for(let a=0;a<e.length;a++)e[a]^=t[3&a]}if(O.exports={concat:function(a,i){if(0===a.length)return e;if(1===a.length)return a[0];const s=Buffer.allocUnsafe(i);let n=0;for(let e=0;e<a.length;e++){const t=a[e];s.set(t,n),n+=t.length}return n<i?new t(s.buffer,s.byteOffset,n):s},mask:a,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(a){if(e.readOnly=!0,Buffer.isBuffer(a))return a;let i;return a instanceof ArrayBuffer?i=new t(a):ArrayBuffer.isView(a)?i=new t(a.buffer,a.byteOffset,a.byteLength):(i=Buffer.from(a),e.readOnly=!1),i},unmask:i},!process.env.WS_NO_BUFFER_UTIL)try{const e=require("bufferutil");O.exports.mask=function(t,i,s,n,r){r<48?a(t,i,s,n,r):e.mask(t,i,s,n,r)},O.exports.unmask=function(t,a){t.length<32?i(t,a):e.unmask(t,a)}}catch(e){}return O.exports}function G(){if(F)return B;F=1;const e=l,t=U(),a=function(){if(N)return L;N=1;const e=Symbol("kDone"),t=Symbol("kRun");return L=class{constructor(a){this[e]=()=>{this.pending--,this[t]()},this.concurrency=a||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[t]()}[t](){if(this.pending!==this.concurrency&&this.jobs.length){const t=this.jobs.shift();this.pending++,t(this[e])}}}}(),{kStatusCode:i}=M(),s=Buffer[Symbol.species],n=Buffer.from([0,0,255,255]),r=Symbol("permessage-deflate"),o=Symbol("total-length"),c=Symbol("callback"),d=Symbol("buffers"),h=Symbol("error");let u;function p(e){this[d].push(e),this[o]+=e.length}function m(e){this[o]+=e.length,this[r]._maxPayload<1||this[o]<=this[r]._maxPayload?this[d].push(e):(this[h]=new RangeError("Max payload size exceeded"),this[h].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[h][i]=1009,this.removeListener("data",m),this.reset())}function f(e){this[r]._inflate=null,this[h]?this[c](this[h]):(e[i]=1007,this[c](e))}return B=class{constructor(e,t,i){if(this._maxPayload=0|i,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!u){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;u=new a(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[c];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,a=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!a)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(a.server_no_context_takeover=!0),t.clientNoContextTakeover&&(a.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(a.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?a.client_max_window_bits=t.clientMaxWindowBits:!0!==a.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete a.client_max_window_bits,a}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let a=e[t];if(a.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(a=a[0],"client_max_window_bits"===t){if(!0!==a){const e=+a;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${a}`);a=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${a}`)}else if("server_max_window_bits"===t){const e=+a;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${a}`);a=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==a)throw new TypeError(`Invalid value for parameter "${t}": ${a}`)}e[t]=a})}),e}decompress(e,t,a){u.add(i=>{this._decompress(e,t,(e,t)=>{i(),a(e,t)})})}compress(e,t,a){u.add(i=>{this._compress(e,t,(e,t)=>{i(),a(e,t)})})}_decompress(a,i,s){const l=this._isServer?"client":"server";if(!this._inflate){const t=`${l}_max_window_bits`,a="number"!=typeof this.params[t]?e.Z_DEFAULT_WINDOWBITS:this.params[t];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:a}),this._inflate[r]=this,this._inflate[o]=0,this._inflate[d]=[],this._inflate.on("error",f),this._inflate.on("data",m)}this._inflate[c]=s,this._inflate.write(a),i&&this._inflate.write(n),this._inflate.flush(()=>{const e=this._inflate[h];if(e)return this._inflate.close(),this._inflate=null,void s(e);const a=t.concat(this._inflate[d],this._inflate[o]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[o]=0,this._inflate[d]=[],i&&this.params[`${l}_no_context_takeover`]&&this._inflate.reset()),s(null,a)})}_compress(a,i,n){const r=this._isServer?"server":"client";if(!this._deflate){const t=`${r}_max_window_bits`,a="number"!=typeof this.params[t]?e.Z_DEFAULT_WINDOWBITS:this.params[t];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:a}),this._deflate[o]=0,this._deflate[d]=[],this._deflate.on("data",p)}this._deflate[c]=n,this._deflate.write(a),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=t.concat(this._deflate[d],this._deflate[o]);i&&(e=new s(e.buffer,e.byteOffset,e.length-4)),this._deflate[c]=null,this._deflate[o]=0,this._deflate[d]=[],i&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),n(null,e)})}}}var j,W,K,V,q,z,H,J,Y,Q,X,Z,ee,te={exports:{}};function ae(){if(j)return te.exports;j=1;const{isUtf8:e}=c,{hasBlob:t}=M();function a(e){const t=e.length;let a=0;for(;a<t;)if(128&e[a])if(192==(224&e[a])){if(a+1===t||128!=(192&e[a+1])||192==(254&e[a]))return!1;a+=2}else if(224==(240&e[a])){if(a+2>=t||128!=(192&e[a+1])||128!=(192&e[a+2])||224===e[a]&&128==(224&e[a+1])||237===e[a]&&160==(224&e[a+1]))return!1;a+=3}else{if(240!=(248&e[a]))return!1;if(a+3>=t||128!=(192&e[a+1])||128!=(192&e[a+2])||128!=(192&e[a+3])||240===e[a]&&128==(240&e[a+1])||244===e[a]&&e[a+1]>143||e[a]>244)return!1;a+=4}else a++;return!0}if(te.exports={isBlob:function(e){return t&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:a,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},e)te.exports.isValidUTF8=function(t){return t.length<24?a(t):e(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const e=require("utf-8-validate");te.exports.isValidUTF8=function(t){return t.length<32?a(t):e(t)}}catch(e){}return te.exports}function ie(){if(K)return W;K=1;const{Writable:e}=r,t=G(),{BINARY_TYPES:a,EMPTY_BUFFER:i,kStatusCode:s,kWebSocket:n}=M(),{concat:o,toArrayBuffer:l,unmask:c}=U(),{isValidStatusCode:d,isValidUTF8:h}=ae(),u=Buffer[Symbol.species];return W=class extends e{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||a[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[n]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,a){if(8===this._opcode&&0==this._state)return a();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(a)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new u(t.buffer,t.byteOffset+e,t.length-e),new u(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const a=this._buffers[0],i=t.length-e;e>=a.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(a.buffer,a.byteOffset,e),i),this._buffers[0]=new u(a.buffer,a.byteOffset+e,a.length-e)),e-=a.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const a=this.consume(2);if(48&a[0]){return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"))}const i=!(64&~a[0]);if(i&&!this._extensions[t.extensionName]){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._fin=!(128&~a[0]),this._opcode=15&a[0],this._payloadLength=127&a[1],0===this._opcode){if(i){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(!this._fragmented){return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"))}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}this._compressed=i}else{if(!(this._opcode>7&&this._opcode<11)){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}if(!this._fin){return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"))}if(i){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~a[1]),this._isServer){if(!this._masked){return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}}else if(this._masked){return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"))}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),a=t.readUInt32BE(0);if(a>Math.pow(2,21)-1){return void e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"))}this._payloadLength=a*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){return void e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"))}this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=i;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!==(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&c(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,a){this._extensions[t.extensionName].decompress(e,this._fin,(e,t)=>{if(e)return a(e);if(t.length){if(this._messageLength+=t.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void a(e)}this._fragments.push(t)}this.dataMessage(a),0===this._state&&this.startLoop(a)})}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,a=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let i;i="nodebuffer"===this._binaryType?o(a,t):"arraybuffer"===this._binaryType?l(o(a,t)):"blob"===this._binaryType?new Blob(a):a,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!0),this._state=0,this.startLoop(e)}))}else{const i=o(a,t);if(!this._skipUTF8Validation&&!h(i)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,i),this.end();else{const a=e.readUInt16BE(0);if(!d(a)){const e=this.createError(RangeError,`invalid status code ${a}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const i=new u(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!h(i)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",a,i),this.end()}this._state=0}}createError(e,t,a,i,n){this._loop=!1,this._errored=!0;const r=new e(a?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(r,this.createError),r.code=n,r[s]=i,r}}}function se(){if(q)return V;q=1;const{Duplex:e}=r,{randomFillSync:t}=n,a=G(),{EMPTY_BUFFER:i,kWebSocket:s,NOOP:o}=M(),{isBlob:l,isValidStatusCode:c}=ae(),{mask:d,toBuffer:h}=U(),u=Symbol("kByteLength"),p=Buffer.alloc(4),m=8192;let f,g=m;class y{constructor(e,t,a){this._extensions=t||{},a&&(this._generateMask=a,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=o,this[s]=void 0}static frame(e,a){let i,s,n=!1,r=2,o=!1;a.mask&&(i=a.maskBuffer||p,a.generateMask?a.generateMask(i):(g===m&&(void 0===f&&(f=Buffer.alloc(m)),t(f,0,m),g=0),i[0]=f[g++],i[1]=f[g++],i[2]=f[g++],i[3]=f[g++]),o=0===(i[0]|i[1]|i[2]|i[3]),r=6),"string"==typeof e?s=a.mask&&!o||void 0===a[u]?(e=Buffer.from(e)).length:a[u]:(s=e.length,n=a.mask&&a.readOnly&&!o);let l=s;s>=65536?(r+=8,l=127):s>125&&(r+=2,l=126);const c=Buffer.allocUnsafe(n?s+r:r);return c[0]=a.fin?128|a.opcode:a.opcode,a.rsv1&&(c[0]|=64),c[1]=l,126===l?c.writeUInt16BE(s,2):127===l&&(c[2]=c[3]=0,c.writeUIntBE(s,4,6)),a.mask?(c[1]|=128,c[r-4]=i[0],c[r-3]=i[1],c[r-2]=i[2],c[r-1]=i[3],o?[c,e]:n?(d(e,i,c,r,s),[c]):(d(e,i,e,0,s),[c,e])):[c,e]}close(e,t,a,s){let n;if(void 0===e)n=i;else{if("number"!=typeof e||!c(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const a=Buffer.byteLength(t);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");n=Buffer.allocUnsafe(2+a),n.writeUInt16BE(e,0),"string"==typeof t?n.write(t,2):n.set(t,2)}else n=Buffer.allocUnsafe(2),n.writeUInt16BE(e,0)}const r={[u]:n.length,fin:!0,generateMask:this._generateMask,mask:a,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,n,!1,r,s]):this.sendFrame(y.frame(n,r),s)}ping(e,t,a){let i,s;if("string"==typeof e?(i=Buffer.byteLength(e),s=!1):l(e)?(i=e.size,s=!1):(i=(e=h(e)).length,s=h.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");const n={[u]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,n,a]):this.getBlobData(e,!1,n,a):0!==this._state?this.enqueue([this.dispatch,e,!1,n,a]):this.sendFrame(y.frame(e,n),a)}pong(e,t,a){let i,s;if("string"==typeof e?(i=Buffer.byteLength(e),s=!1):l(e)?(i=e.size,s=!1):(i=(e=h(e)).length,s=h.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");const n={[u]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,n,a]):this.getBlobData(e,!1,n,a):0!==this._state?this.enqueue([this.dispatch,e,!1,n,a]):this.sendFrame(y.frame(e,n),a)}send(e,t,i){const s=this._extensions[a.extensionName];let n,r,o=t.binary?2:1,c=t.compress;"string"==typeof e?(n=Buffer.byteLength(e),r=!1):l(e)?(n=e.size,r=!1):(n=(e=h(e)).length,r=h.readOnly),this._firstFragment?(this._firstFragment=!1,c&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=n>=s._threshold),this._compress=c):(c=!1,o=0),t.fin&&(this._firstFragment=!0);const d={[u]:n,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:r,rsv1:c};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,d,i]):this.getBlobData(e,this._compress,d,i):0!==this._state?this.enqueue([this.dispatch,e,this._compress,d,i]):this.dispatch(e,this._compress,d,i)}getBlobData(e,t,a,i){this._bufferedBytes+=a[u],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){const e=new Error("The socket was closed while the blob was being read");return void process.nextTick(w,this,e,i)}this._bufferedBytes-=a[u];const s=h(e);t?this.dispatch(s,t,a,i):(this._state=0,this.sendFrame(y.frame(s,a),i),this.dequeue())}).catch(e=>{process.nextTick(v,this,e,i)})}dispatch(e,t,i,s){if(!t)return void this.sendFrame(y.frame(e,i),s);const n=this._extensions[a.extensionName];this._bufferedBytes+=i[u],this._state=1,n.compress(e,i.fin,(e,t)=>{if(this._socket.destroyed){return void w(this,new Error("The socket was closed while data was being compressed"),s)}this._bufferedBytes-=i[u],this._state=0,i.readOnly=!1,this.sendFrame(y.frame(t,i),s),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][u],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][u],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function w(e,t,a){"function"==typeof a&&a(t);for(let a=0;a<e._queue.length;a++){const i=e._queue[a],s=i[i.length-1];"function"==typeof s&&s(t)}}function v(e,t,a){w(e,t,a),e.onerror(t)}return V=y}function ne(){if(Y)return J;Y=1;const{tokenChars:e}=ae();function t(e,t,a){void 0===e[t]?e[t]=[a]:e[t].push(a)}return J={format:function(e){return Object.keys(e).map(t=>{let a=e[t];return Array.isArray(a)||(a=[a]),a.map(e=>[t].concat(Object.keys(e).map(t=>{let a=e[t];return Array.isArray(a)||(a=[a]),a.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(a){const i=Object.create(null);let s,n,r=Object.create(null),o=!1,l=!1,c=!1,d=-1,h=-1,u=-1,p=0;for(;p<a.length;p++)if(h=a.charCodeAt(p),void 0===s)if(-1===u&&1===e[h])-1===d&&(d=p);else if(0===p||32!==h&&9!==h){if(59!==h&&44!==h)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p);const e=a.slice(d,u);44===h?(t(i,e,r),r=Object.create(null)):s=e,d=u=-1}}else-1===u&&-1!==d&&(u=p);else if(void 0===n)if(-1===u&&1===e[h])-1===d&&(d=p);else if(32===h||9===h)-1===u&&-1!==d&&(u=p);else if(59===h||44===h){if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p),t(r,a.slice(d,u),!0),44===h&&(t(i,s,r),r=Object.create(null),s=void 0),d=u=-1}else{if(61!==h||-1===d||-1!==u)throw new SyntaxError(`Unexpected character at index ${p}`);n=a.slice(d,p),d=u=-1}else if(l){if(1!==e[h])throw new SyntaxError(`Unexpected character at index ${p}`);-1===d?d=p:o||(o=!0),l=!1}else if(c)if(1===e[h])-1===d&&(d=p);else if(34===h&&-1!==d)c=!1,u=p;else{if(92!==h)throw new SyntaxError(`Unexpected character at index ${p}`);l=!0}else if(34===h&&61===a.charCodeAt(p-1))c=!0;else if(-1===u&&1===e[h])-1===d&&(d=p);else if(-1===d||32!==h&&9!==h){if(59!==h&&44!==h)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===d)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p);let e=a.slice(d,u);o&&(e=e.replace(/\\/g,""),o=!1),t(r,n,e),44===h&&(t(i,s,r),r=Object.create(null),s=void 0),n=void 0,d=u=-1}}else-1===u&&(u=p);if(-1===d||c||32===h||9===h)throw new SyntaxError("Unexpected end of input");-1===u&&(u=p);const m=a.slice(d,u);return void 0===s?t(i,m,r):(void 0===n?t(r,m,!0):t(r,n,o?m.replace(/\\/g,""):m),t(i,s,r)),i}}}function re(){if(X)return Q;X=1;const l=e,c=t,d=a,h=i,u=s,{randomBytes:p,createHash:m}=n,{Duplex:f,Readable:g}=r,{URL:y}=o,w=G(),v=ie(),b=se(),{isBlob:S}=ae(),{BINARY_TYPES:_,CLOSE_TIMEOUT:k,EMPTY_BUFFER:C,GUID:$,kForOnEventAttribute:I,kListener:x,kStatusCode:T,kWebSocket:A,NOOP:D}=M(),{EventTarget:{addEventListener:R,removeEventListener:E}}=function(){if(H)return z;H=1;const{kForOnEventAttribute:e,kListener:t}=M(),a=Symbol("kCode"),i=Symbol("kData"),s=Symbol("kError"),n=Symbol("kMessage"),r=Symbol("kReason"),o=Symbol("kTarget"),l=Symbol("kType"),c=Symbol("kWasClean");class d{constructor(e){this[o]=null,this[l]=e}get target(){return this[o]}get type(){return this[l]}}Object.defineProperty(d.prototype,"target",{enumerable:!0}),Object.defineProperty(d.prototype,"type",{enumerable:!0});class h extends d{constructor(e,t={}){super(e),this[a]=void 0===t.code?0:t.code,this[r]=void 0===t.reason?"":t.reason,this[c]=void 0!==t.wasClean&&t.wasClean}get code(){return this[a]}get reason(){return this[r]}get wasClean(){return this[c]}}Object.defineProperty(h.prototype,"code",{enumerable:!0}),Object.defineProperty(h.prototype,"reason",{enumerable:!0}),Object.defineProperty(h.prototype,"wasClean",{enumerable:!0});class u extends d{constructor(e,t={}){super(e),this[s]=void 0===t.error?null:t.error,this[n]=void 0===t.message?"":t.message}get error(){return this[s]}get message(){return this[n]}}Object.defineProperty(u.prototype,"error",{enumerable:!0}),Object.defineProperty(u.prototype,"message",{enumerable:!0});class p extends d{constructor(e,t={}){super(e),this[i]=void 0===t.data?null:t.data}get data(){return this[i]}}Object.defineProperty(p.prototype,"data",{enumerable:!0});const m={addEventListener(a,i,s={}){for(const n of this.listeners(a))if(!s[e]&&n[t]===i&&!n[e])return;let n;if("message"===a)n=function(e,t){const a=new p("message",{data:t?e:e.toString()});a[o]=this,f(i,this,a)};else if("close"===a)n=function(e,t){const a=new h("close",{code:e,reason:t.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[o]=this,f(i,this,a)};else if("error"===a)n=function(e){const t=new u("error",{error:e,message:e.message});t[o]=this,f(i,this,t)};else{if("open"!==a)return;n=function(){const e=new d("open");e[o]=this,f(i,this,e)}}n[e]=!!s[e],n[t]=i,s.once?this.once(a,n):this.on(a,n)},removeEventListener(a,i){for(const s of this.listeners(a))if(s[t]===i&&!s[e]){this.removeListener(a,s);break}}};function f(e,t,a){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,a):e.call(t,a)}return z={CloseEvent:h,ErrorEvent:u,Event:d,EventTarget:m,MessageEvent:p}}(),{format:P,parse:L}=ne(),{toBuffer:N}=U(),B=Symbol("kAborted"),F=[8,13],O=["CONNECTING","OPEN","CLOSING","CLOSED"],j=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class W extends l{constructor(e,t,a){super(),this._binaryType=_[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=C,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=W.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(a=t,t=[]):t=[t]),K(this,e,t,a)):(this._autoPong=a.autoPong,this._closeTimeout=a.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){_.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,a){const i=new v({allowSynchronousEvents:a.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:a.maxPayload,skipUTF8Validation:a.skipUTF8Validation}),s=new b(e,this._extensions,a.generateMask);this._receiver=i,this._sender=s,this._socket=e,i[A]=this,s[A]=this,e[A]=this,i.on("conclude",ee),i.on("drain",te),i.on("error",re),i.on("message",le),i.on("ping",ce),i.on("pong",de),s.onerror=ue,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",me),e.on("data",fe),e.on("end",ge),e.on("error",ye),this._readyState=W.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=W.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[w.extensionName]&&this._extensions[w.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=W.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==W.CLOSED){if(this.readyState===W.CONNECTING){const e="WebSocket was closed before the connection was established";return void Y(this,this._req,e)}this.readyState!==W.CLOSING?(this._readyState=W.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),pe(this)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==W.CONNECTING&&this.readyState!==W.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,a){if(this.readyState===W.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(a=e,e=t=void 0):"function"==typeof t&&(a=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===W.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||C,t,a)):Z(this,e,a)}pong(e,t,a){if(this.readyState===W.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(a=e,e=t=void 0):"function"==typeof t&&(a=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===W.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||C,t,a)):Z(this,e,a)}resume(){this.readyState!==W.CONNECTING&&this.readyState!==W.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,a){if(this.readyState===W.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(a=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==W.OPEN)return void Z(this,e,a);const i={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[w.extensionName]||(i.compress=!1),this._sender.send(e||C,i,a)}terminate(){if(this.readyState!==W.CLOSED){if(this.readyState===W.CONNECTING){const e="WebSocket was closed before the connection was established";return void Y(this,this._req,e)}this._socket&&(this._readyState=W.CLOSING,this._socket.destroy())}}}function K(e,t,a,i){const s={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:k,protocolVersion:F[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...i,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=s.autoPong,e._closeTimeout=s.closeTimeout,!F.includes(s.protocolVersion))throw new RangeError(`Unsupported protocol version: ${s.protocolVersion} (supported versions: ${F.join(", ")})`);let n;if(t instanceof y)n=t;else try{n=new y(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===n.protocol?n.protocol="ws:":"https:"===n.protocol&&(n.protocol="wss:"),e._url=n.href;const r="wss:"===n.protocol,o="ws+unix:"===n.protocol;let l;if("ws:"===n.protocol||r||o?o&&!n.pathname?l="The URL's pathname is empty":n.hash&&(l="The URL contains a fragment identifier"):l='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',l){const t=new SyntaxError(l);if(0===e._redirects)throw t;return void V(e,t)}const h=r?443:80,u=p(16).toString("base64"),f=r?c.request:d.request,g=new Set;let v,b;if(s.createConnection=s.createConnection||(r?J:q),s.defaultPort=s.defaultPort||h,s.port=n.port||h,s.host=n.hostname.startsWith("[")?n.hostname.slice(1,-1):n.hostname,s.headers={...s.headers,"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},s.path=n.pathname+n.search,s.timeout=s.handshakeTimeout,s.perMessageDeflate&&(v=new w(!0!==s.perMessageDeflate?s.perMessageDeflate:{},!1,s.maxPayload),s.headers["Sec-WebSocket-Extensions"]=P({[w.extensionName]:v.offer()})),a.length){for(const e of a){if("string"!=typeof e||!j.test(e)||g.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(e)}s.headers["Sec-WebSocket-Protocol"]=a.join(",")}if(s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin),(n.username||n.password)&&(s.auth=`${n.username}:${n.password}`),o){const e=s.path.split(":");s.socketPath=e[0],s.path=e[1]}if(s.followRedirects){if(0===e._redirects){e._originalIpc=o,e._originalSecure=r,e._originalHostOrSocketPath=o?s.socketPath:n.host;const t=i&&i.headers;if(i={...i,headers:{}},t)for(const[e,a]of Object.entries(t))i.headers[e.toLowerCase()]=a}else if(0===e.listenerCount("redirect")){const t=o?!!e._originalIpc&&s.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&n.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!r)&&(delete s.headers.authorization,delete s.headers.cookie,t||delete s.headers.host,s.auth=void 0)}s.auth&&!i.headers.authorization&&(i.headers.authorization="Basic "+Buffer.from(s.auth).toString("base64")),b=e._req=f(s),e._redirects&&e.emit("redirect",e.url,b)}else b=e._req=f(s);s.timeout&&b.on("timeout",()=>{Y(e,b,"Opening handshake has timed out")}),b.on("error",t=>{null===b||b[B]||(b=e._req=null,V(e,t))}),b.on("response",n=>{const r=n.headers.location,o=n.statusCode;if(r&&s.followRedirects&&o>=300&&o<400){if(++e._redirects>s.maxRedirects)return void Y(e,b,"Maximum redirects exceeded");let n;b.abort();try{n=new y(r,t)}catch(t){const a=new SyntaxError(`Invalid URL: ${r}`);return void V(e,a)}K(e,n,a,i)}else e.emit("unexpected-response",b,n)||Y(e,b,`Unexpected server response: ${n.statusCode}`)}),b.on("upgrade",(t,a,i)=>{if(e.emit("upgrade",t),e.readyState!==W.CONNECTING)return;b=e._req=null;const n=t.headers.upgrade;if(void 0===n||"websocket"!==n.toLowerCase())return void Y(e,a,"Invalid Upgrade header");const r=m("sha1").update(u+$).digest("base64");if(t.headers["sec-websocket-accept"]!==r)return void Y(e,a,"Invalid Sec-WebSocket-Accept header");const o=t.headers["sec-websocket-protocol"];let l;if(void 0!==o?g.size?g.has(o)||(l="Server sent an invalid subprotocol"):l="Server sent a subprotocol but none was requested":g.size&&(l="Server sent no subprotocol"),l)return void Y(e,a,l);o&&(e._protocol=o);const c=t.headers["sec-websocket-extensions"];if(void 0!==c){if(!v){return void Y(e,a,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=L(c)}catch(t){return void Y(e,a,"Invalid Sec-WebSocket-Extensions header")}const i=Object.keys(t);if(1!==i.length||i[0]!==w.extensionName){return void Y(e,a,"Server indicated an extension that was not requested")}try{v.accept(t[w.extensionName])}catch(t){return void Y(e,a,"Invalid Sec-WebSocket-Extensions header")}e._extensions[w.extensionName]=v}e.setSocket(a,i,{allowSynchronousEvents:s.allowSynchronousEvents,generateMask:s.generateMask,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation})}),s.finishRequest?s.finishRequest(b,e):b.end()}function V(e,t){e._readyState=W.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function q(e){return e.path=e.socketPath,h.connect(e)}function J(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=h.isIP(e.host)?"":e.host),u.connect(e)}function Y(e,t,a){e._readyState=W.CLOSING;const i=new Error(a);Error.captureStackTrace(i,Y),t.setHeader?(t[B]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(V,e,i)):(t.destroy(i),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function Z(e,t,a){if(t){const a=S(t)?t.size:N(t).length;e._socket?e._sender._bufferedBytes+=a:e._bufferedAmount+=a}if(a){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${O[e.readyState]})`);process.nextTick(a,t)}}function ee(e,t){const a=this[A];a._closeFrameReceived=!0,a._closeMessage=t,a._closeCode=e,void 0!==a._socket[A]&&(a._socket.removeListener("data",fe),process.nextTick(he,a._socket),1005===e?a.close():a.close(e,t))}function te(){const e=this[A];e.isPaused||e._socket.resume()}function re(e){const t=this[A];void 0!==t._socket[A]&&(t._socket.removeListener("data",fe),process.nextTick(he,t._socket),t.close(e[T])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function oe(){this[A].emitClose()}function le(e,t){this[A].emit("message",e,t)}function ce(e){const t=this[A];t._autoPong&&t.pong(e,!this._isServer,D),t.emit("ping",e)}function de(e){this[A].emit("pong",e)}function he(e){e.resume()}function ue(e){const t=this[A];t.readyState!==W.CLOSED&&(t.readyState===W.OPEN&&(t._readyState=W.CLOSING,pe(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function pe(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),e._closeTimeout)}function me(){const e=this[A];if(this.removeListener("close",me),this.removeListener("data",fe),this.removeListener("end",ge),e._readyState=W.CLOSING,!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&0!==this._readableState.length){const t=this.read(this._readableState.length);e._receiver.write(t)}e._receiver.end(),this[A]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",oe),e._receiver.on("finish",oe))}function fe(e){this[A]._receiver.write(e)||this.pause()}function ge(){const e=this[A];e._readyState=W.CLOSING,e._receiver.end(),this.end()}function ye(){const e=this[A];this.removeListener("error",ye),this.on("error",D),e&&(e._readyState=W.CLOSING,this.destroy())}return Object.defineProperty(W,"CONNECTING",{enumerable:!0,value:O.indexOf("CONNECTING")}),Object.defineProperty(W.prototype,"CONNECTING",{enumerable:!0,value:O.indexOf("CONNECTING")}),Object.defineProperty(W,"OPEN",{enumerable:!0,value:O.indexOf("OPEN")}),Object.defineProperty(W.prototype,"OPEN",{enumerable:!0,value:O.indexOf("OPEN")}),Object.defineProperty(W,"CLOSING",{enumerable:!0,value:O.indexOf("CLOSING")}),Object.defineProperty(W.prototype,"CLOSING",{enumerable:!0,value:O.indexOf("CLOSING")}),Object.defineProperty(W,"CLOSED",{enumerable:!0,value:O.indexOf("CLOSED")}),Object.defineProperty(W.prototype,"CLOSED",{enumerable:!0,value:O.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(W.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(W.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[I])return t[x];return null},set(t){for(const t of this.listeners(e))if(t[I]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[I]:!0})}})}),W.prototype.addEventListener=R,W.prototype.removeEventListener=E,Q=W}!function(){if(ee)return Z;ee=1,re();const{Duplex:e}=r;function t(e){e.emit("close")}function a(){!this.destroyed&&this._writableState.finished&&this.destroy()}function i(e){this.removeListener("error",i),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}Z=function(s,n){let r=!0;const o=new e({...n,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(e,t){const a=!t&&o._readableState.objectMode?e.toString():e;o.push(a)||s.pause()}),s.once("error",function(e){o.destroyed||(r=!1,o.destroy(e))}),s.once("close",function(){o.destroyed||o.push(null)}),o._destroy=function(e,a){if(s.readyState===s.CLOSED)return a(e),void process.nextTick(t,o);let i=!1;s.once("error",function(e){i=!0,a(e)}),s.once("close",function(){i||a(e),process.nextTick(t,o)}),r&&s.terminate()},o._final=function(e){s.readyState!==s.CONNECTING?null!==s._socket&&(s._socket._writableState.finished?(e(),o._readableState.endEmitted&&o.destroy()):(s._socket.once("finish",function(){e()}),s.close())):s.once("open",function(){o._final(e)})},o._read=function(){s.isPaused&&s.resume()},o._write=function(e,t,a){s.readyState!==s.CONNECTING?s.send(e,a):s.once("open",function(){o._write(e,t,a)})},o.on("end",a),o.on("error",i),o}}(),ie(),se();var oe,le,ce,de,he,ue,pe,me,fe=D(re());function ge(){if(le)return oe;le=1;const{tokenChars:e}=ae();return oe={parse:function(t){const a=new Set;let i=-1,s=-1,n=0;for(;n<t.length;n++){const r=t.charCodeAt(n);if(-1===s&&1===e[r])-1===i&&(i=n);else if(0===n||32!==r&&9!==r){if(44!==r)throw new SyntaxError(`Unexpected character at index ${n}`);{if(-1===i)throw new SyntaxError(`Unexpected character at index ${n}`);-1===s&&(s=n);const e=t.slice(i,s);if(a.has(e))throw new SyntaxError(`The "${e}" subprotocol is duplicated`);a.add(e),i=s=-1}}else-1===s&&-1!==i&&(s=n)}if(-1===i||-1!==s)throw new SyntaxError("Unexpected end of input");const r=t.slice(i,n);if(a.has(r))throw new SyntaxError(`The "${r}" subprotocol is duplicated`);return a.add(r),a}}}!function(){if(de)return ce;de=1;const t=e,i=a,{Duplex:s}=r,{createHash:o}=n,l=ne(),c=G(),d=ge(),h=re(),{CLOSE_TIMEOUT:u,GUID:p,kWebSocket:m}=M(),f=/^[+/0-9A-Za-z]{22}==$/;function g(e){e._state=2,e.emit("close")}function y(){this.destroy()}function w(e,t,a,s){a=a||i.STATUS_CODES[t],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(a),...s},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r\n`+Object.keys(s).map(e=>`${e}: ${s[e]}`).join("\r\n")+"\r\n\r\n"+a)}function v(e,t,a,i,s,n){if(e.listenerCount("wsClientError")){const i=new Error(s);Error.captureStackTrace(i,v),e.emit("wsClientError",i,a,t)}else w(a,i,s,n)}ce=class extends t{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:u,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:h,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{const a=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":a.length,"Content-Type":"text/plain"}),t.end(a)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const a of Object.keys(t))e.on(a,t[a]);return function(){for(const a of Object.keys(t))e.removeListener(a,t[a])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,a,i)=>{this.handleUpgrade(t,a,i,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",()=>{e(new Error("The server is not running"))}),void process.nextTick(g,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(g,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{g(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,a,i){t.on("error",y);const s=e.headers["sec-websocket-key"],n=e.headers.upgrade,r=+e.headers["sec-websocket-version"];if("GET"!==e.method){return void v(this,e,t,405,"Invalid HTTP method")}if(void 0===n||"websocket"!==n.toLowerCase()){return void v(this,e,t,400,"Invalid Upgrade header")}if(void 0===s||!f.test(s)){return void v(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header")}if(13!==r&&8!==r){return void v(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"})}if(!this.shouldHandle(e))return void w(t,400);const o=e.headers["sec-websocket-protocol"];let h=new Set;if(void 0!==o)try{h=d.parse(o)}catch(a){return void v(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const u=e.headers["sec-websocket-extensions"],p={};if(this.options.perMessageDeflate&&void 0!==u){const a=new c(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=l.parse(u);e[c.extensionName]&&(a.accept(e[c.extensionName]),p[c.extensionName]=a)}catch(a){return void v(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const n={origin:e.headers[""+(8===r?"sec-websocket-origin":"origin")],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(n,(n,r,o,l)=>{if(!n)return w(t,r||401,o,l);this.completeUpgrade(p,s,h,e,t,a,i)});if(!this.options.verifyClient(n))return w(t,401)}this.completeUpgrade(p,s,h,e,t,a,i)}completeUpgrade(e,t,a,i,s,n,r){if(!s.readable||!s.writable)return s.destroy();if(s[m])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return w(s,503);const d=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${o("sha1").update(t+p).digest("base64")}`],h=new this.options.WebSocket(null,void 0,this.options);if(a.size){const e=this.options.handleProtocols?this.options.handleProtocols(a,i):a.values().next().value;e&&(d.push(`Sec-WebSocket-Protocol: ${e}`),h._protocol=e)}if(e[c.extensionName]){const t=e[c.extensionName].params,a=l.format({[c.extensionName]:[t]});d.push(`Sec-WebSocket-Extensions: ${a}`),h._extensions=e}this.emit("headers",d,i),s.write(d.concat("\r\n").join("\r\n")),s.removeListener("error",y),h.setSocket(s,n,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(g,this)})),r(h,i)}}}(),function(e){e[e.StreamDeck=0]="StreamDeck",e[e.StreamDeckMini=1]="StreamDeckMini",e[e.StreamDeckXL=2]="StreamDeckXL",e[e.StreamDeckMobile=3]="StreamDeckMobile",e[e.CorsairGKeys=4]="CorsairGKeys",e[e.StreamDeckPedal=5]="StreamDeckPedal",e[e.CorsairVoyager=6]="CorsairVoyager",e[e.StreamDeckPlus=7]="StreamDeckPlus",e[e.SCUFController=8]="SCUFController",e[e.StreamDeckNeo=9]="StreamDeckNeo",e[e.StreamDeckStudio=10]="StreamDeckStudio",e[e.VirtualStreamDeck=11]="VirtualStreamDeck"}(he||(he={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.DoubleRectangle=1]="DoubleRectangle",e[e.Trapezoid=2]="Trapezoid",e[e.DoubleTrapezoid=3]="DoubleTrapezoid",e[e.Groove=4]="Groove"}(ue||(ue={})),function(e){e.Port="-port",e.Info="-info",e.PluginUUID="-pluginUUID",e.RegisterEvent="-registerEvent"}(pe||(pe={})),function(e){e[e.HardwareAndSoftware=0]="HardwareAndSoftware",e[e.Hardware=1]="Hardware",e[e.Software=2]="Software"}(me||(me={}));class ye{build;major;minor;patch;constructor(e){const t=e.match(/^(0|[1-9]\d*)(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?$/);if(null===t)throw new Error(`Invalid format; expected "{major}[.{minor}[.{patch}[.{build}]]]" but was "${e}"`);[,this.major,this.minor,this.patch,this.build]=[...t.map(e=>parseInt(e)||0)]}compareTo(e){const t=({major:e,minor:t,build:a,patch:i})=>[e,t,a,i],a=t(this),i=t(e);for(let e=0;e<4;e++){if(a[e]<i[e])return-1;if(a[e]>i[e])return 1}return 0}toString(){return`${this.major}.${this.minor}`}}class we{write(e){switch(e.level){case"error":console.error(...e.data);break;case"warn":console.warn(...e.data);break;default:console.log(...e.data)}}}const ve="\n";function be(e){switch(e){case"error":return 0;case"warn":return 1;case"info":return 2;case"debug":return 3;default:return 4}}class Se{#c;#d;#h;constructor(e){this.#d={minimumLevel:"trace",...e},this.#h=void 0===this.#d.scope||""===this.#d.scope.trim()?"":this.#d.scope,"function"!=typeof this.#d.level&&this.setLevel(this.#d.level)}get level(){return void 0!==this.#c?this.#c:"function"==typeof this.#d.level?this.#d.level():this.#d.level}createScope(e){return""===(e=e.trim())?this:new Se({...this.#d,level:()=>this.level,scope:this.#d.scope?`${this.#d.scope}->${e}`:e})}debug(...e){return this.write({level:"debug",data:e,scope:this.#h})}error(...e){return this.write({level:"error",data:e,scope:this.#h})}info(...e){return this.write({level:"info",data:e,scope:this.#h})}setLevel(e){return void 0!==e&&be(e)>be(this.#d.minimumLevel)?this.#c="info":this.#c=e,this}trace(...e){return this.write({level:"trace",data:e,scope:this.#h})}warn(...e){return this.write({level:"warn",data:e,scope:this.#h})}write(e){return be(e.level)<=be(this.level)&&this.#d.targets.forEach(t=>t.write(e)),this}}let _e;function ke(){return void 0===_e&&(_e=process.execArgv.some(e=>{const t=e.split("=")[0];return"--inspect"===t||"--inspect-brk"===t||"--inspect-port"===t})),_e}const Ce=[new class{#u;#d;#p=0;constructor(e){this.#d=e,this.#u=this.getLogFilePath(),this.reIndex()}write(e){const t=d.openSync(this.#u,"a");try{const a=this.#d.format(e);d.writeSync(t,a+"\n"),this.#p+=a.length}finally{d.closeSync(t)}this.#p>=this.#d.maxSize&&(this.reIndex(),this.#p=0)}getLogFilePath(e=0){return p.join(this.#d.dest,`${this.#d.fileName}.${e}.log`)}getLogFiles(){const e=/^\.(\d+)\.log$/;return d.readdirSync(this.#d.dest,{withFileTypes:!0}).reduce((t,a)=>{if(a.isDirectory()||a.name.indexOf(this.#d.fileName)<0)return t;const i=a.name.substring(this.#d.fileName.length).match(e);return 2!==i?.length||t.push({path:p.join(this.#d.dest,a.name),index:parseInt(i[1])}),t},[]).sort(({index:e},{index:t})=>e<t?-1:e>t?1:0)}reIndex(){if(!d.existsSync(this.#d.dest))return void d.mkdirSync(this.#d.dest);const e=this.getLogFiles();for(let t=e.length-1;t>=0;t--){const a=e[t];t>=this.#d.maxFileCount-1?d.rmSync(a.path):d.renameSync(a.path,this.getLogFilePath(t+1))}}}({dest:p.join(g(),"logs"),fileName:function(){const e=p.basename(process.cwd()),t=e.lastIndexOf(".sdPlugin");return t<0?e:e.substring(0,t)}(),format:e=>{const{data:t,level:a,scope:i}=e;let s=`${(new Date).toISOString()} ${a.toUpperCase().padEnd(5)} `;return i&&(s+=`${i}: `),`${s}${function(e){let t="",a=!1;for(const i of e)"object"==typeof i&&i instanceof Error?(t+=`${ve}${i.stack}`,a=!0):(a&&(t+=ve,a=!1),t+="object"==typeof i?JSON.stringify(i):i,t+=" ");return t.trimEnd()}(t)}`},maxFileCount:10,maxSize:52428800})];ke()&&Ce.splice(0,0,new we);const $e=new Se({level:ke()?"debug":"info",minimumLevel:ke()?"trace":"debug",targets:Ce});process.once("uncaughtException",e=>$e.error("Process encountered uncaught exception",e));const Ie=new class extends k{_registrationParameters;_version;canConnect=!0;connection=A();logger=$e.createScope("Connection");get registrationParameters(){return this._registrationParameters??=this.getRegistrationParameters()}get version(){return this._version??=new ye(this.registrationParameters.info.application.version)}async connect(){if(this.canConnect){this.canConnect=!1;const e=new fe(`ws://127.0.0.1:${this.registrationParameters.port}`);e.onmessage=e=>this.tryEmit(e),e.onopen=()=>{e.send(JSON.stringify({event:this.registrationParameters.registerEvent,uuid:this.registrationParameters.pluginUUID})),this.connection.resolve(e),this.emit("connected",this.registrationParameters.info)}}await this.connection.promise}async send(e){const t=await this.connection.promise,a=JSON.stringify(e);this.logger.trace(a),t.send(a)}getRegistrationParameters(){const e={port:void 0,info:void 0,pluginUUID:void 0,registerEvent:void 0},t=$e.createScope("RegistrationParameters");for(let a=0;a<process.argv.length-1;a++){const i=process.argv[a],s=process.argv[++a];switch(i){case pe.Port:t.debug(`port=${s}`),e.port=s;break;case pe.PluginUUID:t.debug(`pluginUUID=${s}`),e.pluginUUID=s;break;case pe.RegisterEvent:t.debug(`registerEvent=${s}`),e.registerEvent=s;break;case pe.Info:t.debug(`info=${s}`),e.info=JSON.parse(s);break;default:a--}}const a=[],i=(e,t)=>{void 0===t&&a.push(e)};if(i(pe.Port,e.port),i(pe.PluginUUID,e.pluginUUID),i(pe.RegisterEvent,e.registerEvent),i(pe.Info,e.info),a.length>0)throw new Error(`Unable to establish a connection with Stream Deck, missing command line arguments: ${a.join(", ")}`);return e}tryEmit(e){try{const t=JSON.parse(e.data.toString());t.event?(this.logger.trace(e.data.toString()),this.emit(t.event,t)):this.logger.warn(`Received unknown message: ${e.data}`)}catch(t){this.logger.error(`Failed to parse message: ${e.data}`,t)}}};class xe{type;constructor(e){this.type=e.event}}class Te extends xe{action;constructor(e,t){super(t),this.action=e}}class Ae extends Te{payload;constructor(e,t){super(e,t),this.payload=t.payload}}const De=new T(()=>{const e=m(process.cwd(),"manifest.json");if(!h(e))throw new Error("Failed to read manifest.json as the file does not exist.");try{return JSON.parse(u(e,{encoding:"utf-8",flag:"r"}).toString())}catch(e){if(e instanceof SyntaxError)return null;throw e}}),Re=new T(()=>null===De.value?null:new ye(De.value.Software.MinimumVersion));function Ee(){return Re.value}const Pe=new Map;class Le extends x{constructor(){super(Pe)}getActionById(e){return Pe.get(e)}}const Ne=new class extends Le{delete(e){Pe.delete(e)}set(e){Pe.set(e.id,e)}};class Be extends xe{application;constructor(e){super(e),this.application=e.payload.application}}class Fe extends xe{device;constructor(e,t){super(e),this.device=t}}class Oe extends xe{url;constructor(e){super(e),this.url=new Ue(e.payload.url)}}const Me="streamdeck://";class Ue{fragment;href;path;query;queryParameters;constructor(e){const t=new URL(`${Me}${e}`);this.fragment=t.hash.substring(1),this.href=t.href.substring(13),this.path=Ue.parsePath(this.href),this.query=t.search.substring(1),this.queryParameters=t.searchParams}static parsePath(e){const t=t=>{const a=e.indexOf(t);return a>=0?a:e.length};return e.substring(0,Math.min(t("?"),t("#")))}}class Ge extends xe{settings;constructor(e){super(e),this.settings=e.payload.settings}}class je extends xe{action;payload;constructor(e,t){super(t),this.action=e,this.payload=t.payload}}function We(e,t){const a=De.value?.SDKVersion??null;if(null!==a&&e>a)throw new Error(`[ERR_NOT_SUPPORTED]: ${t} requires manifest SDK version ${e} or higher, but found version ${a}; please update the "SDKVersion" in the plugin's manifest to ${e} or higher.`)}function Ke(e,t,a){const i={major:Math.floor(e),minor:Number(e.toString().split(".").at(1)??0),patch:0,build:0};if(-1===t.compareTo(i))throw new Error(`[ERR_NOT_SUPPORTED]: ${a} requires Stream Deck version ${i.major}.${i.minor} or higher, but current version is ${t.major}.${t.minor}; please update Stream Deck and the "Software.MinimumVersion" in the plugin's manifest to "${i.major}.${i.minor}" or higher.`);const s=Ee();if(null!==s&&-1===s.compareTo(i))throw new Error(`[ERR_NOT_SUPPORTED]: ${a} requires Stream Deck version ${i.major}.${i.minor} or higher; please update the "Software.MinimumVersion" in the plugin's manifest to "${i.major}.${i.minor}" or higher.`)}let Ve=!1;const qe={get useExperimentalMessageIdentifiers(){return Ve},set useExperimentalMessageIdentifiers(e){Ke(7.1,Ie.version,"Message identifiers"),Ve=e},getGlobalSettings:()=>new Promise(e=>{Ie.once("didReceiveGlobalSettings",t=>e(t.payload.settings)),Ie.send({event:"getGlobalSettings",context:Ie.registrationParameters.pluginUUID,id:y()})}),onDidReceiveGlobalSettings:e=>Ie.disposableOn("didReceiveGlobalSettings",t=>{qe.useExperimentalMessageIdentifiers&&t.id||e(new Ge(t))}),onDidReceiveSettings:e=>Ie.disposableOn("didReceiveSettings",t=>{if(qe.useExperimentalMessageIdentifiers&&t.id)return;const a=Ne.getActionById(t.context);a&&e(new Ae(a,t))}),setGlobalSettings:async e=>{await Ie.send({event:"setGlobalSettings",context:Ie.registrationParameters.pluginUUID,payload:e})}};const ze=new class{#m;#f=0;constructor(){this.onDidAppear(e=>{this.#g(e.action)?this.#f++:(this.#f=1,this.#m=e.action)}),this.onDidDisappear(e=>{this.#g(e.action)&&(this.#f--,this.#f<=0&&(this.#m=void 0))})}get action(){return this.#m}onDidAppear(e){return Ie.disposableOn("propertyInspectorDidAppear",t=>{const a=Ne.getActionById(t.context);a&&e(new Te(a,t))})}onDidDisappear(e){return Ie.disposableOn("propertyInspectorDidDisappear",t=>{const a=Ne.getActionById(t.context);a&&e(new Te(a,t))})}onSendToPlugin(e){return Ie.disposableOn("sendToPlugin",t=>{const a=Ne.getActionById(t.context);a&&e(new je(a,t))})}async sendToPropertyInspector(e){this.#m&&await Ie.send({event:"sendToPropertyInspector",context:this.#m.id,payload:e})}#g(e){return this.#m?.id===e.id&&this.#m?.manifestId===e.manifestId&&this.#m?.device?.id===e.device.id}},He=new Map;class Je extends x{constructor(){super(He)}getDeviceById(e){return He.get(e)}}const Ye=new class extends Je{set(e){He.set(e.id,e)}};class Qe{#y;#w;constructor(e){this.#w=e;const t=Ye.getDeviceById(e.device);if(!t)throw new Error(`Failed to initialize action; device ${e.device} not found`);this.#y=t}get controllerType(){return this.#w.payload.controller}get device(){return this.#y}get id(){return this.#w.context}get manifestId(){return this.#w.action}toJSON(){return{controllerType:this.controllerType,device:this.device,id:this.id,manifestId:this.manifestId}}}class Xe extends Qe{async getResources(){Ke(7.1,Ie.version,"getResources");return(await this.#v("getResources","didReceiveResources")).payload.resources}async getSettings(){return(await this.#v("getSettings","didReceiveSettings")).payload.settings}isDial(){return"Encoder"===this.controllerType}isKey(){return"Keypad"===this.controllerType}setResources(e){return Ke(7.1,Ie.version,"setResources"),Ie.send({event:"setResources",context:this.id,payload:e})}setSettings(e){return Ie.send({event:"setSettings",context:this.id,payload:e})}showAlert(){return Ie.send({event:"showAlert",context:this.id})}async#v(e,t){const{resolve:a,reject:i,promise:s}=A(),n=setTimeout(()=>{r.dispose(),i("The request timed out")},15e3),r=Ie.disposableOn(t,e=>{e.context==this.id&&(clearTimeout(n),r.dispose(),a(e))});return await Ie.send({event:e,context:this.id,id:y()}),s}}class Ze extends Xe{#b;constructor(e){if(super(e),"Encoder"!==e.payload.controller)throw new Error("Unable to create DialAction; source event is not a Encoder");this.#b=Object.freeze(e.payload.coordinates)}get coordinates(){return this.#b}setFeedback(e){return Ie.send({event:"setFeedback",context:this.id,payload:e})}setFeedbackLayout(e){return Ie.send({event:"setFeedbackLayout",context:this.id,payload:{layout:e}})}setImage(e){return Ie.send({event:"setImage",context:this.id,payload:{image:e}})}setTitle(e){return this.setFeedback({title:e})}setTriggerDescription(e){return Ie.send({event:"setTriggerDescription",context:this.id,payload:e||{}})}toJSON(){return{...super.toJSON(),coordinates:this.coordinates}}}class et extends Xe{#b;#w;constructor(e){if(super(e),"Keypad"!==e.payload.controller)throw new Error("Unable to create KeyAction; source event is not a Keypad");this.#b=e.payload.isInMultiAction?void 0:Object.freeze(e.payload.coordinates),this.#w=e}get coordinates(){return this.#b}isInMultiAction(){return this.#w.payload.isInMultiAction}setImage(e,t){return Ie.send({event:"setImage",context:this.id,payload:{image:e,...t}})}setState(e){return Ie.send({event:"setState",context:this.id,payload:{state:e}})}setTitle(e,t){return Ie.send({event:"setTitle",context:this.id,payload:{title:e,...t}})}showOk(){return Ie.send({event:"showOk",context:this.id})}toJSON(){return{...super.toJSON(),coordinates:this.coordinates,isInMultiAction:this.isInMultiAction()}}}const tt=new T(()=>De.value);const at=new class extends Le{constructor(){super(),Ie.prependListener("willAppear",e=>{const t="Encoder"===e.payload.controller?new Ze(e):new et(e);Ne.set(t)}),Ie.prependListener("willDisappear",e=>Ne.delete(e.context))}onDialDown(e){return Ie.disposableOn("dialDown",t=>{const a=Ne.getActionById(t.context);a?.isDial()&&e(new Ae(a,t))})}onDialRotate(e){return Ie.disposableOn("dialRotate",t=>{const a=Ne.getActionById(t.context);a?.isDial()&&e(new Ae(a,t))})}onDialUp(e){return Ie.disposableOn("dialUp",t=>{const a=Ne.getActionById(t.context);a?.isDial()&&e(new Ae(a,t))})}onDidReceiveResources(e){return Ie.disposableOn("didReceiveResources",t=>{if(void 0!==t.id)return;const a=Ne.getActionById(t.context);a&&e(new Ae(a,t))})}onKeyDown(e){return Ie.disposableOn("keyDown",t=>{const a=Ne.getActionById(t.context);a?.isKey()&&e(new Ae(a,t))})}onKeyUp(e){return Ie.disposableOn("keyUp",t=>{const a=Ne.getActionById(t.context);a?.isKey()&&e(new Ae(a,t))})}onTitleParametersDidChange(e){return Ie.disposableOn("titleParametersDidChange",t=>{const a=Ne.getActionById(t.context);a&&e(new Ae(a,t))})}onTouchTap(e){return Ie.disposableOn("touchTap",t=>{const a=Ne.getActionById(t.context);a?.isDial()&&e(new Ae(a,t))})}onWillAppear(e){return Ie.disposableOn("willAppear",t=>{const a=Ne.getActionById(t.context);a&&e(new Ae(a,t))})}onWillDisappear(e){return Ie.disposableOn("willDisappear",t=>e(new Ae(new Qe(t),t)))}registerAction(e){if(void 0===e.manifestId)throw new Error("The action's manifestId cannot be undefined.");if(null!==tt.value&&!tt.value.Actions.some(t=>t.UUID===e.manifestId))throw new Error(`The action's manifestId was not found within the manifest: ${e.manifestId}`);const{manifestId:t}=e,a=(a,i)=>{const s=i?.bind(e);void 0!==s&&a.bind(e)(async e=>{e.action.manifestId==t&&await s(e)})};a(this.onDialDown,e.onDialDown),a(this.onDialUp,e.onDialUp),a(this.onDialRotate,e.onDialRotate),a(ze.onSendToPlugin,e.onSendToPlugin),a(this.onDidReceiveResources,e.onDidReceiveResources),a(qe.onDidReceiveSettings,e.onDidReceiveSettings),a(this.onKeyDown,e.onKeyDown),a(this.onKeyUp,e.onKeyUp),a(ze.onDidAppear,e.onPropertyInspectorDidAppear),a(ze.onDidDisappear,e.onPropertyInspectorDidDisappear),a(this.onTitleParametersDidChange,e.onTitleParametersDidChange),a(this.onTouchTap,e.onTouchTap),a(this.onWillAppear,e.onWillAppear),a(this.onWillDisappear,e.onWillDisappear)}};class it{#S=!1;#_;id;constructor(e,t,a){this.id=e,this.#_=t,this.#S=a,Ie.prependListener("deviceDidConnect",e=>{e.device===this.id&&(this.#_=e.deviceInfo,this.#S=!0)}),Ie.prependListener("deviceDidChange",e=>{e.device===this.id&&(this.#_=e.deviceInfo)}),Ie.prependListener("deviceDidDisconnect",e=>{e.device===this.id&&(this.#S=!1)})}get actions(){return Ne.filter(e=>e.device.id===this.id)}get isConnected(){return this.#S}get name(){return this.#_.name}get size(){return this.#_.size}get type(){return this.#_.type}}const st=new class extends Je{constructor(){super(),Ie.once("connected",e=>{e.devices.forEach(e=>Ye.set(new it(e.id,e,!1)))}),Ie.on("deviceDidConnect",({device:e,deviceInfo:t})=>{Ye.getDeviceById(e)||Ye.set(new it(e,t,!0))}),Ie.on("deviceDidChange",({device:e,deviceInfo:t})=>{Ye.getDeviceById(e)||Ye.set(new it(e,t,!1))})}onDeviceDidChange(e){return Ke(7,Ie.version,"onDeviceDidChange"),Ie.disposableOn("deviceDidChange",t=>e(new Fe(t,this.getDeviceById(t.device))))}onDeviceDidConnect(e){return Ie.disposableOn("deviceDidConnect",t=>e(new Fe(t,this.getDeviceById(t.device))))}onDeviceDidDisconnect(e){return Ie.disposableOn("deviceDidDisconnect",t=>e(new Fe(t,this.getDeviceById(t.device))))}};function nt(e){const t=p.join(process.cwd(),`${e}.json`);if(!d.existsSync(t))return null;try{const e=d.readFileSync(t,{flag:"r"})?.toString();return function(e){const t=JSON.parse(e);if(null!=t&&"object"==typeof t&&"Localization"in t)return t.Localization;throw new TypeError('Translations must be a JSON object nested under a property named "Localization"')}(e)}catch(e){return $e.error(`Failed to load translations from ${t}`,e),null}}var rt=Object.freeze({__proto__:null,switchToProfile:function(e,t,a){return void 0!==a&&Ke(6.5,Ie.version,"Switching to a profile page"),Ie.send({event:"switchToProfile",context:Ie.registrationParameters.pluginUUID,device:e,payload:{page:a,profile:t}})}});var ot=Object.freeze({__proto__:null,getSecrets:function(){return Ke(6.9,Ie.version,"Secrets"),We(3,"Secrets"),new Promise(e=>{Ie.once("didReceiveSecrets",t=>e(t.payload.secrets)),Ie.send({event:"getSecrets",context:Ie.registrationParameters.pluginUUID})})},onApplicationDidLaunch:function(e){return Ie.disposableOn("applicationDidLaunch",t=>e(new Be(t)))},onApplicationDidTerminate:function(e){return Ie.disposableOn("applicationDidTerminate",t=>e(new Be(t)))},onDidReceiveDeepLink:function(e){return Ke(6.5,Ie.version,"Receiving deep-link messages"),Ie.disposableOn("didReceiveDeepLink",t=>e(new Oe(t)))},onSystemDidWakeUp:function(e){return Ie.disposableOn("systemDidWakeUp",t=>e(new xe(t)))},openUrl:function(e){return Ie.send({event:"openUrl",payload:{url:e}})}});function lt(e){const t=e.UUID;return function(e,a){return class extends e{manifestId=t}}}class ct{manifestId;get actions(){return Ne.filter(e=>e.manifestId===this.manifestId)}}let dt;const ht={get actions(){return at},get devices(){return st},get i18n(){return dt??=new I(this.info.application.language,nt)},get info(){return Ie.registrationParameters.info},get logger(){return $e},get profiles(){return rt},get settings(){return qe},get system(){return ot},get ui(){return ze},connect:()=>Ie.connect()};function ut(e,t,a,i,s,n){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",d=!t&&e?i.static?e:e.prototype:null,h=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,p=a.length-1;p>=0;p--){var m={};for(var f in i)m[f]="access"===f?{}:i[f];for(var f in i.access)m.access[f]=i.access[f];m.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");n.push(r(e||null))};var g=(0,a[p])("accessor"===l?{get:h.get,set:h.set}:h[c],m);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=r(g.get))&&(h.get=o),(o=r(g.set))&&(h.set=o),(o=r(g.init))&&s.unshift(o)}else(o=r(g))&&("field"===l?s.unshift(o):h[c]=o)}d&&Object.defineProperty(d,i.name,h),u=!0}function pt(e,t,a){for(var i=arguments.length>2,s=0;s<t.length;s++)a=i?t[s].call(e,a):t[s].call(e);return i?a:void 0}"function"==typeof SuppressedError&&SuppressedError;const mt=ht.logger.createScope("LcuConnector");const ft=new class{credentials=null;pollInterval=null;listeners=[];getCredentials(){return this.credentials}isConnected(){return null!==this.credentials}onConnectionChange(e){this.listeners.push(e)}startPolling(e=3e3){this.pollInterval||(this.discover().catch(e=>mt.error(`LCU discover error: ${e}`)),this.pollInterval=setInterval(()=>{this.discover().catch(e=>mt.error(`LCU discover error: ${e}`))},e),mt.info("Started LCU polling"))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async discover(){if(this.credentials){if(await this.pingLcu())return;return this.credentials=null,mt.info("LCU client lost (ping failed)"),void this.notifyListeners()}try{const e=await this.discoverFromProcess();if(e)return this.credentials=e,mt.info(`LCU discovered on port ${e.port}`),void this.notifyListeners()}catch{}try{const e=await this.discoverFromLockfile();if(e)return this.credentials=e,mt.info(`LCU discovered from lockfile on port ${e.port}`),void this.notifyListeners()}catch{}}pingAgent=new S.Agent({rejectUnauthorized:!1,keepAlive:!0});pingLcu(){if(!this.credentials)return Promise.resolve(!1);const{port:e,password:t}=this.credentials;return new Promise(a=>{const i=S.request({hostname:"127.0.0.1",port:e,path:"/Help",method:"GET",headers:{Authorization:`Basic ${Buffer.from(`riot:${t}`).toString("base64")}`},agent:this.pingAgent,timeout:2e3},e=>{e.resume(),200!==e.statusCode&&mt.warn(`LCU ping got status ${e.statusCode}`),a(200===e.statusCode)});i.on("error",e=>{mt.warn(`LCU ping error: ${e.message}`),a(!1)}),i.on("timeout",()=>{mt.warn("LCU ping timeout"),i.destroy(),a(!1)}),i.end()})}discoverFromProcess(){return new Promise((e,t)=>{const a="win32"===process.platform?'powershell.exe -NoProfile -Command "Get-CimInstance Win32_Process -Filter \\"name=\'LeagueClientUx.exe\'\\" | Select-Object -ExpandProperty CommandLine"':"ps -A -o args | grep LeagueClientUx";w(a,{timeout:5e3},(a,i)=>{if(a)return void t(a);const s=i.match(/--app-port=(\d+)/),n=i.match(/--remoting-auth-token=([\w_-]+)/),r=i.match(/--app-pid=(\d+)/);e(s&&n?{port:parseInt(s[1],10),password:n[1],pid:r?parseInt(r[1],10):0,protocol:"https"}:null)})})}async discoverFromLockfile(){const e="win32"===process.platform?["C:\\Riot Games\\League of Legends\\lockfile","D:\\Riot Games\\League of Legends\\lockfile",m(process.env.LOCALAPPDATA||"","Riot Games","League of Legends","lockfile")]:["/Applications/League of Legends.app/Contents/LoL/lockfile"];for(const t of e)try{const e=(await b(t,"utf-8")).split(":");if(e.length>=5)return{pid:parseInt(e[1],10),port:parseInt(e[2],10),password:e[3],protocol:e[4]}}catch{continue}return null}notifyListeners(){for(const e of this.listeners)try{e(this.credentials)}catch(e){mt.error(`Listener error: ${e}`)}}},gt=ht.logger.createScope("LcuApi");const yt=new class{agent=new S.Agent({rejectUnauthorized:!1,keepAlive:!0});getCache=new Map;GET_CACHE_TTL=500;async get(e){const t=ft.getCredentials();if(!t)return null;const a=this.getCache.get(e);return a&&Date.now()-a.timestamp<this.GET_CACHE_TTL?a.data:(a&&this.getCache.delete(e),new Promise(a=>{const i=Buffer.from(`riot:${t.password}`).toString("base64"),s=S.request({hostname:"127.0.0.1",port:t.port,path:e,method:"GET",headers:{Authorization:`Basic ${i}`,Accept:"application/json"},agent:this.agent},t=>{let i="";t.on("data",e=>{i+=e.toString()}),t.on("end",()=>{try{if(200===t.statusCode){const t=JSON.parse(i);this.getCache.set(e,{data:t,timestamp:Date.now()}),a(t)}else gt.warn(`LCU ${e} returned ${t.statusCode}`),a(null)}catch(t){gt.error(`LCU parse error on ${e}: ${t}`),a(null)}})});s.on("error",t=>{gt.debug(`LCU request error on ${e}: ${t.message}`),a(null)}),s.setTimeout(3e3,()=>{s.destroy(),a(null)}),s.end()}))}async post(e,t){const a=ft.getCredentials();return!!a&&new Promise(i=>{const s=Buffer.from(`riot:${a.password}`).toString("base64"),n=t?JSON.stringify(t):"",r=S.request({hostname:"127.0.0.1",port:a.port,path:e,method:"POST",headers:{Authorization:`Basic ${s}`,"Content-Type":"application/json","Content-Length":Buffer.byteLength(n)},agent:this.agent},t=>{let a="";t.on("data",e=>{a+=e.toString()}),t.on("end",()=>{t.statusCode&&t.statusCode>=200&&t.statusCode<300?i(!0):(gt.warn(`LCU POST ${e} returned ${t.statusCode}`),i(!1))})});r.on("error",t=>{gt.debug(`LCU POST error on ${e}: ${t.message}`),i(!1)}),r.setTimeout(3e3,()=>{r.destroy(),i(!1)}),r.write(n),r.end()})}async getGameflowPhase(){return await this.get("/lol-gameflow/v1/gameflow-phase")??"None"}async getChampSelectSession(){return this.get("/lol-champ-select/v1/session")}async getCurrentSummoner(){return this.get("/lol-summoner/v1/current-summoner")}async getRegion(){const e=await this.get("/riotclient/region-locale");return e?.region??null}async getSummonerByPuuid(e){return this.get(`/lol-summoner/v2/summoners/puuid/${encodeURIComponent(e)}`)}async getRankedStats(e){return this.get(`/lol-ranked/v1/ranked-stats/${encodeURIComponent(e)}`)}async getCurrentRankedStats(){return this.get("/lol-ranked/v1/current-ranked-stats")}async put(e,t){return await this.request("PUT",e,t)??null}async patch(e,t){gt.debug(`PATCH ${e} body: ${JSON.stringify(t)}`);return await this.request("PATCH",e,t)}async del(e){const t=ft.getCredentials();return!!t&&new Promise(a=>{const i=Buffer.from(`riot:${t.password}`).toString("base64"),s=S.request({hostname:"127.0.0.1",port:t.port,path:e,method:"DELETE",headers:{Authorization:`Basic ${i}`},agent:this.agent},e=>{let t="";e.on("data",e=>{t+=e.toString()}),e.on("end",()=>{a(void 0!==e.statusCode&&e.statusCode>=200&&e.statusCode<300)})});s.on("error",()=>a(!1)),s.setTimeout(3e3,()=>{s.destroy(),a(!1)}),s.end()})}async request(e,t,a){const i=ft.getCredentials();return i?new Promise(s=>{const n=Buffer.from(`riot:${i.password}`).toString("base64"),r=a?JSON.stringify(a):"",o=S.request({hostname:"127.0.0.1",port:i.port,path:t,method:e,headers:{Authorization:`Basic ${n}`,"Content-Type":"application/json","Content-Length":Buffer.byteLength(r),Accept:"application/json"},agent:this.agent},a=>{let i="";a.on("data",e=>{i+=e.toString()}),a.on("end",()=>{try{a.statusCode&&a.statusCode>=200&&a.statusCode<300&&i.length>0?s(JSON.parse(i)):a.statusCode&&a.statusCode>=200&&a.statusCode<300?s(void 0):(gt.warn(`LCU ${e} ${t} returned ${a.statusCode}: ${i.slice(0,200)}`),s(null))}catch{s(null)}})});o.on("error",a=>{gt.warn(`LCU ${e} ${t} error: ${a.message}`),s(null)}),o.setTimeout(3e3,()=>{o.destroy(),s(null)}),o.write(r),o.end()}):null}async getRunePages(){return await this.get("/lol-perks/v1/pages")??[]}async getCurrentRunePage(){return this.get("/lol-perks/v1/currentpage")}async createRunePage(e){return ft.getCredentials()?await this.request("POST","/lol-perks/v1/pages",e)??null:null}async updateRunePage(e,t){return this.put(`/lol-perks/v1/pages/${e}`,t)}async deleteRunePage(e){return this.del(`/lol-perks/v1/pages/${e}`)}async setSummonerSpells(e,t){return null!==await this.patch("/lol-champ-select/v1/session/my-selection",{spell1Id:e,spell2Id:t})}};ht.logger.createScope("GameClient");const wt=new S.Agent({rejectUnauthorized:!1});const vt=new class{cachedData=null;lastFetchTime=0;cacheTtlMs=500;request(e){return new Promise(t=>{const a=new URL(e,"https://127.0.0.1:2999"),i=S.request({hostname:a.hostname,port:a.port,path:a.pathname,method:"GET",headers:{Accept:"application/json"},agent:wt},e=>{let a="";e.on("data",e=>{a+=e.toString()}),e.on("end",()=>{try{200===e.statusCode?t(JSON.parse(a)):t(null)}catch{t(null)}})});i.on("error",()=>{t(null)}),i.setTimeout(2e3,()=>{i.destroy(),t(null)}),i.end()})}async isInGame(){return null!==await this.request("/liveclientdata/gamestats")}async getAllData(){const e=Date.now();if(this.cachedData&&e-this.lastFetchTime<this.cacheTtlMs)return this.cachedData;const t=await this.request("/liveclientdata/allgamedata");return t?(this.cachedData=t,this.lastFetchTime=e):this.cachedData=null,this.cachedData}async getActivePlayer(){const e=await this.getAllData();return e?.activePlayer??null}async getAllPlayers(){const e=await this.getAllData();return e?.allPlayers??[]}async getEnemyPlayers(){const e=await this.getAllData();if(!e)return[];const t=e.activePlayer.summonerName,a=e.allPlayers.find(e=>e.riotIdGameName===t||e.summonerName===t);return a?e.allPlayers.filter(e=>e.team!==a.team):[]}async getGameTime(){const e=await this.getAllData();return e?.gameData.gameTime??0}async getEvents(){const e=await this.getAllData();return e?.events??null}clearCache(){this.cachedData=null,this.lastFetchTime=0}},bt=ht.logger.createScope("GameMode");const St=new class{currentMode="NONE";currentPhase="None";pollTimer=null;listeners=[];start(){this.pollTimer||(this.refresh().catch(()=>{}),this.pollTimer=setInterval(()=>this.refresh().catch(()=>{}),2e3),bt.info("GameMode service started"))}stop(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}get(){return this.currentMode}isTFT(){return"TFT"===this.currentMode}isLoL(){return"CLASSIC"===this.currentMode||"ARAM"===this.currentMode}isArena(){return"CHERRY"===this.currentMode}isARAM(){return"ARAM"===this.currentMode}getPhase(){return this.currentPhase}onChange(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}async refresh(){if(!ft.isConnected())return void this.update("NONE","None");const e=await yt.getGameflowPhase();if("None"===e)return void this.update("NONE",e);const t=await yt.get("/lol-gameflow/v1/session"),a=(t?.gameData?.queue?.gameMode??"").toUpperCase();let i;switch(a){case"CLASSIC":case"PRACTICETOOL":i="CLASSIC";break;case"ARAM":i="ARAM";break;case"TFT":i="TFT";break;case"CHERRY":i="CHERRY";break;case"":i="NONE"!==this.currentMode&&"UNKNOWN"!==this.currentMode?this.currentMode:"NONE";break;default:"NONE"!==this.currentMode&&"UNKNOWN"!==this.currentMode?(i=this.currentMode,bt.debug(`Unhandled game mode "${a}", retaining ${i}`)):(i="UNKNOWN",bt.debug(`Unknown game mode: "${a}"`))}this.update(i,e)}update(e,t){if(!(e!==this.currentMode||t!==this.currentPhase))return;const a=this.currentMode,i=this.currentPhase;this.currentMode=e,this.currentPhase=t,bt.info(`Mode: ${a}${e}, Phase: ${i}${t}`);for(const a of this.listeners)try{a(e,t)}catch(e){bt.error(`GameMode listener error: ${e}`)}}},_t=ht.logger.createScope("GameStatus"),kt={None:{label:"Status\nOffline"},Lobby:{label:"Status\nLobby"},Matchmaking:{label:"Status\nQueue..."},ReadyCheck:{label:"MATCH\nFOUND"},ChampSelect:{label:"Champ\nSelect"},GameStart:{label:"Status\nLoading"},InProgress:{label:"Status\nIn Game"},WaitingForStats:{label:"Status\nStats..."},EndOfGame:{label:"Status\nEnd"},Reconnect:{label:"Status\nReconnect"}},Ct={Lobby:{label:"TFT\nLobby"},Matchmaking:{label:"TFT\nQueue..."},ReadyCheck:{label:"TFT\nFOUND"},ChampSelect:{label:"TFT\nLoading"},GameStart:{label:"TFT\nLoading"},InProgress:{label:"TFT\nIn Game"},WaitingForStats:{label:"TFT\nStats..."},EndOfGame:{label:"TFT\nEnd"},Reconnect:{label:"TFT\nReconnect"}},$t={EUW:"euw",EUNE:"eune",NA:"na",KR:"kr",JP:"jp",BR:"br",LAN:"lan",LAS:"las",OCE:"oce",TR:"tr",RU:"ru",PH:"ph",SG:"sg",TH:"th",TW:"tw",VN:"vn",ME:"me"};let It=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.game-status"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;currentPhase="None";detectedRegion=null;onWillAppear(e){return this.startPolling(),e.action.setTitle("LoL\nStatus")}onWillDisappear(e){0===this.actions.length&&this.stopPolling()}async onKeyDown(e){if(ft.isConnected())try{const t=await yt.getCurrentSummoner();if(t&&t.gameName){const a=encodeURIComponent(t.gameName),i=encodeURIComponent(t.tagLine||"EUW");if(!this.detectedRegion){const e=await yt.getRegion();e&&(this.detectedRegion=$t[e.toUpperCase()]??e.toLowerCase())}const s=`https://www.op.gg/summoners/${e.payload.settings.region??this.detectedRegion??"euw"}/${a}-${i}`;return _t.info(`Opening OP.GG: ${s}`),void("darwin"===process.platform?v("open",[s],{stdio:"ignore"}):v("cmd",["/c","start","",s],{stdio:"ignore"}))}}catch(e){_t.error(`Failed to open OP.GG: ${e}`)}await this.updateStatus()}startPolling(){this.pollInterval||(this.updateStatus().catch(e=>_t.error(`updateStatus error: ${e}`)),this.pollInterval=setInterval(()=>this.updateStatus().catch(e=>_t.error(`updateStatus error: ${e}`)),2e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateStatus(){let e="None";if(ft.isConnected()&&(e=await yt.getGameflowPhase()),"InProgress"===e&&!St.isTFT()){await vt.isInGame()||(e="GameStart")}if(e!==this.currentPhase){this.currentPhase=e;const t=(St.isTFT()?Ct:kt)[e]??kt[e]??kt.None;_t.info(`Game phase changed: ${e} (mode=${St.get()})`);for(const e of this.actions)await e.setTitle(t.label)}}},t})();const xt=ht.logger.createScope("DataDragon"),Tt="https://ddragon.leagueoflegends.com";class At{version=null;champions=new Map;championsByKey=new Map;summonerSpells=new Map;items=new Map;initialized=!1;versionCheckTimer=null;static VERSION_CHECK_INTERVAL=18e5;isReady(){return this.initialized}async init(){if(!this.initialized)try{const e=await this.fetchJson(`${Tt}/api/versions.json`);e&&e.length>0?(this.version=e[0],xt.info(`Data Dragon version: ${this.version}`)):(this.version="14.24.1",xt.warn(`Could not fetch DD version, using fallback ${this.version}`)),await this.loadChampions(),await this.loadSummonerSpells(),await this.loadItems(),this.initialized=!0,xt.info(`Data Dragon initialized: ${this.champions.size} champions, ${this.summonerSpells.size} spells, ${this.items.size} items`),this.startVersionCheck()}catch(e){xt.error(`Data Dragon init failed: ${e}`)}}startVersionCheck(){this.versionCheckTimer||(this.versionCheckTimer=setInterval(()=>this.checkForNewVersion().catch(()=>{}),At.VERSION_CHECK_INTERVAL))}async checkForNewVersion(){const e=await this.fetchJson(`${Tt}/api/versions.json`);if(!e||0===e.length)return;const t=e[0];if(t===this.version)return;xt.info(`New Data Dragon version detected: ${this.version}  ${t}`);const a=this.version;this.version=t;const i=new Map,s=new Map,n=new Map,r=new Map;try{const e=await this.fetchJson(`${Tt}/cdn/${t}/data/en_US/champion.json`);if(e?.data)for(const[t,a]of Object.entries(e.data))i.set(t,a),s.set(a.key,a);const a=await this.fetchJson(`${Tt}/cdn/${t}/data/en_US/summoner.json`);if(a?.data)for(const[e,t]of Object.entries(a.data))n.set(e,t);const o=await this.fetchJson(`${Tt}/cdn/${t}/data/en_US/item.json`);if(o?.data)for(const[e,t]of Object.entries(o.data))r.set(e,t);if(0===i.size)throw new Error("Champion data empty after fetch");this.champions=i,this.championsByKey=s,this.summonerSpells=n,this.items=r,xt.info(`Data Dragon refreshed: ${this.champions.size} champions, ${this.summonerSpells.size} spells, ${this.items.size} items`)}catch(e){xt.error(`Data Dragon refresh failed, keeping ${a}: ${e}`),this.version=a}}getVersion(){return this.version??"14.24.1"}getChampion(e){return this.champions.get(e)}getChampionByKey(e){return this.championsByKey.get(e)}getChampionByName(e){const t=e.toLowerCase();for(const e of this.champions.values())if(e.name.toLowerCase()===t||e.id.toLowerCase()===t)return e}getChampionImageUrl(e){return`${Tt}/cdn/${this.getVersion()}/img/champion/${e}.png`}getAllChampions(){return this.champions.values()}getSummonerSpell(e){return this.summonerSpells.get(e)}getSpellImageUrl(e){const t=this.summonerSpells.get(e),a=t?.image.full??`${e}.png`;return`${Tt}/cdn/${this.getVersion()}/img/spell/${a}`}getItem(e){return this.items.get(e)}getItemName(e){return this.items.get(String(e))?.name??`Item ${e}`}getItemCost(e){return this.items.get(String(e))?.gold.total??0}getItemComponents(e){const t=this.items.get(String(e));return t?.from?.map(Number).filter(e=>!isNaN(e))??[]}getItemBaseCost(e){return this.items.get(String(e))?.gold.base??0}getItemImageUrl(e){return`${Tt}/cdn/${this.getVersion()}/img/item/${e}.png`}async loadChampions(){const e=`${Tt}/cdn/${this.getVersion()}/data/en_US/champion.json`,t=await this.fetchJson(e);if(t?.data)for(const[e,a]of Object.entries(t.data))this.champions.set(e,a),this.championsByKey.set(a.key,a)}async loadSummonerSpells(){const e=`${Tt}/cdn/${this.getVersion()}/data/en_US/summoner.json`,t=await this.fetchJson(e);if(t?.data)for(const[e,a]of Object.entries(t.data))this.summonerSpells.set(e,a)}async loadItems(){const e=`${Tt}/cdn/${this.getVersion()}/data/en_US/item.json`,t=await this.fetchJson(e);if(t?.data)for(const[e,a]of Object.entries(t.data))this.items.set(e,a)}async fetchJson(e){try{const t=await fetch(e,{signal:AbortSignal.timeout(15e3)});return t.ok?await t.json():(xt.warn(`DD fetch ${e} returned ${t.status}`),null)}catch(t){return xt.error(`DD fetch error ${e}: ${t}`),null}}}const Dt=new At,Rt=ht.logger.createScope("LoLIcons"),Et=new Map;async function Pt(e,t){const a=Et.get(e);if(void 0!==a){if(""!==a.data)return a.data;if(Date.now()-a.timestamp<3e5)return null;Et.delete(e)}try{const a=await fetch(t);if(!a.ok)return Rt.warn(`Icon fetch failed (${a.status}): ${t}`),Et.set(e,{data:"",timestamp:Date.now()}),null;const i=`data:image/png;base64,${Buffer.from(await a.arrayBuffer()).toString("base64")}`;if(Et.size>=500){const e=Et.keys().next().value;e&&Et.delete(e)}return Et.set(e,{data:i,timestamp:Date.now()}),i}catch(a){return Rt.error(`Icon fetch error: ${t}  ${a}`),Et.set(e,{data:"",timestamp:Date.now()}),null}}async function Lt(e){const t=function(e){if(!e)return null;const t=e.toLowerCase().replace(/['\s.]/g,"");for(const e of Dt.getAllChampions()){if(e.id.toLowerCase().replace(/['\s.]/g,"")===t)return e.id}return null}(e);return t?Pt(`champ:${e}`,Dt.getChampionImageUrl(t)):(Rt.warn(`Cannot resolve DDragon ID for alias: ${e}`),null)}async function Nt(e){if(!e)return null;const t=Dt.getChampionByKey(e);return t?Pt(`champ:${t.id.toLowerCase()}`,Dt.getChampionImageUrl(t.id)):null}async function Bt(e){if(!e)return null;const t=e.toLowerCase().replace(/['\s.]/g,"");for(const e of Dt.getAllChampions()){const a=e.id.toLowerCase().replace(/['\s.]/g,""),i=e.name.toLowerCase().replace(/['\s.]/g,"");if(a===t||i===t)return Pt(`champ:${a}`,Dt.getChampionImageUrl(e.id))}return null}function Ft(e){for(const t of e)Et.has(`champ:${t}`)||Lt(t).catch(()=>{})}async function Ot(e){return Pt(`item:${e}`,`https://ddragon.leagueoflegends.com/cdn/${Dt.getVersion()}/img/item/${e}.png`)}const Mt="https://raw.communitydragon.org/latest/game/assets/ux/minimap/icons",Ut={blue:`${Mt}/blue.png`,red:`${Mt}/red.png`,gromp:`${Mt}/gromp.png`,wolves:`${Mt}/wolf.png`,raptors:`${Mt}/razorbeak.png`,krugs:`${Mt}/krug.png`,scuttle:`${Mt}/crab.png`};async function Gt(e){const t=Ut[e];return t?Pt(`camp:${e}`,t):null}async function jt(e){if(!e||"NONE"===e)return null;const t=e.toLowerCase();return Pt(`ranked-emblem:${t}`,`https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-shared-components/global/default/images/${t}.png`)}const Wt=ht.logger.createScope("LobbyScan"),Kt={top:"TOP",jungle:"JGL",middle:"MID",bottom:"BOT",utility:"SUP","":"?"},Vt=["top","jungle","middle","bottom","utility"],qt=["TOP","JGL","MID","BOT","SUP"];function zt(e){const t=(e<=5?e:e-5)-1;return qt[t]??`#${t+1}`}function Ht(e){if(!e.some(e=>e.assignedPosition&&""!==e.assignedPosition))return{sorted:[...e],hasRoles:!1};return{sorted:[...e].sort((e,t)=>{const a=Vt.indexOf(e.assignedPosition),i=Vt.indexOf(t.assignedPosition);return(-1===a?99:a)-(-1===i?99:i)}),hasRoles:!0}}let Jt=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.lobby-scanner"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;dialStates=new Map;onWillAppear(e){const t=e.payload.settings.slot??1,a=t<=5?"Ally":"Enemy",i=zt(t);return this.startPolling(),e.action.isDial()?(this.getDialSlot(e.action.id,t),e.action.setFeedback({title:`${a} ${i}`,champion:"Waiting...",rank:"",wr_text:"",wr_bar:{value:0}})):e.action.setTitle(`${a}\n${i}`)}onWillDisappear(e){this.dialStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){await this.updateLobby()}async onDialRotate(e){const t=this.getDialSlot(e.action.id);t.currentSlot=(t.currentSlot-1+e.payload.ticks+100)%10+1,await this.updateLobby()}async onDialUp(e){await this.updateLobby()}async onTouchTap(e){await this.updateLobby()}getDialSlot(e,t){let a=this.dialStates.get(e);return a||(a={currentSlot:t??1},this.dialStates.set(e,a)),a}startPolling(){this.pollInterval||(this.updateLobby().catch(e=>Wt.error(`updateLobby error: ${e}`)),this.pollInterval=setInterval(()=>this.updateLobby().catch(e=>Wt.error(`updateLobby error: ${e}`)),2e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateLobby(){if(!ft.isConnected()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",title:"Lobby Scan",champion:"Offline",rank:"",wr_text:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Lobby\nOffline"));return}if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",title:"Lobby Scan",champion:"N/A in TFT",rank:"",wr_text:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Lobby\nN/A TFT"));return}if("ChampSelect"!==await yt.getGameflowPhase()){for(const e of this.actions)if(e.isDial()){const t=this.getDialSlot(e.id).currentSlot,a=t<=5?"Ally":"Enemy",i=zt(t);await e.setFeedback({champ_icon:"",title:`${a} ${i}`,champion:"Waiting...",rank:"",wr_text:"",wr_bar:{value:0}})}else{const t=(await e.getSettings()).slot??1,a=t<=5?"Ally":"Enemy",i=zt(t);await e.setImage(""),await e.setTitle(`${a}\n${i}`)}return}const e=await yt.getChampSelectSession();if(!e)return;const t=Ht(e.myTeam),a=Ht(e.theirTeam);for(const e of this.actions){let i;const s=e.isDial();if(s)i=this.getDialSlot(e.id).currentSlot;else{i=(await e.getSettings()).slot??1}const n=i<=5,r=(n?i:i-5)-1,o=n?t:a,l=o.sorted[r],c=o.hasRoles?Kt[l?.assignedPosition??""]??`#${r+1}`:`#${r+1}`,d=n?"Ally":"Enemy";if(!l){s?await e.setFeedback({champ_icon:"",title:`${d} ${c}`,champion:"No data",rank:"",wr_text:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${d}\n${c}`));continue}let h="???",u=null;const p=l.championId>0?String(l.championId):l.championPickIntent>0?String(l.championPickIntent):null;if(p){const e=Dt.getChampionByKey(p);h=l.championId>0?e?.name??`#${l.championId}`:e?`(${e.name})`:"...",u=await Nt(p)}const m=Kt[l.assignedPosition]??"?";let f="",g=0;if(l.puuid&&""!==l.puuid){const e=await yt.getRankedStats(l.puuid);if(e?.queueMap?.RANKED_SOLO_5x5){const t=e.queueMap.RANKED_SOLO_5x5,a=t.tier?t.tier.charAt(0)+t.tier.slice(1).toLowerCase():"?",i=t.division??"";g=t.wins+t.losses>0?Math.round(t.wins/(t.wins+t.losses)*100):0,f=`${a} ${i}`}}if(s){const t=g>=55?"#2ECC71":g>=50?"#F1C40F":g>0?"#E74C3C":"#666666";await e.setFeedback({champ_icon:u??"",title:`${m}  ${d} ${c}`,champion:h,rank:f||"Unranked",wr_text:g>0?`${g}% WR`:"",wr_bar:{value:g||50,bar_fill_c:t}})}else{u&&await e.setImage(u);const t=f?`${h}\n${f} ${g}%`:`${m}\n${h}`;await e.setTitle(t)}}}},t})();const Yt=ht.logger.createScope("KdaTracker");let Qt=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.kda-tracker"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({kda_line:"- / - / -",cs_line:"",gold_text:"",kda_bar:{value:0},ratio_text:"Waiting..."}):e.action.setTitle("KDA\nWaiting...")}onWillDisappear(e){0===this.actions.length&&this.stopPolling()}startPolling(){this.pollInterval||(this.updateAll().catch(e=>Yt.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>Yt.error(`updateAll error: ${e}`)),1500))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",kda_line:"",cs_line:"N/A in TFT",gold_text:"",kda_bar:{value:0},ratio_text:""}):(await e.setImage(""),await e.setTitle("KDA\nN/A TFT"));return}const e=await vt.getAllData();if(!e){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",kda_line:"- / - / -",cs_line:"No game",gold_text:"",kda_bar:{value:0},ratio_text:""}):(await e.setImage(""),await e.setTitle("KDA\nNo game"));return}const t=e.activePlayer.summonerName,a=e.allPlayers.find(e=>e.riotIdGameName===t||e.summonerName===t);if(!a){for(const e of this.actions)e.isDial()?await e.setFeedback({kda_line:"???",cs_line:"",gold_text:"",kda_bar:{value:0},ratio_text:""}):await e.setTitle("KDA\n?");return}const{kills:i,deaths:s,assists:n,creepScore:r}=a.scores,o=e.gameData.gameTime/60,l=a.championName?await Bt(a.championName):null,c=0===s?i+n:parseFloat(((i+n)/s).toFixed(1)),d=o>.5?(r/o).toFixed(1):r.toString(),h=e.activePlayer.currentGold,u=h>=1e3?`${(h/1e3).toFixed(1)}k`:`${h}`,p=`${i}/${s}/${n}`,m=`${r}cs ${d}/m`,f=0===s?`Perfect ${c}`:`${c} KDA`,g=Math.min(100,Math.round(c/10*100)),y=c>=3?"#2ECC71":c>=1.5?"#F1C40F":"#E74C3C";for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:l??"",kda_line:p,cs_line:m,gold_text:`${u}g`,kda_bar:{value:g,bar_fill_c:y},ratio_text:f}):(l&&await e.setImage(l),await e.setTitle(`${p}\n${f}`))}},t})();const Xt=ht.logger.createScope("AutoAccept");let Zt=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.auto-accept"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;renderTimeout=null;enabled=!0;lastPhase="None";hasAcceptedCurrent=!1;async onWillAppear(e){const t=e.payload.settings;this.enabled=!1!==t.enabled,this.startPolling(),await this.renderAll()}onWillDisappear(e){this.renderTimeout&&(clearTimeout(this.renderTimeout),this.renderTimeout=null)}async onKeyDown(e){this.enabled=!this.enabled,await e.action.setSettings({enabled:this.enabled}),Xt.info("Auto-accept "+(this.enabled?"enabled":"disabled")),await this.renderAll()}startPolling(){this.pollInterval||(this.pollInterval=setInterval(()=>this.checkReadyCheck().catch(e=>Xt.error(`checkReadyCheck error: ${e}`)),500))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async checkReadyCheck(){if(!ft.isConnected())return void("None"!==this.lastPhase&&(this.lastPhase="None",await this.renderAll()));const e=await yt.getGameflowPhase();if(e!==this.lastPhase&&("ReadyCheck"===this.lastPhase&&"ReadyCheck"!==e&&(this.hasAcceptedCurrent=!1),this.lastPhase=e,await this.renderAll()),this.enabled&&"ReadyCheck"===e&&!this.hasAcceptedCurrent){Xt.info("Ready check detected! Auto-accepting...");if(await yt.post("/lol-matchmaking/v1/ready-check/accept")){this.hasAcceptedCurrent=!0,Xt.info("Ready check accepted!");for(const e of this.actions)await e.setTitle("Accepted\n");this.renderTimeout=setTimeout(()=>{this.renderTimeout=null,this.renderAll().catch(e=>Xt.error(`renderAll error: ${e}`))},2e3)}else Xt.warn("Failed to accept ready check")}}async renderAll(){for(const e of this.actions)"ReadyCheck"!==this.lastPhase||this.enabled?this.enabled?await e.setTitle("Accept\nON"):await e.setTitle("Accept\nOFF"):await e.setTitle("MATCH!\nManual")}},t})();const ea=ht.logger.createScope("LolalyticsThrottle"),ta={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"};let aa=3,ia=Date.now();const sa=[];let na=null;function ra(){const e=Date.now()-ia,t=Math.floor(e/500);t>0&&(aa=Math.min(3,aa+t),ia+=500*t)}function oa(){for(ra();sa.length>0&&aa>0;){aa--;const e=sa.shift();e?.()}0===sa.length&&na&&(clearInterval(na),na=null)}async function la(e,t){await(ra(),aa>0?(aa--,Promise.resolve()):new Promise(e=>{sa.push(e),na||(na=setInterval(oa,500))}));const a={...ta,...t?.headers};return ea.debug(`Throttled fetch: ${e} (tokens left: ${aa}, queued: ${sa.length})`),fetch(e,{headers:a,signal:t?.signal})}const ca=ht.logger.createScope("ChampionStats"),da="https://a1.lolalytics.com";class ha{cache=new Map;CACHE_TTL=18e5;async getCounters(e,t){return(await this.getMatchups(e,t)).sort((e,t)=>e.winRateVs-t.winRateVs)}async getBestCounterpicks(e,t){return(await this.getMatchups(e,t)).map(e=>({...e,winRateVs:+(100-e.winRateVs).toFixed(2)})).sort((e,t)=>t.winRateVs-e.winRateVs)}async getBestOverallPick(e,t,a){if(0===e.length)return[];const i=new Map,s=await Promise.all(e.map(e=>this.getBestCounterpicks(e,t)));for(const e of s)for(const a of e){if(a.defaultLane&&!this.isViableInLane(a.defaultLane,a.alias,t))continue;const e=i.get(a.alias);e?(e.totalWr+=a.winRateVs,e.count+=1):i.set(a.alias,{totalWr:a.winRateVs,count:1,name:a.name})}const n=a?.length?this.buildTeamProfile(a):null;return[...i.entries()].filter(([e,t])=>t.count>=1).map(([e,t])=>{const a=t.totalWr/t.count;let i=0;n&&(i=this.computeSynergyBonus(e,n));const s=a+i;return{alias:e,name:t.name,score:+s.toFixed(2),details:n?`ctr ${a.toFixed(1)}% syn ${i>=0?"+":""}${i.toFixed(1)}`:`avg ${a.toFixed(1)}%`}}).sort((e,t)=>t.score-e.score)}buildTeamProfile(e){let t=0,a=0,i=0,s=0;const n=[];for(const r of e){const e=Dt.getChampionByKey(r);e&&(t+=e.info.magic,a+=e.info.attack,i+=e.info.defense,n.push(...e.tags),s++)}return 0===s?{avgMagic:5,avgAttack:5,avgDefense:5,tags:n,hasTank:!1,hasEngage:!1,count:0}:{avgMagic:t/s,avgAttack:a/s,avgDefense:i/s,tags:n,hasTank:n.includes("Tank"),hasEngage:n.includes("Tank")||n.includes("Support"),count:s}}computeSynergyBonus(e,t){if(!e)return 0;const a=Dt.getChampionByName(e);if(!a||0===t.count)return 0;let i=0;t.avgMagic<4&&a.info.magic>=7||t.avgMagic>6&&a.info.magic<=3?i+=2.5:t.avgMagic>=4&&t.avgMagic<=6&&(i+=.5),!t.hasTank&&a.tags.includes("Tank")?i+=1.5:!t.hasTank&&a.info.defense>=7&&(i+=1);const s=a.tags[0];return t.tags.filter(e=>e===s).length>=2&&(i-=1),Math.max(-5,Math.min(5,i))}async getMatchups(e,t){const a=`${e}:${t}`,i=this.cache.get(a);if(i&&Date.now()-i.timestamp<this.CACHE_TTL)return i.data;i&&this.cache.delete(a);const s=Dt.getVersion().split("."),n=`${s[0]}.${s[1]}`,r=[n,"30"];for(const i of r){const s=`${da}/mega/?ep=counter&p=d&v=1&patch=${i}&c=${e}&lane=${t}&tier=emerald_plus&queue=ranked&region=all`;try{ca.debug(`Fetching matchups: ${s}`);const r=await la(s,{signal:AbortSignal.timeout(1e4)});if(!r.ok){ca.warn(`Lolalytics API returned ${r.status} for ${e} ${t} (patch=${i})`);continue}const o=await r.json();if(!o?.counters||!Array.isArray(o.counters)){ca.warn(`Invalid API response structure for ${e} ${t} (patch=${i})`);continue}const l=[];for(const e of o.counters){if(!e.cid||e.n<50)continue;const t=Dt.getChampionByKey(String(e.cid)),a=t?ha.toLolalytics(t.id):String(e.cid),i=t?.name??`Champion ${e.cid}`;l.push({alias:a,name:i,winRateVs:e.vsWr,games:e.n,defaultLane:e.defaultLane})}if(0===l.length){ca.warn(`0 matchups from API for ${e} ${t} (patch=${i})`);continue}return i!==n&&ca.info(`Using patch=${i} fallback for ${e} ${t} (current patch has no data)`),ca.info(`Parsed ${l.length} matchups for ${e} ${t} via API`),this.cache.set(a,{data:l,timestamp:Date.now()}),l}catch(a){ca.error(`Failed to fetch matchups for ${e} ${t} (patch=${i}): ${a}`)}}if(ca.warn(`All patch attempts failed for ${e} ${t}`),"default"!==t)for(const i of r){const s=`${da}/mega/?ep=counter&p=d&v=1&patch=${i}&c=${e}&lane=default&tier=emerald_plus&queue=ranked&region=all`;try{ca.debug(`Trying default lane fallback for ${e} (patch=${i})`);const n=await la(s,{signal:AbortSignal.timeout(1e4)});if(!n.ok)continue;const r=await n.json();if(!r?.counters||!Array.isArray(r.counters))continue;const o=[];for(const e of r.counters){if(!e.cid||e.n<50)continue;const t=Dt.getChampionByKey(String(e.cid)),a=t?ha.toLolalytics(t.id):String(e.cid),i=t?.name??`Champion ${e.cid}`;o.push({alias:a,name:i,winRateVs:e.vsWr,games:e.n,defaultLane:e.defaultLane})}if(o.length>0)return ca.info(`Lane fallback: ${o.length} matchups for ${e} via default lane (requested: ${t})`),this.cache.set(a,{data:o,timestamp:Date.now()}),o}catch(t){ca.debug(`Default lane fallback failed for ${e}: ${t}`)}}return ca.error(`All lane+patch attempts failed for ${e} ${t}`),this.cache.set(a,{data:[],timestamp:Date.now()-this.CACHE_TTL+3e5}),i?.data??[]}isViableInLane(e,t,a){const i=e=>({mid:"middle",middle:"middle",top:"top",jungle:"jungle",jng:"jungle",bot:"bottom",bottom:"bottom",adc:"bottom",sup:"support",support:"support",utility:"support"}[e.toLowerCase()]??e.toLowerCase()),s=i(e),n=i(a);if(s===n)return!0;const r=[["top","jungle"],["top","middle"],["middle","bottom"],["middle","support"],["bottom","middle"],["support","middle"]];for(const e of r)if(e.includes(s)&&e.includes(n))return!0;return!1}static toLolalytics(e){return e.toLowerCase().replace(/['\s.]/g,"")}static toLolalyticsLane(e){return{top:"top",jungle:"jungle",middle:"middle",bottom:"bottom",utility:"support"}[e]??"top"}}const ua=new ha,pa=ht.logger.createScope("SmartPick");let ma=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.smart-pick"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;onWillAppear(e){this.startPolling();const t=e.payload.settings.role??"auto",a="auto"===t?"AUTO":t.toUpperCase(),i=e.payload.settings.defaultMode??"counter";return e.action.isDial()?(this.getState(e.action.id,i),e.action.setFeedback({champ_icon:"",title:`${"counter"===i?"Counter":"Best"}  ${a}`,pick_name:"Waiting...",pick_info:"",score_bar:{value:0}})):e.action.setTitle(`${"counter"===i?"Counter":"Best"}\n${a}`)}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id,e.payload.settings.defaultMode);t.mode="counter"===t.mode?"best":"counter",t.lastHash="",await this.updateSmartPick()}async onDialRotate(e){const t=this.getState(e.action.id);0!==t.lastPicks.length&&(t.viewIndex=(t.viewIndex+e.payload.ticks+100*t.lastPicks.length)%t.lastPicks.length,await this.renderDialPick(e.action,t))}async onDialUp(e){const t=this.getState(e.action.id);t.mode="counter"===t.mode?"best":"counter",t.lastHash="",await this.updateSmartPick()}async onTouchTap(e){this.getState(e.action.id).lastHash="",await this.updateSmartPick()}getState(e,t="counter"){let a=this.actionStates.get(e);return a||(a={mode:t,viewIndex:0,lastHash:"",lastPicks:[],lastInfo:""},this.actionStates.set(e,a)),a}async renderDialPick(e,t){if(!e.isDial())return;const a=t.lastPicks[t.viewIndex];if(!a)return;const i=a.winRateVs??a.score,s=i>=54?"#2ECC71":i>=50?"#F1C40F":"#E74C3C",n=await Lt(a.alias),r="counter"===t.mode?"":"";await e.setFeedback({champ_icon:n??"",title:`${r} ${t.lastInfo}`,pick_name:`#${t.viewIndex+1} ${a.name}`,pick_info:a.details,score_bar:{value:i,bar_fill_c:s}})}startPolling(){this.pollInterval||(this.updateSmartPick().catch(e=>pa.error(`updateSmartPick error: ${e}`)),this.pollInterval=setInterval(()=>this.updateSmartPick().catch(e=>pa.error(`updateSmartPick error: ${e}`)),4e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateSmartPick(){if(!ft.isConnected()){for(const e of this.actions){const t="counter"===this.getState(e.id).mode?"Counter":"Best";e.isDial()?await e.setFeedback({champ_icon:"",title:t,pick_name:"Offline",pick_info:"",score_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${t}\nOffline`))}return}if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",title:"Smart Pick",pick_name:"N/A in TFT",pick_info:"",score_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Pick\nN/A TFT"));return}if(St.isARAM()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",title:"Smart Pick",pick_name:"N/A in ARAM",pick_info:"",score_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Pick\nN/A ARAM"));return}if("ChampSelect"!==await yt.getGameflowPhase()){for(const e of this.actionStates.values())e.lastHash="",e.lastPicks=[];for(const e of this.actions){const t=await e.getSettings(),a=t.role??"auto",i="auto"===a?"AUTO":a.toUpperCase(),s="counter"===this.getState(e.id,t.defaultMode).mode?"Counter":"Best";e.isDial()?await e.setFeedback({champ_icon:"",title:`${s}  ${i}`,pick_name:"Waiting...",pick_info:"Press dial to toggle mode",score_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${s}\n${i}`))}return}const e=await yt.getChampSelectSession();if(!e)return void pa.debug("No champ select session available");const t=e.localPlayerCellId,a=e.myTeam.find(e=>e.cellId===t);for(const t of this.actions){const i=await t.getSettings(),s=(i.role&&"auto"!==i.role?i.role:null)??a?.assignedPosition??"top",n=ha.toLolalyticsLane(s),r=this.getState(t.id,i.defaultMode);"counter"===r.mode?await this.updateCounterMode(t,e,s,n,r):await this.updateBestMode(t,e,s,n,r)}}async updateCounterMode(e,t,a,i,s){if(!t)return;let n=t.theirTeam.find(e=>e.assignedPosition===a&&e.championId>0);if(n||(n=t.theirTeam.find(e=>e.championId>0&&(!e.assignedPosition||""===e.assignedPosition))),n||(n=t.theirTeam.find(e=>e.championId>0)),!n)return void(e.isDial()?await e.setFeedback({title:` Counter  ${a.toUpperCase()}`,pick_name:"No enemy yet",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Counter\nNo enemy"));const r=Dt.getChampionByKey(String(n.championId));if(!r)return;const o=ha.toLolalytics(r.id),l=`counter:${o}`;if(l!==s.lastHash){e.isDial()?await e.setFeedback({title:`vs ${r.name}`,pick_name:"Searching...",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle(`vs ${r.name}\nSearching...`);try{const t=await ua.getBestCounterpicks(o,i);if(s.lastPicks=t.map(e=>({alias:e.alias,name:e.name,score:e.winRateVs,winRateVs:e.winRateVs,games:e.games,details:`${e.winRateVs}% WR  ${e.games>=1e3?`${(e.games/1e3).toFixed(1)}k`:e.games} games`})),s.lastInfo=`vs ${r.name}`,s.lastHash=l,Ft(t.slice(0,5).map(e=>e.alias)),0===t.length)e.isDial()?await e.setFeedback({title:` vs ${r.name}`,pick_name:"No data",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle(`vs ${r.name}\nNo data`);else if(e.isDial())s.viewIndex=0,await this.renderDialPick(e,s);else{const a=t[0],i=await Lt(a.alias);i&&await e.setImage(i),await e.setTitle(`Counter\n${a.name} ${a.winRateVs}%`)}}catch(t){pa.error(`Counter mode error: ${t}`),e.isDial()?await e.setFeedback({title:`vs ${r.name}`,pick_name:"Error",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Counter\nError")}}else e.isDial()&&await this.renderDialPick(e,s)}async updateBestMode(e,t,a,i,s){if(!t)return;const n=[],r=[];for(const e of t.theirTeam)if(e.championId>0){const t=Dt.getChampionByKey(String(e.championId));if(t){const i=ha.toLolalytics(t.id);r.push(i),e.assignedPosition!==a&&""!==e.assignedPosition&&e.assignedPosition||n.push(i)}}const o=[];for(const e of t.myTeam)e.championId>0&&e.cellId!==t.localPlayerCellId&&o.push(String(e.championId));if(0===r.length)return void(e.isDial()?await e.setFeedback({title:` Best  ${a.toUpperCase()}`,pick_name:"No enemy yet",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Best\nNo enemy"));const l=n.length>0?n:r,c=`best:${r.sort().join(",")}|${o.sort().join(",")}`;if(c!==s.lastHash){e.isDial()?await e.setFeedback({title:` Best  ${a.toUpperCase()}`,pick_name:"Searching...",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Best\nSearching...");try{const t=await ua.getBestOverallPick(l,i,o.length>0?o:void 0);if(s.lastPicks=t,s.lastInfo=o.length>0?`vs${l.length} +syn${o.length}`:`vs${l.length}  ${a.toUpperCase()}`,s.lastHash=c,Ft(t.slice(0,5).map(e=>e.alias)),0===t.length)e.isDial()?await e.setFeedback({title:` ${s.lastInfo}`,pick_name:"No data",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Best\nNo data");else if(e.isDial())s.viewIndex=0,await this.renderDialPick(e,s);else{const a=t[0],i=await Lt(a.alias);i&&await e.setImage(i),await e.setTitle(`Best Pick\n${a.name} ${a.score}%`)}}catch(t){pa.error(`Best mode error: ${t}`),e.isDial()?await e.setFeedback({title:` Best  ${a.toUpperCase()}`,pick_name:"Error",pick_info:"",champ_icon:"",score_bar:{value:0}}):await e.setTitle("Best\nError")}}else e.isDial()&&await this.renderDialPick(e,s)}},t})();const fa=ht.logger.createScope("LobbyLevel"),ga={IRON:0,BRONZE:4,SILVER:8,GOLD:12,PLATINUM:16,EMERALD:20,DIAMOND:24,MASTER:28,GRANDMASTER:29,CHALLENGER:30},ya={IRON:"Iron",BRONZE:"Bronze",SILVER:"Silver",GOLD:"Gold",PLATINUM:"Plat",EMERALD:"Em",DIAMOND:"Dia",MASTER:"Master",GRANDMASTER:"GM",CHALLENGER:"Chall"},wa={IV:0,III:1,II:2,I:3};let va=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.lobby-level"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;lastHashMap=new Map;onWillAppear(e){return this.startPolling(),e.action.setTitle("Lobby\nLevel")}onWillDisappear(e){this.lastHashMap.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){this.lastHashMap.set(e.action.id,""),await this.updateLobbyLevel()}startPolling(){this.pollInterval||(this.updateLobbyLevel().catch(e=>fa.error(`updateLobbyLevel error: ${e}`)),this.pollInterval=setInterval(()=>this.updateLobbyLevel().catch(e=>fa.error(`updateLobbyLevel error: ${e}`)),5e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateLobbyLevel(){if(!ft.isConnected()){for(const e of this.actions)await e.setTitle("Lobby Lvl\nOffline");return}if(St.isTFT()){for(const e of this.actions)await e.setTitle("Lobby Lvl\nN/A TFT");return}if("ChampSelect"!==await yt.getGameflowPhase()){for(const e of this.actions)this.lastHashMap.set(e.id,"");for(const e of this.actions)await e.setTitle("Lobby\nLevel");return}const e=await yt.getChampSelectSession();if(!e)return;const t=e.myTeam.map(e=>e.puuid).filter(e=>e&&""!==e),a=e.theirTeam.map(e=>e.puuid).filter(e=>e&&""!==e),i=[...t,...a];if(0===i.length){for(const e of this.actions)await e.setTitle("Lobby Lvl\nWaiting...");return}const s=i.sort().join(",");for(const e of this.actions){if(s===(this.lastHashMap.get(e.id)??""))continue;const i=(await e.getSettings()).view??"all";try{const n=await this.fetchPlayerData(t),r=await this.fetchPlayerData(a);let o;if("allies"===i){const e=this.avgLevel(n.map(e=>e.level));o=`Allies ${this.avgRankLabel(n)}\nLvl ${e}`}else if("enemies"===i){const e=this.avgLevel(r.map(e=>e.level));o=`Enemies ${this.avgRankLabel(r)}\nLvl ${e}`}else{const e=this.avgRankLabel(n),t=this.avgRankLabel(r),a=[...n,...r];o=`${e} vs ${t}\nLvl ${this.avgLevel(a.map(e=>e.level))}`}await e.setTitle(o),this.lastHashMap.set(e.id,s)}catch(t){fa.error(`LobbyLevel error: ${t}`),await e.setTitle("Lobby Lvl\nError")}}}async fetchPlayerData(e){const t=e.map(async e=>{const t=await yt.getSummonerByPuuid(e),a=t?.summonerLevel??0;let i=-1;try{const t=await yt.getRankedStats(e);if(t?.queueMap?.RANKED_SOLO_5x5){const e=t.queueMap.RANKED_SOLO_5x5;i=function(e,t){const a=ga[e]??-1;return a<0?-1:a>=28?a:a+(wa[t]??0)}(e.tier,e.division)}}catch{}return{level:a,rankValue:i}});return Promise.all(t)}avgRankLabel(e){const t=e.filter(e=>e.rankValue>=0);if(0===t.length)return"Unranked";const a=t.reduce((e,t)=>e+t.rankValue,0)/t.length;return function(e){if(e>=30)return"Chall";if(e>=29)return"GM";if(e>=28)return"Master";const t=Object.entries(ga).filter(([,e])=>e<28).sort((e,t)=>t[1]-e[1]);for(const[a,i]of t)if(e>=i){const t=e-i,s=["IV","III","II","I"][Math.min(t,3)];return`${ya[a]} ${s}`}return"Iron IV"}(Math.round(a))}avgLevel(e){const t=e.filter(e=>e>0);return 0===t.length?0:Math.round(t.reduce((e,t)=>e+t,0)/t.length)}},t})();const ba=ht.logger.createScope("LolaBuild"),Sa={0:8e3,1:8100,2:8200,3:8400,4:8300},_a={8005:"Press the Attack",8008:"Lethal Tempo",8010:"Conqueror",8021:"Fleet Footwork",8112:"Electrocute",8124:"Predator",8128:"Dark Harvest",9923:"Hail of Blades",8214:"Summon Aery",8229:"Arcane Comet",8230:"Phase Rush",8351:"Glacial Augment",8360:"Unsealed Spellbook",8369:"First Strike",8437:"Grasp of the Undying",8439:"Aftershock",8465:"Guardian"};const ka=new class{cache=new Map;CACHE_TTL=18e5;async getBuildData(e,t,a){const i=a?`${e}:${t}:vs:${a}`:`${e}:${t}`,s=this.cache.get(i);if(s&&Date.now()-s.timestamp<this.CACHE_TTL)return s.data;s&&this.cache.delete(i);const n="aram"===t?"":t;let r;r="aram"===t?`https://lolalytics.com/lol/${e}/aram/build/`:a?`https://lolalytics.com/lol/${e}/vs/${a}/build/?lane=${n}`:`https://lolalytics.com/lol/${e}/build/?lane=${n}`;try{ba.debug(`Fetching build page: ${r}`);const a=await la(r,{signal:AbortSignal.timeout(15e3),headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html"}});if(!a.ok)return ba.warn(`Lolalytics build page returned ${a.status}`),s?.data??null;const n=await a.text(),o=this.parseQwikData(n,e,t);return o&&(this.cache.set(i,{data:o,timestamp:Date.now()}),ba.info(`Parsed build page for ${e} ${t}: ${o.runes.length} rune pages, ${o.summonerSpells.length} spell combos, ${o.skillPriority.length} skill orders`)),o}catch(a){return ba.error(`Failed to fetch build page for ${e} ${t}: ${a}`),s?.data??null}}parseQwikData(e,t,a){try{const t=e.match(/<script type=["']qwik\/json["']>([\s\S]*?)<\/script>/);if(!t)return ba.warn("No qwik/json script found in build page"),null;const a=JSON.parse(t[1]).objs;if(!Array.isArray(a)||0===a.length)return ba.warn("Empty or invalid qwik objs array"),null;const i=e=>{const t=parseInt(e,36);if(!(isNaN(t)||t>=a.length))return a[t]},s=(e,t=0)=>{if(t>12||null==e)return e;if("number"==typeof e||"boolean"==typeof e)return e;if("string"!=typeof e){if(Array.isArray(e))return e.map(e=>s(e,t+1));if("object"==typeof e){const a={};for(const[i,n]of Object.entries(e))a[i]=s(n,t+1);return a}return e}const a=i(e);return void 0===a?e:s(a,t+1)};let n=a.findIndex(e=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&"summary"in e&&"spells"in e&&"skillOrder"in e);if(-1===n&&(n=a.findIndex(e=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&"summary"in e&&("spells"in e||"skillOrder"in e)),-1!==n&&ba.debug("Using lenient Qwik data match (matchup page?)")),-1===n)return ba.debug("Could not find main data object in Qwik data (expected on matchup pages)"),null;const r=a[n],o=s(i(r.summary));if(!o)return ba.warn("Could not resolve summary data"),null;const l=this.extractRunes(o,a),c=this.extractSummonerSpells(o),d=this.extractSkillPriority(o),h=this.extractSkillOrder(o);return{runes:l,summonerSpells:c,skillPriority:d,skillOrder:h,skillEarly:this.extractSkillEarly(r,a,s)}}catch(e){return ba.error(`Failed to parse Qwik data: ${e}`),null}}extractRunes(e,t){const a=[];if(e.pick?.runes){const i=this.convertRuneData(e.pick.runes,"most_common",t);i&&a.push(i)}if(e.win?.runes){const i=this.convertRuneData(e.win.runes,"highest_wr",t);i&&a.push(i)}return a}convertRuneData(e,t,a){const{set:i,page:s,wr:n,n:r}=e;if(!(i?.pri&&i?.sec&&i?.mod&&s))return null;if(!Array.isArray(i.pri)||4!==i.pri.length)return null;if(!Array.isArray(i.sec)||2!==i.sec.length)return null;if(!Array.isArray(i.mod)||3!==i.mod.length)return null;const o=e=>{if("number"==typeof e)return e;if("string"==typeof e){const t=parseInt(e,36);if(!isNaN(t)&&t<a.length&&"number"==typeof a[t])return a[t]}return 0},l=i.pri.map(o),c=i.sec.map(o),d=i.mod.map(o);if(l[0]<8e3)return ba.warn(`Invalid keystone ID ${l[0]} after resolution (source: ${t})`),null;const h=Sa[s.pri]??this.treeFromKeystoneId(l[0]),u=Sa[s.sec]??this.treeFromRuneId(c[0]);if(!h||!u)return null;return{primaryStyleId:h,subStyleId:u,selectedPerkIds:[...l,...c,...d],winRate:n??0,games:r??0,source:t,keystoneName:_a[l[0]]??`Keystone ${l[0]}`}}extractSummonerSpells(e){const t=[];if(e.pick?.sums){const{ids:a,n:i,wr:s}=e.pick.sums;Array.isArray(a)&&2===a.length&&t.push({ids:a,winRate:s??0,pickRate:100,games:i??0,source:"most_common"})}if(e.win?.sums){const{ids:a,n:i,wr:s}=e.win.sums;if(Array.isArray(a)&&2===a.length){t.some(e=>e.ids[0]===a[0]&&e.ids[1]===a[1])||t.push({ids:a,winRate:s??0,pickRate:0,games:i??0,source:"highest_wr"})}}return t}extractSkillPriority(e){const t=[];if(e.pick?.skillpriority){const{id:a,n:i,wr:s}=e.pick.skillpriority;"string"==typeof a&&a.length>=2&&t.push({order:a,winRate:s??0,pickRate:100,games:i??0,source:"most_common"})}if(e.win?.skillpriority){const{id:a,n:i,wr:s}=e.win.skillpriority;if("string"==typeof a&&a.length>=2){t.some(e=>e.order===a)||t.push({order:a,winRate:s??0,pickRate:0,games:i??0,source:"highest_wr"})}}return t}extractSkillOrder(e){const t=[];if(e.pick?.skillorder){const{id:a,n:i,wr:s}=e.pick.skillorder;"number"==typeof a&&t.push({sequence:a,winRate:s??0,pickRate:100,games:i??0,source:"most_common"})}if(e.win?.skillorder){const{id:a,n:i,wr:s}=e.win.skillorder;if("number"==typeof a){t.some(e=>e.sequence===a)||t.push({sequence:a,winRate:s??0,pickRate:0,games:i??0,source:"highest_wr"})}}return t}extractSkillEarly(e,t,a){try{if(!e.skillEarly)return[];const i=a((e=>{const a=parseInt(e,36);return isNaN(a)||a>=t.length?void 0:t[a]})(e.skillEarly));return Array.isArray(i)?i.map(e=>({skills:e.map(e=>({winRate:e[0]??0,pickRate:e[1]??0,games:e[2]??0}))})):[]}catch{return[]}}treeFromKeystoneId(e){return e>=8e3&&e<8500?100*Math.floor(e/100):9923===e?8100:8e3}treeFromRuneId(e){return e>=8400&&e<8500?8400:e>=8300&&e<8400?8300:e>=8200&&e<8300?8200:e>=8100&&e<8200?8100:8e3}},Ca=ht.logger.createScope("RuneData"),$a=[8e3,8100,8200,8400,8300],Ia={8005:"Press the Attack",8008:"Lethal Tempo",8010:"Conqueror",8021:"Fleet Footwork",8112:"Electrocute",8124:"Predator",8128:"Dark Harvest",9923:"Hail of Blades",8214:"Summon Aery",8229:"Arcane Comet",8230:"Phase Rush",8437:"Grasp of the Undying",8439:"Aftershock",8465:"Guardian",8351:"Glacial Augment",8360:"Unsealed Spellbook",8369:"First Strike"};const xa=new class{cache=new Map;CACHE_TTL=18e5;async getRecommendedRunes(e,t,a){const i=a?`${e}:${t}:vs:${a}`:`${e}:${t}`,s=this.cache.get(i);if(s&&Date.now()-s.timestamp<this.CACHE_TTL)return s.data;s&&this.cache.delete(i);try{const s=await ka.getBuildData(e,t,a);if(s&&s.runes.length>0)return Ca.info(`Parsed ${s.runes.length} rune page(s) via SSR for ${e} ${t}: `+s.runes.map(e=>`${e.source} ${e.keystoneName} ${e.winRate}%`).join(", ")),this.cache.set(i,{data:s.runes,timestamp:Date.now()}),s.runes}catch(a){Ca.warn(`SSR rune fetch failed for ${e} ${t}: ${a}`)}return this.fetchFromApi(e,t,s?.data??[])}async fetchFromApi(e,t,a){const i=Dt.getVersion().split("."),s=`https://a1.lolalytics.com/mega/?ep=rune&v=1&patch=${`${i[0]}.${i[1]}`}&c=${e}&lane=${"aram"===t?"default":t}&tier=emerald_plus${"aram"===t?"&queue=450":"&queue=ranked"}&region=all`;try{Ca.debug(`Fetching runes (API fallback): ${s}`);const i=await la(s,{signal:AbortSignal.timeout(1e4)});if(!i.ok)return Ca.warn(`Lolalytics API returned ${i.status} for rune data`),a;const n=await i.json();if(!n?.summary?.runes)return Ca.warn(`Invalid rune API response for ${e} ${t}`),a;const r=this.parseApiRunes(n.summary.runes);return r.length>0?(Ca.info(`Parsed ${r.length} rune page(s) via API for ${e} ${t}: `+r.map(e=>`${e.source} ${e.keystoneName} ${e.winRate}%`).join(", ")),r):(Ca.warn(`No rune data found via API for ${e} ${t}`),a)}catch(i){return Ca.error(`API rune fetch failed for ${e} ${t}: ${i}`),a}}parseApiRunes(e){const t=[];if(e.pick){const a=this.convertApiEntry(e.pick,"most_common");a&&t.push(a)}if(e.win){const a=this.convertApiEntry(e.win,"highest_wr");a&&t.push(a)}return t}convertApiEntry(e,t){const{set:a,page:i,wr:s,n:n}=e;if(!(a?.pri&&a?.sec&&a?.mod&&i&&4===a.pri.length&&2===a.sec.length&&3===a.mod.length))return null;const r=$a[i.pri]??this.treeFromKeystoneId(a.pri[0]),o=$a[i.sec]??this.treeFromRuneId(a.sec[0]);if(!r||!o)return null;return{primaryStyleId:r,subStyleId:o,selectedPerkIds:[...a.pri,...a.sec,...a.mod],winRate:s??0,games:n??0,source:t,keystoneName:Ia[a.pri[0]]??`Keystone ${a.pri[0]}`}}treeFromKeystoneId(e){return e>=8e3&&e<8500?100*Math.floor(e/100):9923===e?8100:8e3}treeFromRuneId(e){return e>=8400&&e<8500?8400:e>=8300&&e<8400?8300:e>=8200&&e<8300?8200:e>=8100&&e<8200?8100:8e3}},Ta=ht.logger.createScope("AutoRune"),Aa=m(f(_(import.meta.url)),".."),Da=new Map,Ra=new Map,Ea=new Map;function Pa(e){if(Da.has(e))return Da.get(e);try{const t=m(Aa,"imgs","actions","auto-rune","keystones",`${e}@2x.png`),a=u(t).toString("base64");return Da.set(e,a),a}catch{return null}}const La="#C89B3C",Na="#0A1428";function Ba(e,t){const a=`${e}:${t}`;if(Ea.has(a))return Ea.get(a);const i=Pa(e);if(!i)return null;const s=function(e){if(Ra.has(e))return Ra.get(e);try{const t=m(Aa,"imgs","actions","auto-rune","trees",`${e}@2x.png`),a=u(t).toString("base64");return Ra.set(e,a),a}catch{return null}}(t),n=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t<rect width="144" height="144" rx="14" fill="${Na}"/>\n\t\t<defs><radialGradient id="g" cx="50%" cy="50%" r="50%">\n\t\t\t<stop offset="0%" stop-color="${La}" stop-opacity="0.22"/>\n\t\t\t<stop offset="55%" stop-color="${La}" stop-opacity="0.07"/>\n\t\t\t<stop offset="100%" stop-color="${La}" stop-opacity="0"/>\n\t\t</radialGradient></defs>\n\t\t<circle cx="72" cy="72" r="55" fill="url(#g)"/>\n\t\t<rect x="3" y="3" width="138" height="138" rx="11" stroke="${La}" stroke-width="3" fill="none"/>\n\t\t<image href="data:image/png;base64,${i}" x="14" y="14" width="116" height="116"/>\n\t\t${s?`<circle cx="116" cy="116" r="25" fill="${Na}" stroke="${La}" stroke-width="1.5"/>\n\t\t   <clipPath id="tc"><circle cx="116" cy="116" r="22"/></clipPath>\n\t\t   <image href="data:image/png;base64,${s}" x="94" y="94" width="44" height="44" clip-path="url(#tc)"/>`:""}\n\t</svg>`,r=`data:image/svg+xml;base64,${Buffer.from(n).toString("base64")}`;return Ea.set(a,r),r}const Fa="LoL Companion";let Oa=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.auto-rune"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n})}pollInterval=null;actionStates=new Map;onWillAppear(e){this.startPolling();const t=e.payload.settings.role??"auto",a="auto"===t?"AUTO":t.toUpperCase();return e.action.isDial()?e.action.setFeedback({title:`Auto Rune  ${a}`,rune_name:"Waiting...",rune_info:"",wr_bar:{value:0}}):e.action.setTitle(`Auto Rune\n${a}`)}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id);await this.applyRunesForAction(e.action,t,e.payload.settings)}async onDialRotate(e){const t=this.getState(e.action.id);t.lastRunes.length<2||(t.selectedIndex=(t.selectedIndex+1)%t.lastRunes.length,t.applied=!1,await this.renderAction(e.action,t,e.payload.settings))}async onDialUp(e){const t=this.getState(e.action.id);await this.applyRunesForAction(e.action,t,e.payload.settings)}async onTouchTap(e){const t=this.getState(e.action.id);await this.applyRunesForAction(e.action,t,e.payload.settings)}getState(e){let t=this.actionStates.get(e);return t||(t={lastChampKey:"",lastRunes:[],selectedIndex:0,applied:!1,spells:[],spellsApplied:!1,lastEnemyKey:"",vsChampName:""},this.actionStates.set(e,t)),t}startPolling(){this.pollInterval||(this.updateState().catch(e=>Ta.error(`updateState error: ${e}`)),this.pollInterval=setInterval(()=>this.updateState().catch(e=>Ta.error(`updateState error: ${e}`)),3e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateState(){if(!ft.isConnected()){for(const e of this.actions)e.isDial()?await e.setFeedback({keystone_icon:"",title:"Auto Rune",rune_name:"Offline",rune_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Runes\nOffline"));return}if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({keystone_icon:"",title:"Auto Rune",rune_name:"N/A in TFT",rune_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Runes\nN/A TFT"));return}if("ChampSelect"!==await yt.getGameflowPhase()){let e=!1;for(const t of this.actionStates.values())""!==t.lastChampKey&&(e=!0),t.lastChampKey="",t.lastRunes=[],t.selectedIndex=0,t.applied=!1,t.spells=[],t.spellsApplied=!1,t.lastEnemyKey="",t.vsChampName="";if(e)for(const e of this.actions){const t=(await e.getSettings()).role??"auto",a="auto"===t?"AUTO":t.toUpperCase();e.isDial()?await e.setFeedback({keystone_icon:"",title:`Auto Rune  ${a}`,rune_name:"Waiting...",rune_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`Auto Rune\n${a}`))}return}const e=await yt.getChampSelectSession();if(!e)return;const t=e.localPlayerCellId,a=e.myTeam.find(e=>e.cellId===t);if(!a||a.championId<=0)return;const i=String(a.championId),s=Dt.getChampionByKey(i);if(!s)return;const n=e.actions.flat().some(e=>e.actorCellId===t&&"pick"===e.type&&e.completed&&e.championId>0),r=ha.toLolalytics(s.id);for(const t of this.actions){const o=await t.getSettings(),l=this.getState(t.id),c=(o.role&&"auto"!==o.role?o.role:null)??a.assignedPosition??"",d=St.isARAM()?"aram":ha.toLolalyticsLane(c||"top"),h=this.getEnemyLaner(e,c,o),u=h?.alias??"",p=i!==l.lastChampKey,m=u!==l.lastEnemyKey;if(!p&&!m){n&&o.autoApply&&(!l.applied||!l.spellsApplied)&&l.lastRunes.length>0&&await this.applyRunesForAction(t,l,o);continue}p&&(l.lastChampKey=i,l.selectedIndex=0,l.applied=!1,l.spells=[],l.spellsApplied=!1),m&&(l.lastEnemyKey=u,l.vsChampName=h?.name??"",!p&&u&&(l.applied=!1,l.spellsApplied=!1,l.selectedIndex=0));const f=l.vsChampName?` vs ${l.vsChampName}`:"";t.isDial()?await t.setFeedback({title:`${s.name}${f}`,rune_name:"Searching...",rune_info:"",wr_bar:{value:0}}):await t.setTitle(`${s.name}\nSearching...`);const g=u||void 0;try{const e=await xa.getRecommendedRunes(r,d,g);if(g&&e.length>0&&e[0].games<50){Ta.info(`Matchup data for ${s.name} vs ${l.vsChampName} has only ${e[0].games} games, using generic`);const t=await xa.getRecommendedRunes(r,d);l.lastRunes=t,l.vsChampName=""}else l.lastRunes=e;try{const e=await ka.getBuildData(r,d,g);e&&e.summonerSpells.length>0&&(l.spells=e.summonerSpells,Ta.info(`Spells for ${s.name} ${d}${g?` vs ${l.vsChampName}`:""}: ${l.spells[0].ids.join("+")} (${l.spells[0].winRate}%)`))}catch(e){Ta.warn(`Failed to fetch spells for ${s.name}: ${e}`)}if(l.lastRunes.length>0){const e=g&&l.vsChampName?`vs ${l.vsChampName}`:"generic";Ta.info(`Runes for ${s.name} ${d} (${e}): ${l.lastRunes[0].keystoneName} (${l.lastRunes[0].winRate}%)`),n&&o.autoApply&&await this.applyRunesForAction(t,l,o)}await this.renderAction(t,l,o)}catch(e){Ta.error(`Failed to get runes: ${e}`)}}}static POSITION_TO_DEFAULT_LANE={top:["top"],jungle:["jungle"],middle:["middle","mid"],bottom:["bottom","adc"],utility:["support"]};getEnemyLaner(e,t,a){if(!1===a.matchup)return null;if(St.isARAM())return null;if(!t)return null;const i=e.theirTeam.find(e=>e.assignedPosition===t&&e.championId>0);if(i){const e=Dt.getChampionByKey(String(i.championId));if(e)return{alias:ha.toLolalytics(e.id),name:e.name}}const s=ha.toLolalyticsLane(t);for(const t of e.theirTeam){if(t.championId<=0)continue;const e=Dt.getChampionByKey(String(t.championId));if(!e)continue;if(this.championMatchesLane(e,s))return{alias:ha.toLolalytics(e.id),name:e.name}}const n=e.theirTeam.filter(e=>e.championId>0);if(1===n.length){const e=Dt.getChampionByKey(String(n[0].championId));if(e)return{alias:ha.toLolalytics(e.id),name:e.name}}return null}championMatchesLane(e,t){const a=e.tags;switch(t){case"top":return a.includes("Fighter")||a.includes("Tank")&&!a.includes("Support");case"jungle":default:return!1;case"middle":return a.includes("Mage")||a.includes("Assassin");case"bottom":return a.includes("Marksman");case"support":return a.includes("Support")}}async renderAction(e,t,a){const i=t.lastRunes[t.selectedIndex],s=t.lastChampKey?Dt.getChampionByKey(t.lastChampKey):null,n=s?.name??"?";if(!i)return void(e.isDial()?await e.setFeedback({keystone_icon:"",title:n,rune_name:"No data",rune_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${n}\nNo rune data`)));const r="highest_wr"===i.source?"Best WR":"Popular",o=t.applied&&t.spellsApplied?" ":t.applied?" ":"",l=i.games>=1e3?`${(i.games/1e3).toFixed(1)}k`:`${i.games}`,c=i.winRate>=54?"#2ECC71":i.winRate>=50?"#F1C40F":"#E74C3C",d=t.vsChampName?` vs ${t.vsChampName}`:"",h=i.selectedPerkIds[0],u=function(e){const t=Pa(e);return t?`data:image/png;base64,${t}`:null}(h),p=n.length>10?n.slice(0,9)+"":n,m=t.vsChampName?t.vsChampName.length>8?` v ${t.vsChampName.slice(0,7)}`:` v ${t.vsChampName}`:"";if(e.isDial())await e.setFeedback({keystone_icon:u??"",title:`${p}${m}  ${r}${o}`,rune_name:i.keystoneName,rune_info:`${i.winRate}% WR  ${l} games${d?" (matchup)":""}`,wr_bar:{value:i.winRate,bar_fill_c:c}});else{const a=Ba(h,i.subStyleId);a?await e.setImage(a):u&&await e.setImage(u),await e.setTitle(`${n}${o}${d?`\nvs ${t.vsChampName}`:""}`)}}async applyRunesForAction(e,t,a){const i=t.lastRunes[t.selectedIndex];if(i)if(ft.isConnected())try{const s=await yt.getRunePages();let n=s.find(e=>e.name===Fa&&e.isEditable);n||(n=s.find(e=>e.isEditable&&e.isDeletable));const r={name:Fa,primaryStyleId:i.primaryStyleId,subStyleId:i.subStyleId,selectedPerkIds:i.selectedPerkIds,current:!0};if(n){if(await yt.updateRunePage(n.id,r))Ta.info(`Updated rune page ${n.id}  ${i.keystoneName}`),t.applied=!0;else{Ta.debug("Update failed, trying delete + create"),await yt.deleteRunePage(n.id);await yt.createRunePage(r)?(Ta.info(`Recreated rune page  ${i.keystoneName}`),t.applied=!0):Ta.error("Failed to create rune page")}}else{const e=s.filter(e=>e.isDeletable);if(e.length>0){const t=e[e.length-1];await yt.deleteRunePage(t.id)}await yt.createRunePage(r)?(Ta.info(`Created new rune page  ${i.keystoneName}`),t.applied=!0):Ta.error("Failed to create rune page after cleanup")}if(!1!==a.autoSpells&&t.spells.length>0&&!t.spellsApplied){const e=t.spells[0];try{await yt.setSummonerSpells(e.ids[0],e.ids[1])?(t.spellsApplied=!0,Ta.info(`Applied summoner spells: ${e.ids.join("+")} (${e.winRate}% WR)`)):Ta.warn("setSummonerSpells returned false")}catch(e){Ta.warn(`Failed to set summoner spells: ${e}`)}}await this.renderAction(e,t,a)}catch(e){Ta.error(`applyRunes error: ${e}`)}else Ta.warn("Not connected to LCU");else Ta.warn("No rune data to apply")}static{pt(t,i)}},t})();const Ma=ht.logger.createScope("ItemBuilds");class Ua{cache=new Map;CACHE_TTL=18e5;async getBuild(e,t){const a=`${e}:${t}`,i=this.cache.get(a);if(i&&Date.now()-i.timestamp<this.CACHE_TTL)return i.data;i&&this.cache.delete(a);const s=Dt.getVersion().split("."),n=`https://a1.lolalytics.com/mega/?ep=build-itemset&v=1&patch=${`${s[0]}.${s[1]}`}&c=${e}&lane=${"aram"===t?"default":t}&tier=emerald_plus${"aram"===t?"&queue=450":"&queue=ranked"}&region=all`;for(let i=0;i<=2;i++)try{if(i>0){const a=1e3*Math.pow(2,i-1);Ma.debug(`Retry ${i}/2 for ${e} ${t} build in ${a}ms`),await new Promise(e=>setTimeout(e,a))}Ma.debug(`Fetching build (API): ${n}`);const s=await la(n,{signal:AbortSignal.timeout(1e4)});if(!s.ok){Ma.warn(`Lolalytics API returned ${s.status} for ${e} ${t} build`);continue}const r=await s.json();if(!r?.itemSets){Ma.warn(`Invalid API response for ${e} ${t} build`);continue}const o=this.extractBuild(r.itemSets);if(!o||0===o.fullBuild.length){Ma.warn(`Parsed no build data for ${e} ${t} (attempt ${i+1})`);continue}return Ma.info(`Parsed build for ${e} ${t}: start=[${o.startingItems.join(",")}] build=[${o.fullBuild.join(",")}]`),this.cache.set(a,{data:o,timestamp:Date.now()}),o}catch(a){Ma.error(`Failed to fetch build for ${e} ${t} (attempt ${i+1}): ${a}`)}return Ma.error(`All 3 attempts failed for ${e} ${t} build`),i?.data??null}extractBuild(e){let t=this.getBestSet(e.itemBootSet6,6);if(t.length<4&&(t=this.buildSlotBySlot(e)),0===t.length)return null;return{startingItems:this.extractStartingItems(e,t),fullBuild:t}}extractStartingItems(e,t){if(e.startSet){const t=this.getBestSet(e.startSet,1);if(t.length>0)return t}const a=t[0];if(a){const e=Dt.getItemCost(a);if(e>0&&e<=500)return[a,2003];const t=Dt.getItemName(a)?.toLowerCase()??"";if(this.isJungleItem(a))return[1103,2003];if(t.includes("rod")||t.includes("luden")||t.includes("liandry")||t.includes("everfrost")||t.includes("malignance")||t.includes("stormsurge"))return[1056,2003];if(t.includes("sunfire")||t.includes("heartsteel")||t.includes("hollow")||t.includes("iceborn")||t.includes("jak'sho")||t.includes("unending"))return[1054,2003];if(t.includes("shurelya")||t.includes("moonstone")||t.includes("redemption")||t.includes("echoes")||t.includes("dream maker")||t.includes("celestial"))return[3850,2003]}return[1055,2003]}isJungleItem(e){return e>=1101&&e<=1104||e>=1035&&e<=1041}getBestSet(e,t){if(!e||0===e.length)return[];const a=[...e].map(([e,t])=>({ids:e,games:t})).filter(e=>e.games>=5).sort((e,t)=>t.games-e.games);for(const e of a){const a=e.ids.split("_").map(Number).filter(e=>!isNaN(e)&&e>0);if(a.length>=t)return a}return a.length>0?a[0].ids.split("_").map(Number).filter(e=>!isNaN(e)&&e>0):[]}buildSlotBySlot(e){const t=[],a=new Set;for(let i=1;i<=5;i++){const s=e[`itemSet${i}`];if(!s)continue;const n=[...s].map(([e,t])=>({ids:e.split("_").map(Number),games:t})).filter(e=>e.games>=3).sort((e,t)=>t.games-e.games);for(const e of n){const i=e.ids[e.ids.length-1];if(i&&!a.has(i)){t.push(i),a.add(i);break}}}const i=e.itemBootSet1;if(i){const e=[...i].map(([e,t])=>({id:Number(e),games:t})).filter(e=>!isNaN(e.id)&&e.games>=5&&this.isBootsItem(e.id)).sort((e,t)=>t.games-e.games);e.length>0&&!a.has(e[0].id)&&t.splice(1,0,e[0].id)}return t}isBootsItem(e){return e>=3006&&e<=3020||3047===e||3111===e||3117===e||3158===e||3009===e}static toLolalyticsLane(e){return{TOP:"top",JUNGLE:"jungle",MIDDLE:"middle",BOTTOM:"bottom",UTILITY:"support"}[e]??"top"}static toAlias(e){if(!e)return"unknown";for(const t of Dt.getAllChampions())if(t.name.toLowerCase()===e.toLowerCase())return t.id.toLowerCase().replace(/['\s.]/g,"");return e.toLowerCase().replace(/['\s.]/g,"")}clearCache(){this.cache.clear()}}const Ga=new Ua,ja=ht.logger.createScope("BestItem"),Wa=new Set([3006,3009,3020,3047,3111,3117,3158]);let Ka=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.best-item"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;fetchingBuild=!1;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"BEST ITEM",item_name:"Waiting...",cost_text:"",gold_bar:{value:0},status_text:""}):e.action.setTitle("Best Item\nWaiting...")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}onDialRotate(e){const t=this.getState(e.action.id);if(!t.currentBuild||0===t.currentBuild.fullBuild.length)return;const a=t.currentBuild.fullBuild.length;-1===t.browseIndex?t.browseIndex=e.payload.ticks>0?0:a-1:(t.browseIndex+=e.payload.ticks>0?1:-1,t.browseIndex>=a&&(t.browseIndex=0),t.browseIndex<0&&(t.browseIndex=a-1)),this.updateAll().catch(e=>ja.error(`updateAll error: ${e}`))}getState(e){let t=this.actionStates.get(e);return t||(t={currentBuild:null,currentChampion:null,currentLane:null,browseIndex:-1},this.actionStates.set(e,t)),t}startPolling(){this.pollInterval||(this.updateAll().catch(e=>ja.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>ja.error(`updateAll error: ${e}`)),2e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({item_icon:"",title:"BEST ITEM",item_name:"N/A in TFT",cost_text:"",gold_bar:{value:0},status_text:""}):(await e.setImage(""),await e.setTitle("Best Item\nN/A TFT"));return}const e=await vt.getAllData();if(!e){for(const e of this.actionStates.values())e.currentChampion&&(e.currentChampion=null,e.currentLane=null,e.currentBuild=null,e.browseIndex=-1);for(const e of this.actions)e.isDial()?await e.setFeedback({item_icon:"",title:"BEST ITEM",item_name:"No game",cost_text:"",gold_bar:{value:0},status_text:""}):(await e.setImage(""),await e.setTitle("Best Item\nNo game"));return}const t=e.activePlayer.summonerName,a=e.allPlayers.find(e=>e.riotIdGameName===t||e.summonerName===t);if(!a){for(const e of this.actions)e.isDial()?await e.setFeedback({item_name:"Player?",cost_text:"",status_text:""}):await e.setTitle("Best Item\n?");return}const i=a.championName,s=St.isARAM()?"aram":Ua.toLolalyticsLane(a.position);if(i&&""!==i)for(const t of this.actions){const n=this.getState(t.id);if((i!==n.currentChampion||s!==n.currentLane)&&(n.currentChampion=i,n.currentLane=s,n.currentBuild=null,n.browseIndex=-1,!this.fetchingBuild)){this.fetchingBuild=!0,t.isDial()?await t.setFeedback({item_name:"Loading build...",cost_text:"",status_text:""}):await t.setTitle("Best Item\nLoading...");const e=Ua.toAlias(i),a=await Ga.getBuild(e,s);for(const e of this.actionStates.values())e.currentChampion===i&&e.currentLane===s&&(e.currentBuild=a);if(this.fetchingBuild=!1,!a){t.isDial()?await t.setFeedback({item_name:"No data",cost_text:"",status_text:""}):await t.setTitle("Best Item\nNo data");continue}}if(!n.currentBuild||0===n.currentBuild.fullBuild.length)continue;const r=new Set(a.items.map(e=>e.itemID)),o=e.activePlayer.currentGold,l=n.currentBuild.fullBuild;let c,d,h;if(n.browseIndex>=0&&n.browseIndex<l.length)c=l[n.browseIndex],d=`Item ${n.browseIndex+1}/${l.length}`,h=!1;else{const e=this.findNextItemIndex(l,r);if(-1===e){t.isDial()?await t.setFeedback({item_icon:"",title:"BUILD",item_name:"Complete!",cost_text:`${Va(o)}g`,gold_bar:{value:100,bar_fill_c:"#2ECC71"},status_text:"Full build "}):(await t.setImage(""),await t.setTitle("Build\nComplete!"));continue}c=l[e],d=`NEXT (${e+1}/${l.length})`,h=!0}const u=Dt.getItemName(c),p=Dt.getItemCost(c),m=await Ot(c),f=o>=p,g=this.isItemOwned(c,r),y=p>0?Math.min(100,Math.round(o/p*100)):100;let w,v;if(g)w="Owned ",v="#2ECC71";else if(f&&h)w="BUY NOW!",v="#2ECC71";else if(h){w=`Need ${Va(p-o)}g`,v="#F1C40F"}else w=`${Va(p)}g`,v="#888888";const b=`${Va(p)}g | ${Va(o)}g`;if(t.isDial())await t.setFeedback({item_icon:m??"",title:d,item_name:qa(u,18),cost_text:b,gold_bar:{value:g?100:y,bar_fill_c:v},status_text:w});else{m&&await t.setImage(m);const e=g?"":f&&h?"BUY":`${Va(p)}g`;await t.setTitle(`${qa(u,12)}\n${e}`)}}else ja.debug("Champion name not available yet, skipping build fetch")}findNextItemIndex(e,t){for(let a=0;a<e.length;a++)if(!this.isItemOwned(e[a],t))return a;return-1}isItemOwned(e,t){if(t.has(e))return!0;if(Wa.has(e))for(const e of Wa)if(t.has(e))return!0;return!1}},t})();function Va(e){return e>=1e3?`${(e/1e3).toFixed(1)}k`:String(e)}function qa(e,t){return e.length<=t?e:e.substring(0,t-1)+""}const za=ht.logger.createScope("DeathTimer");let Ha=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.death-timer"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;lastDeadMap=new Map;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({champ_icon:"",status_text:"Death Timer",timer_text:"Waiting...",respawn_bar:{value:0}}):e.action.setTitle("Death\nTimer")}onWillDisappear(e){this.lastDeadMap.delete(e.action.id),0===this.actions.length&&this.stopPolling()}startPolling(){this.pollInterval||(this.updateAll().catch(e=>za.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>za.error(`updateAll error: ${e}`)),1e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({champ_icon:"",status_text:"N/A in TFT",timer_text:"",respawn_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Death\nN/A TFT"));return}const e=await vt.getAllData();if(!e){for(const e of this.actions)this.lastDeadMap.set(e.id,!1),e.isDial()?await e.setFeedback({champ_icon:"",status_text:"Death Timer",timer_text:"No game",respawn_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Death\nTimer"));return}const t=e.activePlayer.summonerName,a=e.allPlayers.find(e=>e.riotIdGameName===t||e.summonerName===t);if(!a){for(const e of this.actions)e.isDial()?await e.setFeedback({status_text:"?",timer_text:"",respawn_bar:{value:0}}):await e.setTitle("Death\n?");return}const i=a.championName?await Bt(a.championName):null;if(a.isDead){const e=Math.ceil(a.respawnTimer),t=Math.min(100,Math.round(e/60*100));for(const a of this.actions)this.lastDeadMap.set(a.id,!0),a.isDial()?await a.setFeedback({champ_icon:i??"",status_text:" DEAD",timer_text:`${e}s`,respawn_bar:{value:t,bar_fill_c:"#E74C3C"}}):(i&&await a.setImage(i),await a.setTitle(` DEAD\n${e}s`))}else for(const e of this.actions){const t=this.lastDeadMap.get(e.id)??!1;this.lastDeadMap.set(e.id,!1),e.isDial()?await e.setFeedback({champ_icon:i??"",status_text:t?"RESPAWNED!":"ALIVE",timer_text:`Lvl ${a.level}`,respawn_bar:{value:100,bar_fill_c:"#2ECC71"}}):(i&&await e.setImage(i),await e.setTitle(t?"ALIVE!\n":`ALIVE\nLvl ${a.level}`))}}},t})();const Ja=ht.logger.createScope("AutoPick");let Ya=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.auto-pick"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;getState(e){let t=this.actionStates.get(e);return t||(t={enabled:!0,hasPicked:!1,hasBanned:!1,lastPhaseTimer:""},this.actionStates.set(e,t)),t}async onWillAppear(e){const t=e.payload.settings,a=this.getState(e.action.id);a.enabled=!1!==t.enabled,this.startPolling(),await this.renderAction(e.action,t,a)}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id);t.enabled=!t.enabled,await e.action.setSettings({...e.payload.settings,enabled:t.enabled}),Ja.info("Auto-pick "+(t.enabled?"enabled":"disabled")),await this.renderAction(e.action,e.payload.settings,t)}startPolling(){this.pollInterval||(this.pollInterval=setInterval(()=>this.updateState().catch(e=>Ja.error(`updateState error: ${e}`)),1e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async renderAction(e,t,a){const i=t.pickChampion||"???",s=t.banChampion||"";if(a.enabled){const t=Dt.getChampionByName(i);if(t){const a=await Lt(t.id);a&&await e.setImage(a)}await e.setTitle(`Pick: ${i}\nBan: ${s}\nON`)}else await e.setImage(""),await e.setTitle("Auto Pick\nOFF")}async updateState(){if(!Array.from(this.actionStates.values()).some(e=>e.enabled))return;if(!ft.isConnected()){for(const e of this.actions)await e.setTitle("Auto Pick\nOffline");return}if(St.isTFT())return;if("ChampSelect"!==await yt.getGameflowPhase()){let e=!1;for(const t of this.actionStates.values())(t.hasPicked||t.hasBanned)&&(t.hasPicked=!1,t.hasBanned=!1,t.lastPhaseTimer="",e=!0);if(e)for(const e of this.actions){const t=await e.getSettings(),a=this.getState(e.id);await this.renderAction(e,t,a)}return}const e=await yt.getChampSelectSession();if(!e)return;const t=e.timer?.phase,a=e.localPlayerCellId,i=e.actions.flat(),s=i.filter(e=>e.actorCellId===a);if("PLANNING"===t){for(const e of this.actions){const t=await e.getSettings(),a=this.getState(e.id);if(t.pickChampion&&!a.hasPicked&&a.enabled){const e=this.resolveChampionId(t.pickChampion);if(e){const a=s.find(e=>"pick"===e.type&&!e.completed);a&&a.championId!==e&&(Ja.info(`PLANNING: hovering ${t.pickChampion} as intent`),await yt.patch(`/lol-champ-select/v1/session/actions/${a.id}`,{championId:e}))}}}return}const n=s.filter(e=>"ban"===e.type),r=s.filter(e=>"pick"===e.type);(n.length>0||r.length>0)&&Ja.debug(`My actions: bans=${JSON.stringify(n.map(e=>({id:e.id,inProgress:e.isInProgress,completed:e.completed})))}, picks=${JSON.stringify(r.map(e=>({id:e.id,inProgress:e.isInProgress,completed:e.completed})))}`);for(const e of this.actions){const t=await e.getSettings(),n=this.getState(e.id);if(n.enabled){if(!n.hasBanned&&t.banChampion){const a=s.find(e=>"ban"===e.type&&!e.completed);if(a&&(Ja.debug(`Found ban action: id=${a.id}, isInProgress=${a.isInProgress}, completed=${a.completed}`),a.isInProgress)){const i=this.resolveChampionId(t.banChampion);if(i){Ja.info(`Auto-banning ${t.banChampion} (ID: ${i})`);const s=!1!==t.autoLock;await this.performAction(a.id,i,s)&&(n.hasBanned=!0,await e.setTitle(`Banned!\n${t.banChampion}`))}else Ja.warn(`Could not resolve ban champion: ${t.banChampion}`)}}else!n.hasBanned&&t.banChampion;if(!n.hasPicked&&t.pickChampion){const r=this.resolveChampionId(t.pickChampion);if(r){if(i.some(e=>"ban"===e.type&&e.completed&&e.championId===r)){Ja.warn(`${t.pickChampion} was banned  cannot auto-pick`),await e.setTitle(`BANNED!\n${t.pickChampion}`),n.hasPicked=!0;continue}if(i.some(e=>"pick"===e.type&&e.completed&&e.championId===r&&e.actorCellId!==a)){Ja.warn(`${t.pickChampion} already picked by a teammate`),await e.setTitle(`TAKEN!\n${t.pickChampion}`),n.hasPicked=!0;continue}}const o=s.find(e=>"pick"===e.type&&!e.completed);if(o&&(Ja.debug(`Found pick action: id=${o.id}, isInProgress=${o.isInProgress}, completed=${o.completed}`),o.isInProgress&&r)){Ja.info(`Auto-picking ${t.pickChampion} (ID: ${r})`);const a=!1!==t.autoLock;if(await this.performAction(o.id,r,a)){n.hasPicked=!0;const a=Dt.getChampionByKey(String(r)),i=a?await Lt(a.id):null;i&&await e.setImage(i),await e.setTitle(`Picked!\n${t.pickChampion}`)}}}}}}resolveChampionId(e){const t=Dt.getChampionByName(e);if(t)return parseInt(t.key,10);const a=Dt.getChampion(e);if(a)return parseInt(a.key,10);const i=parseInt(e,10);if(!isNaN(i)){if(Dt.getChampionByKey(e))return i}return Ja.warn(`Could not resolve champion: ${e}`),null}async performAction(e,t,a){try{if(await yt.patch(`/lol-champ-select/v1/session/actions/${e}`,{championId:t}),Ja.info(`Hover action ${e} with champion ${t}: sent`),a){await new Promise(e=>setTimeout(e,600));const t=await yt.post(`/lol-champ-select/v1/session/actions/${e}/complete`,{});if(Ja.info(`Lock action ${e}: ${t?"success":"failed"}`),!t){await new Promise(e=>setTimeout(e,800));const t=await yt.post(`/lol-champ-select/v1/session/actions/${e}/complete`,{});if(Ja.info(`Lock retry action ${e}: ${t?"success":"failed"}`),!t)return Ja.warn(`Failed to lock action ${e} after retry  will retry next poll`),!1}}return!0}catch(e){return Ja.error(`performAction error: ${e}`),!1}}},t})();const Qa=ht.logger.createScope("LpTracker"),Xa=["RANKED_SOLO_5x5","RANKED_FLEX_SR","RANKED_TFT","RANKED_TFT_DOUBLE_UP"],Za={RANKED_SOLO_5x5:"Solo/Duo",RANKED_FLEX_SR:"Flex",RANKED_TFT:"TFT",RANKED_TFT_DOUBLE_UP:"TFT Duo"},ei={IRON:"Iron",BRONZE:"Bronze",SILVER:"Silver",GOLD:"Gold",PLATINUM:"Plat",EMERALD:"Emerald",DIAMOND:"Dia",MASTER:"Master",GRANDMASTER:"GM",CHALLENGER:"Chall"},ti={IRON:"#7C7C7C",BRONZE:"#CD7F32",SILVER:"#C0C0C0",GOLD:"#FFD700",PLATINUM:"#4ECDC4",EMERALD:"#50C878",DIAMOND:"#B9F2FF",MASTER:"#9B59B6",GRANDMASTER:"#E74C3C",CHALLENGER:"#F1C40F"};let ai=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.lp-tracker"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;getState(e){let t=this.actionStates.get(e);return t||(t={queueIndex:0,lastDisplay:"",sessionStartLp:-1,sessionStartTier:"",sessionStartDiv:"",trackingStarted:!1},this.actionStates.set(e,t)),t}onWillAppear(e){return this.getState(e.action.id),this.startPolling(),e.action.isDial()?e.action.setFeedback({rank_text:"LP Tracker",lp_text:"",winrate_text:"Connecting...",lp_bar:{value:0},delta_text:""}):e.action.setTitle("LP\nTracker")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id);t.queueIndex=(t.queueIndex+1)%Xa.length,t.lastDisplay="",await this.updateAll()}async onDialRotate(e){const t=this.getState(e.action.id);t.queueIndex=(t.queueIndex+(e.payload.ticks>0?1:-1)+Xa.length)%Xa.length,t.lastDisplay="",await this.updateAll()}startPolling(){this.pollInterval||(this.updateAll().catch(e=>Qa.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>Qa.error(`updateAll error: ${e}`)),1e4))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(!ft.isConnected()){for(const e of this.actions)e.isDial()?await e.setFeedback({rank_icon:"",rank_text:"Offline",lp_text:"",winrate_text:"",lp_bar:{value:0},delta_text:""}):(await e.setImage(""),await e.setTitle("LP\nOffline"));return}const e=await yt.getCurrentRankedStats();if(e)for(const t of this.actions){const a=this.getState(t.id),i=Xa[a.queueIndex],s=e.queueMap?.[i];if(!s||!s.tier||""===s.tier||"NONE"===s.tier){const e=Za[i]??i;t.isDial()?await t.setFeedback({rank_icon:"",rank_text:e,lp_text:"Unranked",winrate_text:"",lp_bar:{value:0},delta_text:""}):(await t.setImage(""),await t.setTitle(`${e}\nUnranked`));continue}const n=s.tier,r=s.division??"",o=s.leaguePoints??0,l=s.wins??0,c=s.losses??0,d=l+c,h=d>0?Math.round(l/d*100):0,u=ei[n]??n,p=ti[n]??"#FFFFFF",m=Za[i]??i;a.trackingStarted||(a.sessionStartLp=o,a.sessionStartTier=n,a.sessionStartDiv=r,a.trackingStarted=!0);let f="";if(a.trackingStarted&&a.sessionStartTier===n&&a.sessionStartDiv===r){const e=o-a.sessionStartLp;f=e>0?`+${e} LP`:e<0?`${e} LP`:"0 LP"}else if(a.trackingStarted){const e=ii(n,r),t=ii(a.sessionStartTier,a.sessionStartDiv);e>t?f=" Promoted!":e<t&&(f=" Demoted")}const g=`${i}|${n}|${r}|${o}|${l}|${c}`;if(g===a.lastDisplay)continue;a.lastDisplay=g;const y=await jt(n);if(t.isDial()){const e=Math.min(100,o);await t.setFeedback({rank_icon:y??"",rank_text:`${u} ${r}`,lp_text:`${o} LP`,winrate_text:`${l}W ${c}L (${h}%)`,lp_bar:{value:e,bar_fill_c:p},delta_text:f,queue_text:m})}else{y&&await t.setImage(y);const e=[`${u} ${r}`,`${o} LP`,`${h}% WR`];f&&e.push(f),await t.setTitle(e.join("\n"))}}else for(const e of this.actions)e.isDial()?await e.setFeedback({rank_icon:"",rank_text:"No Data",lp_text:"",winrate_text:"",lp_bar:{value:0},delta_text:""}):(await e.setImage(""),await e.setTitle("LP\nNo Data"))}},t})();function ii(e,t){const a={IRON:0,BRONZE:4,SILVER:8,GOLD:12,PLATINUM:16,EMERALD:20,DIAMOND:24,MASTER:28,GRANDMASTER:29,CHALLENGER:30}[e]??0;return a>=28?a:a+({IV:0,III:1,II:2,I:3}[t]??0)}const si=ht.logger.createScope("JunglePath"),ni={blue:"Blue",gromp:"Gromp",wolves:"Wolves",raptors:"Raptors",red:"Red",krugs:"Krugs",scuttle:"Scuttle",gank:"Gank"},ri={fullClearBlue:{name:"Full Clear (Blue start)",shortName:"Full Blue",description:"Optimal 6-camp clear starting blue side",camps:["blue","gromp","wolves","raptors","red","krugs","scuttle"]},fullClearRed:{name:"Full Clear (Red start)",shortName:"Full Red",description:"Optimal 6-camp clear starting red side",camps:["red","krugs","raptors","wolves","blue","gromp","scuttle"]},threeCampBlue:{name:"3-Camp Gank (Blue start)",shortName:"3C Blue",description:"Fast 3-camp into gank  BlueGrompRedGank",camps:["blue","gromp","red","gank"]},threeCampRed:{name:"3-Camp Gank (Red start)",shortName:"3C Red",description:"Fast 3-camp into gank  RedBlueGrompGank",camps:["red","blue","gromp","gank"]},threeCampRedKrugs:{name:"3-Camp Gank (Red+Krugs)",shortName:"3C RedK",description:"RedKrugsRaptorsGank (bot-focused early)",camps:["red","krugs","raptors","gank"]},fiveCampBlue:{name:"5-Camp Skip Krugs",shortName:"5C SkipK",description:"BlueGrompWolvesRaptorsRedScuttle (skip krugs for tempo)",camps:["blue","gromp","wolves","raptors","red","scuttle"]},fiveCampRed:{name:"5-Camp Skip Gromp",shortName:"5C SkipG",description:"RedKrugsRaptorsWolvesBlueScuttle (skip gromp for tempo)",camps:["red","krugs","raptors","wolves","blue","scuttle"]},reverseFullBlue:{name:"Reverse Full (BlueTop)",shortName:"Rev Blue",description:"BlueWolvesRaptorsRedKrugsGromp (reverse path for flex gank)",camps:["blue","wolves","raptors","red","krugs","scuttle"]}},oi={flexible:["fullClearBlue","fiveCampBlue","threeCampBlue"]},li={masteryi:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Full clear always, scale hard"},karthus:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue"],tip:"Red start preferred, AoE clear"},shyvana:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Farm to 6, prioritize drakes"},diana:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed","fiveCampBlue"],tip:"Fast AoE clear, look for dives at 6"},lillia:{style:"powerFarmer",paths:["fullClearBlue","fiveCampBlue","fullClearRed"],tip:"Fastest full clear, invade enemy camps"},udyr:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Very fast clear, contest scuttles"},nocturne:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Farm to 6, then R-gank"},kindred:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue","threeCampRed"],tip:"Track marks, invade for them"},belveth:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue"],tip:"Farm heavy, scale with resets"},kayn:{style:"powerFarmer",paths:["fullClearBlue","fiveCampBlue","fullClearRed"],tip:"Raptor start optional for AoE form stacking"},viego:{style:"flexible",paths:["fullClearBlue","fiveCampBlue","threeCampBlue"],tip:"Flexible clear, strong skirmisher"},graves:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue"],tip:"Kite camps, healthy full clears"},hecarim:{style:"powerFarmer",paths:["fullClearBlue","fiveCampBlue","fullClearRed"],tip:"Fast clear with Q AoE, strong post-6 ganks"},amumu:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"AoE clear, strong post-6 ganks"},fiddlesticks:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"W-drain AoE clears, avoid early fights"},mordekaiser:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Passive AoE clears, strong 1v1 at 6"},gwen:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Scale-heavy, look for dives at 6"},briar:{style:"powerFarmer",paths:["fullClearRed","fullClearBlue","fiveCampRed"],tip:"Very healthy clear with W sustain"},zyra:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Plant-based AoE clear"},brand:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed"],tip:"Passive burn clears camps fast"},taliyah:{style:"powerFarmer",paths:["fullClearBlue","fullClearRed","fiveCampBlue"],tip:"Hard AoE clear, roam with R"},leesin:{style:"ganker",paths:["threeCampRed","threeCampBlue","fullClearRed"],tip:"Early gank power, ward-hop plays"},elise:{style:"ganker",paths:["threeCampRed","threeCampBlue","threeCampRedKrugs"],tip:"Level 3 power spike, tower dive queen"},jarvaniv:{style:"ganker",paths:["threeCampRed","threeCampBlue","fullClearRed"],tip:"Strong level 2-3 ganks with E-Q"},xinzhao:{style:"ganker",paths:["threeCampRed","threeCampRedKrugs","fullClearRed"],tip:"Early duelist, gank at 3"},reksai:{style:"ganker",paths:["threeCampRed","threeCampBlue","fullClearRed"],tip:"Tunnel ganks, strong early pressure"},nidalee:{style:"ganker",paths:["threeCampBlue","threeCampRed"],tip:"Must gank/invade early, falls off"},nunu:{style:"ganker",paths:["threeCampBlue","threeCampRed","fullClearBlue"],tip:"Snowball ganks from level 2-3"},zac:{style:"ganker",paths:["fullClearBlue","threeCampBlue","fiveCampBlue"],tip:"Long-range E ganks at level 4-5"},sejuani:{style:"ganker",paths:["fullClearBlue","threeCampBlue","threeCampRed"],tip:"Strong CC ganks, play for lanes"},rammus:{style:"ganker",paths:["fullClearBlue","threeCampRed","threeCampBlue"],tip:"Q-roll ganks, look for overextended lanes"},volibear:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Strong early duel, tower dive at 6"},warwick:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Blood trail ganks, invade when enemies are low"},pantheon:{style:"ganker",paths:["threeCampRed","threeCampBlue","threeCampRedKrugs"],tip:"Early lane dominant, roam with R at 6"},twistedfate:{style:"ganker",paths:["fullClearBlue","threeCampBlue"],tip:"Farm to 6, global R ganks"},talon:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Wall-hop ganks, invade weak junglers"},qiyana:{style:"ganker",paths:["threeCampRed","threeCampBlue"],tip:"Strong level 3 burst, terrain-based plays"},vi:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Q ganks, point-and-click R at 6"},wukong:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Strong level 2-3, team fight at 6"},ivern:{style:"ganker",paths:["threeCampBlue","threeCampRed"],tip:"Mark & leave camps, perma-gank with Daisy"},poppy:{style:"ganker",paths:["fullClearBlue","threeCampBlue","threeCampRed"],tip:"Wall-stun ganks, anti-dash"},maokai:{style:"ganker",paths:["fullClearBlue","threeCampBlue"],tip:"Sapling vision, root ganks"},rell:{style:"ganker",paths:["threeCampRed","threeCampBlue","fullClearRed"],tip:"Strong CC ganks, engage heavy"},sylas:{style:"ganker",paths:["threeCampBlue","fullClearBlue","threeCampRed"],tip:"Steal ults, flexible duelist"},gragas:{style:"ganker",paths:["threeCampBlue","fullClearBlue","threeCampRed"],tip:"E-flash ganks, body slam CC"},khazix:{style:"invader",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Isolate & delete, invade weak junglers"},rengar:{style:"invader",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Bush-leap ganks, invade at 3"},shaco:{style:"invader",paths:["threeCampRedKrugs","threeCampRed"],tip:"Box-trap start, invade & cheese"},evelynn:{style:"flexible",paths:["fullClearBlue","fullClearRed","fiveCampBlue"],tip:"Farm to 6, perma-stealth ganks"},ekko:{style:"flexible",paths:["fullClearBlue","fiveCampBlue","threeCampBlue"],tip:"Flex between farm and ganks, strong at 6"},yone:{style:"flexible",paths:["fullClearBlue","fullClearRed","fiveCampBlue"],tip:"Scale 6, E-engage ganks"},aurora:{style:"flexible",paths:["fullClearBlue","fiveCampBlue","threeCampBlue"],tip:"R-zoning, flexible clear"},ambessa:{style:"ganker",paths:["threeCampRed","fullClearRed","threeCampBlue"],tip:"Strong early pressure, dash-heavy ganks"},naafiri:{style:"ganker",paths:["threeCampRed","fullClearRed"],tip:"Pack hunter, walls for gank angles"},skarner:{style:"flexible",paths:["fullClearBlue","threeCampBlue","fullClearRed"],tip:"Strong CC, E-stun ganks"},trundle:{style:"invader",paths:["fullClearRed","threeCampRed","fullClearBlue"],tip:"Pillar ganks, steal stats with R"},olaf:{style:"invader",paths:["fullClearRed","threeCampRed","fullClearBlue"],tip:"Healthy clear, run-down ganks"},jax:{style:"flexible",paths:["fullClearBlue","fullClearRed","threeCampRed"],tip:"Scale hard, strong at 2 items"}};function ci(e,t){return"blue"===e?"blue"===t?"Bot Blue":"Top Blue":"red"===e?"blue"===t?"Top Red":"Bot Red":"gromp"===e?"blue"===t?"Bot Gromp":"Top Gromp":"krugs"===e?"blue"===t?"Top Krugs":"Bot Krugs":"wolves"===e?"Wolves":"raptors"===e?"Raptors":"scuttle"===e?"Scuttle":"Gank"}let di=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.jungle-path"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;dialStates=new Map;currentChampAlias="";currentChampName="";currentSide="blue";currentPaths=[];currentTip="";enemyJunglerName="";enemyJunglerAlias="";enemyJunglerStyle="";async onWillAppear(e){this.stopPolling(),this.startPolling(),e.action.isDial()?(this.getDialState(e.action.id),await e.action.setFeedback({champ_icon:"",title:"Jungle Path",path_name:"Waiting...",camp_route:"",step_bar:{value:0}})):await e.action.setTitle("JGL Path\nWaiting...")}onWillDisappear(e){this.dialStates.delete(e.action.id),0===this.actions.length&&(this.stopPolling(),this.resetState())}async onKeyDown(e){const t=this.getDialState(e.action.id);this.currentPaths.length>0&&(t.pathIndex=(t.pathIndex+1)%this.currentPaths.length,t.stepIndex=0),await this.updateAll()}async onDialRotate(e){const t=this.getDialState(e.action.id);if(0===this.currentPaths.length)return;const a=this.currentPaths[t.pathIndex];a&&(t.stepIndex=(t.stepIndex+e.payload.ticks+100*a.camps.length)%a.camps.length,await this.updateAll())}async onDialUp(e){const t=this.getDialState(e.action.id);this.currentPaths.length>0&&(t.pathIndex=(t.pathIndex+1)%this.currentPaths.length,t.stepIndex=0),await this.updateAll()}async onTouchTap(e){await this.updateAll()}startPolling(){this.pollInterval||(this.updateAll().catch(e=>si.error(`JunglePath poll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>si.error(`JunglePath poll error: ${e}`)),4e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null),this.dialStates.clear()}getDialState(e){let t=this.dialStates.get(e);return t||(t={pathIndex:0,stepIndex:0},this.dialStates.set(e,t)),t}async updateAll(){await this.detectState(),this.resolvePaths();for(const e of this.actions){const t=await e.getSettings(),a=this.getDialState(e.id);this.currentPaths.length>0&&(a.pathIndex=a.pathIndex%this.currentPaths.length);const i=this.currentPaths[a.pathIndex];if(!this.currentChampAlias||0===this.currentPaths.length){e.isDial()?await e.setFeedback({champ_icon:"",title:"Jungle Path",path_name:ft.isConnected()?"Pick a JGL champ":"Offline",camp_route:"",step_bar:{value:0}}):(await e.setImage(""),await e.setTitle(ft.isConnected()?"JGL Path\nPick JGL":"JGL Path\nOffline"));continue}const s=t.side&&"auto"!==t.side?t.side:this.currentSide;e.isDial()&&i?await this.renderDial(e,a,i,s):i&&await this.renderKey(e,a,i,s)}}async renderDial(e,t,a,i){if(!e.isDial())return;const s=a.camps[t.stepIndex],n=t.stepIndex+1,r=a.camps.length,o=Math.round(n/r*100),l="gank"!==s?await Gt(s):null,c=await this.getChampIcon(),d=l??c,h="blue"===i?"Blue":"Red",u=this.enemyJunglerName?` vs ${this.enemyJunglerName}`:"",p=`${this.currentChampName}${u}  ${h}`,m=` ${n}/${r}  ${ci(s,i)}`,f=a.camps.map((e,a)=>{const i=ni[e];return a===t.stepIndex?`[${i}]`:i}),g=`${a.shortName}: ${f.join("  ")}`,y=this.currentTip||g,w=this.getBarColor(s);await e.setFeedback({champ_icon:d??"",title:p,path_name:m,camp_route:y,step_bar:{value:o,bar_fill_c:w}})}async renderKey(e,t,a,i){const s=a.camps[t.stepIndex],n="gank"!==s?await Gt(s):null,r=await this.getChampIcon();n?await e.setImage(n):r&&await e.setImage(r);const o=t.stepIndex+1,l=a.camps.length,c=ci(s,i);await e.setTitle(`${a.shortName} ${o}/${l}\n ${c}`)}getBarColor(e){switch(e){case"blue":return"#3498DB";case"red":return"#E74C3C";case"gromp":default:return"#2ECC71";case"wolves":return"#95A5A6";case"raptors":return"#E67E22";case"krugs":return"#8B4513";case"scuttle":return"#1ABC9C";case"gank":return"#F1C40F"}}async detectState(){const e=await vt.getAllData();if(e?.activePlayer)return void await this.detectFromGame();if(!ft.isConnected())return void(this.currentChampAlias||this.resetState());if(St.isTFT()||St.isARAM())return void this.resetState();const t=await yt.getGameflowPhase();"ChampSelect"===t?await this.detectFromChampSelect():"InProgress"===t||"GameStart"===t||"Reconnect"===t?await this.detectFromGame():this.currentChampAlias||this.resetState()}async detectFromChampSelect(){const e=await yt.getChampSelectSession();if(!e)return;const t=e.myTeam.find(t=>t.cellId===e.localPlayerCellId);if(!t)return;if("jungle"!==t.assignedPosition)return void this.resetState();const a=t.championId||t.championPickIntent;if(!a)return;const i=Dt.getChampionByKey(String(a));i&&(this.currentChampAlias=i.id.toLowerCase().replace(/['\s.]/g,""),this.currentChampName=i.name),this.currentSide=e.localPlayerCellId<5?"blue":"red",this.enemyJunglerName="",this.enemyJunglerAlias="",this.enemyJunglerStyle="";const s=e.theirTeam.find(e=>"jungle"===e.assignedPosition);if(s){const e=s.championId||s.championPickIntent;if(e){const t=Dt.getChampionByKey(String(e));if(t){this.enemyJunglerName=t.name,this.enemyJunglerAlias=t.id.toLowerCase().replace(/['\s.]/g,"");const e=li[this.enemyJunglerAlias];this.enemyJunglerStyle=e?.style??""}}}}async detectFromGame(){Dt.isReady()||await Dt.init();const e=await vt.getAllData();if(!e)return;const t=e.activePlayer;if(!t)return;const a=e.allPlayers?.find(e=>e.summonerName===t.summonerName||e.riotIdGameName===t.summonerName);if(!a)return void si.warn("detectFromGame: could not find active player in allPlayers list");const i=(a.summonerSpells?.summonerSpellOne?.displayName??"").toLowerCase(),s=(a.summonerSpells?.summonerSpellTwo?.displayName??"").toLowerCase();if(!(i.includes("smite")||s.includes("smite")||"JUNGLE"===(a.position??"").toUpperCase()))return void(this.currentChampAlias||this.resetState());si.info(`detectFromGame: JGL detected  ${a.championName}, team=${a.team}`);const n=a.championName;if(n){const e=Dt.getChampionByName(n);e?(this.currentChampAlias=e.id.toLowerCase().replace(/['\s.]/g,""),this.currentChampName=e.name):(this.currentChampAlias=n.toLowerCase().replace(/['\s.]/g,""),this.currentChampName=n)}this.currentSide="ORDER"===a.team?"blue":"red";const r=a.team,o=(e.allPlayers?.filter(e=>e.team!==r)??[]).find(e=>{const t=(e.summonerSpells?.summonerSpellOne?.displayName??"").toLowerCase(),a=(e.summonerSpells?.summonerSpellTwo?.displayName??"").toLowerCase();return t.includes("smite")||a.includes("smite")||"JUNGLE"===(e.position??"").toUpperCase()});if(o?.championName){this.enemyJunglerName=o.championName;const e=Dt.getChampionByName(o.championName);if(e){this.enemyJunglerAlias=e.id.toLowerCase().replace(/['\s.]/g,"");const t=li[this.enemyJunglerAlias];this.enemyJunglerStyle=t?.style??""}}}resetState(){this.currentChampAlias="",this.currentChampName="",this.currentPaths=[],this.currentTip="",this.enemyJunglerName="",this.enemyJunglerAlias="",this.enemyJunglerStyle=""}resolvePaths(){if(!this.currentChampAlias)return this.currentPaths=[],void(this.currentTip="");const e=li[this.currentChampAlias];let t,a;if(e?(t=[...e.paths],a=e.tip??""):(t=[...oi.flexible],a="Default paths (champion not in DB)"),this.enemyJunglerStyle){const i=e?.style??"flexible";if("invader"===this.enemyJunglerStyle||"ganker"===this.enemyJunglerStyle)"powerFarmer"===i&&(a=` ${this.enemyJunglerName} invades early! Start away`,t.includes("fiveCampBlue")||t.push("fiveCampBlue"),t.includes("fiveCampRed")||t.push("fiveCampRed"));else if("powerFarmer"===this.enemyJunglerStyle&&"ganker"===i){a=`${this.enemyJunglerName} farms  gank early for lead!`;const e=t.filter(e=>e.startsWith("threeCamp")),i=t.filter(e=>!e.startsWith("threeCamp"));t=[...e,...i]}else"powerFarmer"===this.enemyJunglerStyle&&"invader"===i&&(a=`${this.enemyJunglerName} farms  invade their jungle!`)}this.currentPaths=t.map(e=>ri[e]).filter(e=>!!e),this.currentTip=a}async getChampIcon(){if(!this.currentChampAlias)return null;const e=this.currentChampAlias;for(const t of Dt.getAllChampions()){if(t.id.toLowerCase().replace(/['\s.]/g,"")===e)return Nt(t.key)}return Bt(this.currentChampName)}},t})();const hi=ht.logger.createScope("SkillOrder"),ui=["","Q","W","E","R"],pi={Q:"#3498DB",W:"#2ECC71",E:"#E67E22",R:"#E74C3C"},mi="#C89B3C";let fi=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.skill-order"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"Skill Order",skill_order:"Waiting...",skill_info:"",wr_bar:{value:0}}):e.action.setTitle("Skill\nOrder")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id);t.detailView=!t.detailView,await this.renderAction(e.action,t)}async onDialRotate(e){const t=this.getState(e.action.id),a=Math.max(0,t.priority.length-1);t.selectedIndex=Math.max(0,Math.min(a,t.selectedIndex+(e.payload.ticks>0?1:-1))),await this.renderAction(e.action,t)}async onDialUp(e){const t=this.getState(e.action.id);t.detailView=!t.detailView,await this.renderAction(e.action,t)}async onTouchTap(e){this.getState(e.action.id).lastChampKey="",await this.updateState()}getState(e){let t=this.actionStates.get(e);return t||(t={lastChampKey:"",priority:[],fullOrder:[],selectedIndex:0,detailView:!1},this.actionStates.set(e,t)),t}startPolling(){this.pollInterval||(this.updateState().catch(e=>hi.error(`updateState error: ${e}`)),this.pollInterval=setInterval(()=>this.updateState().catch(e=>hi.error(`updateState error: ${e}`)),3e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateState(){if(0===this.actions.length)return;const e=ft.isConnected()?await yt.getGameflowPhase():null,t=null!==e&&["ChampSelect","GameStart","InProgress","WaitingForStats","Reconnect"].includes(e);if("ChampSelect"!==e){if(!t)for(const e of this.actions){const t=this.getState(e.id);t.lastChampKey&&(t.lastChampKey="",t.priority=[],t.fullOrder=[],t.selectedIndex=0,e.isDial()?await e.setFeedback({title:"Skill Order",skill_order:"Waiting...",skill_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Skill\nOrder")))}return}const a=await yt.getChampSelectSession();if(!a)return;const i=a.localPlayerCellId,s=a.myTeam.find(e=>e.cellId===i);if(!s||s.championId<=0)return;const n=String(s.championId),r=Dt.getChampionByKey(n);if(!r)return;const o=ha.toLolalytics(r.id);for(const e of this.actions){const t=await e.getSettings(),a=this.getState(e.id);if(n===a.lastChampKey&&a.priority.length>0)continue;a.lastChampKey=n,a.selectedIndex=0,a.priority=[],a.fullOrder=[],a.detailView=!1,e.isDial()?await e.setFeedback({title:r.name,skill_order:"Loading...",skill_info:"",wr_bar:{value:0}}):await e.setTitle(`${r.name}\nLoading...`);const i=St.isARAM()?"aram":ha.toLolalyticsLane((t.role&&"auto"!==t.role?t.role:null)??s.assignedPosition??"top");try{const t=await ka.getBuildData(o,i);t&&(a.priority=t.skillPriority,a.fullOrder=t.skillOrder,a.priority.length>0&&hi.info(`Skills for ${r.name} ${i}: ${a.priority[0].order} (${a.priority[0].winRate}% WR)`)),await this.renderAction(e,a)}catch(t){hi.error(`Failed to get skill data: ${t}`),e.isDial()?await e.setFeedback({title:r.name,skill_order:"Error",skill_info:"",wr_bar:{value:0}}):await e.setTitle(`${r.name}\nNo data`)}}}async renderAction(e,t){const a=t.lastChampKey?Dt.getChampionByKey(t.lastChampKey):null,i=a?.name??"?",s=t.priority[t.selectedIndex];if(!s)return void(e.isDial()?await e.setFeedback({title:i,skill_order:"No data",skill_info:"",wr_bar:{value:0}}):(await e.setImage(""),await e.setTitle(`${i}\nNo skill data`)));const n="highest_wr"===s.source?"Best WR":"Popular",r=s.order.split("").join(" > "),o=s.games>=1e3?`${(s.games/1e3).toFixed(1)}k`:`${s.games}`,l=s.winRate>=54?"#2ECC71":s.winRate>=50?"#F1C40F":"#E74C3C";if(e.isDial()){const a=i.length>10?i.slice(0,9)+"":i;await e.setFeedback({title:`${a}  ${n}`,skill_order:t.detailView?this.formatFullOrder(t):r,skill_info:`${s.winRate}% WR  ${s.pickRate}% PR  ${o}`,wr_bar:{value:s.winRate,bar_fill_c:l}})}else{const a=this.composeSkillImage(s,t.detailView?t.fullOrder[t.selectedIndex]:null);a&&await e.setImage(a),await e.setTitle(t.detailView?"":`${i}`)}}formatFullOrder(e){const t=e.fullOrder[e.selectedIndex];if(!t)return"N/A";return String(t.sequence).split("").map(e=>ui[parseInt(e)]||"?").join(" ")}composeSkillImage(e,t){const a=e.order.split("");let i;if(t){const e=String(t.sequence).split(""),a=9,s=14,n=4,r=24,o=2,l=0;let c="";const d=["Q","W","E","R"];for(let e=0;e<15;e++){c+=`<text x="${n+e*(a+l)+a/2}" y="${r-4}" font-size="7" fill="#888" text-anchor="middle" font-family="sans-serif">${e+1}</text>`}for(let t=0;t<4;t++){const i=d[t],h=r+t*(s+o),u=pi[i]??"#FFF";c+=`<text x="${n-1}" y="${h+s-3}" font-size="10" fill="${u}" font-weight="bold" text-anchor="end" font-family="sans-serif">${i}</text>`;for(let t=0;t<e.length&&t<15;t++){const r=n+t*(a+l);ui[parseInt(e[t])]===i?(c+=`<rect x="${r}" y="${h}" width="${a}" height="${s}" rx="2" fill="${u}" opacity="0.85"/>`,c+=`<text x="${r+a/2}" y="${h+s-3}" font-size="8" fill="#FFF" text-anchor="middle" font-weight="bold" font-family="sans-serif"></text>`):c+=`<rect x="${r}" y="${h}" width="${a}" height="${s}" rx="2" fill="#1a1a2e" stroke="#333" stroke-width="0.5"/>`}}c+=`<text x="72" y="${r+4*(s+o)+16}" font-size="11" fill="${mi}" text-anchor="middle" font-family="sans-serif">${t.winRate}% WR</text>`,i=c}else{i=`\n\t\t\t\t<text x="72" y="52" font-size="28" text-anchor="middle" font-family="sans-serif">${a.map(e=>`<tspan fill="${pi[e]??"#FFF"}" font-weight="bold">${e}</tspan>`).join('<tspan fill="#888">  </tspan>')}</text>\n\t\t\t\t<text x="72" y="78" font-size="13" fill="${mi}" text-anchor="middle" font-family="sans-serif">${e.winRate}% WR</text>\n\t\t\t\t<text x="72" y="98" font-size="11" fill="#888" text-anchor="middle" font-family="sans-serif">${e.pickRate}% Pick Rate</text>\n\t\t\t`}const s=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t\t<rect width="144" height="144" rx="14" fill="#0A1428"/>\n\t\t\t<rect x="3" y="3" width="138" height="138" rx="13" fill="none" stroke="${mi}" stroke-width="1.5" opacity="0.4"/>\n\t\t\t${i}\n\t\t</svg>`;return`data:image/svg+xml;base64,${Buffer.from(s).toString("base64")}`}},t})();const gi=ht.logger.createScope("RecallWindow"),yi="#C89B3C",wi="#2ECC71",vi="#3498DB",bi="#F1C40F",Si="#E74C3C",_i="#E67E22",ki=1200;let Ci=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.recall-window"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;onWillAppear(e){return this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"RECALL",status_text:"Waiting...",gold_text:"",gold_bar:{value:0},info_text:""}):e.action.setTitle("Recall\nWindow")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){await this.updateAll()}async onDialRotate(e){const t=await e.action.getSettings(),a=t.goldTarget??1100,i=Math.max(100,a+50*e.payload.ticks);await e.action.setSettings({...t,goldTarget:i}),await this.updateAll()}async onDialUp(e){const t=await e.action.getSettings();await e.action.setSettings({...t,goldTarget:void 0}),await this.updateAll()}async onTouchTap(e){await this.updateAll()}getState(e){let t=this.actionStates.get(e);return t||(t={currentGold:0,targetGold:1100,targetLabel:"Component",goldReady:!1,shouldRecall:!1,timing:{quality:"neutral",reason:"",shortReason:""},goldPerMin:0,etaSeconds:0,gameTime:0,champName:"",lane:"",buildItems:[],goldHistory:[],enemyLanerName:"",enemyDead:!1,componentBreakpoints:[],lastDragonKill:0,lastBaronKill:0,buildItemsLoading:!1},this.actionStates.set(e,t)),t}startPolling(){this.pollInterval||(this.updateAll().catch(e=>gi.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>gi.error(`updateAll error: ${e}`)),1500))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(St.isTFT()){for(const e of this.actions)e.isDial()?await e.setFeedback({title:"RECALL",status_text:"N/A in TFT",gold_text:"",gold_bar:{value:0},info_text:""}):(await e.setImage(""),await e.setTitle("Recall\nN/A TFT"));return}const e=await vt.getAllData();if(!e){for(const e of this.actionStates.values())e.goldHistory=[],e.buildItems=[],e.buildItemsLoading=!1,e.champName="",e.enemyLanerName="",e.componentBreakpoints=[],e.lastDragonKill=0,e.lastBaronKill=0;for(const e of this.actions)e.isDial()?await e.setFeedback({recall_icon:"",title:"RECALL",status_text:"No game",gold_text:"",gold_bar:{value:0},info_text:""}):(await e.setImage(""),await e.setTitle("Recall\nNo game"));return}const t=e.activePlayer,a=t.summonerName,i=e.allPlayers.find(e=>e.riotIdGameName===a||e.summonerName===a);if(!i)return;const s=e.gameData.gameTime,n=t.currentGold,r=i.championName,o=i.team,l=new Set(i.items.map(e=>e.itemID)),c=e.events?.Events??[],d=i.position,h=this.findEnemyLaner(e.allPlayers,o,d);for(const e of this.actions){const t=await e.getSettings(),a=this.getState(e.id);if(a.currentGold=n,a.gameTime=s,a.champName=r,a.lane=d,h?(a.enemyLanerName=h.championName,a.enemyDead=h.isDead):(a.enemyLanerName="",a.enemyDead=!1),this.trackObjectiveEvents(a,c),0===a.buildItems.length&&r&&!a.buildItemsLoading){a.buildItemsLoading=!0;try{const e=St.isARAM()?"aram":Ua.toLolalyticsLane(d),t=Ua.toAlias(r),i=await Ga.getBuild(t,e);i&&i.fullBuild.length>0&&(a.buildItems=i.fullBuild,a.componentBreakpoints=this.buildComponentBreakpoints(i.fullBuild,i.startingItems),gi.info(`Recall: loaded ${a.componentBreakpoints.length} breakpoints for ${r}`))}catch(e){gi.warn(`Failed to load build for recall: ${e}`)}finally{a.buildItemsLoading=!1}}this.updateGoldRate(a,n,s);const{target:i,label:o}=this.findNextTarget(a,l,t);if(a.targetGold=i,a.targetLabel=o,a.goldReady=n>=i,a.timing=this.evaluateTiming(a,s),a.shouldRecall=a.goldReady&&"bad"!==a.timing.quality,a.goldPerMin>0&&!a.goldReady){const e=i-n,t=Math.round(e/a.goldPerMin*60),s=St.isARAM()?4.5:8;a.etaSeconds=t+s}else a.etaSeconds=0;await this.renderAction(e,a)}}findEnemyLaner(e,t,a){const i=e.find(e=>e.team!==t&&e.position===a&&""!==e.position);return i||(e.find(e=>e.team!==t)??null)}trackObjectiveEvents(e,t){for(const a of t)"DragonKill"===a.EventName?e.lastDragonKill=a.EventTime:"BaronKill"===a.EventName&&(e.lastBaronKill=a.EventTime)}evaluateTiming(e,t){const a=St.isARAM(),i=[];if(e.enemyDead&&!a&&i.push({quality:"great",reason:`${e.enemyLanerName} is dead`,shortReason:`${e.enemyLanerName} dead`,priority:10}),!a){const a=this.checkObjectiveTiming(e,t);a&&i.push(a)}if(!a){const e=this.checkCannonTiming(t);e&&i.push(e)}if(e.gameTime>0){const t=this.checkLevelSpike(e);t&&i.push(t)}return 0===i.length?{quality:"neutral",reason:"",shortReason:""}:(i.sort((e,t)=>t.priority-e.priority),i[0])}checkObjectiveTiming(e,t){let a;a=e.lastDragonKill>0?e.lastDragonKill+300:300;const i=a-t;if(i>0&&i<45)return{quality:"bad",reason:`Dragon in ${Math.round(i)}s`,shortReason:`Drake ${Math.round(i)}s`,priority:8};if(t>=1140){let a;a=e.lastBaronKill>0?e.lastBaronKill+360:ki;const i=a-t;if(i>0&&i<45)return{quality:"bad",reason:`Baron in ${Math.round(i)}s`,shortReason:`Baron ${Math.round(i)}s`,priority:9}}if(t<ki){const e=840-t;if(e>0&&e<40)return{quality:"bad",reason:`Herald in ${Math.round(e)}s`,shortReason:`Herald ${Math.round(e)}s`,priority:7}}return null}checkCannonTiming(e){if(e<65)return null;const t=e-65,a=Math.floor(t/30)+1;let i;i=e>=2100?1:e>=1500?2:3;const s=65+30*((a%i===0?a:a+(i-a%i))-1)+15-e;return s>=-5&&s<=20?{quality:"good",reason:"Cannon wave  push & recall",shortReason:"Cannon wave",priority:5}:null}checkLevelSpike(e){return null}buildComponentBreakpoints(e,t){const a=[],i=new Set;if(t.length>0){const e=t.reduce((e,t)=>e+Dt.getItemCost(t),0),i=t.map(e=>Dt.getItemName(e)).join(" + ");e>0&&a.push({gold:e,label:i.length>20?i.slice(0,18)+"":i})}for(const t of e){if(i.has(t))continue;i.add(t);const e=Dt.getItemComponents(t),s=Dt.getItemCost(t);if(e.length>0)for(const t of e){if(i.has(t))continue;const e=Dt.getItemCost(t),s=Dt.getItemName(t);e>=300&&(a.push({gold:e,label:s}),i.add(t))}if(s>0){const e=Dt.getItemName(t);a.push({gold:s,label:e})}}a.sort((e,t)=>e.gold-t.gold);const s=[];for(const e of a)0!==s.length&&s[s.length-1].gold===e.gold||s.push(e);return s}updateGoldRate(e,t,a){if(a<90)return void(e.goldPerMin=0);const i=e.goldHistory[e.goldHistory.length-1];if(!i||a-i.time>=3){e.goldHistory.push({gold:t,time:a});const i=a-60;e.goldHistory=e.goldHistory.filter(e=>e.time>=i)}if(e.goldHistory.length>=2){const t=e.goldHistory[0],i=e.goldHistory[e.goldHistory.length-1];if(i.time-t.time>5){let s=1/0,n=t.time;for(const t of e.goldHistory)t.gold<s&&(s=t.gold,n=t.time);const r=i.time-n;r>10&&i.gold>s?e.goldPerMin=(i.gold-s)/r*60:e.goldPerMin=a<600?250:320}}}findNextTarget(e,t,a){if(a.goldTarget&&a.goldTarget>0)return{target:a.goldTarget,label:`${a.goldTarget}g target`};if(e.componentBreakpoints.length>0){const t=e.componentBreakpoints.filter(e=>!0),a=t.filter(t=>e.currentGold>=t.gold);if(a.length>0){const e=a[a.length-1];return{target:e.gold,label:e.label}}const i=t.find(t=>t.gold>e.currentGold);if(i)return{target:i.gold,label:i.label}}const i=[{gold:350,label:"Boots"},{gold:875,label:"Component"},{gold:1100,label:"Component+"},{gold:1300,label:"Big Comp"},{gold:2600,label:"Full Item"}];for(const t of i)if(e.currentGold<t.gold)return{target:t.gold,label:t.label};return{target:e.currentGold,label:"Full buy"}}async renderAction(e,t){const a=t.targetGold>0?Math.min(100,Math.round(t.currentGold/t.targetGold*100)):100,i=$i(t.currentGold),s=$i(t.targetGold),n=Ii(t.gameTime);"great"===t.timing.quality||"good"===t.timing.quality||t.timing.quality;const r="great"===t.timing.quality?"":"good"===t.timing.quality?"":"bad"===t.timing.quality?"":"",o=t.enemyLanerName?`vs ${t.enemyLanerName}`:"";if(t.shouldRecall){const a=t.timing.reason?`  ${t.timing.shortReason}`:"";if(e.isDial())await e.setFeedback({title:`${t.champName||"RECALL"}  ${n}`,status_text:`RECALL NOW ${r}`,gold_text:`${i}g  ${t.targetLabel}`,gold_bar:{value:100,bar_fill_c:wi},info_text:o?`${o}${a}`:t.timing.reason||"Gold ready!"});else{const a=this.composeKeyImage(t);a&&await e.setImage(a),await e.setTitle("")}}else if(t.goldReady&&"bad"===t.timing.quality)if(e.isDial())await e.setFeedback({title:`${t.champName||"RECALL"}  ${n}`,status_text:`WAIT ${r}`,gold_text:`${i}g   ${t.targetLabel}`,gold_bar:{value:100,bar_fill_c:_i},info_text:t.timing.reason});else{const a=this.composeKeyImage(t);a&&await e.setImage(a),await e.setTitle("")}else{const r=t.etaSeconds>0?`~${Ii(t.etaSeconds)}`:"",o=t.targetGold-t.currentGold,l=a>=80?bi:vi,c=t.timing.reason?`  ${t.timing.shortReason}`:"";if(e.isDial())await e.setFeedback({title:`${t.champName||"RECALL"}  ${n}`,status_text:`Need ${$i(o)}g`,gold_text:`${i}g / ${s}g`,gold_bar:{value:a,bar_fill_c:l},info_text:`${t.targetLabel}${r?`  ${r}`:""}${c}`});else{const a=this.composeKeyImage(t);a&&await e.setImage(a),await e.setTitle("")}}}composeKeyImage(e){const t=40,a=e.targetGold>0?Math.min(1,e.currentGold/e.targetGold):1,i=2*Math.PI*t,s=i*(1-a),n=$i(e.currentGold),r=$i(e.targetGold),o=e.shouldRecall,l=e.goldReady&&"bad"===e.timing.quality;let c,d,h;o?(c=wi,d="NOW",h=wi):l?(c=_i,d="WAIT",h=_i):(c=a>=.8?bi:vi,d=`${Math.round(100*a)}%`,h="#FFF");const u=o||l?28:22;let p="",m="#AAA";"neutral"!==e.timing.quality&&e.timing.shortReason?(p=xi(e.timing.shortReason,12),m="great"===e.timing.quality?wi:"good"===e.timing.quality?vi:"bad"===e.timing.quality?Si:"#AAA"):(p=xi(e.targetLabel,12),e.etaSeconds>0&&!e.goldReady&&(p+=` ${Ii(e.etaSeconds)}`));const f=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t\t<rect width="144" height="144" rx="14" fill="#0A1428"/>\n\t\t\t<rect x="3" y="3" width="138" height="138" rx="12" fill="none" stroke="${yi}" stroke-width="1.5" opacity="0.3"/>\n\n\t\t\t\x3c!-- Progress ring background --\x3e\n\t\t\t<circle cx="72" cy="52" r="40" fill="none" stroke="#333" stroke-width="7"/>\n\t\t\t\x3c!-- Progress ring --\x3e\n\t\t\t<circle cx="72" cy="52" r="40" fill="none" stroke="${c}" stroke-width="7"\n\t\t\t\tstroke-dasharray="${i}" stroke-dashoffset="${s}"\n\t\t\t\tstroke-linecap="round" transform="rotate(-90 72 52)"\n\t\t\t\topacity="0.9"/>\n\n\t\t\t${o?`<circle cx="72" cy="52" r="46" fill="none" stroke="${wi}" stroke-width="2" opacity="0.3"/>`:""}\n\n\t\t\t\x3c!-- Status text inside ring --\x3e\n\t\t\t<text x="72" y="61" font-size="${u}" fill="${h}" text-anchor="middle" font-weight="bold" font-family="sans-serif">${d}</text>\n\n\t\t\t\x3c!-- Gold info --\x3e\n\t\t\t<text x="72" y="116" font-size="18" fill="${yi}" text-anchor="middle" font-weight="700" font-family="sans-serif">${n} / ${r}</text>\n\n\t\t\t\x3c!-- Bottom info --\x3e\n\t\t\t<text x="72" y="136" font-size="14" fill="${m}" text-anchor="middle" font-weight="600" font-family="sans-serif">${g=p,g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}</text>\n\t\t</svg>`;var g;return`data:image/svg+xml;base64,${Buffer.from(f).toString("base64")}`}},t})();function $i(e){return e>=1e4?`${(e/1e3).toFixed(1)}k`:String(Math.round(e))}function Ii(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}function xi(e,t){return e.length>t?e.slice(0,t-1)+"":e}const Ti=ht.logger.createScope("SessionStats"),Ai=["RANKED_SOLO_5x5","RANKED_FLEX_SR"],Di={RANKED_SOLO_5x5:"Solo/Duo",RANKED_FLEX_SR:"Flex"},Ri={IRON:"Iron",BRONZE:"Bronze",SILVER:"Silver",GOLD:"Gold",PLATINUM:"Plat",EMERALD:"Emerald",DIAMOND:"Dia",MASTER:"Master",GRANDMASTER:"GM",CHALLENGER:"Chall"};function Ei(e,t,a){const i={IRON:0,BRONZE:400,SILVER:800,GOLD:1200,PLATINUM:1600,EMERALD:2e3,DIAMOND:2400,MASTER:2800,GRANDMASTER:2900,CHALLENGER:3e3}[e]??0;return i>=2800?i+a:i+({IV:0,III:100,II:200,I:300}[t]??0)+a}let Pi=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.session-stats"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;getState(e){let t=this.actionStates.get(e);return t||(t={queueIndex:0,lastDisplay:"",baselines:new Map,knownGameIds:new Set,sessionRecord:new Map,streak:new Map,sessionStart:Date.now()},this.actionStates.set(e,t)),t}onWillAppear(e){return this.getState(e.action.id),this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"Session Stats",record_text:"",lp_text:"Loading...",streak_text:"",winrate_bar:{value:0}}):e.action.setTitle("Session\nStats")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){this.resetSession(e.action.id),await e.action.setTitle("Session\nReset!"),await this.updateAll()}async onDialRotate(e){const t=this.getState(e.action.id);t.queueIndex=(t.queueIndex+(e.payload.ticks>0?1:-1)+Ai.length)%Ai.length,t.lastDisplay="",await this.updateAll()}async onDialUp(e){this.resetSession(e.action.id),await this.updateAll()}async onTouchTap(e){await this.updateAll()}resetSession(e){const t=this.getState(e);t.baselines.clear(),t.knownGameIds.clear(),t.sessionRecord.clear(),t.streak.clear(),t.lastDisplay="",t.sessionStart=Date.now(),Ti.info(`Session reset for action ${e}`)}startPolling(){this.pollInterval||(this.updateAll().catch(e=>Ti.error(`updateAll error: ${e}`)),this.pollInterval=setInterval(()=>this.updateAll().catch(e=>Ti.error(`updateAll error: ${e}`)),15e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async updateAll(){if(!ft.isConnected()){for(const e of this.actions)e.isDial()?await e.setFeedback({title:"Session Stats",record_text:"",lp_text:"Offline",streak_text:"",winrate_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Session\nOffline"));return}const e=await yt.getCurrentRankedStats();if(!e){for(const e of this.actions)e.isDial()?await e.setFeedback({title:"Session Stats",record_text:"",lp_text:"No Data",streak_text:"",winrate_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Session\nNo Data"));return}const t=await this.fetchRecentMatches();for(const a of this.actions){const i=this.getState(a.id),s=Ai[i.queueIndex],n=e.queueMap?.[s],r=Di[s]??s;if(!n||!n.tier||""===n.tier||"NONE"===n.tier){a.isDial()?await a.setFeedback({title:r,record_text:"",lp_text:"Unranked",streak_text:"",winrate_bar:{value:0}}):(await a.setImage(""),await a.setTitle(`${r}\nUnranked`));continue}const o=Ei(n.tier,n.division,n.leaguePoints??0);i.baselines.has(s)||(i.baselines.set(s,{tier:n.tier,div:n.division,lp:n.leaguePoints??0,totalLp:o,wins:n.wins??0,losses:n.losses??0}),Ti.info(`Session baseline for ${s}: ${n.tier} ${n.division} ${n.leaguePoints}LP`));const l=i.baselines.get(s),c=(n.wins??0)-l.wins,d=(n.losses??0)-l.losses,h=c+d,u=h>0?Math.round(c/h*100):0,p=o-l.totalLp;let m;m=p>0?`+${p} LP`:p<0?`${p} LP`:"0 LP";const f="RANKED_SOLO_5x5"===s?420:440,g=this.calculateStreak(t,f);let y="";g>0?y=` ${g}W`:g<0&&(y=` ${Math.abs(g)}L`);const w=Ri[n.tier]??n.tier;n.tier;const v=`${s}|${n.tier}|${n.division}|${n.leaguePoints}|${n.wins}|${n.losses}|${g}`;if(v===i.lastDisplay)continue;i.lastDisplay=v;const b=await jt(n.tier);if(a.isDial())await a.setFeedback({title:`${r}  ${w} ${n.division}`,record_text:h>0?`${c}W ${d}L (${u}%)`:"No games yet",lp_text:m,streak_text:y,winrate_bar:{value:h>0?u:50,bar_fill_c:h>0?u>=50?"#2ECC71":"#E74C3C":"#555"},rank_icon:b??""});else{b&&await a.setImage(b);const e=[];h>0?e.push(`${c}W ${d}L`):e.push("No games"),e.push(m),y&&e.push(y),await a.setTitle(e.join("\n"))}}}async fetchRecentMatches(){try{const e=await yt.get("/lol-match-history/v1/products/lol/current-summoner/matches?begIndex=0&endIndex=20");return e?.games?.games??[]}catch(e){return Ti.warn(`Failed to fetch match history: ${e}`),[]}}calculateStreak(e,t){const a=e.filter(e=>e.queueId===t).sort((e,t)=>t.gameCreation-e.gameCreation);if(0===a.length)return 0;const i=a[0].participants?.[0]?.stats?.win;if(void 0===i)return 0;let s=0;for(const e of a){const t=e.participants?.[0]?.stats?.win;if(t!==i)break;s++}return i?s:-s}},t})();const Li=ht.logger.createScope("PostGame"),Ni="#C89B3C",Bi="#2ECC71",Fi="#E74C3C",Oi=["overview","damage","details"];let Mi=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.post-game"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}lastMatchStats=null;lastGameId=0;displayPage="overview";unsubscribeMode=null;pollInterval=null;wasInGame=!1;onWillAppear(e){return this.startListening(),this.lastMatchStats?this.renderAll():e.action.isDial()?e.action.setFeedback({title:"Post-Game",result_text:"",kda_text:"No game yet",stat1_text:"",stat2_text:"",stat_bar:{value:0}}):e.action.setTitle("Post\nGame")}onWillDisappear(e){0===this.actions.length&&this.stopListening()}async onKeyDown(e){await this.fetchLatestMatch(),await this.renderAll()}async onDialRotate(e){const t=(Oi.indexOf(this.displayPage)+(e.payload.ticks>0?1:-1)+Oi.length)%Oi.length;this.displayPage=Oi[t],await this.renderAll()}async onTouchTap(e){await this.fetchLatestMatch(),await this.renderAll()}startListening(){this.unsubscribeMode||(this.unsubscribeMode=St.onChange((e,t)=>{"InProgress"===t&&(this.wasInGame=!0),!this.wasInGame||"EndOfGame"!==t&&"PreEndOfGame"!==t||(this.wasInGame=!1,setTimeout(()=>{this.fetchLatestMatch().then(()=>this.renderAll()).catch(e=>Li.error(`Post-game fetch error: ${e}`))},3e3))})),this.pollInterval||(this.pollInterval=setInterval(()=>{const e=St.getPhase();this.lastMatchStats||"EndOfGame"!==e&&"Lobby"!==e||this.fetchLatestMatch().then(()=>this.renderAll()).catch(e=>Li.error(`Post-game poll error: ${e}`))},3e4))}stopListening(){this.unsubscribeMode&&(this.unsubscribeMode(),this.unsubscribeMode=null),this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async fetchLatestMatch(){if(ft.isConnected())try{const e=await yt.get("/lol-match-history/v1/products/lol/current-summoner/matches?begIndex=0&endIndex=1"),t=e?.games?.games;if(!t||0===t.length)return void Li.debug("No recent matches in history");const a=t[0];if(a.gameId===this.lastGameId)return;const i=a.participants?.[0],s=i?.stats;if(!s)return void Li.warn("No participant stats in match history entry");const n=i.championId,r=Dt.getChampionByKey(String(n));this.lastMatchStats={win:s.win,championName:r?.name??`Champ ${n}`,kills:s.kills??0,deaths:s.deaths??0,assists:s.assists??0,cs:(s.totalMinionsKilled??0)+(s.neutralMinionsKilled??0),goldEarned:s.goldEarned??0,totalDamageDealt:s.totalDamageDealtToChampions??0,visionScore:s.visionScore??0,gameDuration:a.gameDuration??0,gameMode:a.gameMode??"",queueId:a.queueId??0,gameId:a.gameId},this.lastGameId=a.gameId,this.displayPage="overview",Li.info(`Post-game: ${this.lastMatchStats.win?"WIN":"LOSS"} as ${this.lastMatchStats.championName} (${this.lastMatchStats.kills}/${this.lastMatchStats.deaths}/${this.lastMatchStats.assists}) ${Math.round(this.lastMatchStats.gameDuration/60)}min`)}catch(e){Li.error(`Failed to fetch match history: ${e}`)}}async renderAll(){for(const e of this.actions)await this.renderAction(e)}async renderAction(e){const t=this.lastMatchStats;if(!t)return void(e.isDial()?await e.setFeedback({title:"Post-Game",result_text:"",kda_text:"No game yet",stat1_text:"",stat2_text:"",stat_bar:{value:0}}):(await e.setImage(""),await e.setTitle("Post\nGame")));const a=t.deaths>0?((t.kills+t.assists)/t.deaths).toFixed(1):"Perfect",i=`${t.kills}/${t.deaths}/${t.assists}`,s=t.gameDuration>0?(t.cs/(t.gameDuration/60)).toFixed(1):"0",n=Math.round(t.gameDuration/60),r=(t.goldEarned/1e3).toFixed(1),o=(t.totalDamageDealt/1e3).toFixed(1),l=t.win?Bi:Fi,c=t.win?"VICTORY":"DEFEAT";if(e.isDial())switch(this.displayPage){case"overview":await e.setFeedback({title:`${t.championName}  ${n}min`,result_text:{value:c,color:l},kda_text:{value:`${i}  (${a} KDA)`,color:"#FFF"},stat1_text:{value:`${t.cs} CS (${s}/min)`,color:"#AAA"},stat2_text:{value:`${r}k gold  ${t.visionScore} vision`,color:Ni},stat_bar:{value:Math.min(100,Math.round((t.kills+t.assists)/Math.max(1,t.deaths)*20)),bar_fill_c:l}});break;case"damage":await e.setFeedback({title:`${t.championName}  Damage`,result_text:{value:c,color:l},kda_text:{value:`${o}k damage to champs`,color:"#FFF"},stat1_text:{value:`${r}k gold earned`,color:Ni},stat2_text:{value:`${i}  (${a} KDA)`,color:"#AAA"},stat_bar:{value:Math.min(100,Math.round(t.totalDamageDealt/500)),bar_fill_c:"#3498DB"}});break;case"details":await e.setFeedback({title:`${t.championName}  Details`,result_text:{value:c,color:l},kda_text:{value:`${t.cs} CS (${s}/min)`,color:"#FFF"},stat1_text:{value:`Vision: ${t.visionScore}`,color:"#AAA"},stat2_text:{value:`Game: ${n}min`,color:"#AAA"},stat_bar:{value:Math.min(100,Math.round(3*t.visionScore)),bar_fill_c:"#9B59B6"}})}else{const a=this.composeKeyImage(t);a&&await e.setImage(a),await e.setTitle("")}}composeKeyImage(e){const t=e.deaths>0?((e.kills+e.assists)/e.deaths).toFixed(1):"Perfect",a=`${e.kills}/${e.deaths}/${e.assists}`,i=e.gameDuration>0?(e.cs/(e.gameDuration/60)).toFixed(1):"0",s=Math.round(e.gameDuration/60),n=(e.goldEarned/1e3).toFixed(1),r=e.win?Bi:Fi,o=e.win?"VICTORY":"DEFEAT",l=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t\t<rect width="144" height="144" rx="14" fill="#0A1428"/>\n\t\t\t<rect x="3" y="3" width="138" height="138" rx="12" fill="none" stroke="${r}" stroke-width="2" opacity="0.4"/>\n\n\t\t\t\x3c!-- Result banner --\x3e\n\t\t\t<rect x="10" y="8" width="124" height="28" rx="6" fill="${e.win?"rgba(46,204,113,0.15)":"rgba(231,76,60,0.15)"}"/>\n\t\t\t<text x="72" y="28" font-size="20" fill="${r}" text-anchor="middle" font-weight="bold" font-family="sans-serif">${o}</text>\n\n\t\t\t\x3c!-- Champion name --\x3e\n\t\t\t<text x="72" y="52" font-size="13" fill="${Ni}" text-anchor="middle" font-weight="600" font-family="sans-serif">${function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}((c=e.championName,d=14,c.length>d?c.slice(0,d-1)+"":c))}  ${s}m</text>\n\n\t\t\t\x3c!-- KDA --\x3e\n\t\t\t<text x="72" y="76" font-size="22" fill="#FFF" text-anchor="middle" font-weight="bold" font-family="sans-serif">${a}</text>\n\t\t\t<text x="72" y="94" font-size="13" fill="#AAA" text-anchor="middle" font-family="sans-serif">${t} KDA</text>\n\n\t\t\t\x3c!-- Stats row --\x3e\n\t\t\t<text x="72" y="116" font-size="12" fill="#AAA" text-anchor="middle" font-family="sans-serif">${e.cs} CS (${i}/m)  ${n}k gold</text>\n\n\t\t\t\x3c!-- Vision --\x3e\n\t\t\t<text x="72" y="134" font-size="11" fill="#888" text-anchor="middle" font-family="sans-serif">Vision ${e.visionScore}</text>\n\t\t</svg>`;var c,d;return`data:image/svg+xml;base64,${Buffer.from(l).toString("base64")}`}},t})();const Ui=ht.logger.createScope("TftComps"),Gi={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml"};let ji=[],Wi=0,Ki=!1;async function Vi(){if(ji.length>0&&Date.now()-Wi<72e5)return ji;if(Ki){for(let e=0;e<30&&(await new Promise(e=>setTimeout(e,500)),Ki);e++);return ji}Ki=!0;try{Ui.info("Fetching TFT meta comps from tftactics.gg...");const e=await fetch("https://tftactics.gg/tierlist/team-comps",{headers:Gi});if(!e.ok)return Ui.warn(`TFT comps fetch failed: ${e.status}`),ji;const t=function(e){const t=[];e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();const a=e.split(/Copy Team Code/i);for(const e of a){if(e.length<50)continue;const a=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),i=a.match(/([]?\s*[NEW\s]*)?\b([SABN])\s*([A-Z][a-zA-Z &']+?)(?:\s*(?:Fast|Slow|Standard|lvl|Augment|Emblem))/);if(!i)continue;const s=a.includes("")?"up":a.includes("")?"down":a.includes("NEW")?"new":"stable",n=i[2];let r=i[3].trim();if(r=r.replace(/\s+/g," ").trim(),r.length<3||r.length>40)continue;const o=a.match(/(Fast\s+\d+|Slow\s+Roll\s*\(\d+\)|Standard|lvl\s+\d+)/i),l=o?o[1]:"",c=e.matchAll(/\/champions\/([a-z_&]+)\/?/gi),d=new Set,h=[];for(const t of c){const i=t[1].replace(/_/g," ").replace(/&/g," & ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");if(d.has(i))continue;d.add(i);const s=a.includes(` ${i}`),n=qi(e,t[1]);h.push({name:i,items:n,threeStarred:s})}h.length<3||t.push({tier:n,name:r,playstyle:l,trend:s,champions:h})}const i=new Set,s=[];for(const e of t){const t=e.name.toLowerCase();i.has(t)||(i.add(t),s.push(e))}return s}(await e.text());return t.length>0?(ji=t,Wi=Date.now(),Ui.info(`Parsed ${t.length} TFT meta comps (S: ${t.filter(e=>"S"===e.tier).length}, A: ${t.filter(e=>"A"===e.tier).length}, B: ${t.filter(e=>"B"===e.tier).length})`)):Ui.warn("TFT comps parse returned 0 comps  page structure may have changed"),ji}catch(e){return Ui.error(`TFT comps fetch error: ${e}`),ji}finally{Ki=!1}}function qi(e,t){const a=e.split(new RegExp(`/champions/${t}/?`,"i"));if(a.length<2)return[];const i=a[1].substring(0,300),s=[],n=["Bloodthirster","Deathblade","Giant Slayer","Guinsoo's Rageblade","Hand of Justice","Hextech Gunblade","Infinity Edge","Last Whisper","Nashor's Tooth","Quicksilver","Rabadon's Deathcap","Spear of Shojin","Statikk Shiv","Titan's Resolve","Archangel's Staff","Blue Buff","Bramble Vest","Dragon's Claw","Edge of Night","Evenshroud","Gargoyle Stoneplate","Ionic Spark","Morellonomicon","Redemption","Shroud of Stillness","Spark","Sunfire Cape","Warmog's Armor","Jeweled Gauntlet","Crownguard","Adaptive Helm","Red Buff","Spirit Visage","Sterak's Gage","Striker's Flail","Void Staff","Kraken's Fury"];for(const e of n)if(i.includes(e)&&(s.push(e),s.length>=3))break;return s}const zi=ht.logger.createScope("TftComp"),Hi="#C89B3C",Ji={S:"#FF7F50",A:"#2ECC71",B:"#3498DB",N:"#95A5A6"},Yi=["ALL","S","A","B"];let Qi=(()=>{let e,t,a=[lt({UUID:"com.desstroct.lol-api.tft-comp"})],i=[],s=ct;return class extends s{static{t=this}static{const n="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ut(null,e={value:t},a,{kind:"class",name:t.name,metadata:n},null,i),t=e.value,n&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:n}),pt(t,i)}pollInterval=null;actionStates=new Map;lastComps=[];dataLoaded=!1;onWillAppear(e){const t=e.payload.settings.tierFilter??"ALL";return this.getState(e.action.id,t),this.startPolling(),e.action.isDial()?e.action.setFeedback({title:"TFT Meta Comps",comp_name:"Loading...",comp_info:"",champ_list:"",tier_bar:{value:0}}):e.action.setTitle("TFT\nComps")}onWillDisappear(e){this.actionStates.delete(e.action.id),0===this.actions.length&&this.stopPolling()}async onKeyDown(e){const t=this.getState(e.action.id,e.payload.settings.tierFilter),a=this.getFilteredComps(t.tierFilter);a.length>0&&(t.compIndex=(t.compIndex+1)%a.length),await this.renderAll()}async onDialRotate(e){const t=this.getState(e.action.id,e.payload.settings.tierFilter),a=this.getFilteredComps(t.tierFilter);a.length>0&&(t.compIndex=(t.compIndex+e.payload.ticks+100*a.length)%a.length),await this.renderAll()}async onDialUp(e){const t=this.getState(e.action.id,e.payload.settings.tierFilter),a=Yi.indexOf(t.tierFilter);t.tierFilter=Yi[(a+1)%Yi.length],t.compIndex=0,await this.renderAll()}async onTouchTap(e){ji=[],Wi=0,this.dataLoaded=!1,await this.fetchComps(),await this.renderAll()}getState(e,t){let a=this.actionStates.get(e);return a||(a={compIndex:0,tierFilter:t??"ALL"},this.actionStates.set(e,a)),a}getFilteredComps(e){return"ALL"===e?this.lastComps:this.lastComps.filter(t=>t.tier===e)}startPolling(){this.pollInterval||(this.fetchComps().then(()=>this.renderAll()).catch(e=>zi.error(`TFT fetch error: ${e}`)),this.pollInterval=setInterval(()=>{this.fetchComps().then(()=>this.renderAll()).catch(e=>zi.error(`TFT poll error: ${e}`))},18e5))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}async fetchComps(){const e=await Vi();e.length>0&&(this.lastComps=e,this.dataLoaded=!0)}async renderAll(){for(const e of this.actions)await this.renderAction(e)}async renderAction(e){const t=this.getState(e.id),a=this.getFilteredComps(t.tierFilter);if(!this.dataLoaded||0===a.length)return void(e.isDial()?await e.setFeedback({title:`TFT Comps  ${t.tierFilter}`,comp_name:this.dataLoaded?"No comps found":"Loading...",comp_info:"",champ_list:"",tier_bar:{value:0}}):(await e.setImage(""),await e.setTitle(this.dataLoaded?"TFT\nNo comps":"TFT\nLoading...")));const i=a[t.compIndex%a.length],s=Ji[i.tier]??"#AAA",n="up"===i.trend?"":"down"===i.trend?"":"new"===i.trend?"":"",r=i.champions.slice(0,5).map(e=>`${e.threeStarred?"":""}${Xi(e.name)}`).join(" ");i.champions.map(e=>{const t=e.threeStarred?"":"",a=e.items.length>0?` (${e.items.map(Zi).join(",")})`:"";return`${t}${e.name}${a}`}).join("  ");const o=i.champions.filter(e=>e.items.length>0).slice(0,2).map(e=>`${Xi(e.name)}: ${e.items.map(Zi).join("+")}`).join(" | ");if(e.isDial()){const l="S"===i.tier?95:"A"===i.tier?65:"B"===i.tier?35:15;await e.setFeedback({title:{value:`${n} [${i.tier}] ${i.name}`,color:s},comp_name:{value:`${i.playstyle}  ${t.compIndex+1}/${a.length}`,color:"#FFF"},comp_info:{value:o||r,color:"#AAA"},champ_list:{value:r,color:Hi},tier_bar:{value:l,bar_fill_c:s}})}else{const s=this.composeKeyImage(i,t.compIndex+1,a.length,t.tierFilter);s&&await e.setImage(s),await e.setTitle("")}}composeKeyImage(e,t,a,i){const s=Ji[e.tier]??"#AAA",n="up"===e.trend?"":"down"===e.trend?"":"",r=e.champions.slice(0,4).map(e=>(e.threeStarred?"":"")+Xi(e.name)).join(" "),o=e.champions.length>4?e.champions.slice(4,8).map(e=>(e.threeStarred?"":"")+Xi(e.name)).join(" "):"",l=e.champions.find(e=>e.items.length>0),c=l?`${Xi(l.name)}: ${l.items.map(Zi).join("+")}`:"",d=`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144">\n\t\t\t<rect width="144" height="144" rx="14" fill="#0A1428"/>\n\t\t\t<rect x="3" y="3" width="138" height="138" rx="12" fill="none" stroke="${s}" stroke-width="2" opacity="0.5"/>\n\n\t\t\t\x3c!-- Tier badge --\x3e\n\t\t\t<rect x="10" y="7" width="30" height="22" rx="5" fill="${s}" opacity="0.9"/>\n\t\t\t<text x="25" y="24" font-size="16" fill="#FFF" text-anchor="middle" font-weight="bold" font-family="sans-serif">${ts(e.tier)}</text>\n\n\t\t\t\x3c!-- Trend + index --\x3e\n\t\t\t<text x="132" y="23" font-size="11" fill="#888" text-anchor="end" font-family="sans-serif">${ts(n)} ${t}/${a}</text>\n\n\t\t\t\x3c!-- Comp name --\x3e\n\t\t\t<text x="72" y="48" font-size="14" fill="${s}" text-anchor="middle" font-weight="bold" font-family="sans-serif">${ts(es(e.name,16))}</text>\n\n\t\t\t\x3c!-- Playstyle --\x3e\n\t\t\t<text x="72" y="65" font-size="11" fill="#AAA" text-anchor="middle" font-family="sans-serif">${ts(e.playstyle||"Standard")}</text>\n\n\t\t\t\x3c!-- Champions line 1 --\x3e\n\t\t\t<text x="72" y="86" font-size="11" fill="${Hi}" text-anchor="middle" font-weight="600" font-family="sans-serif">${ts(es(r,22))}</text>\n\n\t\t\t\x3c!-- Champions line 2 --\x3e\n\t\t\t<text x="72" y="102" font-size="11" fill="${Hi}" text-anchor="middle" font-weight="600" font-family="sans-serif">${ts(es(o,22))}</text>\n\n\t\t\t\x3c!-- Carry items --\x3e\n\t\t\t<text x="72" y="122" font-size="10" fill="#AAA" text-anchor="middle" font-family="sans-serif">${ts(es(c,24))}</text>\n\n\t\t\t\x3c!-- Filter indicator --\x3e\n\t\t\t<text x="72" y="138" font-size="9" fill="#666" text-anchor="middle" font-family="sans-serif">Filter: ${i}</text>\n\t\t</svg>`;return`data:image/svg+xml;base64,${Buffer.from(d).toString("base64")}`}},t})();function Xi(e){if(e.includes("&")){return e.split("&").map(e=>e.trim()).map(e=>e.slice(0,3)).join("&")}const t=e.split(" ");if(t.length>=2){return t[0].charAt(0).toUpperCase()+t[1].charAt(0).toUpperCase()}return e.length>5?e.slice(0,4):e}function Zi(e){return{Bloodthirster:"BT",Deathblade:"DB","Giant Slayer":"GS","Guinsoo's Rageblade":"GRB","Hand of Justice":"HoJ","Hextech Gunblade":"HGB","Infinity Edge":"IE","Last Whisper":"LW","Nashor's Tooth":"NT",Quicksilver:"QSS","Rabadon's Deathcap":"Rab","Spear of Shojin":"SoS","Statikk Shiv":"SS","Titan's Resolve":"TR","Archangel's Staff":"AA","Blue Buff":"BB","Bramble Vest":"BV","Dragon's Claw":"DC","Edge of Night":"EoN",Evenshroud:"ES","Gargoyle Stoneplate":"GS","Ionic Spark":"IS",Morellonomicon:"Mor","Sunfire Cape":"SFC","Warmog's Armor":"WA","Jeweled Gauntlet":"JG",Crownguard:"CG","Adaptive Helm":"AH","Red Buff":"RB","Spirit Visage":"SV","Sterak's Gage":"SG","Striker's Flail":"SF","Void Staff":"VS","Kraken's Fury":"KF"}[e]??e.split(" ").map(e=>e[0]).join("")}function es(e,t){return e.length>t?e.slice(0,t-1)+"":e}function ts(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}for(const e of[process.stdout,process.stderr])e?.on?.("error",e=>{if("EPIPE"!==e.code&&"ERR_STREAM_DESTROYED"!==e.code)throw e});ht.logger.setLevel("info");const as=ht.logger.createScope("Plugin");process.on("uncaughtException",e=>{if("EPIPE"!==e.code&&"ERR_STREAM_DESTROYED"!==e.code)try{as.error(`Uncaught exception: ${e.message}\n${e.stack}`)}catch{}}),process.on("unhandledRejection",e=>{try{as.error(`Unhandled rejection: ${e}`)}catch{}}),ht.actions.registerAction(new It),ht.actions.registerAction(new Jt),ht.actions.registerAction(new Qt),ht.actions.registerAction(new Zt),ht.actions.registerAction(new ma),ht.actions.registerAction(new va),ht.actions.registerAction(new Oa),ht.actions.registerAction(new Ka),ht.actions.registerAction(new Ha),ht.actions.registerAction(new Ya),ht.actions.registerAction(new ai),ht.actions.registerAction(new di),ht.actions.registerAction(new fi),ht.actions.registerAction(new Ci),ht.actions.registerAction(new Pi),ht.actions.registerAction(new Mi),ht.actions.registerAction(new Qi),ht.connect().then(()=>{(async function(){as.info("LoL Companion plugin starting...");for(let e=1;e<=3&&(await Dt.init(),!Dt.isReady()&&3!==e);e++)as.warn(`DataDragon init attempt ${e} may have failed, retrying in ${2*e}s...`),await new Promise(t=>setTimeout(t,2e3*e));ft.startPolling(3e3),St.start(),ft.onConnectionChange(e=>{e?as.info(`League Client connected (port ${e.port})`):as.info("League Client disconnected")}),as.info("LoL Companion plugin initialized")})().catch(e=>as.error(`Init failed: ${e}`))});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            

Error: Failed to read manifest.json as the file does not exist.
    at T.<anonymous> (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:57706)
    at get value (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:4772)
    at T.<anonymous> (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:64498)
    at get value (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:4772)
    at Le.registerAction (file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:66035)
    at file:///C:/Users/guigu/lol-api/com.desstroct.lol-api.sdPlugin/bin/plugin.js:1:212800
    at ModuleJobSync.runSync (node:internal/modules/esm/module_job:454:37)
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:435:47)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1537:24)
    at Module._compile (node:internal/modules/cjs/loader:1688:5)
